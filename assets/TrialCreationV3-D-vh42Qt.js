import{r as U,c as R,a as Y,d as ve,i as Q,n as oe,o as fe,w as G,j as k,aa as ne,y as z,ab as ge,b as u,k as e,v as E,t as $,z as _,ac as ye,af as _e,F as X,A as ee,m as v,x as O,D as S,at as ue,_ as Z,au as de,R as Ce,P as ae,a4 as be,q as H,L as he,p as ke,av as $e,aw as we,u as Te,Y as Ie,ax as Se,ak as Pe,ay as xe,az as De,X as Ve,M as Me,B as se}from"./index-yGRnnLgY.js";import{u as Oe}from"./useV4Templates-BunOJwpL.js";import{a as Ae}from"./useV4VariableLists--34ihzau.js";import{u as pe}from"./useV4Models-BP9zM3Me.js";import{u as ce,a as Ne,b as Le,F as ze,C as Ee}from"./useV4TrialCommands-DqPP7A3F.js";import{G as Re}from"./GenericModelSelectorModalV3-B0gWZw5f.js";import{S as me}from"./SaveOutlined-36-mhsH9.js";import"./useV4LiveQuery-DsjyWZb5.js";import"./useV4ProviderParameters-C1v91Kem.js";function je(W){const{templates:I}=Oe(),{variableLists:i}=Ae(),{enabledModels:w}=pe(),{runningTrials:c}=ce(),T=Le(),{createTrial:f}=Ne(),o=U(null),h=U(""),x=U(""),V=U(1),P=U([]),N=U(!1),g=U(!1),s=R(()=>I.value||[]),A=R(()=>[]),D=R(()=>{var b,B;if(!o.value)return 0;if(o.value.type==="template"){const L=o.value;if(!L.variables)return 1;let q=1;for(const[,J]of Object.entries(L.variables))if(J.type==="value"&&J.values)q*=J.values.length;else if(J.type==="list"&&J.listId){const K=i.value.find(te=>te.id===J.listId);K&&(K.category==="simple"?q*=((b=K.values)==null?void 0:b.length)||0:K.category==="attributed"?q*=((B=K.items)==null?void 0:B.length)||0:K.category==="tabular"&&(q*=K.itemCount||0))}return q}else return 0}),j=R(()=>D.value*P.value.length*V.value),p=R(()=>{let b=0;for(const B of P.value){const L=l(B);b+=L*D.value*V.value}return b}),d=R(()=>o.value!==null&&P.value.length>0&&h.value.trim()!=="");function t(b){o.value=b,h.value=a(b)}function a(b){const B=b||o.value;if(!B)return"New Trial";const L=new Date().toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return`${B.name} - ${L}`}function l(b){var te,le;if(!o.value)return 0;const B=w.value.find(re=>re.provider===b.provider&&re.modelId===b.modelId);if(!(B!=null&&B.capabilities))return 0;const L=r(),q=((te=b.parameters)==null?void 0:te.max_tokens)||((le=b.parameters)==null?void 0:le.maxTokens)||256,J=(B.capabilities.inputCostPerToken||0)*L,K=(B.capabilities.outputCostPerToken||0)*q;return J+K}function r(){return o.value&&o.value.type==="template"?150:100}function y(b){P.value.push(b)}function C(b){P.value.splice(b,1)}async function n(){if(d.value){N.value=!0;try{const b=JSON.parse(JSON.stringify(o.value)),B={name:h.value,description:"",type:b.type,configurations:JSON.parse(JSON.stringify(P.value)),repeatCount:V.value,templateConfig:b.type==="template"?{template:b.template,variables:b.variables,outputType:b.outputType,extractPattern:b.extractPattern,refusalWords:b.refusalWords,rejectRefusalWords:b.rejectRefusalWords}:void 0,spreadsheetConfig:b.type==="spreadsheet"?{promptPattern:b.promptPattern,datasetId:b.datasetId}:void 0},L=await f(B);if(L.ok)return L.value;throw L.error}finally{N.value=!1}}}async function m(){const b=await n();if(b)return c.value.length>0?{trialId:b,needsConfirmation:!0,runningTrial:c.value[0]}:await M(b)}async function M(b){Y.info("V4: Creation view starting trial via V4 execution control",b);const B=await T.startTrialWithStreaming(b);if(B.ok){Y.info("V4: Trial started successfully via V4 execution control");const L=B.value.progress$.subscribe({next:J=>{Y.info("V4: Creation view received progress update:",J.type)},error:J=>{Y.error("V4: Creation view stream error:",J)}}),q=B.value.calls$.subscribe({next:J=>{Y.info("V4: Creation view received batch of",J.length,"calls")},error:J=>{Y.error("V4: Creation view calls stream error:",J)}});return Y.info("V4: Creation view subscribed to BOTH streams, execution started, navigating to trials view"),setTimeout(()=>{L.unsubscribe(),q.unsubscribe(),Y.info("V4: Creation view unsubscribed from streams after navigation")},1e3),{trialId:b,needsConfirmation:!1}}else throw B.error}async function F(){var b,B;try{await T.initialize(),Y.info("V4: Execution control initialized in creation view")}catch(L){Y.error("V4: Failed to initialize execution control in creation view:",L)}if(W.value.type==="duplicate"&&W.value.sourceTrialId){const L=await ve.trials.get(W.value.sourceTrialId);if(L){if(h.value=`Copy of ${L.name}`,V.value=L.repeatCount||1,L.configurations&&(P.value=L.configurations.map(q=>{var J;return{name:((J=q.modelSnapshot)==null?void 0:J.displayName)||q.modelId,provider:q.provider,modelId:q.modelId,parameters:q.parameters||{}}})),L.type==="template"&&((b=L.templateConfig)!=null&&b.template)){const q=s.value.find(J=>{var K;return J.template===((K=L.templateConfig)==null?void 0:K.template)});q&&t(q)}else if(L.type==="spreadsheet"&&((B=L.spreadsheetConfig)!=null&&B.datasetId)){const q=A.value.find(J=>{var K;return J.datasetId===((K=L.spreadsheetConfig)==null?void 0:K.datasetId)});q&&t(q)}}}}return{selectedPrompt:o,trialName:h,description:x,repeatCount:V,configurations:P,creating:N,showModelSelector:g,templates:s,spreadsheets:A,variableLists:i,enabledModels:w,runningTrials:c,totalCombinations:D,totalExperiments:j,totalCost:p,canProceed:d,selectPrompt:t,generateTrialName:a,addConfiguration:y,removeConfiguration:C,getConfigCostPerCall:l,createTrialAsDraft:n,createAndStartTrial:m,initialize:F}}const Be={key:0,class:"preview-controls"},Ue={class:"template-name"},Fe={key:0,class:"cycle-info"},Je={key:1,class:"variable-legend"},qe={class:"variable-value"},We=Q({__name:"TemplatePreviewV3",props:{template:{},variableLists:{default:()=>[]},cycling:{type:Boolean,default:!0},cyclingSpeed:{default:1e3},showControls:{type:Boolean,default:!1},displayMode:{default:"block"},showLegend:{type:Boolean,default:!1},maxLines:{default:0}},emits:["update:paused","back-to-select"],setup(W,{emit:I}){const i=W,w=I,c=U(0),T=U(!1);let f=null;const o=["variable-highlight-blue","variable-highlight-green","variable-highlight-purple","variable-highlight-orange","variable-highlight-pink","variable-highlight-teal"],h=R(()=>i.template.type==="template"?i.template.template:i.template.type==="spreadsheet"?i.template.promptPattern:""),x=R(()=>{var y;if(i.template.type==="spreadsheet"){const C=i.variableLists.find(n=>n.id===i.template.datasetId);return(C==null?void 0:C.category)==="tabular"&&((y=C.tabularData)!=null&&y.rows)?C.tabularData.rows.map(n=>{const m={};return Object.keys(n).forEach(M=>{let F=M.replace(/[^a-zA-Z0-9_]/g,"_");/^[a-zA-Z]/.test(F)||(F="col_"+F),F=F.replace(/_+/g,"_").replace(/_+$/,""),m[F]=String(n[M]||"")}),m}):[]}const t=[];if(i.template.variables){for(const[C,n]of Object.entries(i.template.variables))if(n.type==="value"&&n.values)t.push({name:C,values:[...n.values]});else if(n.type==="list"&&n.listId){const m=i.variableLists.find(M=>M.id===n.listId);m&&(m.category==="simple"&&m.values?t.push({name:C,values:[...m.values]}):m.category==="attributed"&&m.items&&t.push({name:C,values:m.items.map(M=>M.value)}))}}if(t.length===0)return[];const a=C=>C.reduce((n,m)=>n.flatMap(M=>m.map(F=>[...M,F])),[[]]),l=t.map(C=>C.values);return a(l).map(C=>{const n={};return t.forEach((m,M)=>{n[m.name]=C[M]}),n})}),V=R(()=>x.value.length),P=R(()=>x.value.length===0?null:x.value[c.value]||x.value[0]),N=R(()=>{const t=h.value;if(!t)return"";const a=P.value;if(!a||Object.keys(a).length===0)return A(t).replace(/\n/g,"<br>");let l=A(t);if(Object.keys(a).sort((y,C)=>C.length-y.length).forEach((y,C)=>{const n=a[y],m=A(n),M=s(C),F=new RegExp(`{{\\s*${D(y)}\\s*}}`,"g");l=l.replace(F,`<span class="${M} variable-value">${m}</span>`)}),l=l.replace(/\n/g,"<br>"),i.maxLines>0){const y=l.split("<br>");y.length>i.maxLines&&(l=y.slice(0,i.maxLines).join("<br>")+'<br><span class="line-clamp-indicator">...</span>')}return l}),g=R(()=>i.displayMode==="inline"&&i.maxLines>0?{display:"-webkit-box","-webkit-line-clamp":i.maxLines,"-webkit-box-orient":"vertical",overflow:"hidden"}:{});function s(t){return o[t%o.length]}function A(t){const a=document.createElement("div");return a.textContent=t,a.innerHTML}function D(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function j(){T.value=!T.value,w("update:paused",T.value)}function p(){!i.cycling||T.value||V.value<=1||(f=setInterval(()=>{c.value=(c.value+1)%V.value},i.cyclingSpeed))}function d(){f&&(clearInterval(f),f=null)}return oe(()=>{i.cycling&&!T.value&&p()}),fe(()=>{d()}),G(()=>T.value,t=>{t||!i.cycling?d():p()}),G(()=>i.cycling,t=>{t?T.value||p():(d(),c.value=0)}),G(()=>i.cyclingSpeed,()=>{i.cycling&&!T.value&&(d(),p())}),G(V,()=>{c.value=0}),(t,a)=>{const l=E("a-button"),r=E("a-tag"),y=ye("dompurify-html");return v(),k("div",{class:ne(["template-preview",[`preview-${t.displayMode}`,{"preview-cycling":t.cycling&&!T.value}]])},[t.showControls?(v(),k("div",Be,[u(l,{type:"link",onClick:a[0]||(a[0]=C=>t.$emit("back-to-select")),class:"back-to-select"},{default:$(()=>[u(S(ue)),a[1]||(a[1]=O(" Back to Select Template "))]),_:1,__:[1]}),e("h3",Ue,_(i.template.name),1),u(l,{onClick:j,size:"small",type:T.value?"default":"primary",disabled:!t.cycling||V.value<=1},{default:$(()=>[O(_(T.value?"Start":"Pause")+" Variable Selection ",1)]),_:1},8,["type","disabled"]),t.cycling&&V.value>1?(v(),k("span",Fe,_(c.value+1)+" / "+_(V.value),1)):z("",!0),u(r,{color:i.template.type==="template"?"blue":"green",class:"source-badge"},{default:$(()=>[O(_(i.template.type==="template"?"Prompt Design":"Spreadsheet Design"),1)]),_:1},8,["color"])])):z("",!0),ge(e("div",{class:"preview-content",style:_e(g.value)},null,4),[[y,N.value,"template"]]),t.showLegend&&P.value&&Object.keys(P.value).length>0?(v(),k("div",Je,[(v(!0),k(X,null,ee(P.value,(C,n,m)=>(v(),k("div",{key:n,class:"legend-item"},[e("span",{class:ne(s(m))},_(n),3),e("span",qe,_(C),1)]))),128))])):z("",!0)],2)}}}),ie=Z(We,[["__scopeId","data-v-136e11b6"]]),Ke={class:"design-selection"},Ye={class:"design-selector","data-testid":"template-design-selector"},He={key:0,class:"no-designs-state"},Ge={class:"no-designs-content"},Qe={key:1,class:"no-designs-state"},Ze={class:"no-designs-content"},Xe={key:2,class:"design-list","data-testid":"design-list"},et=["data-template-id","data-template-name","onClick"],tt={class:"design-header"},at={class:"design-title-section"},st={class:"design-name"},nt={key:0,class:"design-inline-description"},it={class:"design-date"},ot={class:"design-stats"},lt={class:"stat-item"},rt={class:"stat-value"},dt={class:"stat-item"},ut={class:"stat-value"},pt={class:"stat-item"},ct={class:"stat-value"},mt={class:"design-selector","data-testid":"spreadsheet-design-selector"},vt={key:0,class:"no-designs-state"},ft={class:"no-designs-content"},gt={key:1,class:"design-list","data-testid":"design-list"},yt=["data-spreadsheet-id","data-spreadsheet-name","onClick"],_t={class:"design-header"},Ct={class:"design-title-section"},bt={class:"design-name"},ht={key:0,class:"design-inline-description"},kt={class:"design-date"},$t={class:"design-stats"},wt={class:"stat-item"},Tt={class:"stat-value"},It={class:"stat-item"},St={class:"stat-value"},Pt={class:"stat-item"},xt={class:"stat-value"},Dt=Q({__name:"TrialDesignSelectionV3",props:{templates:{},spreadsheets:{},variableLists:{}},emits:["select","create-template","create-spreadsheet"],setup(W){const I=W,i=U("template"),w=U(""),c=U(""),T=R(()=>{if(!w.value)return I.templates;const g=w.value.toLowerCase();return I.templates.filter(s=>s.name.toLowerCase().includes(g)||(s.description||"").toLowerCase().includes(g))}),f=R(()=>{if(!c.value)return I.spreadsheets;const g=c.value.toLowerCase();return I.spreadsheets.filter(s=>s.name.toLowerCase().includes(g)||(s.description||"").toLowerCase().includes(g))});function o(g){const s=typeof g=="string"?new Date(g):g,D=new Date().getTime()-s.getTime(),j=Math.floor(D/(1e3*60*60*24));if(j===0){const p=Math.floor(D/36e5);if(p===0){const d=Math.floor(D/6e4);return d<=1?"just now":`${d} min ago`}return p===1?"1 hour ago":`${p} hours ago`}else return j===1?"yesterday":j<7?`${j} days ago`:s.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function h(g){return g.variables?Object.keys(g.variables).length:0}function x(g){var A,D;if(!g.variables)return 1;let s=1;for(const[,j]of Object.entries(g.variables))if(j.type==="value"&&j.values)s*=j.values.length;else if(j.type==="list"&&j.listId){const p=I.variableLists.find(d=>d.id===j.listId);p&&(p.category==="simple"?s*=((A=p.values)==null?void 0:A.length)||0:p.category==="attributed"?s*=((D=p.items)==null?void 0:D.length)||0:p.category==="tabular"&&(s*=p.itemCount||0))}return s}function V(g){const s=I.variableLists.find(A=>A.id===g.datasetId);return(s==null?void 0:s.itemCount)||0}function P(g){var A;const s=I.variableLists.find(D=>D.id===g.datasetId);return(s==null?void 0:s.category)==="tabular"&&((A=s.tabularData)!=null&&A.columns)?s.tabularData.columns.length:0}function N(){return"~150"}return(g,s)=>{const A=E("a-input"),D=E("a-spin"),j=E("a-button"),p=E("a-tag"),d=E("a-tab-pane"),t=E("a-tabs");return v(),k("div",Ke,[u(t,{activeKey:i.value,"onUpdate:activeKey":s[6]||(s[6]=a=>i.value=a),size:"large"},{default:$(()=>[u(d,{key:"template",tab:"Prompt Designs (one API call per combination)"},{default:$(()=>[e("div",Ye,[u(A,{value:w.value,"onUpdate:value":s[0]||(s[0]=a=>w.value=a),placeholder:"Search prompt designs...",size:"large",class:"design-search","data-testid":"input-template-search",allowClear:""},{prefix:$(()=>[u(S(de))]),_:1},8,["value"]),!g.templates||g.templates.length===0?(v(),k("div",He,[e("div",Ge,[u(D,{size:"large",tip:"Loading templates..."})])])):T.value.length===0?(v(),k("div",Qe,[e("div",Ze,[s[8]||(s[8]=e("p",null,"No prompt designs found",-1)),u(j,{type:"primary",onClick:s[1]||(s[1]=a=>g.$emit("create-template"))},{default:$(()=>[u(S(Ce)),s[7]||(s[7]=O(" Create Prompt Design "))]),_:1,__:[7]})])])):(v(),k("div",Xe,[(v(!0),k(X,null,ee(T.value,a=>(v(),k("div",{key:a.id,class:"design-item","data-testid":"template-item","data-template-id":a.id,"data-template-name":a.name,onClick:l=>g.$emit("select",a)},[e("div",tt,[e("div",at,[e("h4",st,[O(_(a.name)+" ",1),a.description?(v(),k("span",nt,"- "+_(a.description),1)):z("",!0)])]),e("span",it,_(o(a.updated)),1)]),u(ie,{template:a,"variable-lists":g.variableLists,cycling:!0,"show-controls":!1,"display-mode":"inline","max-lines":5,class:"design-preview"},null,8,["template","variable-lists"]),e("div",ot,[u(p,{size:"small",color:"blue",class:"output-type-tag"},{default:$(()=>[O(_(a.outputType||"text"),1)]),_:2},1024),e("span",lt,[e("span",rt,_(h(a)),1),s[9]||(s[9]=e("span",{class:"stat-label"},"vars",-1))]),s[12]||(s[12]=e("span",{class:"stat-divider"},"•",-1)),e("span",dt,[e("span",ut,_(x(a)),1),s[10]||(s[10]=e("span",{class:"stat-label"},"combos",-1))]),s[13]||(s[13]=e("span",{class:"stat-divider"},"•",-1)),e("span",pt,[e("span",ct,_(N(a)),1),s[11]||(s[11]=e("span",{class:"stat-label"},"tokens",-1))])])],8,et))),128)),e("div",{class:"design-item design-item-create","data-testid":"btn-create-design",onClick:s[2]||(s[2]=a=>g.$emit("create-template"))},[u(S(ae),{style:{"font-size":"24px"}}),s[14]||(s[14]=e("span",null,"Create New Design",-1))])]))])]),_:1}),u(d,{key:"spreadsheet",tab:"Spreadsheet Designs (one API call per row)"},{default:$(()=>[e("div",mt,[u(A,{value:c.value,"onUpdate:value":s[3]||(s[3]=a=>c.value=a),placeholder:"Search spreadsheet designs...",size:"large",class:"design-search","data-testid":"input-spreadsheet-search",allowClear:""},{prefix:$(()=>[u(S(de))]),_:1},8,["value"]),f.value.length===0?(v(),k("div",vt,[e("div",ft,[s[16]||(s[16]=e("p",null,"No spreadsheet designs found",-1)),u(j,{type:"primary",onClick:s[4]||(s[4]=a=>g.$emit("create-spreadsheet"))},{default:$(()=>[u(S(ze)),s[15]||(s[15]=O(" Create Spreadsheet Design "))]),_:1,__:[15]})])])):(v(),k("div",gt,[(v(!0),k(X,null,ee(f.value,a=>(v(),k("div",{key:a.id,class:"design-item","data-testid":"spreadsheet-item","data-spreadsheet-id":a.id,"data-spreadsheet-name":a.name,onClick:l=>g.$emit("select",a)},[e("div",_t,[e("div",Ct,[e("h4",bt,[O(_(a.name)+" ",1),a.description?(v(),k("span",ht,"- "+_(a.description),1)):z("",!0)])]),e("span",kt,_(o(a.updated)),1)]),u(ie,{template:a,"variable-lists":g.variableLists,cycling:!0,"show-controls":!1,"display-mode":"inline","max-lines":5,class:"design-preview"},null,8,["template","variable-lists"]),e("div",$t,[u(p,{size:"small",color:"green",class:"output-type-tag"},{default:$(()=>[O(_(a.outputType||"text"),1)]),_:2},1024),e("span",wt,[e("span",Tt,_(V(a)),1),s[17]||(s[17]=e("span",{class:"stat-label"},"rows",-1))]),s[20]||(s[20]=e("span",{class:"stat-divider"},"•",-1)),e("span",It,[e("span",St,_(P(a)),1),s[18]||(s[18]=e("span",{class:"stat-label"},"cols",-1))]),s[21]||(s[21]=e("span",{class:"stat-divider"},"•",-1)),e("span",Pt,[e("span",xt,_(N(a)),1),s[19]||(s[19]=e("span",{class:"stat-label"},"tokens",-1))])])],8,yt))),128)),e("div",{class:"design-item design-item-create","data-testid":"btn-create-spreadsheet",onClick:s[5]||(s[5]=a=>g.$emit("create-spreadsheet"))},[u(S(ae),{style:{"font-size":"24px"}}),s[22]||(s[22]=e("span",null,"Create New Spreadsheet Design",-1))])]))])]),_:1})]),_:1},8,["activeKey"])])}}}),Vt=Z(Dt,[["__scopeId","data-v-0be78869"]]),Mt={class:"trial-metadata-form"},Ot=Q({__name:"TrialMetadataV3",props:{name:{},repeatCount:{default:1},description:{default:""},totalCombinations:{default:0}},emits:["update:name","update:repeatCount","update:description"],setup(W,{emit:I}){const i=W,w=I,c=be({name:i.name,repeatCount:i.repeatCount,description:i.description||""}),T=R(()=>{if(i.totalCombinations>0&&c.repeatCount>1){const o=i.totalCombinations*c.repeatCount;return`Each prompt will be run ${c.repeatCount} times (${o} total calls)`}return"Number of times to run each prompt"});function f(){w("update:name",c.name),w("update:repeatCount",c.repeatCount),w("update:description",c.description)}return G(()=>i.name,o=>{c.name=o}),G(()=>i.repeatCount,o=>{c.repeatCount=o}),G(()=>i.description,o=>{c.description=o||""}),(o,h)=>{const x=E("a-input"),V=E("a-form-item"),P=E("a-col"),N=E("a-input-number"),g=E("a-row"),s=E("a-textarea"),A=E("a-form");return v(),k("div",Mt,[u(A,{layout:"vertical",model:c},{default:$(()=>[u(g,{gutter:24},{default:$(()=>[u(P,{span:18},{default:$(()=>[u(V,{label:"Trial Name",rules:[{required:!0,message:"Please enter a trial name"}]},{default:$(()=>[u(x,{value:c.name,"onUpdate:value":h[0]||(h[0]=D=>c.name=D),size:"large",placeholder:"e.g., GPT-4 Performance Test",onChange:f},null,8,["value"])]),_:1})]),_:1}),u(P,{span:6},{default:$(()=>[u(V,{label:"Repeat Count",help:T.value},{default:$(()=>[u(N,{value:c.repeatCount,"onUpdate:value":h[1]||(h[1]=D=>c.repeatCount=D),min:1,max:100,size:"large",style:{width:"100%"},onChange:f},null,8,["value"])]),_:1},8,["help"])]),_:1})]),_:1}),u(V,{label:"Description (Optional)"},{default:$(()=>[u(s,{value:c.description,"onUpdate:value":h[2]||(h[2]=D=>c.description=D),placeholder:"Add any notes about this trial...",rows:2,onChange:f},null,8,["value"])]),_:1})]),_:1},8,["model"])])}}}),At=Z(Ot,[["__scopeId","data-v-b945eb57"]]),Nt={class:"model-configuration"},Lt={key:0,class:"quick-add-section"},zt={class:"quick-add-models"},Et={class:"provider-name"},Rt={class:"model-name"},jt={key:0,class:"param-info"},Bt={class:"configuration-table"},Ut={class:"table-header"},Ft={style:{display:"inline-flex","align-items":"center",gap:"0"}},Jt={key:0,class:"model-name-cell"},qt={class:"model-name"},Wt={class:"model-id"},Kt={key:1,class:"parameter-tags"},Yt={key:2,class:"cost-cell"},Ht={class:"cost-value"},Gt={key:0,class:"cost-total"},Qt={key:0,class:"cost-summary"},Zt={class:"cost-summary-item"},Xt={class:"cost-summary-item"},ea={class:"total-cost"},ta=Q({__name:"ModelConfigurationV3",props:{configurations:{},totalCombinations:{},repeatCount:{},avgTokens:{default:150}},emits:["add-configuration","remove-configuration"],setup(W,{emit:I}){const i=W,w=I,{models:c}=pe(),{trials:T}=ce(),f=U(!1),o=R(()=>{var C;const t=new Map;if(T.value&&T.value.length>0){const n=T.value.filter(m=>m.status!=="draft").slice(0,10);for(const m of n)if(m.configurations){for(const M of m.configurations){const F=JSON.stringify(M.parameters||{}),b=`${M.provider}-${M.modelId}-${F}`;if(t.has(b)||t.set(b,M),t.size>=15)break}if(t.size>=15)break}}const a=new Set(i.configurations.map(n=>{const m=JSON.stringify(n.parameters||{});return`${n.provider}-${n.modelId}-${m}`})),l=Array.from(t.values()).filter(n=>{var b;const m=JSON.stringify(n.parameters||{}),M=`${n.provider}-${n.modelId}-${m}`;if(a.has(M))return!1;const F=(b=c.value)==null?void 0:b.find(B=>B.provider===n.provider&&B.modelId===n.modelId);return!(!F||!F.enabled)}),r=[{provider:"openai-chat",modelId:"gpt-4o-mini",params:{temperature:0,max_completion_tokens:1e3}},{provider:"openai-chat",modelId:"gpt-4.1-nano",params:{temperature:0,max_completion_tokens:500}},{provider:"anthropic",modelId:"claude-3-5-haiku-latest",params:{temperature:0,max_tokens:1e3}},{provider:"openrouter",modelId:"meta-llama/llama-4-maverick",params:{temperature:.8,max_tokens:2e3}},{provider:"openrouter",modelId:"mistralai/mistral-nemo",params:{temperature:.7,max_tokens:1500}},{provider:"ollama-generate",modelId:"qwen2.5:0.5b",params:{temperature:0,num_predict:500,stream:!1}},{provider:"ollama-generate",modelId:"llama3.2:1b",params:{temperature:0,num_predict:1e3,stream:!1}}],y=[];for(const n of r){const m=JSON.stringify(n.params),M=`${n.provider}-${n.modelId}-${m}`;if(!a.has(M)&&!t.has(M)){const F=(C=c.value)==null?void 0:C.find(b=>b.provider===n.provider&&b.modelId===n.modelId);F&&F.enabled&&y.push({provider:n.provider,modelId:n.modelId,parameters:n.params,providerSnapshot:{},modelSnapshot:F})}}return[...l,...y].slice(0,10)}),h=[{title:"Model",key:"name",width:"35%"},{title:"Parameters",key:"parameters",width:"35%"},{title:"Cost",key:"cost",width:"20%"},{title:"",key:"actions",width:"10%"}],x=R(()=>i.configurations.map((t,a)=>({key:`${t.provider}-${t.modelId}-${a}`,...t,costPerCall:N(t)}))),V=R(()=>i.totalCombinations*i.configurations.length*i.repeatCount),P=R(()=>i.configurations.reduce((t,a)=>{const l=N(a);return t+l*i.totalCombinations*i.repeatCount},0));function N(t){var C,n,m;const a=(C=c.value)==null?void 0:C.find(M=>M.provider===t.provider&&M.modelId===t.modelId);if(!(a!=null&&a.capabilities))return 0;const l=((n=t.parameters)==null?void 0:n.max_tokens)||((m=t.parameters)==null?void 0:m.maxTokens)||256,r=(a.capabilities.inputCostPerToken||0)*i.avgTokens,y=(a.capabilities.outputCostPerToken||0)*l;return r+y}function g(t){return t===0?"0.00":t<.01?"<0.01":t<1?t.toFixed(2):t<10?t.toFixed(1):Math.round(t).toString()}function s(t){const a={},l=["temperature","max_tokens","max_completion_tokens","num_predict","maxTokens","top_p","top_k","reasoning_effort"];for(const r of l)t[r]!==void 0&&t[r]!==null&&(a[r]=t[r]);for(const[r,y]of Object.entries(t))y!=null&&!l.includes(r)&&(a[r]=y);return a}function A(t){return t.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())}function D(t){if(!t||Object.keys(t).length===0)return"";const a=[];return t.temperature!==void 0&&a.push(`T:${t.temperature}`),t.max_tokens!==void 0?a.push(`${t.max_tokens}t`):t.maxTokens!==void 0?a.push(`${t.maxTokens}t`):t.num_predict!==void 0&&a.push(`${t.num_predict}t`),t.top_p!==void 0&&a.push(`p:${t.top_p}`),a.length>0?`(${a.join(", ")})`:""}function j(t){var r,y;const a=ke.validateParameters(t.provider,t.modelId,t.parameters||{});if(!a.valid){Y.error("Quick Add validation failed:",{provider:t.provider,modelId:t.modelId,parameters:t.parameters,errors:a.errors}),alert(`Cannot add model configuration: ${((r=a.errors)==null?void 0:r.join(", "))||"Invalid parameters"}`);return}const l={name:((y=t.modelSnapshot)==null?void 0:y.displayName)||t.modelId,provider:t.provider,modelId:t.modelId,parameters:{...t.parameters}};w("add-configuration",l)}function p(t){w("add-configuration",t),f.value=!1}function d(t){w("remove-configuration",t)}return(t,a)=>{const l=E("a-button"),r=E("a-tooltip"),y=E("a-tag"),C=E("a-table");return v(),k("div",Nt,[o.value.length>0?(v(),k("div",Lt,[a[2]||(a[2]=e("h4",null,"Quick Add Recent Models",-1)),e("div",zt,[(v(!0),k(X,null,ee(o.value,n=>{var m;return v(),H(l,{key:`${n.provider}-${n.modelId}-${JSON.stringify(n.parameters)}`,size:"small",onClick:M=>j(n),class:"quick-add-button",title:`Add ${((m=n.modelSnapshot)==null?void 0:m.displayName)||n.modelId} (${n.provider}) with recent parameters`},{default:$(()=>{var M;return[u(S(ae)),e("span",Et,_(n.provider)+"/",1),e("span",Rt,_(((M=n.modelSnapshot)==null?void 0:M.displayName)||n.modelId),1),D(n.parameters)?(v(),k("span",jt,_(D(n.parameters)),1)):z("",!0)]}),_:2},1032,["onClick","title"])}),128))])])):z("",!0),e("div",Bt,[e("div",Ut,[e("h3",Ft,[u(r,{placement:"topLeft"},{title:$(()=>a[3]||(a[3]=[O(" Add models to test with your template and configure their parameters like temperature, max tokens, etc. ")])),default:$(()=>[a[4]||(a[4]=e("span",null,"Model Configurations to Test",-1))]),_:1,__:[4]}),a[6]||(a[6]=e("span",null,"  ",-1)),u(l,{type:"primary",size:"small",onClick:a[0]||(a[0]=n=>f.value=!0)},{default:$(()=>[u(S(ae)),a[5]||(a[5]=O(" Add Model "))]),_:1,__:[5]})])]),u(C,{columns:h,"data-source":x.value,pagination:!1,locale:{emptyText:"No models configured. Add at least one model to proceed."},"row-key":"key"},{bodyCell:$(({column:n,record:m,index:M})=>[n.key==="name"?(v(),k("div",Jt,[e("span",qt,_(m.name),1),e("span",Wt,_(m.provider)+":"+_(m.modelId),1)])):n.key==="parameters"?(v(),k("div",Kt,[(v(!0),k(X,null,ee(s(m.parameters),(F,b)=>(v(),H(y,{key:b},{default:$(()=>[O(_(A(b))+": "+_(F),1)]),_:2},1024))),128))])):n.key==="cost"?(v(),k("div",Yt,[e("span",Ht,"$"+_(g(m.costPerCall)),1),a[7]||(a[7]=e("span",{class:"cost-label"},"per call",-1)),t.totalCombinations>1?(v(),k("div",Gt," Total: $"+_(g(m.costPerCall*t.totalCombinations*t.repeatCount)),1)):z("",!0)])):n.key==="actions"?(v(),H(l,{key:3,type:"text",danger:"",size:"small",onClick:F=>d(M)},{default:$(()=>[u(S(he))]),_:2},1032,["onClick"])):z("",!0)]),_:1},8,["data-source"]),t.configurations.length>0?(v(),k("div",Qt,[e("div",Zt,[a[8]||(a[8]=e("span",null,"Total experiments:",-1)),e("strong",null,_(V.value),1)]),e("div",Xt,[a[9]||(a[9]=e("span",null,"Estimated total cost:",-1)),e("strong",ea,"$"+_(g(P.value)),1)])])):z("",!0)]),u(Re,{visible:f.value,"onUpdate:visible":a[1]||(a[1]=n=>f.value=n),mode:"trial","trial-context":{totalCombinations:t.totalCombinations,avgTokens:t.avgTokens},"existing-configurations":t.configurations,onAddConfiguration:p},null,8,["visible","trial-context","existing-configurations"])])}}}),aa=Z(ta,[["__scopeId","data-v-f4b373de"]]),sa={class:"trial-configuration"},na={class:"configuration-sections"},ia={class:"config-section"},oa={class:"config-section"},la=["aria-expanded"],ra={class:"section-title"},da={class:"expand-hint"},ua={key:0,class:"design-info"},pa={class:"design-stats"},ca={class:"stat"},ma={class:"stat-value"},va={class:"stat"},fa={class:"stat-value"},ga={class:"config-section"},ya=Q({__name:"TrialConfiguration",setup(W){const I=$e("trialCreation"),i=U(!1),w=U(!1),c=R(()=>I.selectedPrompt.value),T=R(()=>c.value.type==="template"?150:100);return(f,o)=>{var h;return v(),k("div",sa,[e("div",na,[e("section",ia,[o[6]||(o[6]=e("h2",{class:"section-title"},"Trial Details",-1)),u(At,{name:S(I).trialName.value,"repeat-count":S(I).repeatCount.value,description:((h=S(I).description)==null?void 0:h.value)||"","total-combinations":S(I).totalCombinations.value,"onUpdate:name":o[0]||(o[0]=x=>S(I).trialName.value=x),"onUpdate:repeatCount":o[1]||(o[1]=x=>S(I).repeatCount.value=x),"onUpdate:description":o[2]||(o[2]=x=>S(I).description.value=x)},null,8,["name","repeat-count","description","total-combinations"])]),e("section",oa,[e("button",{class:"collapsible-header",onClick:o[3]||(o[3]=x=>i.value=!i.value),"aria-expanded":i.value},[u(S(we),{class:ne([{expanded:i.value},"expand-icon"])},null,8,["class"]),e("h2",ra,[o[7]||(o[7]=O("Selected Design Preview ")),e("span",da,"(click to "+_(i.value?"collapse":"expand")+")",1)])],8,la),i.value?(v(),k("div",ua,[u(ie,{template:c.value,"variable-lists":S(I).variableLists.value,cycling:w.value,"show-controls":!0,"display-mode":"block","show-legend":!0,"onUpdate:paused":o[4]||(o[4]=x=>w.value=!x),onBackToSelect:o[5]||(o[5]=x=>f.$emit("back"))},null,8,["template","variable-lists","cycling"]),e("div",pa,[e("div",ca,[o[8]||(o[8]=e("span",{class:"stat-label"},"Total Combinations:",-1)),e("span",ma,_(S(I).totalCombinations.value),1)]),e("div",va,[o[9]||(o[9]=e("span",{class:"stat-label"},"Estimated Tokens:",-1)),e("span",fa,"~"+_(T.value)+" per call",1)])])])):z("",!0)]),e("section",ga,[o[10]||(o[10]=e("h2",{class:"section-title"},"Add Models and Set Parameters",-1)),u(aa,{configurations:S(I).configurations.value,"total-combinations":S(I).totalCombinations.value,"repeat-count":S(I).repeatCount.value,"avg-tokens":T.value,onAddConfiguration:S(I).addConfiguration,onRemoveConfiguration:S(I).removeConfiguration},null,8,["configurations","total-combinations","repeat-count","avg-tokens","onAddConfiguration","onRemoveConfiguration"])])])])}}}),_a=Z(ya,[["__scopeId","data-v-0126c983"]]),Ca={class:"trial-submission"},ba={class:"review-section"},ha={class:"summary-card"},ka={class:"summary-item"},$a={class:"value"},wa={class:"summary-item"},Ta={class:"value"},Ia={class:"summary-item"},Sa={class:"value"},Pa={key:0,class:"summary-item"},xa={class:"value"},Da={key:1,class:"summary-item"},Va={class:"value"},Ma={class:"summary-item"},Oa={class:"value"},Aa={key:2,class:"summary-item"},Na={class:"value"},La={class:"summary-item"},za={class:"value highlight"},Ea={key:3,class:"summary-item"},Ra={class:"value highlight"},ja={class:"configurations-review"},Ba={class:"config-header"},Ua={class:"config-name"},Fa={class:"config-model"},Ja={class:"config-params"},qa={key:0,class:"running-trials-warning"},Wa={class:"action-buttons"},Ka={key:0},Ya={key:1},Ha=Q({__name:"TrialSubmission",props:{trialConfig:{},design:{}},emits:["back","create-draft","create-and-start","export-python"],setup(W,{emit:I}){const i=W,w=I,c=Te(),T=U(null),f=U(!1),o=U(!1),h=R(()=>c.runningTrials.value.length>0),x=R(()=>c.runningTrials.value.length),V=R(()=>{var t,a,l,r;if(!i.trialConfig.configurations)return 0;let p=1;if(i.design.type==="template"&&i.design.variables)for(const[,y]of Object.entries(i.design.variables)){const C=y;if(C.type==="value"&&C.values)p*=C.values.length;else if(C.type==="list"&&C.listId){const n=(t=c.variableLists.value)==null?void 0:t.find(m=>m.id===C.listId);n&&(n.category==="simple"?p*=((a=n.values)==null?void 0:a.length)||0:n.category==="attributed"?p*=((l=n.items)==null?void 0:l.length)||0:n.category==="tabular"&&(p*=n.itemCount||0))}}else if(i.design.type==="spreadsheet"){const y=(r=c.variableLists.value)==null?void 0:r.find(C=>C.id===i.design.datasetId);p=(y==null?void 0:y.itemCount)||0}const d=i.trialConfig.repeatCount||1;return p*i.trialConfig.configurations.length*d}),P=R(()=>{var t,a,l;if(!i.trialConfig.configurations)return 0;let p=0;const d=150;for(const r of i.trialConfig.configurations){const y=(t=c.models.value)==null?void 0:t.find(C=>C.provider===r.provider&&C.modelId===r.modelId);if(y!=null&&y.capabilities){const C=((a=r.parameters)==null?void 0:a.max_tokens)||((l=r.parameters)==null?void 0:l.maxTokens)||256,n=(y.capabilities.inputCostPerToken||0)*d,m=(y.capabilities.outputCostPerToken||0)*C;p+=n+m}}return p*V.value});function N(p){const d=[];"temperature"in p&&d.push(`temperature=${p.temperature}`),"max_tokens"in p&&d.push(`max_tokens=${p.max_tokens}`),"top_p"in p&&d.push(`top_p=${p.top_p}`);const t=Object.keys(p).length-d.length;return t>0&&d.push(`+${t} more`),d.join(", ")}function g(){return{name:i.trialConfig.name||"",description:i.trialConfig.description,type:i.design.type,configurations:i.trialConfig.configurations||[],repeatCount:i.trialConfig.repeatCount||1,templateConfig:i.trialConfig.templateConfig,spreadsheetConfig:i.trialConfig.spreadsheetConfig}}async function s(){T.value="draft";try{const p=g();w("create-draft",p)}finally{T.value=null}}async function A(){f.value=!0;try{const p=g();w("export-python",p)}finally{f.value=!1}}function D(){h.value||P.value>10?o.value=!0:j()}async function j(){o.value=!1,T.value="start";try{const p=g();w("create-and-start",p)}finally{T.value=null}}return(p,d)=>{var r;const t=E("a-button"),a=E("a-alert"),l=E("a-modal");return v(),k("div",Ca,[u(t,{type:"link",onClick:d[0]||(d[0]=y=>p.$emit("back")),class:"back-button"},{default:$(()=>[u(S(Ie)),d[3]||(d[3]=O(" Back to Configuration "))]),_:1,__:[3]}),e("div",ba,[d[15]||(d[15]=e("h2",null,"Review & Create Trial",-1)),e("div",ha,[d[13]||(d[13]=e("h3",null,"Trial Summary",-1)),e("div",ka,[d[4]||(d[4]=e("span",{class:"label"},"Name:",-1)),e("span",$a,_(p.trialConfig.name),1)]),e("div",wa,[d[5]||(d[5]=e("span",{class:"label"},"Type:",-1)),e("span",Ta,_(p.design.type==="template"?"Template":"Spreadsheet"),1)]),e("div",Ia,[d[6]||(d[6]=e("span",{class:"label"},"Design:",-1)),e("span",Sa,_(p.design.name),1)]),p.design.type==="template"?(v(),k("div",Pa,[d[7]||(d[7]=e("span",{class:"label"},"Variables:",-1)),e("span",xa,_(Object.keys(p.design.variables||{}).length)+" variables configured ",1)])):z("",!0),p.design.type==="spreadsheet"?(v(),k("div",Da,[d[8]||(d[8]=e("span",{class:"label"},"Dataset:",-1)),e("span",Va,_(p.design.rowCount)+" rows",1)])):z("",!0),e("div",Ma,[d[9]||(d[9]=e("span",{class:"label"},"Model Configurations:",-1)),e("span",Oa,_(((r=p.trialConfig.configurations)==null?void 0:r.length)||0)+" models",1)]),p.trialConfig.repeatCount&&p.trialConfig.repeatCount>1?(v(),k("div",Aa,[d[10]||(d[10]=e("span",{class:"label"},"Repeat Count:",-1)),e("span",Na,_(p.trialConfig.repeatCount)+" times per prompt",1)])):z("",!0),e("div",La,[d[11]||(d[11]=e("span",{class:"label"},"Total API Calls:",-1)),e("span",za,_(V.value),1)]),P.value>0?(v(),k("div",Ea,[d[12]||(d[12]=e("span",{class:"label"},"Estimated Cost:",-1)),e("span",Ra,"$"+_(P.value.toFixed(4)),1)])):z("",!0)]),e("div",ja,[d[14]||(d[14]=e("h3",null,"Model Configurations",-1)),(v(!0),k(X,null,ee(p.trialConfig.configurations,(y,C)=>(v(),k("div",{key:`review-config-${C}`,class:"config-review-item"},[e("div",Ba,[e("span",Ua,_(y.name||y.modelId),1),e("span",Fa,_(y.provider)+":"+_(y.modelId),1)]),e("div",Ja,_(N(y.parameters)),1)]))),128))]),h.value?(v(),k("div",qa,[u(a,{message:"Running Trials Detected",description:`You have ${x.value} trial(s) currently running. Starting a new trial may affect performance.`,type:"warning","show-icon":""},null,8,["description"])])):z("",!0)]),e("div",Wa,[u(t,{size:"large",onClick:s,loading:T.value==="draft"},{default:$(()=>[u(S(me)),d[16]||(d[16]=O(" Create as Draft "))]),_:1,__:[16]},8,["loading"]),u(t,{size:"large",onClick:A,loading:f.value},{default:$(()=>[u(S(Ee)),d[17]||(d[17]=O(" Export to Python "))]),_:1,__:[17]},8,["loading"]),u(t,{type:"primary",size:"large",onClick:D,loading:T.value==="start"},{default:$(()=>[u(S(Se)),d[18]||(d[18]=O(" Create and Start "))]),_:1,__:[18]},8,["loading"])]),u(l,{visible:o.value,"onUpdate:visible":d[1]||(d[1]=y=>o.value=y),title:"Confirm Trial Creation",onOk:j,onCancel:d[2]||(d[2]=y=>o.value=!1)},{default:$(()=>[d[19]||(d[19]=e("p",null,"You are about to create and start a trial with:",-1)),e("ul",null,[e("li",null,_(V.value)+" API calls",1),P.value>0?(v(),k("li",Ka,"Estimated cost: $"+_(P.value.toFixed(4)),1)):z("",!0),h.value?(v(),k("li",Ya,_(x.value)+" other trial(s) running",1)):z("",!0)]),d[20]||(d[20]=e("p",null,"Do you want to proceed?",-1))]),_:1,__:[19,20]},8,["visible"])])}}}),Ga=Z(Ha,[["__scopeId","data-v-4e799800"]]),Qa={class:"conflict-content"},Za={class:"warning-section"},Xa={class:"warning-text"},es={class:"trial-info"},ts={class:"summary-grid"},as={class:"summary-item"},ss={class:"value"},ns={class:"summary-item"},is={class:"value"},os={key:0,class:"summary-item"},ls={class:"value"},rs={class:"modal-footer"},ds=Q({__name:"TrialConflictModal",props:{visible:{type:Boolean},runningTrial:{},trialConfig:{},totalApiCalls:{},estimatedCost:{}},emits:["update:visible","cancel","create-draft"],setup(W,{emit:I}){const i=W,w=I,c=U(!1);function T(){w("update:visible",!1),w("cancel")}async function f(){if(i.trialConfig){c.value=!0;try{w("create-draft",i.trialConfig),w("update:visible",!1)}finally{c.value=!1}}}return(o,h)=>{const x=E("a-button"),V=E("a-modal");return v(),H(V,{visible:o.visible,title:"Running Trial Detected",closable:!1,"mask-closable":!1,width:"600px",onCancel:T},{footer:$(()=>[e("div",rs,[u(x,{onClick:T,disabled:c.value},{default:$(()=>h[8]||(h[8]=[O(" Cancel ")])),_:1,__:[8]},8,["disabled"]),u(x,{type:"primary",onClick:f,loading:c.value},{default:$(()=>[u(S(me)),h[9]||(h[9]=O(" Create Draft "))]),_:1,__:[9]},8,["loading"])])]),default:$(()=>{var P,N;return[e("div",Qa,[e("div",Za,[u(S(Pe),{class:"warning-icon"}),e("div",Xa,[h[2]||(h[2]=e("h3",null,"Another trial is currently running",-1)),e("p",null,[h[0]||(h[0]=O(' The trial "')),e("strong",null,_((P=o.runningTrial)==null?void 0:P.name),1),h[1]||(h[1]=O('" is currently executing. You can only run one trial at a time. '))])])]),h[7]||(h[7]=e("div",{class:"message-section"},[e("p",null,"You can only run one trial at a time. Your new trial will be saved as a draft and you can start it manually after the current trial finishes, or you can pause or cancel the running trial, then start your new draft trial.")],-1)),e("div",es,[h[6]||(h[6]=e("h4",null,"New Trial Summary:",-1)),e("div",ts,[e("div",as,[h[3]||(h[3]=e("span",{class:"label"},"Name:",-1)),e("span",ss,_((N=o.trialConfig)==null?void 0:N.name),1)]),e("div",ns,[h[4]||(h[4]=e("span",{class:"label"},"API Calls:",-1)),e("span",is,_(o.totalApiCalls),1)]),o.estimatedCost>0?(v(),k("div",os,[h[5]||(h[5]=e("span",{class:"label"},"Estimated Cost:",-1)),e("span",ls,"$"+_(o.estimatedCost.toFixed(4)),1)])):z("",!0)])])])]}),_:1},8,["visible"])}}}),us=Z(ds,[["__scopeId","data-v-1eb58d5b"]]),ps={class:"trial-creation-content"},cs={class:"step-content"},ms={key:1,class:"modal-footer"},vs={key:2,class:"create-actions"},fs={key:2,class:"view-footer"},gs={key:0,class:"validation-errors"},ys={class:"create-actions"},_s=Q({__name:"TrialCreationContent",props:{mode:{},initialData:{}},emits:["cancel","create-template","create-spreadsheet","created","created-and-started","export-python"],setup(W,{expose:I,emit:i}){const w=W,c=i,T=R(()=>{var l,r;return{type:((l=w.initialData)==null?void 0:l.type)||"create",sourceTrialId:(r=w.initialData)==null?void 0:r.sourceTrialId}}),f=je(xe(T));De("trialCreation",f);const o=U(0),h=U(!1),x=U(null),V=U(null),P=U(null);I({currentStep:o});const N=R(()=>{if(w.mode==="view")return f.selectedPrompt.value!==null&&f.canProceed.value&&f.configurations.value.length>0;switch(o.value){case 0:return f.selectedPrompt.value!==null;case 1:return f.canProceed.value;default:return!0}}),g=R(()=>{const l=[];return f.selectedPrompt.value||l.push("Select a template or spreadsheet"),f.configurations.value.length===0&&l.push("Add at least one model configuration"),f.trialName.value.trim()===""&&l.push("Enter a trial name"),l.join(" • ")});function s(){var r;const l=JSON.parse(JSON.stringify(f.selectedPrompt.value));return{name:f.trialName.value,description:((r=f.description)==null?void 0:r.value)||"",type:l.type,configurations:JSON.parse(JSON.stringify(f.configurations.value)),repeatCount:f.repeatCount.value,templateConfig:l.type==="template"?{template:l.template,variables:l.variables,outputType:l.outputType,extractPattern:l.extractPattern,refusalWords:l.refusalWords,rejectRefusalWords:l.rejectRefusalWords}:void 0,spreadsheetConfig:l.type==="spreadsheet"?{promptPattern:l.promptPattern,datasetId:l.datasetId}:void 0}}function A(l){f.selectPrompt(l),w.mode==="view"&&(o.value=1)}async function D(){try{const l=await f.createTrialAsDraft();l&&c("created",l)}catch(l){Y.error("Failed to create draft trial:",l)}}async function j(){try{const l=await f.createAndStartTrial();l&&(l.needsConfirmation?(x.value=s(),V.value=l.trialId,P.value=l.runningTrial,h.value=!0):c("created-and-started",l.trialId))}catch(l){Y.error("Failed to create and start trial:",l)}}async function p(){c("export-python",s())}function d(){a()}async function t(l){try{V.value&&c("created",V.value),a()}catch(r){Y.error("Failed to handle draft creation:",r)}}function a(){h.value=!1,x.value=null,V.value=null,P.value=null}return oe(async()=>{var l,r;if(await f.initialize(),(l=w.initialData)!=null&&l.templateId&&((r=w.initialData)==null?void 0:r.promptSource)==="template"){const y=()=>{const C=f.templates.value.find(n=>{var m;return n.id===((m=w.initialData)==null?void 0:m.templateId)});return C?(f.selectPrompt(C),o.value=1,!0):!1};if(!y()){const C=G(()=>f.templates.value,()=>{y()&&C()},{immediate:!0});setTimeout(()=>C(),3e3)}}}),G(o,()=>{w.mode==="view"&&window.scrollTo(0,0)}),(l,r)=>{const y=E("a-step"),C=E("a-steps"),n=E("a-button");return v(),k("div",ps,[l.mode==="modal"?(v(),H(C,{key:0,current:o.value,class:"creation-steps"},{default:$(()=>[u(y,{title:"Select Design"}),u(y,{title:"Configure Trial"}),u(y,{title:"Review & Create"})]),_:1},8,["current"])):z("",!0),e("div",cs,[o.value===0?(v(),H(Vt,{key:0,templates:S(f).templates.value,spreadsheets:S(f).spreadsheets.value,"variable-lists":S(f).variableLists.value,onSelect:A,onCreateTemplate:r[0]||(r[0]=m=>l.$emit("create-template")),onCreateSpreadsheet:r[1]||(r[1]=m=>l.$emit("create-spreadsheet"))},null,8,["templates","spreadsheets","variable-lists"])):o.value===1?(v(),H(_a,{key:1,onBack:r[2]||(r[2]=m=>o.value--)})):o.value===2?(v(),H(Ga,{key:2,"trial-config":s(),design:S(f).selectedPrompt.value,onBack:r[3]||(r[3]=m=>o.value--),onCreateDraft:D,onCreateAndStart:j,onExportPython:p},null,8,["trial-config","design"])):z("",!0)]),w.mode==="modal"?(v(),k("div",ms,[u(n,{onClick:r[4]||(r[4]=m=>l.$emit("cancel"))},{default:$(()=>r[8]||(r[8]=[O("Cancel")])),_:1,__:[8]}),o.value>0?(v(),H(n,{key:0,onClick:r[5]||(r[5]=m=>o.value--)},{default:$(()=>r[9]||(r[9]=[O(" Back ")])),_:1,__:[9]})):z("",!0),o.value<2?(v(),H(n,{key:1,type:"primary",disabled:!N.value,onClick:r[6]||(r[6]=m=>o.value++)},{default:$(()=>r[10]||(r[10]=[O(" Next ")])),_:1,__:[10]},8,["disabled"])):z("",!0),o.value===2?(v(),k("div",vs,[u(n,{type:"primary",disabled:!N.value,onClick:D},{default:$(()=>r[11]||(r[11]=[O(" Create Draft ")])),_:1,__:[11]},8,["disabled"]),u(n,{type:"primary",disabled:!N.value,onClick:j},{default:$(()=>r[12]||(r[12]=[O(" Create & Start ")])),_:1,__:[12]},8,["disabled"])])):z("",!0)])):z("",!0),w.mode==="view"?(v(),k("div",fs,[N.value?z("",!0):(v(),k("div",gs,_(g.value),1)),e("div",ys,[u(n,{size:"large",disabled:!N.value,onClick:p},{default:$(()=>r[13]||(r[13]=[O(" Export Python ")])),_:1,__:[13]},8,["disabled"]),u(n,{type:"primary",size:"large",disabled:!N.value,onClick:D},{default:$(()=>r[14]||(r[14]=[O(" Create Draft ")])),_:1,__:[14]},8,["disabled"]),u(n,{type:"primary",size:"large",disabled:!N.value,onClick:j},{default:$(()=>r[15]||(r[15]=[O(" Create & Start ")])),_:1,__:[15]},8,["disabled"])])])):z("",!0),u(us,{visible:h.value,"onUpdate:visible":r[7]||(r[7]=m=>h.value=m),"running-trial":P.value,"trial-config":x.value,"total-api-calls":S(f).totalExperiments.value,"estimated-cost":S(f).totalCost.value,onCancel:d,onCreateDraft:t},null,8,["visible","running-trial","trial-config","total-api-calls","estimated-cost"])])}}}),Cs=Z(_s,[["__scopeId","data-v-f3b1f061"]]),bs={class:"trial-creation-view"},hs={class:"creation-header"},ks={class:"header-title"},$s={class:"creation-content"},ws=Q({__name:"TrialCreationV3",setup(W){const I=Ve(),i=Me(),w=U(),c=U(null);async function T(){const g=I.query;if(g.duplicate){const s=g.duplicate;w.value={type:"duplicate",sourceTrialId:s}}else g.designId&&g.promptSource==="template"&&(w.value={type:"create",templateId:g.designId,promptSource:"template"})}function f(){i.push("/trials")}function o(){c.value&&(c.value.currentStep=0)}async function h(g){se.success("Trial created as draft"),i.push({path:"/trials",query:{trialId:g,tab:"details"}})}async function x(g){se.success("Trial created and started"),i.push({path:"/trials",query:{trialId:g,tab:"tasks"}})}async function V(){se.info("Python export not yet implemented")}function P(){i.push("/templates/new")}function N(){i.push("/spreadsheet")}return oe(()=>{T()}),(g,s)=>{var D;const A=E("a-button");return v(),k("div",bs,[e("div",hs,[e("div",ks,[s[1]||(s[1]=e("h1",null,"Create New Trial",-1)),((D=c.value)==null?void 0:D.currentStep)===1?(v(),H(A,{key:0,type:"link",class:"back-button",onClick:o},{default:$(()=>[u(S(ue)),s[0]||(s[0]=O(" Back to Select Template "))]),_:1,__:[0]})):z("",!0)]),u(A,{onClick:f},{default:$(()=>s[2]||(s[2]=[O("Cancel")])),_:1,__:[2]})]),e("div",$s,[u(Cs,{ref_key:"creationContentRef",ref:c,mode:"view","initial-data":w.value,onCancel:f,onCreated:h,onCreatedAndStarted:x,onExportPython:V,onCreateTemplate:P,onCreateSpreadsheet:N},null,8,["initial-data"])])])}}}),As=Z(ws,[["__scopeId","data-v-abf666af"]]);export{As as default};
