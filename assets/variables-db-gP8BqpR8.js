import{S as e,f as t,c as a,U as i}from"./vendor-AtAbR8ZE.js";import{l as s}from"./db-CL8uhZCz.js";import{r,l,N as n}from"./index-B_4MOQZM.js";const o=e("variableLists",()=>{const e=t([]),o=t(!1),u=t(null);let d=null;const c=a(()=>e.value.filter(e=>"simple"===e.category)),v=a(()=>e.value.filter(e=>"attributed"===e.category)),b=a(()=>e.value.filter(e=>"refusal"===e.category)),f=a(()=>e.value.slice().sort((e,t)=>t.updated.getTime()-e.updated.getTime()));return{lists:e,isLoading:i(o),error:i(u),simpleLists:c,attributedLists:v,refusalLists:b,listsByDate:f,initialize:async function(){if(!d){o.value=!0,u.value=null;try{d=s(()=>r.variableLists.orderBy("updated").reverse().toArray()).subscribe({next:t=>{e.value=t,o.value=!1},error:e=>{l.error("Variable lists store subscription error",e),u.value="Failed to load variable lists",o.value=!1}})}catch(t){l.error("Failed to initialize variable lists store",t),u.value="Failed to initialize variable lists",o.value=!1}}},createList:async function(e){const t=new Date,a=n(),i={...e,id:a,created:t,updated:t};return await r.variableLists.add(i),a},updateList:async function(e,t){await r.variableLists.update(e,{...t,updated:new Date})},deleteList:async function(e){const t=(await r.designs.toArray()).filter(t=>t.variableBindings&&Object.values(t.variableBindings).some(t=>"list"===t.type&&t.listId===e));if(t.length>0){const e=t.map(e=>e.name).join(", ");throw new Error(`Cannot delete variable list - it is used in designs: ${e}`)}await r.variableLists.delete(e)},getList:async function(e){return await r.variableLists.get(e)},getAllLists:async function(){try{return await r.variableLists.toArray()}catch(e){return l.error("Failed to get all lists",e),[]}},destroy:function(){d&&(d.unsubscribe(),d=null)}}});export{o as u};
