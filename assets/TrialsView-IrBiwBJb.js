const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./PivotTableCore-Cl4TvA4W.js","./BaseModal.vue_vue_type_style_index_0_lang-D3rbY83j.js","./vendor-DImCB_rW.js","./BaseModal-DbTyIa7L.css","./index-B1L31PPG.js","./db-CL8uhZCz.js","./index-Brryp45E.css","./designs-db-xzJUdtVO.js","./defaultData-BR5V2V3r.js","./variable.service-F52OeuqK.js","./variables-db-CynsS7O5.js","./models-db-CCNjdEp8.js","./useEnvironmentalCost-aVOV7dso.js","./cost-formatting-Bv_drrqY.js","./GenericModelSelectorModal-Cw1Mc2v7.js","./GenericModelSelectorModal-BzY4famE.css","./PivotTableCore-CRoQpIXd.css"])))=>i.map(i=>d[i]);
import{I as e,l as a,_ as t,u as l,r as i,s as r,t as s,d as n,g as o,c as u,a as c}from"./index-B1L31PPG.js";import{k as d,S as v,a9 as p,X as f,f as g,c as m,d as y,r as b,V as h,Y as k,W as w,Z as _,_ as T,a6 as C,a1 as x,G as I,a0 as S,F as P,a8 as F,H as E,ah as $,o as z,b as D,w as j,ab as O,ad as A,u as M,ag as L,ai as R,q as V,aj as N,aa as U,B as q,$ as H}from"./vendor-DImCB_rW.js";import{P as K,A as B,_ as W,a as Y,T as G}from"./PivotTableCore-Cl4TvA4W.js";import{l as J}from"./db-CL8uhZCz.js";import{u as X}from"./useResponsiveTable-Cw1RaX8o.js";import"./BaseModal.vue_vue_type_style_index_0_lang-D3rbY83j.js";import"./designs-db-xzJUdtVO.js";import"./defaultData-BR5V2V3r.js";import"./variable.service-F52OeuqK.js";import"./variables-db-CynsS7O5.js";import"./models-db-CCNjdEp8.js";import"./useEnvironmentalCost-aVOV7dso.js";import"./cost-formatting-Bv_drrqY.js";import"./GenericModelSelectorModal-Cw1Mc2v7.js";var Z={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M304 176h80v672h-80zm408 0h-64c-4.4 0-8 3.6-8 8v656c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V184c0-4.4-3.6-8-8-8z"}}]},name:"pause",theme:"outlined"};function Q(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),l.forEach(function(a){ee(e,a,t[a])})}return e}function ee(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var ae=function(a,t){var l=Q({},a,t.attrs);return d(e,Q({},l,{icon:Z}),null)};ae.displayName="PauseOutlined",ae.inheritAttrs=!1;var te={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372 0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884zm288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372 0 89-31.3 170.8-83.5 234.8z"}}]},name:"stop",theme:"outlined"};function le(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),l.forEach(function(a){ie(e,a,t[a])})}return e}function ie(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var re=function(a,t){var l=le({},a,t.attrs);return d(e,le({},l,{icon:te}),null)};re.displayName="StopOutlined",re.inheritAttrs=!1;const se="auditomatic.trials",ne=v("trial-navigation",()=>{const e=p(),t=f(),l=g(null),i=g("all"),r=g("list"),s=g(!1),n=g({status:"all",search:""}),o=g({rowField:"",columnField:"model",valueField:"extracted_value",aggregation:"mean"});function u(t,l){s.value=!0;try{const s={tab:t};l&&Object.assign(s,l),"current"===t&&"list"!==r.value&&(s.subtab=r.value),e.push({name:"trials",query:s}),i.value=t,a.debug("Navigated to trials tab",{tab:t,query:s})}catch(n){a.error("Failed to navigate to tab",{error:n})}finally{s.value=!1}}return function(){try{const e=localStorage.getItem(`${se}.listViewFilters`);e&&(n.value=JSON.parse(e));const a=localStorage.getItem(`${se}.pivotConfig`);a&&(o.value=JSON.parse(a))}catch(e){a.warn("Failed to load trial navigation preferences",{error:e})}}(),{currentTrialId:m(()=>l.value),currentTab:m(()=>i.value),currentSubtab:m(()=>r.value),isNavigating:m(()=>s.value),listViewFilters:m(()=>n.value),pivotConfig:m(()=>o.value),selectTrial:function(e){l.value=e,u("current",{id:e})},navigateToTab:u,clearCurrentTrial:function(){l.value=null,u("all")},setSubtab:function(e){r.value=e,"current"===i.value&&l.value&&u("current",{id:l.value,subtab:"list"!==e?e:void 0})},saveListFilters:function(e){n.value=e;try{localStorage.setItem(`${se}.listViewFilters`,JSON.stringify(e))}catch(t){a.warn("Failed to save list view filters",{error:t})}},savePivotConfig:function(e){o.value=e;try{localStorage.setItem(`${se}.pivotConfig`,JSON.stringify(e))}catch(t){a.warn("Failed to save pivot config",{error:t})}},clearPreferences:function(){try{localStorage.removeItem(`${se}.listViewFilters`),localStorage.removeItem(`${se}.pivotConfig`),n.value={status:"all",search:""},o.value={rowField:"",columnField:"model",valueField:"extracted_value",aggregation:"mean"}}catch(e){a.warn("Failed to clear preferences",{error:e})}},syncWithRoute:function(){const e=t.query;e.tab&&(i.value=e.tab),e.id&&(l.value=e.id),e.subtab&&(r.value=e.subtab)}}});const oe={class:"summary-row"},ue={key:0,class:"filter-row"},ce=["title"],de=["title"],ve=t(y({__name:"PivotCellDetailModal",props:{row:{},column:{},apiCalls:{},trial:{},value:{}},emits:["close"],setup(e){const a=e,t=b({}),l=m(()=>{const e=new Set;return a.apiCalls.forEach(a=>{a.variables&&Object.keys(a.variables).forEach(a=>e.add(a)),a.attributedVariables&&Object.entries(a.attributedVariables).forEach(([a,t])=>{t&&"object"==typeof t&&Object.keys(t).forEach(t=>{e.add(`${a}.${t}`)})})}),Array.from(e).sort()}),i=m(()=>l.value.map(e=>({title:e,dataIndex:`var_${e}`,key:`var_${e}`,width:150,ellipsis:!0,sorter:(a,t)=>{const l=a[`var_${e}`]||"",i=t[`var_${e}`]||"";return l.localeCompare(i)}}))),r=[{title:"Status",dataIndex:"status",key:"status",width:100,fixed:"left",sorter:(e,a)=>e.status.localeCompare(a.status)},{title:"Model",dataIndex:"model",key:"model",width:150,ellipsis:!0,sorter:(e,a)=>e.model.localeCompare(a.model)}],s=[{title:"Response",dataIndex:"response",key:"response",width:300,ellipsis:!0},{title:"Extracted",dataIndex:"extracted",key:"extracted",width:150,ellipsis:!0,sorter:(e,a)=>(e.extracted||"").localeCompare(a.extracted||"")},{title:"Duration",dataIndex:"duration",key:"duration",width:100,sorter:(e,a)=>(parseInt(e.duration)||0)-(parseInt(a.duration)||0)},{title:"Cost",dataIndex:"cost",key:"cost",width:100,sorter:(e,a)=>(e.cost||0)-(a.cost||0)}],n=m(()=>[...r,...i.value,...s]),o=m(()=>`${a.row} × ${a.column} - ${a.apiCalls.length} API Calls`),u=m(()=>a.apiCalls.map(e=>{const a={id:e.id,status:e.status,model:e.model||"-",response:e.result?.content||e.result?.error||"-",extracted:e.extracted||"-",duration:e.duration?`${e.duration}ms`:"-",cost:e.cost||0};return l.value.forEach(t=>{if(t.includes(".")){const[l,i]=t.split("."),r=e.attributedVariables?.[l]?.[i];a[`var_${t}`]=void 0!==r?String(r):"-"}else a[`var_${t}`]=e.variables?.[t]||"-"}),a})),c=m(()=>Object.values(t).some(e=>void 0!==e&&""!==e)),v=m(()=>c.value?u.value.filter(e=>Object.entries(t).every(([a,t])=>!t||e[a]===t)):u.value),p=m(()=>{const e=a.apiCalls.filter(e=>"completed"===e.status).length;return Math.round(e/a.apiCalls.length*100)}),f=m(()=>{const e=a.apiCalls.filter(e=>e.duration).map(e=>e.duration);return 0===e.length?0:Math.round(e.reduce((e,a)=>e+a,0)/e.length)}),g=m(()=>a.apiCalls.filter(e=>e.cost).map(e=>e.cost).reduce((e,a)=>e+a,0).toFixed(4));function y(e){switch(e){case"completed":return"success";case"failed":return"error";case"pending":return"warning";case"running":return"processing";default:return"default"}}function E(e){const a=new Set;return u.value.forEach(t=>{const l=t[e];l&&"-"!==l&&a.add(l)}),Array.from(a).sort()}function $(){}function z(){Object.keys(t).forEach(e=>{delete t[e]})}return(e,a)=>{const l=w("a-select-option"),r=w("a-select"),s=w("a-button"),u=w("a-tag"),m=w("a-table"),b=w("a-modal");return k(),h(b,{open:!0,width:"98vw",footer:null,title:o.value,onCancel:a[0]||(a[0]=a=>e.$emit("close")),"body-style":{padding:"16px",height:"90vh",display:"flex",flexDirection:"column"},class:"pivot-cell-detail-modal"},{default:_(()=>[T("div",oe,[T("span",null,[a[1]||(a[1]=T("b",null,"Total:",-1)),I(" "+S(e.apiCalls.length),1)]),T("span",null,[a[2]||(a[2]=T("b",null,"Success Rate:",-1)),I(" "+S(p.value)+"%",1)]),T("span",null,[a[3]||(a[3]=T("b",null,"Avg Duration:",-1)),I(" "+S(f.value)+"ms",1)]),T("span",null,[a[4]||(a[4]=T("b",null,"Total Cost:",-1)),I(" $"+S(g.value),1)])]),i.value.length>0?(k(),C("div",ue,[(k(!0),C(P,null,F(i.value,e=>(k(),C("div",{key:e.key,class:"variable-filter"},[d(r,{value:t[e.key],"onUpdate:value":a=>t[e.key]=a,placeholder:`Filter ${e.title}`,allowClear:"",style:{width:"150px"},size:"small",onChange:$},{default:_(()=>[(k(!0),C(P,null,F(E(e.key),e=>(k(),h(l,{key:e,value:e},{default:_(()=>[I(S(e),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])]))),128)),c.value?(k(),h(s,{key:0,size:"small",onClick:z},{default:_(()=>a[5]||(a[5]=[I("Clear Filters")])),_:1,__:[5]})):x("",!0)])):x("",!0),d(m,{columns:n.value,"data-source":v.value,scroll:{x:1500,y:"calc(90vh - 140px)"},pagination:!1,size:"small","row-key":e=>e.id,class:"api-calls-table"},{bodyCell:_(({column:e,record:a})=>{return["status"===e.key?(k(),h(u,{key:0,color:y(a.status),style:{margin:"0"}},{default:_(()=>[I(S(a.status),1)]),_:2},1032,["color"])):"response"===e.key?(k(),C("span",{key:1,class:"response-cell",title:a.response},S((t=a.response,l=100,t?t.length<=l?t:t.slice(0,l)+"...":"")),9,ce)):"cost"===e.key?(k(),C(P,{key:2},[I(S(0===a.cost?"-":`$${a.cost.toFixed(4)}`),1)],64)):e.key.startsWith("var_")?(k(),C("span",{key:3,class:"variable-cell",title:a[e.key]},S(a[e.key]||"-"),9,de)):x("",!0)];var t,l}),_:1},8,["columns","data-source","row-key"])]),_:1},8,["title"])}}}),[["__scopeId","data-v-d1eba3c3"]]);"undefined"!=typeof WorkerGlobalScope&&(globalThis,WorkerGlobalScope);const pe=()=>{};function fe(e,a=200,t=!1,l=!0,i=!1){return function(e,a){return function(...t){return new Promise((l,i)=>{Promise.resolve(e(()=>a.apply(this,t),{fn:a,thisArg:this,args:t})).then(l).catch(i)})}}(function(...e){let a,t,l,i,r,s,n=0,o=!0,u=pe;E(e[0])||"object"!=typeof e[0]?[l,i=!0,r=!0,s=!1]=e:({delay:l,trailing:i=!0,leading:r=!0,rejectOnCancel:s=!1}=e[0]);const c=()=>{a&&(clearTimeout(a),a=void 0,u(),u=pe)};return e=>{const d=$(l),v=Date.now()-n,p=()=>t=e();return c(),d<=0?(n=Date.now(),p()):(v>d&&(r||!o)?(n=Date.now(),p()):i&&(t=new Promise((e,t)=>{u=s?t:e,a=setTimeout(()=>{n=Date.now(),o=!0,e(p()),c()},Math.max(0,d-v))})),r||a||(a=setTimeout(()=>o=!0,d)),o=!1,t)}}(a,t,l,i),e)}const ge={class:"virtual-table"},me={class:"virtual-table"},ye=["data-row-index","data-row-id"],be=t(y({__name:"VirtualTable",props:{columns:{},dataSource:{},rowHeight:{default:48},rowKey:{type:[String,Function],default:"id"},overscan:{default:5},showHeader:{type:Boolean,default:!0},getRowClass:{},minHeight:{default:"300px"},maxHeight:{default:"calc(100vh - 250px)"}},setup(e,{expose:a}){R(e=>({fb3a8ad6:e.minHeight,"5457a427":e.maxHeight}));const t=e,l=g(),i=g(),r=g(0),s=g(0),n=g(0);let o=null;const u=m(()=>t.dataSource.length*t.rowHeight),c=m(()=>{const e=Math.floor(r.value/t.rowHeight),a=Math.ceil((r.value+s.value)/t.rowHeight);return{start:Math.max(0,e-t.overscan),end:Math.min(t.dataSource.length,a+t.overscan)}}),d=m(()=>c.value.start),v=m(()=>t.dataSource.slice(c.value.start,c.value.end)),p=m(()=>d.value*t.rowHeight);function f(e){return"function"==typeof t.rowKey?t.rowKey(e):e[t.rowKey]}function y(e,a){return e[a.key]}function b(e){const a={};return e.width&&(a.width="number"==typeof e.width?`${e.width}px`:e.width),e.align&&(a.textAlign=e.align),a}const h=fe(e=>{null!==o&&cancelAnimationFrame(o),o=requestAnimationFrame(()=>{const a=e.target;r.value=a.scrollTop,o=null})},16);let w=null;function _(){if(l.value){const e=l.value.querySelector(".virtual-content");s.value=e?e.clientHeight:l.value.clientHeight}i.value&&(n.value=i.value.offsetHeight)}function E(){if(l.value){const e=l.value.querySelector(".virtual-content");e&&(e.scrollTop=0)}}return z(()=>{_(),l.value&&(w=new ResizeObserver(()=>{_()}),w.observe(l.value))}),D(()=>{w&&w.disconnect(),null!==o&&cancelAnimationFrame(o)}),j(()=>t.dataSource.length,()=>{r.value>u.value&&E()}),a({scrollToRow:function(e){if(l.value){const a=l.value.querySelector(".virtual-content");if(a){const l=e*t.rowHeight;a.scrollTop=l}}},scrollToTop:E}),(e,a)=>(k(),C("div",{class:"virtual-table-container",ref_key:"containerRef",ref:l,"data-testid":"virtual-table",role:"table","aria-label":"Data table with virtual scrolling"},[e.showHeader?(k(),C("div",{key:0,class:"virtual-header",ref_key:"headerRef",ref:i},[T("table",ge,[T("thead",null,[T("tr",null,[(k(!0),C(P,null,F(e.columns,e=>(k(),C("th",{key:e.key,style:A(b(e)),class:O(e.className)},S(e.title),7))),128))])])])],512)):x("",!0),T("div",{class:"virtual-content",style:A({height:`calc(100% - ${n.value}px)`}),onScrollPassive:a[0]||(a[0]=(...e)=>M(h)&&M(h)(...e))},[T("div",{class:"virtual-spacer",style:A({height:u.value+"px"})},[T("div",{class:"virtual-viewport",style:A({transform:`translateY(${p.value}px)`})},[T("table",me,[T("tbody",null,[(k(!0),C(P,null,F(v.value,(a,t)=>(k(),C("tr",{key:f(a),"data-row-index":d.value+t,"data-row-id":f(a),class:O(e.getRowClass?e.getRowClass(a):""),"data-testid":"table-row",role:"row"},[(k(!0),C(P,null,F(e.columns,t=>(k(),C("td",{key:t.key,style:A(b(t)),class:O(t.className)},[L(e.$slots,"cell",{column:t,record:a,value:y(a,t)},()=>[I(S(y(a,t)),1)],!0)],6))),128))],10,ye))),128))])])],4)],4)],36)],512))}}),[["__scopeId","data-v-c8787a4b"]]),he={class:"execution-monitor","data-testid":"execution-monitor"},ke={class:"monitor-header"},we={class:"header-left"},_e={key:0,class:"progress-summary"},Te={class:"progress-bar"},Ce={class:"progress-text"},xe={key:0,class:"time-estimate"},Ie={key:1,class:"network-errors"},Se={key:0,class:"header-right"},Pe={class:"header-stats"},Fe={class:"stat"},Ee={class:"stat pending"},$e={class:"stat running"},ze={class:"stat completed"},De={class:"stat failed"},je={key:0,class:"execution-controls"},Oe={key:0,class:"monitor-tabs"},Ae={class:"monitor-filters"},Me={class:"monitor-content"},Le={key:0,class:"empty-state"},Re={class:"placeholder-content"},Ve={key:1,class:"results-table"},Ne={key:0,class:"col-status"},Ue={key:1,class:"col-config"},qe={class:"config-info"},He={class:"model-name"},Ke={class:"provider-name"},Be={key:2,class:"col-repeat"},We={key:0,class:"repeat-info"},Ye={key:1,class:"repeat-placeholder"},Ge={key:3,class:"col-variables"},Je={class:"variables-list"},Xe={class:"var-key"},Ze={class:"var-value"},Qe={key:0,class:"separator"},ea={key:4,class:"col-response"},aa={key:0,class:"response-placeholder"},ta={key:1,class:"response-placeholder"},la={key:2,class:"response-error"},ia={key:3,class:"response-content"},ra={key:4,class:"response-placeholder"},sa={key:5,class:"col-time"},na={key:0,class:"time-info"},oa={class:"duration"},ua={key:0,class:"latency"},ca={key:1,class:"time-placeholder"},da={class:"pivot-container"},va={class:"pivot-wrapper"},pa={key:1,class:"empty-state"},fa={key:1,class:"monitor-content"},ga={class:"empty-state"},ma={key:0,class:"loading-state"},ya={key:1,class:"placeholder-content"},ba=t(y({__name:"ExecutionMonitor",props:{trialId:{}},setup(e){const t=e,o=g(null),u=g([]),c=g("all"),v=g(""),p=g(null),f=g("list"),y=g(!0),b=g(null),E=[{key:"status",title:"Status",width:120},{key:"config",title:"Config",width:150},{key:"repeat",title:"Repeat",width:80},{key:"variables",title:"Variables",width:"30%"},{key:"response",title:"Response",width:"40%"},{key:"time",title:"Time",width:100}],$=g({rowField:"",columnField:"model",valueField:"extracted_value",aggregation:"mean"}),L=g(null),R=g([]),q=g(!1),H=l();let W=null,Y=null,G=null;const X=m(()=>{const e={total:0,pending:0,running:0,completed:0,failed:0};return u.value.forEach(a=>{e.total++,"completed"===a.status?e.completed++:"failed"===a.status?(e.failed++,e.completed++):e[a.status]++}),e}),Z=m(()=>o.value&&0!==o.value.progress.total?o.value.progress.completed/o.value.progress.total*100:0),Q=m(()=>{if(!o.value||"running"!==o.value.status||!L.value)return null;const e=o.value.progress.completed,a=o.value.progress.total-e;if(0===e||a<=0)return null;const t=R.value.slice(-10);if(t.length<2){return ue((Date.now()-L.value.getTime())/e*a)}let l=0,i=0;for(let r=1;r<t.length;r++){const e=t[r].time.getTime()-t[r-1].time.getTime(),a=t[r].completed-t[r-1].completed;if(a>0){const s=e/a,n=r/t.length;l+=s*n,i+=n}}if(0===i)return null;return ue(1.1*(l/i*a))}),ee=m(()=>{let e=u.value;if("all"!==c.value&&(e=e.filter(e=>e.status===c.value)),v.value.trim()){const a=v.value.toLowerCase();e=e.filter(e=>Object.values(e.variables).some(e=>e.toLowerCase().includes(a))||e.result?.content&&String(e.result.content).toLowerCase().includes(a)||e.result?.error&&e.result.error.toLowerCase().includes(a))}return e.sort((e,a)=>a.created.getTime()-e.created.getTime())}),te=m(()=>o.value&&["running","paused","pending"].includes(o.value.status));function le(e){return e.status}function ie(e){const a=e.target.closest("tr");if(a){const e=a.getAttribute("data-row-id"),t=ee.value.find(a=>a.id===e);t&&function(e){p.value=e}(t)}}function se(e){if(!o.value||!o.value.configurationSnapshots[e])return"Unknown Model";return o.value.configurationSnapshots[e].modelId||"Unknown Model"}function ne(e){if(!o.value||!o.value.configurationSnapshots[e])return"Unknown Provider";return o.value.configurationSnapshots[e].provider||"Unknown Provider"}function oe(e,a){return e.length<=a?e:e.slice(0,a)+"..."}function ue(e){const a=Math.floor(e/1e3),t=Math.floor(a/60),l=Math.floor(t/60);if(l>0){return`${l}h ${t%60}m`}if(t>0){return`${t}m ${a%60}s`}return`${a}s`}async function ce(){if(o.value){q.value=!0;try{await H.pauseTrial(o.value.id),a.info("Trial paused",{trialId:o.value.id})}catch(e){a.error("Failed to pause trial",e),s.error({title:"Failed to pause trial",content:e instanceof Error?e.message:"Unknown error"})}finally{q.value=!1}}}async function de(){if(o.value){q.value=!0;try{await H.executeTrial(o.value.id),a.info("Trial resumed",{trialId:o.value.id})}catch(e){a.error("Failed to resume trial",e),s.error({title:"Failed to resume trial",content:e instanceof Error?e.message:"Unknown error"})}finally{q.value=!1}}}function pe(){o.value&&s.confirm({title:"Cancel Trial Execution?",content:"This will permanently cancel the trial. You will not be able to resume it.",okText:"Yes, Cancel",okType:"danger",cancelText:"No, Keep Running",onOk:fe})}async function fe(){if(o.value){q.value=!0;try{await H.cancelTrial(o.value.id),a.info("Trial cancelled",{trialId:o.value.id})}catch(e){a.error("Failed to cancel trial",e),s.error({title:"Failed to cancel trial",content:e instanceof Error?e.message:"Unknown error"})}finally{q.value=!1}}}function ge(e){$.value=e}function me(e){if(!e.cell)return;const a=e.cell.apiCalls||[];if(0===a.length)return;const t=a.map(e=>{const a=o.value?.configurationSnapshots[e.configurationIndex];return{...e,model:a?.modelId||"Unknown Model",duration:e.response?.latencyMs,cost:e.response?.cost,extracted:e.result?.extracted,attributedVariables:e.attributedVariables}});b.value={row:e.row,column:e.column,apiCalls:t,value:e.cell.value}}async function ye(){if(o.value&&L.value&&"running"===o.value.status)try{await n.trialExecutionStates.put({trialId:o.value.id,startedAt:L.value,lastActivityAt:new Date,progressHistory:R.value.map(e=>({time:e.time,completed:e.completed}))}),a.debug("Saved execution state",{trialId:o.value.id})}catch(e){a.error("Failed to save execution state",e)}}function ba(){W&&(clearInterval(W),W=null)}function ha(){Y&&Y.unsubscribe(),G&&G.unsubscribe(),Y=J(()=>n.trials.get(t.trialId)).subscribe({next:async e=>{const t=o.value;if(o.value=e||null,y.value=!1,e&&("running"===e.status&&"running"!==t?.status&&(await async function(e){try{const t=await n.trialExecutionStates.get(e);t&&(L.value=t.startedAt,R.value=t.progressHistory,a.info("Restored execution state",{trialId:e,historyLength:t.progressHistory.length}))}catch(t){a.error("Failed to restore execution state",t)}}(e.id),L.value||(L.value=new Date,R.value=[{time:new Date,completed:e.progress.completed}]),ba(),W=window.setInterval(()=>{ye()},5e3)),"running"===e.status&&t&&e.progress.completed>t.progress.completed&&(R.value.push({time:new Date,completed:e.progress.completed}),R.value.length>20&&(R.value=R.value.slice(-20)),await ye()),"running"!==e.status&&"running"===t?.status)){ba();try{await n.trialExecutionStates.delete(e.id)}catch(l){a.warn("Failed to clean up execution state",{error:l})}L.value=null,R.value=[]}},error:e=>{a.error("Trial subscription error",e),y.value=!1}}),G=J(()=>n.apiCalls.where("trialId").equals(t.trialId).toArray()).subscribe({next:e=>{u.value=e},error:e=>{a.error("API calls subscription error",e)}})}return j(()=>t.trialId,e=>{e&&(y.value=!0,ha())},{immediate:!0}),j([c,v],()=>{}),z(()=>{ha()}),D(()=>{ba(),ye(),Y&&Y.unsubscribe(),G&&G.unsubscribe()}),(e,a)=>{const t=w("a-tag"),l=w("a-button"),s=w("a-tab-pane"),n=w("a-tabs");return k(),C("div",he,[T("div",ke,[T("div",we,[T("h3",null,[I(S(o.value?.name||"Select a trial to monitor")+" ",1),o.value?.repeatConfig?.callsPerPrompt&&o.value.repeatConfig.callsPerPrompt>1?(k(),h(t,{key:0,size:"small",color:"purple",style:{"margin-left":"8px"}},{default:_(()=>[I(S(o.value.repeatConfig.callsPerPrompt)+"× repeat ",1)]),_:1})):x("",!0)]),o.value?(k(),C("div",_e,[T("div",Te,[T("div",{class:"progress-fill",style:A({width:Z.value+"%"})},null,4)]),T("span",Ce,[I(S(o.value.progress.completed)+" / "+S(o.value.progress.total)+" completed ",1),Q.value&&"running"===o.value.status?(k(),C("span",xe," • "+S(Q.value)+" remaining ",1)):x("",!0),o.value.progress.networkErrors>0?(k(),C("span",Ie,"("+S(o.value.progress.networkErrors)+" network errors)",1)):x("",!0)])])):x("",!0)]),o.value?(k(),C("div",Se,[T("div",Pe,[T("span",Fe,S(X.value.total)+" total",1),T("span",Ee,S(X.value.pending)+" pending",1),T("span",$e,S(X.value.running)+" running",1),T("span",ze,S(X.value.completed)+" completed",1),T("span",De,S(X.value.failed)+" failed",1)]),te.value?(k(),C("div",je,["running"===o.value.status?(k(),h(l,{key:0,size:"small",onClick:ce,loading:q.value,"data-testid":"btn-pause-trial"},{icon:_(()=>[d(M(ae))]),default:_(()=>[a[5]||(a[5]=I(" Pause "))]),_:1,__:[5]},8,["loading"])):"paused"===o.value.status?(k(),h(l,{key:1,type:"primary",size:"small",onClick:de,loading:q.value,"data-testid":"btn-resume-trial"},{icon:_(()=>[d(M(i))]),default:_(()=>[a[6]||(a[6]=I(" Resume "))]),_:1,__:[6]},8,["loading"])):x("",!0),"running"===o.value.status||"paused"===o.value.status?(k(),h(l,{key:2,danger:"",size:"small",onClick:pe,loading:q.value,"data-testid":"btn-cancel-trial"},{icon:_(()=>[d(M(re))]),default:_(()=>[a[7]||(a[7]=I(" Cancel "))]),_:1,__:[7]},8,["loading"])):x("",!0)])):x("",!0)])):x("",!0)]),o.value?(k(),C("div",Oe,[d(n,{activeKey:f.value,"onUpdate:activeKey":a[2]||(a[2]=e=>f.value=e),type:"card",size:"large"},{default:_(()=>[d(s,{key:"list"},{tab:_(()=>a[8]||(a[8]=[T("span",{style:{"font-size":"20px","font-weight":"500"}},"List View",-1)])),default:_(()=>[T("div",Ae,[V(T("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>c.value=e),class:"filter-select","data-testid":"filter-status","aria-label":"Filter by task status"},a[9]||(a[9]=[T("option",{value:"all"},"All Statuses",-1),T("option",{value:"pending"},"Pending",-1),T("option",{value:"running"},"Running",-1),T("option",{value:"completed"},"Completed",-1),T("option",{value:"failed"},"Failed",-1)]),512),[[N,c.value]]),V(T("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>v.value=e),type:"text",placeholder:"Search variables or response...",class:"search-input","data-testid":"input-search-tasks","aria-label":"Search tasks by variables or response content"},null,512),[[U,v.value]])]),T("div",Me,[0===ee.value.length?(k(),C("div",Le,[T("div",Re,[a[10]||(a[10]=T("h4",null,"No API Calls",-1)),T("p",null,S(0===X.value.total?"Start the trial to see API calls here.":"No API calls match the current filters."),1)])])):(k(),C("div",Ve,[d(be,{columns:E,"data-source":ee.value,"row-height":60,overscan:10,"max-height":"calc(100vh - 350px)","get-row-class":le,onClick:ie},{cell:_(({column:e,record:a})=>{return["status"===e.key?(k(),C("div",Ne,[T("span",{class:O(["status-badge",a.status])},S(a.status),3)])):"config"===e.key?(k(),C("div",Ue,[T("div",qe,[T("div",He,S(se(a.configurationIndex)),1),T("div",Ke,S(ne(a.configurationIndex)),1)])])):"repeat"===e.key?(k(),C("div",Be,[void 0!==a.repeatIndex?(k(),C("span",We,S(a.repeatIndex+1)+"/"+S(o.value?.repeatConfig?.callsPerPrompt||1),1)):(k(),C("span",Ye,"—"))])):"variables"===e.key?(k(),C("div",Ge,[T("div",Je,[(k(!0),C(P,null,F(Object.entries(a.variables),([e,t],l)=>(k(),C("span",{key:e,class:"variable-pair"},[T("span",Xe,S(e)+":",1),T("span",Ze,S(oe(String(t),30)),1),l<Object.entries(a.variables).length-1?(k(),C("span",Qe,"•")):x("",!0)]))),128))])])):"response"===e.key?(k(),C("div",ea,["pending"===a.status?(k(),C("div",aa," Waiting... ")):"running"===a.status?(k(),C("div",ta," Processing... ")):"failed"===a.status?(k(),C("div",la,S(a.result?.error||"API call failed"),1)):a.result?.content?(k(),C("div",ia,S(oe(String(a.result.content),100)),1)):(k(),C("div",ra," No content "))])):"time"===e.key?(k(),C("div",sa,[a.completed?(k(),C("div",na,[T("div",oa,S((t=a.completed.getTime()-a.created.getTime(),t<1e3?`${t}ms`:`${(t/1e3).toFixed(1)}s`)),1),a.response?(k(),C("div",ua,S(a.response.latencyMs)+"ms",1)):x("",!0)])):(k(),C("div",ca,"—"))])):x("",!0)];var t}),_:1},8,["data-source"])]))])]),_:1}),d(s,{key:"pivot"},{tab:_(()=>a[11]||(a[11]=[T("span",{style:{"font-size":"20px","font-weight":"500"}},"Pivot Table",-1)])),default:_(()=>[T("div",da,[T("div",va,[u.value.length>0?(k(),h(K,{key:0,"api-calls":ee.value,trial:o.value,config:$.value,"show-totals":!0,onConfigChange:ge,onCellClick:me},null,8,["api-calls","trial","config"])):(k(),C("div",pa,a[12]||(a[12]=[T("div",{class:"placeholder-content"},[T("h4",null,"No Data Available"),T("p",null,"Start the trial to see pivot table analysis.")],-1)])))])])]),_:1})]),_:1},8,["activeKey"])])):(k(),C("div",fa,[T("div",ga,[y.value?(k(),C("div",ma,[d(M(r),{size:"large"},{tip:_(()=>a[13]||(a[13]=[I("Loading trial data...")])),_:1})])):(k(),C("div",ya,a[14]||(a[14]=[T("h4",null,"No Trial Selected",-1),T("p",null,"Click on a trial card to monitor its execution progress and view results.",-1)])))])])),p.value?(k(),h(B,{key:2,"api-call":p.value,trial:o.value,onClose:a[3]||(a[3]=e=>p.value=null)},null,8,["api-call","trial"])):x("",!0),b.value?(k(),h(ve,{key:3,row:b.value.row,column:b.value.column,"api-calls":b.value.apiCalls,trial:o.value,value:b.value.value,onClose:a[4]||(a[4]=e=>b.value=null)},null,8,["row","column","api-calls","trial","value"])):x("",!0)])}}}),[["__scopeId","data-v-879ea551"]]),ha={class:"trials-table-container full-width scientific-table-wrapper","data-testid":"trials-table-container"},ka={key:0,class:"trial-name-cell"},wa={class:"trial-header"},_a={class:"trial-name"},Ta={class:"trial-design"},Ca={class:"text-secondary"},xa={key:1,class:"progress-cell"},Ia={class:"progress-text text-xs"},Sa={key:0,class:"network-errors"},Pa={key:4,class:"api-calls-cell"},Fa={class:"total-calls"},Ea={class:"calls-calculation text-secondary"},$a={key:0},za={key:1,class:"text-secondary"},Da={class:"date-cell"},ja={class:"date-value"},Oa={class:"time-value text-secondary"},Aa={key:7,class:"trial-actions-4"},Ma=t(y({__name:"TrialsTable",props:{trials:{},isLoading:{type:Boolean,default:!1}},emits:["trial-selected","trial-started","trial-paused","trial-resumed","trial-cancelled","trial-exported","trial-duplicated","trial-deleted","trial-viewed","trial-export-data","trial-export-python","trial-edited","trial-retried","status-filter-changed"],setup(e,{emit:t}){const l=e,i=t,r=g("all"),s=[{key:"all",label:"All"},{key:"draft",label:"Draft"},{key:"pending",label:"Pending"},{key:"running",label:"Running"},{key:"paused",label:"Paused"},{key:"completed",label:"Completed"},{key:"failed",label:"Failed"},{key:"cancelled",label:"Cancelled"}],{createTrialColumns:n,getVisibleColumns:u}=X(),c=u(n()),v=m(()=>"all"===r.value?l.trials:l.trials.filter(e=>e.status===r.value));function p(e){r.value=e,i("status-filter-changed",e)}function f(e){return{onClick:t=>{const l=t.target;l.closest(".ant-btn")||l.closest(".ant-dropdown-trigger")||(a.debug("Row clicked",{name:e.name,id:e.id}),i("trial-selected",e))}}}function y(e){return"all"===e?l.trials.length:l.trials.filter(a=>a.status===e).length}function b(e){return"failed"===e.status?"exception":"completed"===e.status?"success":e.progress.networkErrors>0?"exception":"normal"}function E(e){const a=[];return"running"===e.status&&a.push("status-running"),"failed"===e.status&&a.push("status-failed"),"completed"===e.status&&a.push("status-completed"),a.join(" ")}function $(e){const a=(new Date).getTime()-e.getTime(),t=Math.floor(a/864e5);return 0===t?"Today":1===t?"Yesterday":t<7?`${t} days ago`:t<30?`${Math.floor(t/7)} weeks ago`:e.toLocaleDateString()}function z(e){const a=Math.abs(e);if(0===a)return"";if(a<.01){const e=a.toFixed(10).match(/0\.0*([1-9])/);if(e){const t=e[0].length-1;return`$${a.toFixed(Math.max(2,t))}`}}return`$${a.toFixed(2)}`}function D(e){i("trial-viewed",e)}function j(e){i("trial-duplicated",e)}return(e,a)=>{const t=w("a-tab-pane"),l=w("a-tabs"),n=w("a-tag"),u=w("a-progress"),g=w("a-tooltip"),m=w("a-button"),A=w("a-menu-item"),L=w("a-menu"),R=w("a-dropdown"),V=w("a-table");return k(),C("div",ha,[d(l,{activeKey:r.value,"onUpdate:activeKey":a[0]||(a[0]=e=>r.value=e),size:"small",class:"status-tabs","data-testid":"trials-status-tabs",onChange:p},{default:_(()=>[(k(),C(P,null,F(s,e=>d(t,{key:e.key,tab:`${e.label} (${y(e.key)})`},null,8,["tab"])),64))]),_:1},8,["activeKey"]),d(V,{columns:M(c),"data-source":v.value,pagination:!1,size:"small",scroll:{y:"calc(100vh - 200px)"},"row-key":"id","row-class-name":E,class:"scientific-table clickable-rows","custom-row":f,"data-testid":"table-trials",role:"table","aria-label":"Trials data table"},{bodyCell:_(({column:e,record:t})=>{return["name"===e.key?(k(),C("div",ka,[T("div",wa,[T("strong",_a,S(t.name),1),d(n,{color:(r=t.status,{draft:"default",pending:"processing",running:"processing",paused:"warning",completed:"success",failed:"error",cancelled:"default"}[r]||"default"),size:"small",class:"trial-status-tag"},{default:_(()=>[I(S(t.status.toUpperCase()),1)]),_:2},1032,["color"])]),T("div",Ta,[T("small",Ca," Design: "+S(t.designSnapshot?.originalName||"Unknown Design"),1)]),a[2]||(a[2]=T("div",{class:"click-hint"},[T("small",{class:"text-secondary"},"Click to view live progress")],-1))])):x("",!0),"progress"===e.key?(k(),C("div",xa,[d(u,{percent:(l=t,0===l.progress.total?0:Math.round(l.progress.completed/l.progress.total*100)),size:"small",status:b(t),"show-info":!1,class:"progress-bar"},null,8,["percent","status"]),T("div",Ia,[I(S(t.progress.completed)+" / "+S(t.progress.total)+" ",1),t.progress.networkErrors>0?(k(),C("span",Sa," ("+S(t.progress.networkErrors)+" errors) ",1)):x("",!0)])])):x("",!0),"configurations"===e.key?(k(),C(P,{key:2},[d(g,{title:`${t.configurationSnapshots?.length||0} model configurations`},{default:_(()=>[d(n,{size:"small",color:"blue"},{default:_(()=>[I(S(t.configurationSnapshots?.length||0)+" configs ",1)]),_:2},1024)]),_:2},1032,["title"]),t.repeatConfig?.callsPerPrompt&&t.repeatConfig.callsPerPrompt>1?(k(),h(n,{key:0,size:"small",color:"purple",style:{"margin-left":"4px"}},{default:_(()=>[I(S(t.repeatConfig.callsPerPrompt)+"× repeat ",1)]),_:2},1024)):x("",!0)],64)):x("",!0),"variables"===e.key?(k(),h(g,{key:3,title:`${t.totalCombinations} variable combinations`},{default:_(()=>[d(n,{size:"small",color:"green"},{default:_(()=>[I(S(t.totalCombinations)+" combos ",1)]),_:2},1024)]),_:2},1032,["title"])):x("",!0),"api_calls"===e.key?(k(),C("div",Pa,[T("span",Fa,S(t.progress.total),1),T("small",Ea,[I(S(t.configurationSnapshots?.length||0)+" × "+S(t.totalCombinations),1),t.repeatConfig?.callsPerPrompt&&t.repeatConfig.callsPerPrompt>1?(k(),C("span",$a," × "+S(t.repeatConfig.callsPerPrompt),1)):x("",!0)])])):x("",!0),"cost"===e.key?(k(),C("span",{key:5,class:O(["cost-cell",{negative:t.estimatedCost<0}])},[z(t.estimatedCost)?(k(),C(P,{key:0},[I(S(z(t.estimatedCost)),1)],64)):(k(),C("span",za,"-"))],2)):x("",!0),"created"===e.key?(k(),h(g,{key:6,title:t.created.toLocaleString()},{default:_(()=>{return[T("div",Da,[T("span",ja,S($(t.created)),1),T("small",Oa,S((e=t.created,e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))),1)])];var e}),_:2},1032,["title"])):x("",!0),"actions"===e.key?(k(),C("div",Aa,["draft"===t.status||"pending"===t.status?(k(),h(m,{key:0,size:"small",type:"primary",onClick:q(e=>function(e){i("trial-started",e)}(t),["stop"]),"data-testid":"trial-start-btn","data-trial-id":t.id,"aria-label":`Start trial ${t.name}`},{default:_(()=>a[3]||(a[3]=[I(" Start ")])),_:2,__:[3]},1032,["onClick","data-trial-id","aria-label"])):"running"===t.status?(k(),h(m,{key:1,size:"small",type:"primary",onClick:q(e=>D(t),["stop"]),"data-testid":"trial-view-live-btn","data-trial-id":t.id,"aria-label":`View live progress for ${t.name}`},{default:_(()=>a[4]||(a[4]=[I(" View Live ")])),_:2,__:[4]},1032,["onClick","data-trial-id","aria-label"])):"completed"===t.status?(k(),h(m,{key:2,size:"small",type:"primary",onClick:q(e=>D(t),["stop"]),"data-testid":"trial-results-btn","data-trial-id":t.id,"aria-label":`View results for ${t.name}`},{default:_(()=>a[5]||(a[5]=[I(" Results ")])),_:2,__:[5]},1032,["onClick","data-trial-id","aria-label"])):"failed"===t.status?(k(),h(m,{key:3,size:"small",type:"primary",onClick:q(e=>D(t),["stop"])},{default:_(()=>a[6]||(a[6]=[I(" Details ")])),_:2,__:[6]},1032,["onClick"])):"paused"===t.status?(k(),h(m,{key:4,size:"small",type:"primary",onClick:q(e=>function(e){i("trial-resumed",e)}(t),["stop"])},{default:_(()=>a[7]||(a[7]=[I(" Resume ")])),_:2,__:[7]},1032,["onClick"])):x("",!0),"draft"===t.status?(k(),h(m,{key:5,size:"small",onClick:q(e=>function(e){i("trial-edited",e)}(t),["stop"])},{default:_(()=>a[8]||(a[8]=[I(" Edit ")])),_:2,__:[8]},1032,["onClick"])):"running"===t.status?(k(),h(m,{key:6,size:"small",class:"btn-warning",onClick:q(e=>function(e){i("trial-paused",e)}(t),["stop"])},{default:_(()=>a[9]||(a[9]=[I(" Pause ")])),_:2,__:[9]},1032,["onClick"])):"completed"===t.status?(k(),h(m,{key:7,size:"small",onClick:q(e=>j(t),["stop"])},{default:_(()=>a[10]||(a[10]=[I(" Duplicate ")])),_:2,__:[10]},1032,["onClick"])):"failed"===t.status?(k(),h(m,{key:8,size:"small",class:"btn-warning",onClick:q(e=>function(e){i("trial-retried",e)}(t),["stop"])},{default:_(()=>a[11]||(a[11]=[I(" Retry ")])),_:2,__:[11]},1032,["onClick"])):"paused"===t.status?(k(),h(m,{key:9,size:"small",onClick:q(e=>D(t),["stop"])},{default:_(()=>a[12]||(a[12]=[I(" Progress ")])),_:2,__:[12]},1032,["onClick"])):(k(),h(m,{key:10,size:"small",onClick:q(e=>j(t),["stop"])},{default:_(()=>a[13]||(a[13]=[I(" Duplicate ")])),_:2,__:[13]},1032,["onClick"])),d(R,{trigger:"click"},{overlay:_(()=>[d(L,null,{default:_(()=>[d(A,{onClick:e=>function(e){i("trial-export-data",e)}(t)},{default:_(()=>a[15]||(a[15]=[I(" Export Data ")])),_:2,__:[15]},1032,["onClick"]),d(A,{onClick:e=>function(e){i("trial-export-python",e)}(t)},{default:_(()=>a[16]||(a[16]=[I(" Export Python ")])),_:2,__:[16]},1032,["onClick"])]),_:2},1024)]),default:_(()=>[d(m,{size:"small",class:"btn-success",onClick:a[1]||(a[1]=q(()=>{},["stop"]))},{default:_(()=>[a[14]||(a[14]=I(" Export ")),d(M(o))]),_:1,__:[14]})]),_:2},1024),"running"===t.status?(k(),h(m,{key:11,size:"small",danger:"",onClick:q(e=>function(e){i("trial-cancelled",e)}(t),["stop"])},{default:_(()=>a[17]||(a[17]=[I(" Cancel ")])),_:2,__:[17]},1032,["onClick"])):(k(),h(m,{key:12,size:"small",danger:"",onClick:q(e=>function(e){i("trial-deleted",e)}(t),["stop"])},{default:_(()=>a[18]||(a[18]=[I(" Delete ")])),_:2,__:[18]},1032,["onClick"]))])):x("",!0)];var l,r}),_:1},8,["columns","data-source"])])}}}),[["__scopeId","data-v-eadb10a6"]]),La={class:"trials-page-header"},Ra={class:"header-content"},Va={class:"description"},Na={class:"header-actions"},Ua=t(y({__name:"TrialsPageHeader",props:{activeTab:{},currentTrial:{},hasProviders:{type:Boolean}},emits:["create-trial"],setup(e){const a=e,t=m(()=>{switch(a.activeTab){case"all":default:return"Trials";case"current":return a.currentTrial?.name||"Current Trial";case"create":return"Create New Trial"}}),l=m(()=>{switch(a.activeTab){case"all":return"Systematic testing of LLM models with complete reproducibility";case"current":return"Monitor trial execution progress and view results in real-time";case"create":return"Configure and launch a new trial with your selected models and variables";default:return""}}),i=m(()=>"all"===a.activeTab);return(e,a)=>{const r=w("a-button"),s=w("a-alert");return k(),C(P,null,[T("div",La,[T("div",Ra,[T("h1",null,S(t.value),1),T("p",Va,S(l.value),1)]),T("div",Na,[i.value?(k(),h(r,{key:0,type:"primary",size:"default",disabled:!e.hasProviders,onClick:a[0]||(a[0]=a=>e.$emit("create-trial")),"data-testid":"btn-create-trial","aria-label":"Create new trial"},{default:_(()=>a[1]||(a[1]=[I(" Create Trial ")])),_:1,__:[1]},8,["disabled"])):x("",!0)])]),e.hasProviders?x("",!0):(k(),h(s,{key:0,type:"warning",message:"No LLM providers configured",description:"Add keys for external APIs (local Ollama does not need keys) or enable Ollama provider.","show-icon":"",class:"warning-banner",action:""},{action:_(()=>[d(M(H),{to:"/settings"},{default:_(()=>[d(r,{size:"small",type:"primary"},{default:_(()=>a[2]||(a[2]=[I(" Go to Settings ")])),_:1,__:[2]})]),_:1})]),_:1}))],64)}}}),[["__scopeId","data-v-499842b9"]]),qa={class:"all-trials-tab"},Ha={key:0,class:"loading-state"},Ka={key:1,class:"empty-state"},Ba={key:2,class:"trials-table-wrapper"},Wa=t(y({__name:"AllTrialsTab",props:{hasProviders:{type:Boolean}},emits:["select-trial","show-create"],setup(e){const t=l(),i=ne(),r=p(),s=g(null),n=g(!1),o=g(null),c=m(()=>t.isLoading),v=m(()=>[...t.trials]);function f(e){a.info("Trial selected in AllTrialsTab",{trialName:e.name,trialId:e.id}),i.selectTrial(e.id)}function y(e){"running"===e.status||"pending"===e.status?i.selectTrial(e.id):"completed"===e.status?r.push({name:"results",query:{trialId:e.id}}):s.value=e}async function b(e){try{await t.executeTrial(e.id),a.info("Trial started",{trialId:e.id}),i.selectTrial(e.id)}catch(l){a.error("Failed to start trial",l),alert("Failed to start trial: "+(l instanceof Error?l.message:"Unknown error"))}}async function S(e){try{await t.pauseTrial(e.id),a.info("Pausing trial",{trialId:e.id})}catch(l){a.error("Failed to pause trial",l),alert("Failed to pause trial")}}async function P(e){try{await t.executeTrial(e.id),a.info("Resuming trial",{trialId:e.id})}catch(l){a.error("Failed to resume trial",l),alert("Failed to resume trial")}}async function F(e){try{await t.cancelTrial(e.id),a.info("Cancelling trial",{trialId:e.id})}catch(l){a.error("Failed to cancel trial",l),alert("Failed to cancel trial")}}async function E(e){await z(e)}async function $(e){alert("Data export functionality coming soon")}async function z(e){try{const{PythonExportService:a}=await u(async()=>{const{PythonExportService:e}=await import("./PivotTableCore-Cl4TvA4W.js").then(e=>e.p);return{PythonExportService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url),t=a.validateTrialForExport(e);if(!t.valid)return void alert(`Cannot export trial:\n${t.errors.join("\n")}`);o.value=e,n.value=!0}catch(t){a.error("Python export failed",t),alert(`Export failed: ${t instanceof Error?t.message:String(t)}`)}}function D(e){a.info("Python script exported",{filename:e})}function j(e){i.navigateToTab("create",{duplicate:e.id})}function O(e){i.navigateToTab("create",{duplicate:e.id,edit:"true"})}async function A(e){if(confirm(`Are you sure you want to delete "${e.name}"? This action cannot be undone.`))try{await t.deleteTrial(e.id)}catch(l){a.error("Failed to delete trial",l),alert("Failed to delete trial")}}function M(){}function L(e){a.info("Status filter changed",{status:e})}return(e,a)=>{const t=w("a-spin"),l=w("a-button"),i=w("a-empty");return k(),C("div",qa,[c.value?(k(),C("div",Ha,[d(t,{size:"large"},{tip:_(()=>a[3]||(a[3]=[I("Loading trials...")])),_:1})])):0===v.value.length?(k(),C("div",Ka,[d(i,{description:e.hasProviders?"No trials yet":"Configure LLM providers to start creating trials"},{image:_(()=>a[4]||(a[4]=[T("div",{style:{color:"#bfbfbf","font-size":"48px"}},"🧪",-1)])),default:_(()=>[e.hasProviders?(k(),h(l,{key:0,type:"primary",onClick:a[0]||(a[0]=a=>e.$emit("show-create"))},{default:_(()=>a[5]||(a[5]=[I(" Create Your First Trial ")])),_:1,__:[5]})):x("",!0)]),_:1},8,["description"])])):(k(),C("div",Ba,[d(Ma,{trials:v.value,"is-loading":c.value,onTrialSelected:f,onTrialStarted:b,onTrialPaused:S,onTrialResumed:P,onTrialCancelled:F,onTrialExported:E,onTrialDuplicated:j,onTrialEdited:O,onTrialDeleted:A,onTrialViewed:y,onTrialExportData:$,onTrialExportPython:z,onStatusFilterChanged:L},null,8,["trials","is-loading"])])),s.value?(k(),h(W,{key:3,trial:s.value,onClose:a[1]||(a[1]=e=>s.value=null),onUpdated:M},null,8,["trial"])):x("",!0),n.value&&o.value?(k(),h(Y,{key:4,trial:o.value,onClose:a[2]||(a[2]=e=>{n.value=!1,o.value=null}),onExported:D},null,8,["trial"])):x("",!0)])}}}),[["__scopeId","data-v-b2e50a4e"]]),Ya={class:"current-trial-tab"},Ga={key:0,class:"no-trial-selected"},Ja={key:1,class:"trial-content"},Xa={class:"trial-header"},Za={key:0,class:"header-actions"},Qa={class:"monitor-wrapper"},et=t(y({__name:"CurrentTrialTab",props:{trialId:{}},setup(e){const t=e,l=ne(),i=g(null);function r(){l.navigateToTab("all")}async function s(){if(t.trialId)try{i.value=await n.trials.get(t.trialId)||null,i.value||a.warn("Trial not found",{trialId:t.trialId})}catch(e){a.error("Failed to load trial",e),i.value=null}else i.value=null}return j(()=>t.trialId,()=>{s()},{immediate:!0}),z(()=>{s()}),(e,a)=>{const t=w("a-button"),l=w("a-empty");return k(),C("div",Ya,[e.trialId?(k(),C("div",Ja,[T("div",Xa,[T("h2",null,S(i.value?.name||"Loading..."),1),i.value?(k(),C("div",Za,[d(t,{size:"small",onClick:r,"data-testid":"btn-back-to-trials"},{default:_(()=>a[2]||(a[2]=[I(" ← Back to Trials ")])),_:1,__:[2]})])):x("",!0)]),T("div",Qa,[d(ba,{"trial-id":e.trialId},null,8,["trial-id"])])])):(k(),C("div",Ga,[d(l,{description:"No trial selected"},{image:_(()=>a[0]||(a[0]=[T("div",{style:{color:"#bfbfbf","font-size":"48px"}},"📊",-1)])),default:_(()=>[d(t,{type:"primary",onClick:r},{default:_(()=>a[1]||(a[1]=[I(" View All Trials ")])),_:1,__:[1]})]),_:1})]))])}}}),[["__scopeId","data-v-cfb9f40c"]]),at={class:"create-trial-tab"},tt={class:"tab-content"},lt=t(y({__name:"CreateTrialTab",props:{initialDesignId:{},duplicateFrom:{}},setup(e){const t=e,l=f(),i=ne(),r=g(),s=g(null),o=g(!1);async function u(){const e=l.query;if(e.design&&"string"==typeof e.design?r.value=e.design:t.initialDesignId&&(r.value=t.initialDesignId),e.duplicate&&"string"==typeof e.duplicate)try{const a=await n.trials.get(e.duplicate);a&&(s.value=a,o.value="true"===e.edit)}catch(i){a.error("Failed to load trial for duplication",i)}else t.duplicateFrom&&(s.value=t.duplicateFrom)}function c(){i.navigateToTab("all")}function v(e){a.info("Trial created",{trialId:e}),i.navigateToTab("all")}async function p(e){a.info("Trial created and started",{trialId:e}),await new Promise(e=>setTimeout(e,100)),i.selectTrial(e)}function m(e){a.info("Trial export requested",{trialId:e.id})}return j(()=>l.query,()=>{"create"===i.currentTab&&u()}),z(()=>{u()}),(e,a)=>(k(),C("div",at,[T("div",tt,[d(G,{initialDesignId:r.value,trialToDuplicate:s.value||void 0,isEditMode:o.value,"is-tab-mode":!0,onClose:c,onCreated:v,onCreatedAndStarted:p,onExportTrial:m},null,8,["initialDesignId","trialToDuplicate","isEditMode"])])]))}}),[["__scopeId","data-v-9eb6af2d"]]),it={class:"trials-view full-width","data-testid":"page-trials"},rt={key:0,class:"trials-view-tabs"},st={key:1},nt={class:"page-header"},ot={class:"header-actions"},ut={class:"main-content"},ct={key:0,class:"loading-state"},dt={key:1,class:"empty-state"},vt={key:2,class:"trials-table-wrapper"},pt={key:0,class:"monitoring-content"},ft={key:1,class:"monitoring-placeholder"},gt=t(y({__name:"TrialsView",setup(e){const t=l(),i=c(),r=ne(),s=f(),n=p(),o=m(()=>!1),v=function(){const e=f(),a=ne();function t(e,t){a.navigateToTab(e,t)}return{activeTab:m(()=>{const a=e.query.tab;return a&&["all","current","create"].includes(a)?a:"all"}),currentTrialId:m(()=>e.query.id||null),currentSubtab:m(()=>{const a=e.query.subtab;return a&&["list","pivot"].includes(a)?a:"list"}),isNavigating:m(()=>a.isNavigating),navigateToTab:t,selectTrial:function(e){a.selectTrial(e)},clearCurrentTrial:function(){a.clearCurrentTrial()},setSubtab:function(e){a.setSubtab(e)},createTrialWithDesign:function(e){t("create",{design:e})},duplicateTrial:function(e){t("create",{duplicate:e})},editTrial:function(e){t("create",{duplicate:e,edit:"true"})},listViewFilters:m(()=>a.listViewFilters),pivotConfig:m(()=>a.pivotConfig),saveListFilters:a.saveListFilters,savePivotConfig:a.savePivotConfig}}(),y=g(!1),b=g(null),S=g(null),P=g(!1),F=g(!1),E=g(null),$=g(null),D=g(!1),O=g(),A=m(()=>t.isLoading),L=m(()=>[...t.trials]),R=m({get:()=>v.activeTab.value,set:e=>v.navigateToTab(e)}),V=m(()=>v.currentTrialId.value),N=m(()=>V.value&&L.value.find(e=>e.id===V.value)||null),U=m(()=>i.hasAnyApiKeys||i.isProviderEnabled("ollama-chat")||i.isProviderEnabled("ollama-generate"));function q(e){a.info("Trial selected in TrialsView",{trialName:e.name,trialId:e.id}),S.value=e,P.value=!0}function K(e){a.info("Status filter changed",{status:e})}function B(e){"running"===e.status||"pending"===e.status?q(e):"completed"===e.status?n.push({name:"results",query:{trialId:e.id}}):b.value=e}function J(){pe()}async function X(e){try{await t.executeTrial(e.id),a.info("Trial started",{trialId:e.id}),q(e)}catch(l){a.error("Failed to start trial",l),alert("Failed to start trial: "+(l instanceof Error?l.message:"Unknown error"))}}async function Z(e){try{await t.pauseTrial(e.id),a.info("Pausing trial",{trialId:e.id})}catch(l){a.error("Failed to pause trial",l),alert("Failed to pause trial")}}async function Q(e){try{await t.executeTrial(e.id),a.info("Resuming trial",{trialId:e.id})}catch(l){a.error("Failed to resume trial",l),alert("Failed to resume trial")}}async function ee(e){try{await t.cancelTrial(e.id),a.info("Cancelling trial",{trialId:e.id})}catch(l){a.error("Failed to cancel trial",l),alert("Failed to cancel trial")}}async function ae(e){await le(e)}async function te(e){alert("Data export functionality coming soon")}async function le(e){try{const{PythonExportService:a}=await u(async()=>{const{PythonExportService:e}=await import("./PivotTableCore-Cl4TvA4W.js").then(e=>e.p);return{PythonExportService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url),t=a.validateTrialForExport(e);if(!t.valid)return void alert(`Cannot export trial:\n${t.errors.join("\n")}`);E.value=e,F.value=!0}catch(t){a.error("Python export failed",t),alert(`Export failed: ${t instanceof Error?t.message:String(t)}`)}}function ie(e){a.info("Python script exported",{filename:e})}function re(e){o.value?v.duplicateTrial(e.id):($.value=e,D.value=!1,y.value=!0)}function se(e){o.value?v.editTrial(e.id):($.value=e,D.value=!0,y.value=!0)}async function oe(e){if(confirm(`Are you sure you want to delete "${e.name}"? This action cannot be undone.`))try{await t.deleteTrial(e.id)}catch(l){a.error("Failed to delete trial",l),alert("Failed to delete trial")}}function ue(e){a.info("Trial created",{trialId:e})}async function ce(e){if(a.info("Trial created and started",{trialId:e}),o.value)v.selectTrial(e);else{await new Promise(e=>setTimeout(e,100));let t=L.value.find(a=>a.id===e),l=0;for(;!t&&l<5;)await new Promise(e=>setTimeout(e,200)),t=L.value.find(a=>a.id===e),l++;t?(S.value=t,P.value=!0):a.warn("Could not find trial for monitoring",{trialId:e})}}function de(e){a.info("Opening export for trial",{trialId:e.id}),E.value=e,F.value=!0}function ve(){}function pe(){o.value?v.navigateToTab("create"):y.value=!0}function fe(e){v.navigateToTab(e)}function ge(e){v.selectTrial(e.id)}return j(()=>s.query,()=>{o.value&&r.syncWithRoute()},{immediate:!0}),z(async()=>{if(await t.initialize(),o.value)r.syncWithRoute();else{const e=s.query.designId;e&&(O.value=e,y.value=!0)}}),(e,a)=>{const t=w("a-tab-pane"),l=w("a-tabs"),i=w("a-button"),r=w("a-alert"),s=w("a-spin"),n=w("a-empty"),u=w("a-modal");return k(),C("div",it,[o.value?(k(),C("div",rt,[d(Ua,{"active-tab":R.value,"current-trial":N.value,"has-providers":U.value,onCreateTrial:pe},null,8,["active-tab","current-trial","has-providers"]),d(l,{activeKey:R.value,"onUpdate:activeKey":a[0]||(a[0]=e=>R.value=e),onChange:fe,class:"trials-tabs",type:"card",size:"large"},{default:_(()=>[d(t,{key:"all",tab:"All Trials"},{default:_(()=>[d(Wa,{"has-providers":U.value,onSelectTrial:ge,onShowCreate:pe},null,8,["has-providers"])]),_:1}),d(t,{key:"current",tab:"Current Trial",disabled:!V.value},{default:_(()=>[V.value?(k(),h(et,{key:0,"trial-id":V.value},null,8,["trial-id"])):x("",!0)]),_:1},8,["disabled"]),d(t,{key:"create",tab:"Create Trial"},{default:_(()=>[d(lt)]),_:1})]),_:1},8,["activeKey"])])):(k(),C("div",st,[T("div",nt,[a[7]||(a[7]=T("div",{class:"header-content"},[T("h1",null,"Trials"),T("p",{class:"description"}," Systematic testing of LLM models with complete reproducibility ")],-1)),T("div",ot,[d(i,{type:"primary",size:"default",disabled:!U.value,onClick:J,"data-testid":"btn-create-trial","aria-label":"Create new trial"},{default:_(()=>a[6]||(a[6]=[I(" Create Trial ")])),_:1,__:[6]},8,["disabled"])])]),U.value?x("",!0):(k(),h(r,{key:0,type:"warning",message:"No LLM providers configured",description:"Add keys for external APIs (local Ollama does not need keys) or enable Ollama provider.","show-icon":"",class:"warning-banner",action:""},{action:_(()=>[d(M(H),{to:"/settings"},{default:_(()=>[d(i,{size:"small",type:"primary"},{default:_(()=>a[8]||(a[8]=[I(" Go to Settings ")])),_:1,__:[8]})]),_:1})]),_:1})),T("div",ut,[A.value?(k(),C("div",ct,[d(s,{size:"large"},{tip:_(()=>a[9]||(a[9]=[I("Loading trials...")])),_:1})])):0===L.value.length?(k(),C("div",dt,[d(n,{description:U.value?"No trials yet":"Configure LLM providers to start creating trials"},{image:_(()=>a[10]||(a[10]=[T("div",{style:{color:"#bfbfbf","font-size":"48px"}},"🧪",-1)])),default:_(()=>[U.value?(k(),h(i,{key:0,type:"primary",onClick:a[1]||(a[1]=e=>y.value=!0)},{default:_(()=>a[11]||(a[11]=[I(" Create Your First Trial ")])),_:1,__:[11]})):x("",!0)]),_:1},8,["description"])])):(k(),C("div",vt,[d(Ma,{trials:L.value,"is-loading":A.value,onTrialSelected:q,onTrialStarted:X,onTrialPaused:Z,onTrialResumed:Q,onTrialCancelled:ee,onTrialExported:ae,onTrialDuplicated:re,onTrialEdited:se,onTrialDeleted:oe,onTrialViewed:B,onTrialExportData:te,onTrialExportPython:le,onStatusFilterChanged:K},null,8,["trials","is-loading"])]))])])),o.value?x("",!0):(k(),h(u,{key:2,open:P.value,"onUpdate:open":a[2]||(a[2]=e=>P.value=e),title:`Live Progress: ${S.value?.name||"Trial"}`,width:"95vw",footer:null,"body-style":{padding:0,height:"90vh",overflow:"auto"},"destroy-on-close":!0,centered:!0},{default:_(()=>[S.value?(k(),C("div",pt,[d(ba,{"trial-id":S.value.id},null,8,["trial-id"])])):(k(),C("div",ft,[d(n,{description:"No trial selected for monitoring"})]))]),_:1},8,["open","title"])),!o.value&&y.value?(k(),h(G,{key:3,initialDesignId:O.value,trialToDuplicate:$.value||void 0,isEditMode:D.value,onClose:a[3]||(a[3]=e=>{y.value=!1,O.value=void 0,$.value=null,D.value=!1}),onCreated:ue,onCreatedAndStarted:ce,onExportTrial:de},null,8,["initialDesignId","trialToDuplicate","isEditMode"])):x("",!0),b.value?(k(),h(W,{key:4,trial:b.value,onClose:a[4]||(a[4]=e=>b.value=null),onUpdated:ve},null,8,["trial"])):x("",!0),F.value&&E.value?(k(),h(Y,{key:5,trial:E.value,onClose:a[5]||(a[5]=e=>{F.value=!1,E.value=null}),onExported:ie},null,8,["trial"])):x("",!0)])}}}),[["__scopeId","data-v-fc1d26ed"]]);export{gt as default};
