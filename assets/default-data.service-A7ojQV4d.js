import{d as s}from"./index-JPKDQHeA.js";import{a,g as t,d as e}from"./defaultData-DyqJdH2z.js";import"./vendor-BiapkIQZ.js";import"./db-CL8uhZCz.js";class i{static async importDefaults(i,n){const r={};let d=0,l=0;const o=n?a.filter(s=>n.includes(s.name)):a;for(const a of o){const e=await s.variableLists.where("name").equals(a.name).first();if(e){r[a.name]=e.id;continue}const i=t(),n=new Date;await s.variableLists.add({...a,id:i,created:n,updated:n}),r[a.name]=i,d++}const c=i?e.filter(s=>i.includes(s.name)):e;for(const a of c){if(await s.designs.where("name").equals(a.name).first())continue;const e=t(),i=new Date,n=await this.processVariableBindings(a.variableBindings,r);let d=a.refusalWordsListRef;!d&&a.refusalWords&&(d=r["Standard Refusal Patterns"]),await s.designs.add({...a,id:e,variableBindings:n,refusalWordsListRef:d,created:i,updated:i}),l++}return{designs:l,lists:d}}static async processVariableBindings(a,t){const e={...a};for(const[i,n]of Object.entries(e))if("list"===n.type&&n.listName){const a=t[n.listName];if(a){const t=await s.variableLists.get(a);t&&"simple"===t.category&&t.values?e[i]={type:"direct",values:[...t.values],source:{listId:t.id,listName:t.name}}:n.listId=a}else n.listId=""}return e}static async loadDefaultsOnFirstRun(){return 0===await s.variableLists.count()&&(await this.importDefaults(),!0)}}export{i as DefaultDataService};
