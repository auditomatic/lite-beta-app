import{d as a,f as t,c as e,o as l,a6 as s,_ as n,a0 as i,F as o,a8 as r,Y as d,a1 as c,q as u,ad as b}from"./vendor-AtAbR8ZE.js";import{u as p,l as m,r as v,_ as f}from"./index-CUKeN6v3.js";import{u as g}from"./designs-db-DRTwaT6B.js";import{u as w}from"./variables-db-w0s2OEpK.js";import{s as y}from"./storage-calculation.service-CZViCrkn.js";import"./db-CL8uhZCz.js";import"./defaultData-Bk-Mi7PC.js";import"./variable.service-CAlTEhg4.js";function k(a,t){if(Array.isArray(a))return a.map(a=>k(a,t));const e={...a};for(const l of t)e[l]&&"string"==typeof e[l]&&(e[l]=new Date(e[l]));return e}function h(a){return k(a,["created","started","completed"])}function C(a){return k(a,["created","updated"])}function x(a){return k(a,["created","updated"])}function D(a){return k(a,["created"])}function S(a){return k(a,["created","completed"])}const L={class:"debug-view","data-testid":"page-debug"},I={class:"section"},_={class:"info-grid"},j={class:"info-item"},$={class:"info-item"},A={class:"info-item"},E={class:"info-item"},O={class:"section"},R={class:"table-header"},U={class:"table-actions"},V=["onClick","data-testid","aria-label"],T=["onClick","data-testid","aria-label"],P=["onClick","disabled","data-testid","aria-label"],J={key:0,class:"table-content"},M={class:"table-controls"},N=["onUpdate:modelValue","data-testid","aria-label"],z=["onClick","data-testid","aria-label"],F={class:"table-data"},q=["onClick","data-testid","aria-label","aria-expanded"],B=f(a({__name:"DebugView",setup(a){const f=g(),k=w(),B=p(),Y=t(new Set),Z=t({}),G=t({}),H=t(""),K=t(),Q=t(null),W=e(()=>({dbVersion:"1.0.0",totalRecords:Object.values(G.value).reduce((a,t)=>a+t.length,0),storageUsed:Q.value?Q.value.formattedUsed:"Calculating...",lastUpdated:(new Date).toLocaleString()})),X=e(()=>[{name:"designs",count:G.value.designs?.length||0},{name:"variableLists",count:G.value.variableLists?.length||0},{name:"trials",count:G.value.trials?.length||0},{name:"models",count:G.value.models?.length||0},{name:"apiCalls",count:G.value.apiCalls?.length||0},{name:"settings",count:G.value.settings?.length||0}]);async function aa(){try{G.value={designs:await v.designs.toArray(),variableLists:await v.variableLists.toArray(),trials:await v.trials.toArray(),models:await v.models.toArray(),apiCalls:await v.apiCalls.toArray(),settings:await v.settings.toArray()}}catch(a){m.error("Failed to load table data",a)}}function ta(a){const t=G.value[a]||[],e=Z.value[a]?.toLowerCase()||"";if(!e)return JSON.stringify(t.slice(0,10),null,2);const l=t.filter(a=>JSON.stringify(a).toLowerCase().includes(e));return JSON.stringify(l.slice(0,10),null,2)}async function ea(){ga({version:"1.0.0",exported:(new Date).toISOString(),data:G.value},`auditomatic_full_export_${Date.now()}.json`)}async function la(){const a=G.value.designs||[],t=G.value.variableLists||[];ga({version:"1.0.0",exported:(new Date).toISOString(),designs:a,variableLists:t},`designs_variables_export_${Date.now()}.json`)}async function sa(){const a=G.value.trials||[],t=G.value.apiCalls||[];ga({version:"1.0.0",exported:(new Date).toISOString(),trials:a,apiCalls:t},`trials_export_${Date.now()}.json`)}async function na(){ga(G.value.models||[],`models_export_${Date.now()}.json`)}async function ia(){ga((G.value.models||[]).map(a=>({id:a.id,provider:a.provider,modelId:a.modelId,enabled:a.enabled})),`model_states_export_${Date.now()}.json`)}function oa(){H.value="fullDatabase",K.value?.click()}function ra(){H.value="designsAndVariables",K.value?.click()}function da(){H.value="trials",K.value?.click()}function ca(){H.value="models",K.value?.click()}function ua(){H.value="modelStates",K.value?.click()}async function ba(a){const t=a.target.files?.[0];if(t){try{const a=await t.text(),e=JSON.parse(a);switch(H.value){case"fullDatabase":await async function(a){const t=function(a){const t={...a};return a.data&&(a.data.trials&&(t.data.trials=h(a.data.trials)),a.data.designs&&(t.data.designs=C(a.data.designs)),a.data.variableLists&&(t.data.variableLists=x(a.data.variableLists)),a.data.models&&(t.data.models=D(a.data.models)),a.data.apiCalls&&(t.data.apiCalls=S(a.data.apiCalls))),t}(a);if(t.data)for(const[e,l]of Object.entries(t.data))await pa(e,l)}(e);break;case"designsAndVariables":await async function(a){if(a.designs){const t=C(a.designs);await v.designs.bulkPut(t)}if(a.variableLists){const t=x(a.variableLists);await v.variableLists.bulkPut(t)}}(e);break;case"trials":await async function(a){if(a.trials){const t=h(a.trials);await v.trials.bulkPut(t)}if(a.apiCalls){const t=S(a.apiCalls);await v.apiCalls.bulkPut(t)}}(e);break;case"models":await async function(a){const t=D(a);await v.models.bulkPut(t)}(e);break;case"modelStates":await async function(a){for(const t of a)await v.models.update(t.id,{enabled:t.enabled})}(e);break;default:G.value[H.value]&&await pa(H.value,e)}await aa(),alert("Import completed successfully!")}catch(e){m.error("Import failed",e),alert("Import failed: "+(e instanceof Error?e.message:"Unknown error"))}K.value&&(K.value.value="")}}async function pa(a,t){const e=v[a];if(e){let l=t;switch(a){case"trials":l=h(t);break;case"designs":l=C(t);break;case"variableLists":l=x(t);break;case"models":l=D(t);break;case"apiCalls":l=S(t)}await e.bulkPut(l)}}async function ma(){confirm("Are you sure you want to clear ALL data? This cannot be undone.")&&(await v.delete(),await v.open(),await aa())}async function va(){confirm("Reset all settings to defaults? This will clear all data.")&&(await ma(),await Promise.all([f.initialize(),k.initialize(),B.initialize()]))}async function fa(){confirm("Regenerate database? This will clear all data and rebuild.")&&(await v.delete(),await v.open(),await aa())}function ga(a,t){const e=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),l=URL.createObjectURL(e),s=document.createElement("a");s.href=l,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(l)}return l(async()=>{await aa();try{Q.value=await y.getStorageInfo()}catch(a){m.warn("Failed to get storage info",{error:a})}}),(a,t)=>(d(),s("div",L,[t[14]||(t[14]=n("div",{class:"header"},[n("h1",null,"Debug & Data Management"),n("p",null,"System diagnostics, database viewer, and import/export tools")],-1)),n("div",I,[t[4]||(t[4]=n("h2",null,"System Information",-1)),n("div",_,[n("div",j,[t[0]||(t[0]=n("label",null,"Database Version:",-1)),n("span",null,i(W.value.dbVersion),1)]),n("div",$,[t[1]||(t[1]=n("label",null,"Records Count:",-1)),n("span",null,i(W.value.totalRecords),1)]),n("div",A,[t[2]||(t[2]=n("label",null,"Storage Used:",-1)),n("span",null,i(W.value.storageUsed),1)]),n("div",E,[t[3]||(t[3]=n("label",null,"Last Updated:",-1)),n("span",null,i(W.value.lastUpdated),1)])])]),n("div",O,[t[5]||(t[5]=n("h2",null,"Database Tables",-1)),(d(!0),s(o,null,r(X.value,a=>(d(),s("div",{key:a.name,class:"table-section"},[n("div",R,[n("h3",null,i(a.name)+" ("+i(a.count)+" records)",1),n("div",U,[n("button",{onClick:t=>async function(a){ga(G.value[a]||[],`${a}_export.json`)}(a.name),class:"export-btn","data-testid":`btn-export-table-${a.name}`,"aria-label":`Export ${a.name} table`},"Export",8,V),n("button",{onClick:t=>{return e=a.name,H.value=e,void K.value?.click();var e},class:"import-btn","data-testid":`btn-import-table-${a.name}`,"aria-label":`Import ${a.name} table`},"Import",8,T),n("button",{onClick:t=>async function(a){if(!confirm(`Are you sure you want to clear all ${a} data? This cannot be undone.`))return;const t=v[a];t&&(await t.clear(),await aa())}(a.name),class:"clear-btn",disabled:0===a.count,"data-testid":`btn-clear-table-${a.name}`,"aria-label":`Clear all ${a.name} data`}," Clear All ",8,P)])]),Y.value.has(a.name)?(d(),s("div",J,[n("div",M,[u(n("input",{"onUpdate:modelValue":t=>Z.value[a.name]=t,placeholder:"Search records...",class:"search-input","data-testid":`input-search-${a.name}`,"aria-label":`Search ${a.name} records`},null,8,N),[[b,Z.value[a.name]]]),n("button",{onClick:t=>async function(){await aa()}(a.name),class:"refresh-btn","data-testid":`btn-refresh-${a.name}`,"aria-label":`Refresh ${a.name} table`},"Refresh",8,z)]),n("div",F,[n("pre",null,i(ta(a.name)),1)])])):c("",!0),n("button",{onClick:t=>{return e=a.name,void(Y.value.has(e)?Y.value.delete(e):Y.value.add(e));var e},class:"toggle-btn","data-testid":`btn-toggle-${a.name}`,"aria-label":`${Y.value.has(a.name)?"Collapse":"Expand"} ${a.name} table`,"aria-expanded":Y.value.has(a.name)},i(Y.value.has(a.name)?"Collapse":"Expand"),9,q)]))),128))]),n("div",{class:"section"},[t[12]||(t[12]=n("h2",null,"Import/Export Tools",-1)),n("div",{class:"export-group"},[t[6]||(t[6]=n("h3",null,"Complete Database",-1)),n("div",{class:"export-actions"},[n("button",{onClick:ea,class:"export-all-btn","data-testid":"btn-export-full-database","aria-label":"Export complete database"},"Export All Data"),n("button",{onClick:oa,class:"import-all-btn","data-testid":"btn-import-full-database","aria-label":"Import complete database"},"Import All Data")])]),n("div",{class:"export-group"},[t[7]||(t[7]=n("h3",null,"Designs & Variables",-1)),t[8]||(t[8]=n("p",{class:"export-desc"},"Exports designs with their linked variable lists",-1)),n("div",{class:"export-actions"},[n("button",{onClick:la,class:"export-btn","data-testid":"btn-export-designs-variables","aria-label":"Export designs and variables"},"Export Designs+Variables"),n("button",{onClick:ra,class:"import-btn","data-testid":"btn-import-designs-variables","aria-label":"Import designs and variables"},"Import Designs+Variables")])]),n("div",{class:"export-group"},[t[9]||(t[9]=n("h3",null,"Trials",-1)),t[10]||(t[10]=n("p",{class:"export-desc"},"Exports trials with configuration snapshots and results",-1)),n("div",{class:"export-actions"},[n("button",{onClick:sa,class:"export-btn"},"Export Trials"),n("button",{onClick:da,class:"import-btn"},"Import Trials")])]),n("div",{class:"export-group"},[t[11]||(t[11]=n("h3",null,"Models",-1)),n("div",{class:"export-actions"},[n("button",{onClick:na,class:"export-btn"},"Export All Models"),n("button",{onClick:ca,class:"import-btn"},"Import All Models")]),n("div",{class:"export-actions"},[n("button",{onClick:ia,class:"export-state-btn"},"Export Model States Only"),n("button",{onClick:ua,class:"import-state-btn"},"Import Model States Only")])])]),n("div",{class:"section danger-zone"},[t[13]||(t[13]=n("h2",null,"Danger Zone",-1)),n("div",{class:"danger-actions"},[n("button",{onClick:ma,class:"danger-btn","data-testid":"btn-clear-all-data","aria-label":"Clear all application data"},"Clear All Data"),n("button",{onClick:va,class:"danger-btn","data-testid":"btn-reset-defaults","aria-label":"Reset application to default settings"},"Reset to Defaults"),n("button",{onClick:fa,class:"danger-btn","data-testid":"btn-regenerate-database","aria-label":"Regenerate database structure"},"Regenerate Database")])]),n("input",{ref_key:"fileInput",ref:K,type:"file",accept:".json",onChange:ba,style:{display:"none"},"data-testid":"input-file-import","aria-label":"Select JSON file to import"},null,544)]))}}),[["__scopeId","data-v-cbedced9"]]);export{B as default};
