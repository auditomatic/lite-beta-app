import{_ as e}from"./BaseModal.vue_vue_type_style_index_0_lang-Bs7DwrLe.js";import{d as a,a9 as t,Z as l,$ as i,a0 as s,ag as n,f as o,c as r,w as d,o as c,b as u,ab as p,X as v,F as m,k as g,Y as f,_ as b,a2 as y,ad as h,aa as C,G as k,u as _,H as T,ak as w,n as I}from"./vendor-BePovdhV.js";import{_ as S,a as D,s as x,v as M,u as P,G as $,K as E,c as N,d as O,b as z,p as j,j as F,l as V,E as B,T as L,f as A}from"./index-usdRBVPx.js";import{u as U}from"./useEnvironmentalCost-R7W_l3H_.js";import{a as q}from"./cost-formatting-Bv_drrqY.js";import{G as J}from"./GenericModelSelectorModal-F286-aIC.js";const H={class:"modal-footer"},R={key:0,class:"footer-left"},W={class:"footer-actions"},G=S(a({__name:"ModalFooter",setup:e=>(e,a)=>(l(),t("div",H,[e.$slots.left?(l(),t("div",R,[n(e.$slots,"left",{},void 0,!0)])):i("",!0),s("div",W,[n(e.$slots,"default",{},void 0,!0)])]))}),[["__scopeId","data-v-3a3879d0"]]),Y={key:0,class:"preview-controls"},Z={key:0,class:"cycle-info"},K=["innerHTML"],Q={key:1,class:"variable-legend"},X={class:"variable-value"},ee=S(a({__name:"TemplatePreview",props:{design:{},template:{},variables:{},tabularData:{},cycling:{type:Boolean,default:!0},cyclingPaused:{type:Boolean,default:!1},cyclingSpeed:{default:1e3},showControls:{default:"none"},displayMode:{default:"block"},showLegend:{type:Boolean,default:!1},maxHeight:{default:"300px"},previewMode:{type:Boolean,default:!1}},emits:["update:cyclingPaused","update:previewMode"],setup(e,{emit:a}){const n=e,T=a,w=D(),I=o(0);let S=null;const P=["variable-highlight-blue","variable-highlight-green","variable-highlight-purple","variable-highlight-orange","variable-highlight-pink","variable-highlight-teal"],$=r(()=>n.design?n.design.promptTemplate:n.template||""),E=r(()=>{if(n.tabularData&&n.tabularData.length>0)return n.tabularData.map(e=>{const a={};return Object.keys(e).forEach(t=>{let l=t.replace(/[^a-zA-Z0-9_]/g,"_");/^[a-zA-Z]/.test(l)||(l="col_"+l),l=l.replace(/_+/g,"_"),l=l.replace(/_+$/,""),a[l]=String(e[t]||"")}),a});if("aligned"===n.design?.executionMode&&n.design?.variableBindings?.__tabular__){const e=n.design.variableBindings.__tabular__;if("list"===e.type&&e.listId){const a=w.lists.find(a=>a.id===e.listId);if("tabular"===a?.category&&a.tabularData)return a.tabularData.rows.map(e=>{const t={};return a.tabularData.columns.forEach(a=>{t[a]=String(e[a]||"")}),t})}}const e=[];if(n.design?.variableBindings){for(const[t,l]of Object.entries(n.design.variableBindings))if("direct"===l.type&&l.values)e.push({name:t,values:[...l.values]});else if("list"===l.type&&l.listId){const a=w.lists.find(e=>e.id===l.listId);a&&("simple"===a.category&&a.values?e.push({name:t,values:[...a.values]}):"attributed"===a.category&&a.items&&e.push({name:t,values:a.items.map(e=>e.value)}))}}else if(n.variables)for(const[t,l]of Object.entries(n.variables))l.length>0&&e.push({name:t,values:[...l]});if(0===e.length)return[];const a=e.map(e=>e.values);return a.reduce((e,a)=>e.flatMap(e=>a.map(a=>[...e,a])),[[]]).map(a=>{const t={};return e.forEach((e,l)=>{t[e.name]=a[l]}),t})}),N=r(()=>E.value.length),O=r(()=>0===E.value.length?{}:E.value[I.value%E.value.length]),z=r(()=>{let e=$.value;"inline"===n.displayMode&&(e=e.replace(/\s+/g," ").trim());let a=F(e);if(E.value.length>0&&(n.cycling||n.previewMode)){const e=O.value;Object.keys(e).forEach((t,l)=>{const i=e[t];if(void 0!==i){const e=new RegExp(`\\{\\{\\s*${s=t,s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\s*\\}\\}`,"g"),n=`<span class="${j(l)}">${F(i)}</span>`;a=a.replace(e,n)}var s})}return a});function j(e){return P[e%P.length]}function F(e){const a=document.createElement("div");return a.textContent=e,a.innerHTML}function V(){T("update:cyclingPaused",!n.cyclingPaused)}function B(){T("update:previewMode",!n.previewMode)}function L(){!n.cycling||n.cyclingPaused||E.value.length<=1||(A(),S=setInterval(()=>{I.value=(I.value+1)%E.value.length},n.cyclingSpeed))}function A(){S&&(clearInterval(S),S=null)}return d([()=>n.cycling,()=>n.cyclingPaused],()=>{n.cycling&&!n.cyclingPaused?L():A()},{immediate:!0}),d(()=>n.template,()=>{I.value=0}),c(()=>{n.cycling&&!n.cyclingPaused&&L()}),u(()=>{A()}),(e,a)=>{const n=f("a-button");return l(),t("div",{class:p(["template-preview",[`preview-${e.displayMode}`,{"preview-cycling":e.cycling&&!e.cyclingPaused}]])},["none"!==e.showControls?(l(),t("div",Y,["pause-play"===e.showControls?(l(),t(m,{key:0},[g(n,{onClick:V,size:"small",type:e.cyclingPaused?"default":"primary",disabled:!e.cycling||N.value<=1},{default:b(()=>[k(y(e.cyclingPaused?"Start":"Pause")+" Variable Substitution ",1)]),_:1},8,["type","disabled"]),e.cycling&&N.value>1?(l(),t("span",Z,y(I.value+1)+" / "+y(N.value),1)):i("",!0)],64)):"editor-mode"===e.showControls?(l(),v(n,{key:1,type:e.previewMode?"default":"primary",onClick:B},{default:b(()=>[e.previewMode?(l(),v(_(M),{key:1})):(l(),v(_(x),{key:0})),k(" "+y(e.previewMode?"Return to Editor":"Preview Filled-In Prompts"),1)]),_:1},8,["type"])):i("",!0)])):i("",!0),s("div",{class:"preview-content",innerHTML:z.value,style:h({maxHeight:e.maxHeight})},null,12,K),e.showLegend&&O.value&&Object.keys(O.value).length>0?(l(),t("div",Q,[(l(!0),t(m,null,C(O.value,(e,a,i)=>(l(),t("div",{key:a,class:"legend-item"},[s("span",{class:p(j(i))},y(a),3),s("span",X,y(e),1)]))),128))])):i("",!0)],2)}}}),[["__scopeId","data-v-e1f62fa2"]]),ae={class:"design-selection-step"},te={class:"step-body"},le={class:"design-selector","data-testid":"design-selector"},ie={key:0,class:"no-designs-state"},se={class:"no-designs-content"},ne={key:1,class:"design-list","data-testid":"design-list"},oe=["data-design-id","data-design-name","onClick"],re={class:"design-header"},de={class:"design-title-section"},ce={class:"design-name"},ue={key:0,class:"design-inline-description"},pe={class:"design-date"},ve={class:"design-stats"},me={class:"stat-item"},ge={class:"stat-value"},fe={class:"stat-item"},be={class:"stat-value"},ye={class:"stat-item"},he={class:"stat-value"},Ce=S(a({__name:"DesignSelectionStep",props:{designSearch:{},filteredDesigns:{},countVariables:{type:Function},formatLastEditDate:{type:Function},getOutputTypeColor:{type:Function},getCombinationCount:{type:Function}},emits:["select","create-new"],setup(e){const a=e,n=P(),{designSearch:o,filteredDesigns:r,countVariables:d,formatLastEditDate:c,getOutputTypeColor:u,getCombinationCount:p}=a;return(e,a)=>{const v=f("a-input"),h=f("a-button"),w=f("a-tag");return l(),t("div",ae,[a[11]||(a[11]=s("div",{class:"step-header"},[s("h3",null,"What are you testing?")],-1)),s("div",te,[s("div",le,[g(v,{value:_(o),"onUpdate:value":a[0]||(a[0]=e=>T(o)?o.value=e:null),placeholder:"Search designs...",size:"large",class:"design-search","data-testid":"input-design-search",allowClear:""},{prefix:b(()=>[g(_(E))]),_:1},8,["value"]),0===_(r).length?(l(),t("div",ie,[s("div",se,[a[4]||(a[4]=s("p",null,"No designs found",-1)),g(h,{onClick:a[1]||(a[1]=()=>_(n).initialize())},{default:b(()=>a[3]||(a[3]=[k("Refresh Designs")])),_:1,__:[3]})])])):(l(),t("div",ne,[(l(!0),t(m,null,C(_(r),n=>(l(),t("div",{key:n.id,class:"design-item","data-testid":"design-item","data-design-id":n.id,"data-design-name":n.name,onClick:a=>e.$emit("select",n)},[s("div",re,[s("div",de,[s("h4",ce,[k(y(n.name)+" ",1),n.description?(l(),t("span",ue,"- "+y(n.description),1)):i("",!0)])]),s("span",pe,y(_(c)(n.updated)),1)]),g(ee,{design:n,cycling:!0,"show-controls":"none","display-mode":"inline","max-height":"none",class:"design-description"},null,8,["design"]),s("div",ve,[g(w,{size:"small",color:_(u)(n.outputType),class:"output-type-tag"},{default:b(()=>[k(y(n.outputType||"text"),1)]),_:2},1032,["color"]),s("span",me,[s("span",ge,y(_(d)(n)),1),a[5]||(a[5]=s("span",{class:"stat-label"},"vars",-1))]),a[8]||(a[8]=s("span",{class:"stat-divider"},"•",-1)),s("span",fe,[s("span",be,y(_(p)(n)),1),a[6]||(a[6]=s("span",{class:"stat-label"},"combos",-1))]),a[9]||(a[9]=s("span",{class:"stat-divider"},"•",-1)),s("span",ye,[s("span",he,y(n.tokenEstimate?.avgTokens||"?"),1),a[7]||(a[7]=s("span",{class:"stat-label"},"tokens",-1))])])],8,oe))),128)),s("div",{class:"design-card design-card-create","data-testid":"btn-create-design",onClick:a[2]||(a[2]=a=>e.$emit("create-new"))},[g(_($),{style:{"font-size":"24px"}}),a[10]||(a[10]=s("span",null,"Create New Design",-1))])]))])])])}}}),[["__scopeId","data-v-a52dcf0e"]]),ke={class:"trial-metadata-form"},_e={class:"form-section"},Te={class:"trial-name-section"},we={class:"repeat-section"},Ie={class:"form-stats"},Se={class:"stat-item"},De={class:"stat-value"},xe={class:"stat-item"},Me={class:"stat-value"},Pe=S(a({__name:"TrialMetadataForm",props:{modelValue:{},totalCombinations:{}},emits:["update:modelValue"],setup(e,{emit:a}){const i=e,n=a;function o(e){n("update:modelValue",{...i.modelValue,trialName:e})}function r(e){n("update:modelValue",{...i.modelValue,repeatCount:e||1})}return(e,a)=>{const i=f("a-input"),n=f("a-input-number");return l(),t("div",ke,[s("div",_e,[s("div",Te,[a[0]||(a[0]=s("label",{class:"form-label"},"Trial Name:",-1)),g(i,{value:e.modelValue.trialName,"onUpdate:value":o,placeholder:"Enter trial name",class:"trial-name-input","data-testid":"input-trial-name",size:"large"},null,8,["value"])]),s("div",we,[a[1]||(a[1]=s("label",{class:"form-label"},"Repeat Each Prompt:",-1)),g(n,{value:e.modelValue.repeatCount,"onUpdate:value":r,min:1,max:10,size:"large",class:"repeat-count-input"},null,8,["value"]),a[2]||(a[2]=s("span",{class:"repeat-suffix"},"times",-1))])]),s("div",Ie,[s("div",Se,[a[3]||(a[3]=s("span",{class:"stat-label"},"Total Combinations:",-1)),s("span",De,y(e.totalCombinations),1)]),s("div",xe,[a[4]||(a[4]=s("span",{class:"stat-label"},"API Calls per Model:",-1)),s("span",Me,y(e.totalCombinations*e.modelValue.repeatCount),1)])])])}}}),[["__scopeId","data-v-50707609"]]),$e={class:"model-configuration-section"},Ee={class:"quick-add-row"},Ne={class:"quick-add-section"},Oe={class:"quick-add-buttons"},ze={key:0,class:"quick-cost"},je={key:0,class:"config-table","data-testid":"model-config-table"},Fe=["data-config-index","data-provider","data-model"],Ve={class:"col-model"},Be={class:"model-name"},Le={class:"model-provider"},Ae={class:"col-params"},Ue={class:"params-text"},qe={class:"col-calls"},Je={class:"calls-breakdown"},He={class:"calls-value"},Re={class:"col-cost"},We={class:"cost-breakdown"},Ge={key:0,class:"cost-value"},Ye={key:1,class:"env-cost"},Ze={class:"col-total"},Ke={class:"cost-breakdown"},Qe={key:0,class:"cost-value total-cost"},Xe={key:1,class:"env-cost"},ea={class:"col-actions"},aa={key:0,class:"table-summary-row"},ta={class:"col-model"},la={class:"summary-label"},ia={class:"col-calls"},sa={class:"summary-calls"},na={class:"col-total"},oa={key:0,class:"summary-cost"},ra={key:1,class:"empty-config-state"},da=S(a({__name:"ModelConfigurationSection",props:{configurations:{},design:{},totalCombinations:{},repeatCount:{}},emits:["show-model-selector","add","remove"],setup(e,{emit:a}){const n=e,o=a,d=N(),c=O(),u=z(),{hasDataForModel:p}=U(),h=r(()=>c.financialCostsEnabled),T=r(()=>c.environmentalCostsEnabled),S=r(()=>n.totalCombinations*n.configurations.length*n.repeatCount),D=r(()=>{let e=0;for(const a of n.configurations)e+=F(a)*n.totalCombinations*n.repeatCount;return e}),x=r(()=>{const e=e=>c.hasApiKey(e),a=(e,a)=>!!d.enabledModels.find(t=>t.provider===e&&t.modelId===a&&t.enabled),t=[],l=new Set,i=[...u.trials].sort((e,a)=>new Date(a.created).getTime()-new Date(e.created).getTime());for(const d of i){if(t.length>=5)break;for(const i of d.configurationSnapshots||[]){if(t.length>=5)break;const s=`${i.provider}:${i.modelId}:${JSON.stringify(i.parameters)}`;if(!l.has(s)&&e(i.provider)&&a(i.provider,i.modelId)){const e=j.getParametersForModel(i.provider,i.modelId);if(!e)continue;if(Object.keys(i.parameters).some(a=>!(a in e)))continue;l.add(s),t.push({provider:i.provider,modelId:i.modelId,displayName:i.modelId,parameters:i.parameters,outputType:"text"})}}}const s=(e,a)=>{const t=j.getParametersForModel(e,a),l={},i=(e,a)=>{Object.entries(e).forEach(([e,t])=>{"object"===t.type&&t.properties?(a[e]={},i(t.properties,a[e])):void 0!==t.default&&(a[e]=t.default)})};i(t,l),l.temperature||!l.options||l.options.temperature||(l.options?l.options.temperature=0:l.temperature=0);const s=(e,a)=>{for(const[t,l]of Object.entries(e))"object"===l.type&&l.properties?(a[t]||(a[t]={}),s(l.properties,a[t])):l.is_output_length&&void 0===a[t]&&(a[t]=128)};return s(t,l),l},n=[{provider:"openai-chat",modelId:"gpt-4.1-nano",displayName:"gpt-4.1-nano",parameters:s("openai-chat","gpt-4.1-nano"),outputType:"text"},{provider:"anthropic",modelId:"claude-3-haiku-20240307",displayName:"claude-3-haiku-20240307",parameters:s("anthropic","claude-3-haiku-20240307"),outputType:"text"}],o=new Set(t.map(e=>`${e.provider}:${e.modelId}:${JSON.stringify(e.parameters)}`));for(const d of n){const l=`${d.provider}:${d.modelId}:${JSON.stringify(d.parameters)}`;!o.has(l)&&e(d.provider)&&a(d.provider,d.modelId)&&t.push(d)}const r=[],p=new Set;for(const d of t){const e=`${d.provider}:${d.modelId}`;p.has(e)||(p.add(e),r.push(d))}return r.slice(0,7)});function M(e){const a=[];for(const[t,l]of Object.entries(e))null!=l&&a.push(`${t}=${l}`);return a.join(", ")||"Default settings"}function P(e){return n.configurations.some(a=>a.provider===e.provider&&a.modelId===e.modelId&&JSON.stringify(a.parameters)===JSON.stringify(e.parameters))}function E(e){const a=d.enabledModels.find(a=>a.provider===e.provider&&a.modelId===e.modelId);if(!a||!n.design)return 0;const t=n.design.tokenEstimate?.avgTokens||0,l=j.getParametersForModel(e.provider,e.modelId);let i=0;for(const[s,n]of Object.entries(l))if(n.is_output_length&&e.parameters[s]){i=e.parameters[s];break}if(0===t||0===i)return 0;return((a.capabilities?.inputCostPerToken||0)*t+(a.capabilities?.outputCostPerToken||0)*i)*n.totalCombinations*n.repeatCount}function F(e){const a=d.enabledModels.find(a=>a.provider===e.provider&&a.modelId===e.modelId);if(!a||!n.design)return 0;const t=n.design.tokenEstimate?.avgTokens||0,l=j.getParametersForModel(e.provider,e.modelId);let i=0;for(const[s,n]of Object.entries(l))if(n.is_output_length&&e.parameters[s]){i=e.parameters[s];break}if(0===t||0===i)return 0;return(a.capabilities?.inputCostPerToken||0)*t+(a.capabilities?.outputCostPerToken||0)*i}function V(e){return F(e)*n.totalCombinations*n.repeatCount}function B(e){return p(e.provider,e.modelId)}function L(e,a){return"per-call"===a?"<1mg CO₂e":"~10mg CO₂e"}return(e,a)=>{const n=f("a-button");return l(),t("div",$e,[s("div",Ee,[g(n,{onClick:a[0]||(a[0]=a=>e.$emit("show-model-selector")),type:"primary",size:"large",class:"big-add-model-btn","data-testid":"btn-add-model","aria-label":"Add Model Configuration"},{default:b(()=>[g(_($)),a[1]||(a[1]=k(" Add Model "))]),_:1,__:[1]}),a[3]||(a[3]=s("div",{class:"separator-bar"},null,-1)),s("div",Ne,[a[2]||(a[2]=s("div",{class:"quick-add-label"},"Quick add recent/popular models (with default temperature=0, max response length = 128):",-1)),s("div",Oe,[(l(!0),t(m,null,C(x.value,e=>(l(),v(n,{key:`${e.provider}:${e.modelId}:${JSON.stringify(e.parameters)}`,onClick:a=>function(e){P(e)||(o("add",{name:e.displayName,provider:e.provider,modelId:e.modelId,parameters:e.parameters}),I(()=>{const e=document.querySelector(".ant-modal-body");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})}))}(e),size:"small",class:"quick-preset-btn",disabled:P(e),"data-testid":"quick-add-model","data-provider":e.provider,"data-model":e.modelId,"aria-label":`Quick add ${e.displayName} model`},{default:b(()=>[k(y(e.displayName)+" ",1),h.value?(l(),t("span",ze,y(_(q)(E(e))),1)):i("",!0)]),_:2},1032,["onClick","disabled","data-provider","data-model","aria-label"]))),128))])])]),e.configurations.length>0?(l(),t("div",je,[a[8]||(a[8]=w('<div class="table-header" data-v-82ddd342><div class="col-model" data-v-82ddd342>Model</div><div class="col-params" data-v-82ddd342>Parameters</div><div class="col-calls" data-v-82ddd342>API Calls</div><div class="col-cost" data-v-82ddd342>Cost per Call</div><div class="col-total" data-v-82ddd342>Total Cost</div><div class="col-actions" data-v-82ddd342>Actions</div></div>',1)),(l(!0),t(m,null,C(e.configurations,(o,r)=>(l(),t("div",{key:r,class:"table-row","data-testid":"model-config-row","data-config-index":r,"data-provider":o.provider,"data-model":o.modelId},[s("div",Ve,[s("div",Be,y(o.provider)+":"+y(o.modelId),1),s("div",Le,y(o.provider),1)]),s("div",Ae,[s("span",Ue,y(M(o.parameters)),1)]),s("div",qe,[s("span",Je,y(e.totalCombinations)+" × "+y(e.repeatCount)+" = ",1),s("span",He,y(e.totalCombinations*e.repeatCount),1)]),s("div",Re,[s("div",We,[h.value?(l(),t("span",Ge,y(_(q)(F(o))),1)):i("",!0),T.value&&B(o)?(l(),t("small",Ye,y(L(0,"per-call")),1)):i("",!0)])]),s("div",Ze,[s("div",Ke,[h.value?(l(),t("span",Qe,y(_(q)(V(o))),1)):i("",!0),T.value&&B(o)?(l(),t("small",Xe,y(L(0,"total")),1)):i("",!0)])]),s("div",ea,[g(n,{type:"text",size:"small",danger:"",onClick:a=>e.$emit("remove",r),class:"remove-btn","data-testid":"remove-model-config","data-config-index":r,"aria-label":`Remove ${o.provider} ${o.modelId} configuration`},{default:b(()=>a[4]||(a[4]=[k("Remove")])),_:2,__:[4]},1032,["onClick","data-config-index","aria-label"])])],8,Fe))),128)),e.configurations.length>1?(l(),t("div",aa,[s("div",ta,[s("div",la,"TOTAL ("+y(e.configurations.length)+" models)",1)]),a[5]||(a[5]=s("div",{class:"col-params"},null,-1)),s("div",ia,[s("span",sa,y(S.value),1)]),a[6]||(a[6]=s("div",{class:"col-cost"},null,-1)),s("div",na,[h.value?(l(),t("span",oa,y(_(q)(D.value)),1)):i("",!0)]),a[7]||(a[7]=s("div",{class:"col-actions"},null,-1))])):i("",!0)])):(l(),t("div",ra,a[9]||(a[9]=[s("p",null,"No models configured yet. Add at least one model to continue.",-1)])))])}}}),[["__scopeId","data-v-82ddd342"]]);const ca={key:0,class:"trial-creation-form"},ua={class:"streamlined-content"},pa={class:"content-section"},va={class:"section-header"},ma={class:"section-body"},ga={key:1,class:"selected-design-with-template"},fa={class:"unified-header"},ba={class:"combinations-count"},ya={class:"header-controls"},ha={class:"design-stats"},Ca={class:"stat-item"},ka={class:"stat-value"},_a={class:"stat-item"},Ta={class:"stat-value"},wa={class:"stat-item"},Ia={class:"stat-value"},Sa={key:0,class:"content-section","data-testid":"trial-config-section"},Da={class:"section-body"},xa={class:"model-section"},Ma={class:"tab-footer"},Pa={class:"footer-actions"},$a={class:"streamlined-content"},Ea={class:"content-section"},Na={class:"section-header"},Oa={class:"section-body"},za={key:1,class:"selected-design-with-template"},ja={class:"unified-header"},Fa={class:"combinations-count"},Va={class:"header-controls"},Ba={class:"design-stats"},La={class:"stat-item"},Aa={class:"stat-value"},Ua={class:"stat-item"},qa={class:"stat-value"},Ja={class:"stat-item"},Ha={class:"stat-value"},Ra={key:0,class:"content-section","data-testid":"trial-config-section"},Wa={class:"section-body"},Ga={class:"model-section"},Ya=S(a({__name:"TrialCreationModalNew",props:{initialDesignId:{},trialToDuplicate:{},isEditMode:{type:Boolean},isTabMode:{type:Boolean}},emits:["close","created","created-and-started","export-trial"],setup(a,{emit:n}){const p=a,m=n,h=r(()=>({type:p.isEditMode?"edit":p.trialToDuplicate?"duplicate":"create",initialDesignId:p.initialDesignId,sourceTrial:p.trialToDuplicate||void 0})),C=D(),T=function(e){const a=P(),t=D(),l=N(),i=z(),s=O(),n=o(null),d=o(""),c=o(1),u=o([]),p=o(!1),v=o(!1),m=o(!1),g=o(!1),f=r(()=>{if(!n.value)return 0;let e=1;for(const a of Object.values(n.value.variableBindings))if("direct"===a.type)e*=a.values?.length||1;else if(a.listId){const l=t.lists.find(e=>e.id===a.listId);e*=l?.itemCount||1}return e}),b=r(()=>f.value*u.value.length*c.value),y=r(()=>{let e=0;for(const a of u.value)e+=_(a)*f.value*c.value;return e}),h=r(()=>null!==n.value&&u.value.length>0);function C(e){n.value=e,d.value=k(e),m.value=!0}function k(e){return e||n.value?`${e?.name||n.value?.name||"Trial"} - ${(new Date).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}`:"New Trial"}function _(e){const a=l.enabledModels.find(a=>a.provider===e.provider&&a.modelId===e.modelId);if(!a)return 0;const t=n.value?.tokenEstimate?.avgTokens||0,i=j.getParametersForModel(e.provider,e.modelId);let s=0;for(const[l,n]of Object.entries(i))if(n.is_output_length&&e.parameters[l]){s=e.parameters[l];break}return 0===t||0===s?0:(a.capabilities?.inputCostPerToken||0)*t+(a.capabilities?.outputCostPerToken||0)*s}return{selectedDesign:n,trialName:d,repeatCount:c,configurations:u,creating:p,showModelSelector:v,liveUpdatePaused:m,showPlaceholders:g,totalCombinations:f,totalExperiments:b,totalCost:y,canProceed:h,selectDesign:C,generateTrialName:k,addConfiguration:function(e){u.value.push(e)},removeConfiguration:function(e){u.value.splice(e,1)},getConfigCostPerCall:_,createDraftTrial:async function(){if(n.value&&0!==u.value.length){p.value="draft";try{const e=await i.createTrial({name:d.value||k(),designId:n.value.id,configurations:u.value.map(e=>({name:e.name,provider:e.provider,modelId:e.modelId,parameters:JSON.parse(JSON.stringify(e.parameters||{}))})),repeatConfig:c.value>1?{callsPerPrompt:c.value,strategy:"sequential"}:void 0});return F.success("Trial created as draft!"),e}catch(e){throw V.error("Failed to create draft trial",e),F.error("Failed to create draft trial"),e}finally{p.value=!1}}},createAndStartTrial:async function(){if(n.value&&0!==u.value.length){p.value="start";try{const e=await i.createTrial({name:d.value||k(),designId:n.value.id,configurations:u.value.map(e=>({name:e.name,provider:e.provider,modelId:e.modelId,parameters:JSON.parse(JSON.stringify(e.parameters||{}))})),repeatConfig:c.value>1?{callsPerPrompt:c.value,strategy:"sequential"}:void 0});return F.success("Trial created! Starting execution..."),i.executeTrial(e).catch(e=>{V.error("Failed to start trial",e),F.error("Failed to start trial execution")}),e}catch(e){throw V.error("Failed to create trial",e),F.error("Failed to create trial"),e}finally{p.value=!1}}},createAndExportTrial:async function(){if(n.value&&0!==u.value.length){p.value="export";try{const e=await i.createTrial({name:d.value||k(),designId:n.value.id,configurations:u.value.map(e=>({name:e.name,provider:e.provider,modelId:e.modelId,parameters:JSON.parse(JSON.stringify(e.parameters||{}))})),repeatConfig:c.value>1?{callsPerPrompt:c.value,strategy:"sequential"}:void 0}),a=await i.getTrial(e);if(!a)throw new Error("Trial not found after creation");return F.success("Trial created! Opening export options..."),a}catch(e){throw V.error("Failed to create trial for export",e),F.error("Failed to create trial for export"),e}finally{p.value=!1}}},initialize:async function(){await Promise.all([a.initialize(),t.initialize(),i.initialize()]);const l=e.value;if(l.initialDesignId){const e=a.designs.find(e=>e.id===l.initialDesignId);e&&C(e)}if(l.sourceTrial){const e=l.sourceTrial,t=a.designs.find(a=>a.id===e.designSnapshot.originalId);t&&(n.value=t,d.value="edit"===l.type?e.name:`Copy of ${e.name}`,e.repeatConfig?.callsPerPrompt&&(c.value=e.repeatConfig.callsPerPrompt),e.configurationSnapshots&&e.configurationSnapshots.length>0&&(u.value=e.configurationSnapshots.map(e=>({name:e.name||e.modelId,provider:e.provider,modelId:e.modelId,parameters:e.parameters||{}}))),m.value=!0)}},designsStore:a,variableListsStore:t,modelsStore:l,settingsStore:s}}(h),w=function(){const e=P(),a=D(),t=o(""),l=o(0);let i=null;const s=r(()=>{const a=e.designs;if(!t.value)return a;const l=t.value.toLowerCase();return a.filter(e=>e.name.toLowerCase().includes(l)||e.promptTemplate.toLowerCase().includes(l))});function n(e){return e.replace(/\n+/g," ").replace(/\s+/g," ").trim()}function d(e){if(!e.variableBindings)return[{}];const t=[];for(const[i,s]of Object.entries(e.variableBindings))if("direct"===s.type&&s.values)t.push({name:i,values:[...s.values]});else if("list"===s.type&&s.listId){const e=a.lists.find(e=>e.id===s.listId);if(e){let a=[];a="simple"===e.category&&e.values?e.values:"attributed"===e.category&&e.items?e.items.map(e=>e.value):[`${i}_sample`],t.push({name:i,values:a})}}if(0===t.length)return[{}];const l=[...t.map(e=>e.values).reduce((e,a)=>e.flatMap(e=>a.map(a=>[...e,a])),[[]])];for(let a=l.length-1;a>0;a--){const e=Math.floor(Math.random()*(a+1));[l[a],l[e]]=[l[e],l[a]]}return l.map(e=>{const a={};return t.forEach((t,l)=>{a[t.name]=e[l]}),a})}function p(e){const a=document.createElement("div");return a.textContent=e,a.innerHTML}function v(){i||(i=setInterval(()=>{l.value++},1e3))}function m(){i&&(clearInterval(i),i=null)}return c(()=>{v()}),u(()=>{m()}),{designSearch:t,previewCycleIndex:l,filteredDesigns:s,countVariables:function(e){return Object.keys(e.variableBindings).length},truncateTemplate:n,formatLastEditDate:function(e){const a=new Date,t=a.getTime()-e.getTime(),l=Math.floor(t/864e5);if(0===l)return"Today";if(1===l)return"Yesterday";if(l<7)return`${l} days ago`;if(l<30){const e=Math.floor(l/7);return`${e} week${e>1?"s":""} ago`}return e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:e.getFullYear()!==a.getFullYear()?"numeric":void 0})},getOutputTypeColor:function(e){return{text:"blue",number:"green",boolean:"purple",json:"orange"}[e]||"default"},getCombinationCount:function(e){if(!e.variableBindings)return"1";let t=1;for(const l of Object.values(e.variableBindings))if("direct"===l.type&&l.values)t*=l.values.length;else if("list"===l.type&&l.listId){const e=a.lists.find(e=>e.id===l.listId);t*=e?.itemCount||1}return t>1e3?`${(t/1e3).toFixed(1)}k`:t.toString()},generateVariableCombinations:d,getPreviewTemplateHTML:function(e){const a=d(e);if(a.length<=1)return p(n(e.promptTemplate));const t=a[l.value%a.length],i=["variable-highlight-blue","variable-highlight-green","variable-highlight-purple","variable-highlight-orange","variable-highlight-pink","variable-highlight-teal"];let s=e.promptTemplate;Object.keys(e.variableBindings||{}).forEach((e,a)=>{if(void 0!==t[e]){const l=new RegExp(`\\{\\{\\s*${e}\\s*\\}\\}`,"g"),n=`<span class="${i[a%i.length]}">${p(String(t[e]))}</span>`;s=s.replace(l,n)}});let o=p(s);return i.forEach(e=>{o=o.replace(new RegExp(`&lt;span class="${e}"&gt;`,"g"),`<span class="${e}">`).replace(/&lt;\/span&gt;/g,"</span>")}),n(o)},escapeHtml:p,startCycling:v,stopCycling:m}}(),I=o(!0),S=r(()=>T.selectedDesign.value),x=r({get:()=>T.trialName.value,set:e=>{T.trialName.value=e}}),M=r({get:()=>T.repeatCount.value,set:e=>{T.repeatCount.value=e}}),$=r(()=>T.configurations.value),E=r({get:()=>T.showModelSelector.value,set:e=>{T.showModelSelector.value=e}}),U=r(()=>T.creating.value),q=r(()=>T.totalCombinations.value),{countVariables:H,getOutputTypeColor:R}=w,W=r(()=>p.isEditMode&&p.trialToDuplicate?`Edit Trial: ${p.trialToDuplicate.name}`:p.trialToDuplicate?`Duplicate Trial: ${p.trialToDuplicate.name}`:"Create New Trial"),Y=r(()=>T.canProceed.value);async function Z(e){0===C.lists.length&&await C.initialize();const a={...e,variableBindings:Object.entries(e.variableBindings).reduce((e,[a,t])=>(e[a]={type:t.type,values:t.values?[...t.values]:void 0,listId:t.listId,listName:t.listName,source:t.source?{...t.source}:void 0},e),{}),tokenEstimate:e.tokenEstimate?{...e.tokenEstimate}:void 0,refusalWords:e.refusalWords?[...e.refusalWords]:void 0};T.selectDesign(a),I.value=!0,w.stopCycling()}async function K(e){try{const a=await A.designs.get(e);a&&T.selectDesign(a)}catch(a){V.error("Failed to load design",a),L.error({title:"Failed to load design",content:a instanceof Error?a.message:"Unknown error"})}}function Q(){T.selectedDesign.value=null,T.configurations.value=[]}async function X(){m("close"),window.location.href="#/designs"}function ae(e){T.trialName.value=e.trialName,T.repeatCount.value=e.repeatCount}function te(e){T.addConfiguration(e)}function le(e){T.removeConfiguration(e)}function ie(e){te(e),T.showModelSelector.value=!1}async function se(){try{const e=await T.createDraftTrial();e&&(m("created",e),m("close"))}catch(e){}}async function ne(){try{const e=await T.createAndExportTrial();e&&(m("export-trial",e),m("close"))}catch(e){}}async function oe(){try{const e=await T.createAndStartTrial();e&&(m("created-and-started",e),m("close"))}catch(e){}}function re(){I.value=!I.value,I.value?w.stopCycling():w.startCycling()}return c(async()=>{await T.initialize(),0===C.lists.length&&await C.initialize()}),d(()=>p.trialToDuplicate,()=>{p.trialToDuplicate&&async function(){if(p.trialToDuplicate)try{p.trialToDuplicate.designSnapshot?.originalId&&await K(p.trialToDuplicate.designSnapshot.originalId),p.isEditMode?T.trialName.value=p.trialToDuplicate.name:T.trialName.value=`${p.trialToDuplicate.name} (Copy)`,T.repeatCount.value=p.trialToDuplicate.repeatConfig?.callsPerPrompt||1,T.configurations.value=p.trialToDuplicate.configurationSnapshots||[]}catch(e){V.error("Failed to initialize duplication",e),L.error({title:"Failed to load trial data",content:e instanceof Error?e.message:"Unknown error"})}}()},{immediate:!0}),d(()=>p.initialDesignId,()=>{p.initialDesignId&&!p.trialToDuplicate&&async function(){p.initialDesignId&&await K(p.initialDesignId)}()},{immediate:!0}),(a,n)=>{const o=f("a-button"),r=f("a-tag");return a.isTabMode?(l(),t("div",ca,[s("div",ua,[s("section",pa,[s("div",va,[n[8]||(n[8]=s("h3",null,"What are you testing?",-1)),S.value?(l(),v(o,{key:0,onClick:Q,size:"small",class:"back-button",style:{"margin-left":"2em"}},{default:b(()=>n[7]||(n[7]=[k(" ← Back to Select Design ")])),_:1,__:[7]})):i("",!0)]),s("div",ma,[S.value?(l(),t("div",ga,[s("div",fa,[s("h4",null,y(S.value.name),1),s("span",ba,y(q.value)+" combinations",1),s("div",ya,[g(o,{onClick:re,size:"small",type:I.value?"default":"primary",class:"pause-btn"},{default:b(()=>[k(y(I.value?"Start Variable Substitution":"Pause Variable Substitution"),1)]),_:1},8,["type"])])]),g(ee,{design:S.value,cycling:!0,"cycling-paused":I.value,"show-controls":"none","display-mode":"inline","max-height":"none",class:"step2-preview","onUpdate:cyclingPaused":n[0]||(n[0]=e=>I.value=e)},null,8,["design","cycling-paused"]),s("div",ha,[g(r,{size:"small",color:_(R)(S.value.outputType),class:"output-type-tag"},{default:b(()=>[k(y(S.value.outputType||"text"),1)]),_:1},8,["color"]),s("span",Ca,[s("span",ka,y(_(H)(S.value)),1),n[9]||(n[9]=s("span",{class:"stat-label"},"vars",-1))]),n[12]||(n[12]=s("span",{class:"stat-divider"},"•",-1)),s("span",_a,[s("span",Ta,y(q.value),1),n[10]||(n[10]=s("span",{class:"stat-label"},"combos",-1))]),n[13]||(n[13]=s("span",{class:"stat-divider"},"•",-1)),s("span",wa,[s("span",Ia,y(S.value.tokenEstimate?.avgTokens||"?"),1),n[11]||(n[11]=s("span",{class:"stat-label"},"tokens",-1))])])])):(l(),v(Ce,{key:0,"design-search":_(w).designSearch,"filtered-designs":_(w).filteredDesigns,"count-variables":_(w).countVariables,"format-last-edit-date":_(w).formatLastEditDate,"get-output-type-color":_(w).getOutputTypeColor,"get-combination-count":_(w).getCombinationCount,onSelect:Z,onCreateNew:X},null,8,["design-search","filtered-designs","count-variables","format-last-edit-date","get-output-type-color","get-combination-count"]))])]),S.value?(l(),t("section",Sa,[n[15]||(n[15]=s("h3",null,"Trial Configuration",-1)),s("div",Da,[g(Pe,{"model-value":{trialName:x.value,repeatCount:M.value},"total-combinations":q.value,"onUpdate:modelValue":ae},null,8,["model-value","total-combinations"]),s("div",xa,[n[14]||(n[14]=s("h4",null,"Model Configuration",-1)),g(da,{configurations:$.value,design:S.value,"total-combinations":q.value,"repeat-count":M.value,onShowModelSelector:n[1]||(n[1]=e=>E.value=!0),onAdd:te,onRemove:le},null,8,["configurations","design","total-combinations","repeat-count"])])])])):i("",!0)]),s("div",Ma,[s("div",Pa,[g(o,{size:"large",onClick:se,loading:"draft"===U.value,disabled:!Y.value,"data-testid":"btn-create-draft-tab","aria-label":"Create trial as draft"},{default:b(()=>n[16]||(n[16]=[k(" Create as Draft ")])),_:1,__:[16]},8,["loading","disabled"]),g(o,{size:"large",onClick:ne,loading:"export"===U.value,disabled:!Y.value,"data-testid":"btn-export-python-tab","aria-label":"Export trial to Python"},{default:b(()=>n[17]||(n[17]=[k(" Export to Python ")])),_:1,__:[17]},8,["loading","disabled"]),g(o,{type:"primary",size:"large",onClick:oe,loading:"start"===U.value,disabled:!Y.value,"data-testid":"btn-create-and-start-tab","aria-label":"Create and start trial execution"},{default:b(()=>[g(_(B)),n[18]||(n[18]=k(" Create and Start "))]),_:1,__:[18]},8,["loading","disabled"])])]),g(J,{open:E.value&&!!S.value,mode:"trial",design:S.value||void 0,"existing-configurations":$.value,onClose:n[2]||(n[2]=e=>E.value=!1),onAddConfiguration:ie},null,8,["open","design","existing-configurations"])])):(l(),v(e,{key:1,"model-value":!0,title:W.value,size:"full","data-testid":"modal-trial-creation","onUpdate:modelValue":n[6]||(n[6]=e=>a.$emit("close"))},{footer:b(()=>[g(G,null,{default:b(()=>[g(o,{size:"large",onClick:se,loading:"draft"===U.value,disabled:!Y.value,"data-testid":"btn-create-draft","aria-label":"Create trial as draft"},{default:b(()=>n[28]||(n[28]=[k(" Create as Draft ")])),_:1,__:[28]},8,["loading","disabled"]),g(o,{size:"large",onClick:ne,loading:"export"===U.value,disabled:!Y.value,"data-testid":"btn-export-python","aria-label":"Export trial to Python"},{default:b(()=>n[29]||(n[29]=[k(" Export to Python ")])),_:1,__:[29]},8,["loading","disabled"]),g(o,{type:"primary",size:"large",onClick:oe,loading:"start"===U.value,disabled:!Y.value,"data-testid":"btn-create-and-start","aria-label":"Create and start trial execution"},{default:b(()=>[g(_(B)),n[30]||(n[30]=k(" Create and Start "))]),_:1,__:[30]},8,["loading","disabled"])]),_:1})]),default:b(()=>[s("div",$a,[s("section",Ea,[s("div",Na,[n[20]||(n[20]=s("h3",null,"What are you testing?",-1)),S.value?(l(),v(o,{key:0,onClick:Q,size:"small",class:"back-button",style:{"margin-left":"2em"}},{default:b(()=>n[19]||(n[19]=[k(" ← Back to Select Design ")])),_:1,__:[19]})):i("",!0)]),s("div",Oa,[S.value?(l(),t("div",za,[s("div",ja,[s("h4",null,y(S.value.name),1),s("span",Fa,y(q.value)+" combinations",1),s("div",Va,[g(o,{onClick:re,size:"small",type:I.value?"default":"primary",class:"pause-btn"},{default:b(()=>[k(y(I.value?"Start Variable Substitution":"Pause Variable Substitution"),1)]),_:1},8,["type"])])]),g(ee,{design:S.value,cycling:!0,"cycling-paused":I.value,"show-controls":"none","display-mode":"inline","max-height":"none",class:"step2-preview","onUpdate:cyclingPaused":n[3]||(n[3]=e=>I.value=e)},null,8,["design","cycling-paused"]),s("div",Ba,[g(r,{size:"small",color:_(R)(S.value.outputType),class:"output-type-tag"},{default:b(()=>[k(y(S.value.outputType||"text"),1)]),_:1},8,["color"]),s("span",La,[s("span",Aa,y(_(H)(S.value)),1),n[21]||(n[21]=s("span",{class:"stat-label"},"vars",-1))]),n[24]||(n[24]=s("span",{class:"stat-divider"},"•",-1)),s("span",Ua,[s("span",qa,y(q.value),1),n[22]||(n[22]=s("span",{class:"stat-label"},"combos",-1))]),n[25]||(n[25]=s("span",{class:"stat-divider"},"•",-1)),s("span",Ja,[s("span",Ha,y(S.value.tokenEstimate?.avgTokens||"?"),1),n[23]||(n[23]=s("span",{class:"stat-label"},"tokens",-1))])])])):(l(),v(Ce,{key:0,"design-search":_(w).designSearch,"filtered-designs":_(w).filteredDesigns,"count-variables":_(w).countVariables,"format-last-edit-date":_(w).formatLastEditDate,"get-output-type-color":_(w).getOutputTypeColor,"get-combination-count":_(w).getCombinationCount,onSelect:Z,onCreateNew:X},null,8,["design-search","filtered-designs","count-variables","format-last-edit-date","get-output-type-color","get-combination-count"]))])]),S.value?(l(),t("section",Ra,[n[27]||(n[27]=s("h3",null,"Trial Configuration",-1)),s("div",Wa,[g(Pe,{"model-value":{trialName:x.value,repeatCount:M.value},"total-combinations":q.value,"onUpdate:modelValue":ae},null,8,["model-value","total-combinations"]),s("div",Ga,[n[26]||(n[26]=s("h4",null,"Model Configuration",-1)),g(da,{configurations:$.value,design:S.value,"total-combinations":q.value,"repeat-count":M.value,onShowModelSelector:n[4]||(n[4]=e=>E.value=!0),onAdd:te,onRemove:le},null,8,["configurations","design","total-combinations","repeat-count"])])])])):i("",!0)]),g(J,{open:E.value&&!!S.value,mode:"trial",design:S.value||void 0,"existing-configurations":$.value,onClose:n[5]||(n[5]=e=>E.value=!1),onAddConfiguration:ie},null,8,["open","design","existing-configurations"])]),_:1},8,["title"]))}}}),[["__scopeId","data-v-d9d0a3a2"]]);export{Ya as T,ee as a};
