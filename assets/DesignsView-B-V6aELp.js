const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./default-data.service-A7ojQV4d.js","./index-JPKDQHeA.js","./vendor-BiapkIQZ.js","./db-CL8uhZCz.js","./index-D-paDmtB.css","./defaultData-DyqJdH2z.js"])))=>i.map(i=>d[i]);
import{r as e,f as a,c as t,w as l,d as s,Z as i,W as r,Y as n,_ as o,k as u,a5 as c,F as d,a6 as v,a8 as p,X as m,G as f,S as b,q as g,a9 as y,aa as h,ab as _,B as k,n as x,o as w,U as C,u as L,a7 as V}from"./vendor-BiapkIQZ.js";import{_ as S,u as T}from"./BaseModal.vue_vue_type_style_index_0_lang-cdfHDDQp.js";import{u as R,t as E,p as W,a as D}from"./designs-db-BnxPWGVY.js";import{u as I}from"./variables-db-CPg65Q8f.js";import{_ as j,a as z,b as F,D as U,P as A}from"./index-JPKDQHeA.js";import{d as B,a as P}from"./defaultData-DyqJdH2z.js";import{u as $}from"./models-db-wgnka_cR.js";import{_ as N}from"./BaseButton.vue_vue_type_style_index_0_lang-CQIR86sW.js";import{M as O}from"./ModelSelectionTable-BiNHnxLg.js";import"./db-CL8uhZCz.js";import"./registry-CD_hKmbW.js";import"./logger.service-_k__GSpu.js";import"./cost-formatting-D-OPWEvg.js";import"./settings-db-B3gFDSc-.js";const M=[{label:"Full Response (default)",value:"",description:"Extract the entire response"},{label:"First Number",value:"\\d+",description:"Extract the first number found"},{label:"Last Number",value:"\\d+(?!.*\\d)",description:"Extract the last number found"},{label:"First Number After Colon",value:":\\s*(\\d+)",description:"Extract first number after a colon"},{label:"Last Number After Colon",value:":\\s*(\\d+)(?!.*:\\s*\\d)",description:"Extract last number after a colon"},{label:"First Word",value:"\\b\\w+\\b",description:"Extract the first word"},{label:"First Phrase (before punctuation)",value:"^[^.!?]+",description:"Extract text before first punctuation"},{label:"First Full Sentence",value:"^[^.!?]+[.!?]",description:"Extract the first complete sentence"},{label:"First Word After Colon",value:":\\s*(\\w+)",description:"Extract first word after a colon"},{label:"First Phrase After Colon",value:":\\s*([^.!?]+)",description:"Extract phrase after colon before punctuation"},{label:"First Sentence After Colon",value:":\\s*([^.!?]+[.!?])",description:"Extract complete sentence after colon"},{label:"Last Word",value:"\\b\\w+\\b(?!.*\\b\\w+\\b)",description:"Extract the last word"},{label:"Last Phrase",value:"[^.!?]+(?=[.!?]$)",description:"Extract the last phrase before final punctuation"},{label:"Last Full Sentence",value:"[^.!?]+[.!?](?!.*[.!?])",description:"Extract the last complete sentence"}];const K={class:"variable-chip-input"},q={key:0,class:"attributed-list-display"},H={class:"list-header"},J={class:"source-name"},Y={key:0,class:"attribute-breakdown"},G={key:0,class:"separator"},X={class:"total-conditions"},Z={class:"attributed-chips-container"},Q={class:"item-name"},ee={key:0,class:"attributes-wrapper"},ae={key:1,class:"direct-values"},te={key:0,class:"source-indicator"},le={class:"source-name"},se={class:"tag-input-wrapper"},ie={class:"custom-tag-input"},re={class:"tag-container"},ne=["title"],oe=["onClick"],ue=["placeholder","onKeydown"],ce={key:0,class:"helper-text"},de=j(s({__name:"VariableChipInput",props:{values:{},listRef:{},listName:{},source:{},placeholder:{},attributedSamples:{},attributeBreakdown:{},attributeKeys:{},previewValues:{},totalCount:{}},emits:["update:values","clear-source","clear-list","select-list"],setup(e,{emit:t}){const l=e,s=t,x=a(""),w=a();function C(e){s("update:values",e),l.source&&s("clear-source")}function L(){const e=x.value.trim();e&&(l.values.includes(e)||C([...l.values,e]),x.value="")}function V(e){e.preventDefault();const a=(e.clipboardData?.getData("text")||"").split(/\r?\n/).map(e=>e.trim()).filter(e=>e.length>0);if(a.length>0){const e=new Set(l.values),t=a.filter(a=>!e.has(a));t.length>0&&C([...l.values,...t]),x.value=""}}function S(){if(""===x.value&&l.values.length>0){const e=[...l.values];e.pop(),C(e)}}function T(){C([]),l.source&&s("clear-source")}return(e,a)=>(r(),i("div",K,[e.listRef&&e.attributedSamples?(r(),i("div",q,[n("div",H,[a[6]||(a[6]=n("span",{class:"source-label"},"From list:",-1)),n("span",J,c(e.listName||"Unknown List"),1),e.attributeBreakdown&&e.attributeBreakdown.parts.length>0?(r(),i("div",Y,[(r(!0),i(d,null,v(e.attributeBreakdown.parts,(a,t)=>(r(),i(d,{key:t},[n("span",{class:"attribute-part",style:p({backgroundColor:[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}][a.colorIndex].bg,color:[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}][a.colorIndex].text})},c(a.text),5),t<e.attributeBreakdown.parts.length-1?(r(),i("span",G," Ã— ")):o("",!0)],64))),128)),a[4]||(a[4]=n("span",{class:"arrow"}," â†’ ",-1)),n("span",X,c(e.attributeBreakdown.totalItems)+" conditions",1)])):o("",!0),u(N,{variant:"danger",size:"small",onClick:a[0]||(a[0]=a=>e.$emit("clear-list"))},{default:m(()=>a[5]||(a[5]=[f(" Remove List ")])),_:1,__:[5]})]),n("div",Z,[a[9]||(a[9]=n("span",{class:"sample-hint"},"Sample values:",-1)),(r(!0),i(d,null,v(e.attributedSamples,e=>{return r(),i("div",{key:e.value,class:"attributed-item-chip"},[n("span",Q,c(e.value),1),e.attributes?(r(),i("span",ee,[a[7]||(a[7]=f(" (")),(r(!0),i(d,null,v((t=e.attributes,l.attributeKeys?Object.entries(t).map(([e,a])=>({value:a,colorIndex:l.attributeKeys.indexOf(e)%5})):[]),(e,a)=>(r(),i("span",{key:a,class:"attribute-value",style:p({backgroundColor:[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}][e.colorIndex].bg,color:[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}][e.colorIndex].text})},c(e.value),5))),128)),a[8]||(a[8]=f(") "))])):o("",!0)]);var t}),128))])])):(r(),i("div",ae,[e.source?(r(),i("div",te,[a[12]||(a[12]=n("span",{class:"source-label"},"From list:",-1)),n("span",le,c(e.source.listName),1),u(N,{variant:"secondary",size:"small",onClick:a[1]||(a[1]=a=>e.$emit("clear-source"))},{default:m(()=>a[10]||(a[10]=[f(" Unlink ")])),_:1,__:[10]}),u(N,{variant:"danger",size:"small",onClick:T},{default:m(()=>a[11]||(a[11]=[f(" Remove List ")])),_:1,__:[11]})])):o("",!0),n("div",se,[n("div",ie,[n("div",re,[(r(!0),i(d,null,v(e.values,(a,t)=>(r(),i("div",{key:`${a}-${t}`,class:y(["tag",{"tag-readonly":e.source}])},[n("span",{class:"tag-text",title:a.length>100?a:""},c(a.length>100?a.substring(0,100)+"...":a),9,ne),e.source?o("",!0):(r(),i("button",{key:0,type:"button",class:"tag-remove",onClick:e=>function(e){const a=[...l.values];a.splice(e,1),C(a)}(t)}," Ã— ",8,oe))],2))),128)),e.source?o("",!0):g((r(),i("input",{key:0,ref_key:"inputField",ref:w,"onUpdate:modelValue":a[2]||(a[2]=e=>x.value=e),placeholder:e.placeholder,class:"tag-input-field",onKeydown:[_(k(L,["prevent"]),["enter"]),_(S,["backspace"])],onPaste:V},null,40,ue)),[[h,x.value]])]),e.values.length>0?(r(),i("div",ce,c(e.values.length)+" values ",1)):o("",!0)]),u(N,{variant:"secondary",size:"small",onClick:a[3]||(a[3]=a=>e.$emit("select-list"))},{default:m(()=>a[13]||(a[13]=[f(" Replace with List ")])),_:1,__:[13]}),e.values.length>0?(r(),b(N,{key:0,variant:"danger",size:"small",onClick:T},{default:m(()=>a[14]||(a[14]=[f(" Clear ")])),_:1,__:[14]})):o("",!0)])]))]))}}),[["__scopeId","data-v-a08dfdfb"]]),ve={class:"list-selector"},pe={class:"list-grid"},me=["onClick"],fe={class:"list-header"},be={class:"item-count"},ge={key:0,class:"list-description"},ye={class:"list-preview"},he={key:0,class:"preview-more"},_e={key:1,class:"attributed-badge"},ke={key:0,class:"empty-state"},xe=j(s({__name:"ListSelector",props:{modelValue:{type:Boolean},listType:{}},emits:["update:modelValue","select"],setup(e,{emit:a}){const l=e,s=a,p=I(),g=t(()=>"all"===l.listType?p.lists:"simple"===l.listType?p.simpleLists:"refusal"===l.listType?p.refusalLists:[]),y=e=>"attributed"===e.category&&e.items?e.items.slice(0,5).map(e=>e.value):e.values?.slice(0,5)??[];return(e,a)=>(r(),b(S,{"model-value":e.modelValue,title:"Select List",size:"medium","onUpdate:modelValue":a[1]||(a[1]=a=>e.$emit("update:modelValue",a))},{footer:m(()=>[u(N,{variant:"ghost",onClick:a[0]||(a[0]=a=>e.$emit("update:modelValue",!1))},{default:m(()=>a[2]||(a[2]=[f(" Cancel ")])),_:1,__:[2]})]),default:m(()=>[n("div",ve,[n("div",pe,[(r(!0),i(d,null,v(g.value,e=>(r(),i("div",{key:e.id,class:"list-option",onClick:a=>(e=>{s("select",e),s("update:modelValue",!1)})(e)},[n("div",fe,[n("h4",null,c(e.name),1),n("span",be,c(e.itemCount)+" items",1)]),e.description?(r(),i("p",ge,c(e.description),1)):o("",!0),n("div",ye,[(r(!0),i(d,null,v(y(e),(e,a)=>(r(),i("span",{key:a,class:"preview-value"},c(e),1))),128)),e.itemCount>5?(r(),i("span",he," +"+c(e.itemCount-5)+" more ",1)):o("",!0)]),"attributed"===e.category?(r(),i("div",_e," Attributed List ")):o("",!0)],8,me))),128))]),0===g.value.length?(r(),i("div",ke," No "+c(e.listType)+" lists available ",1)):o("",!0)])]),_:1},8,["model-value"]))}}),[["__scopeId","data-v-b6e2244c"]]),we={class:"template-editor"},Ce=["innerHTML"],Le=["placeholder","rows"],Ve=j(s({__name:"TemplateEditor",props:{modelValue:{},label:{},placeholder:{default:"Enter your prompt template..."},required:{type:Boolean},rows:{default:4},variables:{default:()=>[]},variableColors:{default:()=>({})}},emits:["update:modelValue"],setup(e,{expose:s,emit:o}){const u=e,c=o,d=a(),v=a(),p=a(!1),m=t({get:()=>u.modelValue,set:e=>c("update:modelValue",e)}),f=t(()=>{let e=b(m.value);return e=e.replace(/\{\{(\w+)\}\}/g,(e,a)=>{const t=/^\w+$/.test(a),l=u.variableColors[a];return t&&l?`<span class="variable-highlight" style="background-color: ${l.bg}; box-shadow: 0 0 0 1px ${l.bg};">${b(e)}</span>`:t?`<span class="variable-highlight">${b(e)}</span>`:`<span class="variable-error">${b(e)}</span>`}),e=e.replace(/\n/g,"<br>"),e=e.replace(/  /g," &nbsp;"),e.endsWith("<br>")||(e+="<br>"),e});function b(e){const a=document.createElement("div");return a.textContent=e,a.innerHTML}function _(){d.value&&v.value&&(v.value.scrollTop=d.value.scrollTop,v.value.scrollLeft=d.value.scrollLeft)}return l(m,async()=>{await x(),_()}),s({focus:()=>d.value?.focus()}),(e,a)=>(r(),i("div",we,[n("div",{class:y(["editor-container",{focused:p.value}])},[n("div",{ref_key:"highlightRef",ref:v,class:"editor-highlight",innerHTML:f.value,"aria-hidden":"true"},null,8,Ce),g(n("textarea",{ref_key:"textareaRef",ref:d,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value=e),class:"editor-textarea",placeholder:e.placeholder,rows:e.rows,onFocus:a[1]||(a[1]=e=>p.value=!0),onBlur:a[2]||(a[2]=e=>p.value=!1),onScroll:_},null,40,Le),[[h,m.value]])],2)]))}}),[["__scopeId","data-v-38014dcd"]]),Se={class:"design-form-container"},Te={class:"name-desc-row"},Re={key:0,class:"variables-container"},Ee={class:"variable-label"},We={class:"variable-content"},De={class:"output-row"},Ie={class:"refusal-row"},je={class:"refusal-content"},ze={class:"modal-footer"},Fe={class:"stats"},Ue={class:"actions"},Ae={class:"pricing-content"},Be={key:0,class:"token-stats"},Pe={class:"stats-grid"},$e=j(s({__name:"DesignEditor",props:{modelValue:{type:Boolean},designId:{}},emits:["update:modelValue","saved"],setup(s,{emit:g}){const y=s,h=g,_=function(s){const i=R(),r=I(),n=e({name:"",description:"",promptTemplate:"",outputType:"text",extractPattern:"",refusalWords:[],refusalWordsListRef:"",refusalWordsSource:null,rejectRefusalWords:!1}),o=a({}),u=a({}),c=a({}),d=a(!1),v=a(!1),p=a([]),m=t(()=>E.extractVariables(n.promptTemplate)),f=t(()=>E.validateTemplate(n.promptTemplate)),b=t(()=>{const e=[];n.name.trim()||e.push("Name is required"),n.promptTemplate.trim()||e.push("Template is required"),f.value.isValid||e.push(...f.value.errors);const a=m.value.filter(e=>{const a=(o.value[e]?.length??0)>0,t=!!u.value[e];return!a&&!t});return a.length&&e.push(`Missing values for variables: ${a.join(", ")}`),{isValid:0===e.length,errors:e}}),g=t(()=>{const e={};for(const a of m.value)if(u.value[a]){const t=r.lists.find(e=>e.id===u.value[a]);e[a]=t?.itemCount??0}else e[a]=o.value[a]?.length??0;return e}),y=t(()=>W.getPermutationInfo(g.value));return l(()=>n.promptTemplate,()=>{const e=m.value;for(const a in o.value)e.includes(a)||(delete o.value[a],delete u.value[a],delete c.value[a]);for(const a of e)a in o.value||a in u.value||(o.value[a]=[])}),l(b,e=>{p.value=e.errors}),s&&async function(){if(s){v.value=!0;try{const e=await i.getDesign(s);if(!e)return;if(n.name=e.name,n.description=e.description||"",n.promptTemplate=e.promptTemplate,n.outputType=e.outputType,n.extractPattern="string"==typeof e.extractPattern?e.extractPattern:"",n.rejectRefusalWords=e.rejectRefusalWords??!1,n.refusalWords=e.refusalWords||[],n.refusalWordsListRef=e.refusalWordsListRef||"",n.refusalWordsSource=e.refusalWordsSource||null,e.variableBindings)for(const[a,t]of Object.entries(e.variableBindings))"list"===t.type&&t.listId?u.value[a]=t.listId:"direct"===t.type&&t.values&&(o.value[a]=[...t.values],t.source&&(c.value[a]=t.source))}finally{v.value=!1}}}(),{form:n,variableArrays:o,variableListRefs:u,variableListSources:c,detectedVariables:m,templateValidation:f,validation:b,errors:p,variableCounts:g,permutationInfo:y,isSaving:d,isLoading:v,saveDesign:async function(e){if(b.value.isValid){d.value=!0;try{const a={};for(const e of m.value)if(u.value[e]){const t=r.lists.find(a=>a.id===u.value[e]);a[e]={type:"list",listId:u.value[e],listName:t?.name}}else o.value[e]?.length>0&&(a[e]={type:"direct",values:[...o.value[e]],source:c.value[e]&&null!==c.value[e]?{listId:c.value[e].listId,listName:c.value[e].listName}:void 0});const t={name:n.name,description:n.description,promptTemplate:n.promptTemplate,outputType:n.outputType,extractPattern:n.extractPattern,variableBindings:JSON.parse(JSON.stringify(a)),refusalWords:[...n.refusalWords],refusalWordsListRef:n.refusalWordsListRef||void 0,refusalWordsSource:n.refusalWordsSource?{...n.refusalWordsSource}:void 0,rejectRefusalWords:n.rejectRefusalWords};return e&&(t.tokenEstimate=e),s?(await i.updateDesign(s,t),s):await i.createDesign(t)}finally{d.value=!1}}}}}(y.designId),k=I(),x=$(),V=a(!1),T=a(!1),j=a("all"),z=a(""),F=a(!1),U=a(""),A=a(null),B=t(()=>x.allModels),P=[{bg:"#E8D5F2",text:"#6B21A8"},{bg:"#D5F2E8",text:"#047857"},{bg:"#FFE4D6",text:"#C2410C"},{bg:"#D6E4FF",text:"#1E40AF"},{bg:"#F3E8D5",text:"#92400E"}];function N(e){const a=_.detectedVariables.value.indexOf(e);return P[a%P.length]}function K(e){return`{{${e}}}`}const q=t(()=>{const e={};return _.detectedVariables.value.forEach((a,t)=>{e[a]=P[t%P.length]}),e});function H(e){const a=_.variableListRefs.value[e];if(!a)return;const t=k.lists.find(e=>e.id===a);return t?.name}function J(e){const a=_.variableListRefs.value[e];if(!a)return;const t=k.lists.find(e=>e.id===a);return t?.itemCount}function Y(e){const a=_.variableListRefs.value[e];if(!a)return;const t=k.lists.find(e=>e.id===a);return t&&"attributed"===t.category&&t.items?t.items.slice(0,10):void 0}function G(e){const a=_.variableListRefs.value[e];if(!a)return;const t=k.lists.find(e=>e.id===a);if(!t||"attributed"!==t.category)return;const l=[];return t.attributeKeys&&l.push(...t.attributeKeys.map((e,a)=>({text:e,colorIndex:a%5}))),{parts:l,totalItems:t.itemCount||0}}function X(e){const a=_.variableListRefs.value[e];if(!a)return;const t=k.lists.find(e=>e.id===a);return t?.attributeKeys}function Z(e){const a=_.variableListRefs.value[e];if(!a)return;const t=k.lists.find(e=>e.id===a);return t&&"simple"===t.category?t.values?.slice(0,10):void 0}function Q(e){z.value&&("simple"===e.category?(_.variableArrays.value[z.value]=e.values||[],_.variableListRefs.value[z.value]="",_.variableListSources.value[z.value]={listId:e.id,listName:e.name}):(_.variableListRefs.value[z.value]=e.id,_.variableArrays.value[z.value]=[],_.variableListSources.value[z.value]=null)),V.value=!1}function ee(){if(!_.form.refusalWordsListRef)return;const e=k.lists.find(e=>e.id===_.form.refusalWordsListRef);return e?.name}function ae(e){_.form.refusalWordsListRef=e.id,_.form.refusalWords=[],_.form.refusalWordsSource=null,T.value=!1}function te(){_.form.extractPattern=U.value}l(()=>_.form.extractPattern,e=>{const a=M.find(a=>a.value===e);U.value=a?a.value:""});const le=t(()=>{const e={};for(const a of _.detectedVariables.value)if(_.variableListRefs.value[a]){const t=k.lists.find(e=>e.id===_.variableListRefs.value[a]);e[a]={type:"list",listId:_.variableListRefs.value[a],listName:t?.name}}else _.variableArrays.value[a]?.length>0&&(e[a]={type:"direct",values:[..._.variableArrays.value[a]]});return{id:y.designId||"temp",name:_.form.name,description:_.form.description,promptTemplate:_.form.promptTemplate,variableBindings:e,tokenEstimate:A.value||void 0,outputType:_.form.outputType,extractPattern:_.form.extractPattern,refusalWords:_.form.refusalWords,refusalWordsListRef:_.form.refusalWordsListRef,rejectRefusalWords:_.form.rejectRefusalWords,created:new Date,updated:new Date}});async function se(){const e=await _.saveDesign(A.value||void 0);e&&(h("saved",e),h("update:modelValue",!1))}return l(F,async e=>{e&&!A.value&&(A.value=await D.calculateDesignTokens(le.value))}),w(async()=>{await k.initialize()}),(e,a)=>{const t=C("a-input"),l=C("a-form-item"),s=C("a-select-option"),g=C("a-select"),y=C("a-checkbox"),h=C("a-alert"),k=C("a-form"),x=C("a-button"),w=C("a-modal");return r(),i(d,null,[u(S,{"model-value":e.modelValue,title:e.designId?"Edit Design":"Create Design",size:"full","onUpdate:modelValue":a[13]||(a[13]=a=>e.$emit("update:modelValue",a))},{footer:m(()=>[n("div",ze,[n("div",Fe,c(L(_).detectedVariables.value.length)+" variables â€¢ "+c(L(_).permutationInfo.value.formatted)+" combinations ",1),n("div",Ue,[u(x,{size:"large",onClick:a[11]||(a[11]=e=>F.value=!0)},{default:m(()=>a[30]||(a[30]=[f("Calculate Pricing")])),_:1,__:[30]}),u(x,{size:"large",onClick:a[12]||(a[12]=a=>e.$emit("update:modelValue",!1))},{default:m(()=>a[31]||(a[31]=[f("Cancel")])),_:1,__:[31]}),u(x,{size:"large",type:"primary",onClick:se},{default:m(()=>a[32]||(a[32]=[f("Save")])),_:1,__:[32]})])])]),default:m(()=>[n("div",Se,[u(k,{model:L(_).form,layout:"vertical",onFinish:se},{default:m(()=>[n("div",Te,[a[18]||(a[18]=n("label",{class:"inline-field-label"},"Name",-1)),u(l,{name:"name",rules:[{required:!0,message:"Required"}],class:"name-field"},{default:m(()=>[u(t,{value:L(_).form.name,"onUpdate:value":a[0]||(a[0]=e=>L(_).form.name=e),placeholder:"Enter design name",size:"large"},null,8,["value"])]),_:1}),a[19]||(a[19]=n("label",{class:"inline-field-label"},"Description",-1)),u(l,{name:"description",class:"desc-field"},{default:m(()=>[u(t,{value:L(_).form.description,"onUpdate:value":a[1]||(a[1]=e=>L(_).form.description=e),placeholder:"Optional description",size:"large"},null,8,["value"])]),_:1})]),u(l,{label:"Template",name:"promptTemplate",rules:[{required:!0,message:"Required"}],class:"template-form-item"},{default:m(()=>[u(Ve,{modelValue:L(_).form.promptTemplate,"onUpdate:modelValue":a[2]||(a[2]=e=>L(_).form.promptTemplate=e),placeholder:"Enter your prompt template... Use {{variable}} for variables",rows:10,variables:L(_).detectedVariables.value,"variable-colors":q.value},null,8,["modelValue","variables","variable-colors"])]),_:1}),L(_).detectedVariables.value.length>0?(r(),i("div",Re,[(r(!0),i(d,null,v(L(_).detectedVariables.value,e=>(r(),i("div",{key:e,class:"variable-row"},[n("div",Ee,[a[20]||(a[20]=n("span",{class:"variable-text"},"Variable:",-1)),n("span",{style:p({backgroundColor:N(e).bg,color:N(e).text}),class:"variable-badge"},c(K(e)),5)]),n("div",We,[u(de,{values:L(_).variableArrays.value[e]||[],"list-ref":L(_).variableListRefs.value[e],"list-name":H(e),source:L(_).variableListSources.value[e]||null,placeholder:`Enter a value for {{${e}}} and hit enter`,"attributed-samples":Y(e),"attribute-breakdown":G(e),"attribute-keys":X(e),"preview-values":Z(e),"total-count":J(e),"onUpdate:values":a=>function(e,a){_.variableArrays.value[e]=a}(e,a),onClearSource:a=>function(e){_.variableListSources.value[e]=null}(e),onClearList:a=>function(e){_.variableListRefs.value[e]="",_.variableArrays.value[e]=[]}(e),onSelectList:a=>function(e){z.value=e,j.value="all",V.value=!0}(e)},null,8,["values","list-ref","list-name","source","placeholder","attributed-samples","attribute-breakdown","attribute-keys","preview-values","total-count","onUpdate:values","onClearSource","onClearList","onSelectList"])])]))),128))])):o("",!0),n("div",De,[a[25]||(a[25]=n("label",{class:"row-label"},"Output Format",-1)),u(g,{value:L(_).form.outputType,"onUpdate:value":a[3]||(a[3]=e=>L(_).form.outputType=e),size:"large",style:{width:"120px"}},{default:m(()=>[u(s,{value:"text"},{default:m(()=>a[21]||(a[21]=[f("Text")])),_:1,__:[21]}),u(s,{value:"number"},{default:m(()=>a[22]||(a[22]=[f("Number")])),_:1,__:[22]}),u(s,{value:"boolean"},{default:m(()=>a[23]||(a[23]=[f("Boolean")])),_:1,__:[23]})]),_:1},8,["value"]),a[26]||(a[26]=n("label",{class:"inline-label"},"Parse Preset",-1)),u(g,{value:U.value,"onUpdate:value":a[4]||(a[4]=e=>U.value=e),size:"large",style:{flex:"1"},onChange:te},{default:m(()=>[u(s,{value:""},{default:m(()=>a[24]||(a[24]=[f("Full Response (default)")])),_:1,__:[24]}),(r(!0),i(d,null,v(L(M),e=>(r(),b(s,{key:e.value,value:e.value},{default:m(()=>[f(c(e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),a[27]||(a[27]=n("label",{class:"inline-label"},"Regex Extract",-1)),u(t,{value:L(_).form.extractPattern,"onUpdate:value":a[5]||(a[5]=e=>L(_).form.extractPattern=e),placeholder:"Leave blank for full response",size:"large",style:{flex:"1"}},null,8,["value"])]),n("div",Ie,[a[29]||(a[29]=n("label",{class:"row-label"},"Parse Refusals",-1)),n("div",je,[u(de,{values:L(_).form.refusalWords,"list-ref":L(_).form.refusalWordsListRef,"list-name":ee(),source:L(_).form.refusalWordsSource||null,placeholder:"Enter a refusal word and hit enter (e.g., cannot, unable, refuse)","onUpdate:values":a[6]||(a[6]=e=>L(_).form.refusalWords=e),onClearSource:a[7]||(a[7]=e=>L(_).form.refusalWordsSource=null),onClearList:a[8]||(a[8]=e=>(_.form.refusalWordsListRef="",void(_.form.refusalWords=[]))),onSelectList:a[9]||(a[9]=e=>T.value=!0)},null,8,["values","list-ref","list-name","source"])]),u(y,{checked:L(_).form.rejectRefusalWords,"onUpdate:checked":a[10]||(a[10]=e=>L(_).form.rejectRefusalWords=e),class:"reject-checkbox"},{default:m(()=>a[28]||(a[28]=[f(" Reject on match ")])),_:1,__:[28]},8,["checked"])]),L(_).errors.value.length>0?(r(),b(h,{key:1,type:"error","show-icon":"",class:"error-alert"},{message:m(()=>[f(c(L(_).errors.value.join(", ")),1)]),_:1})):o("",!0)]),_:1},8,["model"])])]),_:1},8,["model-value","title"]),u(xe,{modelValue:V.value,"onUpdate:modelValue":a[14]||(a[14]=e=>V.value=e),"list-type":j.value,onSelect:Q},null,8,["modelValue","list-type"]),u(xe,{modelValue:T.value,"onUpdate:modelValue":a[15]||(a[15]=e=>T.value=e),"list-type":"refusal",onSelect:ae},null,8,["modelValue"]),u(w,{open:F.value,"onUpdate:open":a[17]||(a[17]=e=>F.value=e),title:"Cost Estimation",width:"90vw",style:{maxWidth:"1000px"}},{footer:m(()=>[u(x,{onClick:a[16]||(a[16]=e=>F.value=!1)},{default:m(()=>a[34]||(a[34]=[f("Close")])),_:1,__:[34]})]),default:m(()=>[n("div",Ae,[A.value?(r(),i("div",Be,[a[33]||(a[33]=n("h4",null,"Token Analysis",-1)),n("div",Pe,[n("div",null,"Min: "+c(A.value.minTokens),1),n("div",null,"Max: "+c(A.value.maxTokens),1),n("div",null,"Avg: "+c(A.value.avgTokens),1),n("div",null,"Sample: "+c(A.value.sampleSize),1)])])):o("",!0),u(O,{models:B.value,"total-calls":L(_).permutationInfo.value.total,design:le.value,"model-params":{}},null,8,["models","total-calls","design"])])]),_:1},8,["open"])],64)}}}),[["__scopeId","data-v-e8e44c77"]]),Ne={class:"import-defaults-content"},Oe={class:"section-header"},Me={class:"item-content"},Ke={class:"item-header"},qe={class:"item-description"},He={class:"item-meta"},Je={class:"section-header"},Ye={class:"item-content"},Ge={class:"item-header"},Xe={class:"item-description"},Ze={class:"item-meta"},Qe={class:"modal-footer"},ea=j(s({__name:"ImportDefaultsModal",props:{modelValue:{type:Boolean}},emits:["update:modelValue","imported"],setup(e,{emit:s}){const p=e,g=s,y=R(),h=I(),_=t({get:()=>p.modelValue,set:e=>g("update:modelValue",e)}),k=a("designs"),x=a(!1),L=a(!1),V=a(new Set),S=a(new Set),T=a({}),E=a({}),W=a(!1),D=a(!1),j=t(()=>B),U=t(()=>P),A=t(()=>{const e=Object.values(T.value).some(e=>e),a=Object.values(E.value).some(e=>e);return e||a});async function $(){x.value=!0;try{const e=await y.getAllDesigns(),a=await h.getAllLists();V.value=new Set(e.map(e=>e.name)),S.value=new Set(a.map(e=>e.name)),T.value={},E.value={},B.forEach(e=>{T.value[e.name]=!1}),P.forEach(e=>{E.value[e.name]=!1})}finally{x.value=!1}}function N(){B.forEach(e=>{V.value.has(e.name)||(T.value[e.name]=W.value)})}function O(){P.forEach(e=>{S.value.has(e.name)||(E.value[e.name]=D.value)})}async function M(){L.value=!0;try{const{DefaultDataService:e}=await z(async()=>{const{DefaultDataService:e}=await import("./default-data.service-A7ojQV4d.js");return{DefaultDataService:e}},__vite__mapDeps([0,1,2,3,4,5]),import.meta.url),a=Object.entries(T.value).filter(([e,a])=>a).map(([e])=>e),t=Object.entries(E.value).filter(([e,a])=>a).map(([e])=>e),l=await e.importDefaults(a.length>0?a:null,t.length>0?t:null),s=[];l.designs>0&&s.push(`${l.designs} designs`),l.lists>0&&s.push(`${l.lists} variable lists`),s.length>0?F.success(`Successfully imported ${s.join(" and ")}`):F.info("No new items were imported (may already exist)"),g("imported"),K()}catch(e){console.error("Import failed:",e),F.error("Failed to import selected items")}finally{L.value=!1}}function K(){_.value=!1}function q(e){switch(e){case"attributed":return"blue";case"refusal":return"red";default:return"green"}}return w(async()=>{await $()}),l(()=>p.modelValue,e=>{e&&$()}),(e,a)=>{const t=C("a-alert"),l=C("a-checkbox"),s=C("a-tag"),p=C("a-list-item"),g=C("a-list"),y=C("a-tab-pane"),h=C("a-tabs"),w=C("a-button"),R=C("a-modal");return r(),b(R,{open:_.value,"onUpdate:open":a[3]||(a[3]=e=>_.value=e),title:"Import Default Designs & Variables",width:"95vw",footer:null,onCancel:K,centered:!0,"body-style":{height:"90vh",overflow:"auto"}},{default:m(()=>[n("div",Ne,[u(t,{type:"info",message:"Import pre-configured designs and variable lists",description:"Select which default designs and variable lists you want to import. These are carefully crafted templates for common LLM bias testing scenarios.","show-icon":!0,style:{marginBottom:"var(--spacing-xl)"}}),u(h,{activeKey:k.value,"onUpdate:activeKey":a[2]||(a[2]=e=>k.value=e)},{default:m(()=>[u(y,{key:"designs",tab:"Designs"},{default:m(()=>[n("div",Oe,[a[5]||(a[5]=n("h4",null,"Available Designs",-1)),u(l,{checked:W.value,"onUpdate:checked":a[0]||(a[0]=e=>W.value=e),onChange:N},{default:m(()=>a[4]||(a[4]=[f(" Select All ")])),_:1,__:[4]},8,["checked"])]),u(g,{"data-source":j.value,loading:x.value,size:"small",class:"import-list"},{renderItem:m(({item:e})=>[u(p,null,{default:m(()=>[u(l,{checked:T.value[e.name],"onUpdate:checked":a=>T.value[e.name]=a,disabled:V.value.has(e.name)},{default:m(()=>[n("div",Me,[n("div",Ke,[n("strong",null,c(e.name),1),V.value.has(e.name)?(r(),b(s,{key:0,size:"small",color:"orange"},{default:m(()=>a[6]||(a[6]=[f(" Already Exists ")])),_:1,__:[6]})):o("",!0)]),n("div",qe,c(e.description),1),n("div",He,[(r(!0),i(d,null,v(Object.keys(e.variableBindings),e=>(r(),b(s,{key:e,size:"small"},{default:m(()=>[f(c(e),1)]),_:2},1024))),128))])])]),_:2},1032,["checked","onUpdate:checked","disabled"])]),_:2},1024)]),_:1},8,["data-source","loading"])]),_:1}),u(y,{key:"variables",tab:"Variable Lists"},{default:m(()=>[n("div",Je,[a[8]||(a[8]=n("h4",null,"Available Variable Lists",-1)),u(l,{checked:D.value,"onUpdate:checked":a[1]||(a[1]=e=>D.value=e),onChange:O},{default:m(()=>a[7]||(a[7]=[f(" Select All ")])),_:1,__:[7]},8,["checked"])]),u(g,{"data-source":U.value,loading:x.value,size:"small",class:"import-list"},{renderItem:m(({item:e})=>[u(p,null,{default:m(()=>[u(l,{checked:E.value[e.name],"onUpdate:checked":a=>E.value[e.name]=a,disabled:S.value.has(e.name)},{default:m(()=>[n("div",Ye,[n("div",Ge,[n("strong",null,c(e.name),1),u(s,{size:"small",color:q(e.category)},{default:m(()=>[f(c(e.category),1)]),_:2},1032,["color"]),S.value.has(e.name)?(r(),b(s,{key:0,size:"small",color:"orange"},{default:m(()=>a[9]||(a[9]=[f(" Already Exists ")])),_:1,__:[9]})):o("",!0)]),n("div",Xe,c(e.description),1),n("div",Ze,c(e.itemCount)+" items ",1)])]),_:2},1032,["checked","onUpdate:checked","disabled"])]),_:2},1024)]),_:1},8,["data-source","loading"])]),_:1})]),_:1},8,["activeKey"]),n("div",Qe,[u(w,{onClick:K,size:"large",class:"footer-button"},{default:m(()=>a[10]||(a[10]=[f(" Cancel ")])),_:1,__:[10]}),u(w,{type:"primary",onClick:M,loading:L.value,disabled:!A.value,size:"large",class:"footer-button footer-button-primary"},{default:m(()=>a[11]||(a[11]=[f(" Import Selected ")])),_:1,__:[11]},8,["loading","disabled"])])])]),_:1},8,["open"])}}}),[["__scopeId","data-v-1417a9c5"]]),aa={class:"designs-view"},ta={class:"page-header"},la={key:3,class:"scientific-table-container"},sa={class:"scientific-table-wrapper"},ia={key:0,class:"table-info-cell"},ra={class:"table-info-title"},na={class:"table-info-subtitle"},oa={key:1,class:"variables-cell"},ua={key:0},ca={class:"variables-calculation"},da={class:"variable-item"},va={key:0,class:"multiply-symbol"},pa={class:"equals-result"},ma={key:1,class:"text-secondary"},fa={key:0,class:"token-info"},ba={class:"token-line"},ga={key:0,class:"token-line"},ya={key:1,class:"text-secondary"},ha={key:3,class:"usage-cell"},_a={key:4,class:"date-cell"},ka={key:5,class:"table-actions-grid"},xa=j(s({__name:"DesignsView",setup(e){const l=R(),s=I(),p=V(),{getVisibleColumns:g,formatDateTime:y,createDesignColumns:h}=T(),_=a(!1),k=a(),x=a(!1),S=g(h()),D=t(()=>({y:"calc(100vh - 180px)"}));function j(e){k.value=e,_.value=!0}function z(){k.value=void 0,_.value=!1}function F(){x.value=!1}function B(e){if(!e.promptTemplate||!e.variableBindings)return[];const a=E.extractVariables(e.promptTemplate),t=[];for(const l of a){const a=e.variableBindings[l];if(!a)continue;let i=0;if("list"===a.type&&a.listId){const e=s.lists.find(e=>e.id===a.listId);e&&("simple"===e.category?i=e.values?.length||0:"attributed"===e.category&&(i=e.items?.length||0))}else"direct"===a.type&&(i=a.values?.length||0);i>0&&t.push({name:`{{${l}}}`,count:i})}return t}function P(e){if(!e.variableBindings)return 1;const a={};for(const[t,l]of Object.entries(e.variableBindings)){const e=l;if("list"===e.type&&e.listId){const l=s.lists.find(a=>a.id===e.listId);l&&("simple"===l.category?a[t]=l.values?.length||0:"attributed"===l.category&&(a[t]=l.items?.length||0))}else"direct"===e.type&&(a[t]=e.values?.length||0)}return W.calculateTotalPermutations(a)}function $(e){return e>999999?`${(e/1e6).toFixed(1)}M`:e>9999?`${(e/1e3).toFixed(0)}k`:e.toLocaleString()}return w(async()=>{await l.initialize(),await s.initialize()}),(e,a)=>{const t=C("a-button"),s=C("a-space"),g=C("a-spin"),h=C("a-alert"),w=C("a-empty"),V=C("a-table");return r(),i("div",aa,[n("div",ta,[a[8]||(a[8]=n("div",{class:"header-content"},[n("h1",null,"Prompt Designs"),n("p",{class:"description"},"Create and manage prompt templates for systematic testing")],-1)),u(s,null,{default:m(()=>[u(t,{onClick:a[0]||(a[0]=e=>x.value=!0)},{icon:m(()=>[u(L(U))]),default:m(()=>[a[6]||(a[6]=f(" Import Defaults "))]),_:1,__:[6]}),u(t,{type:"primary",onClick:a[1]||(a[1]=e=>_.value=!0)},{icon:m(()=>[u(L(A))]),default:m(()=>[a[7]||(a[7]=f(" Create Design "))]),_:1,__:[7]})]),_:1})]),L(l).isLoading?(r(),b(g,{key:0,size:"large",tip:"Loading designs..."},{default:m(()=>a[9]||(a[9]=[n("div",{style:{"min-height":"200px"}},null,-1)])),_:1,__:[9]})):L(l).error?(r(),b(h,{key:1,type:"error",message:L(l).error,class:"error-alert"},null,8,["message"])):0===L(l).designs.length?(r(),b(w,{key:2,description:"No designs yet. Create your first prompt design to start testing."},{image:m(()=>a[10]||(a[10]=[n("div",{style:{color:"#bfbfbf","font-size":"48px"}},"ðŸ“",-1)])),default:m(()=>[u(t,{type:"primary",onClick:a[2]||(a[2]=e=>_.value=!0)},{default:m(()=>a[11]||(a[11]=[f(" Create Your First Design ")])),_:1,__:[11]})]),_:1})):(r(),i("div",la,[n("div",sa,[u(V,{columns:L(S),"data-source":L(l).designsWithStats,pagination:!1,size:"small",scroll:D.value,"row-key":"id",class:"scientific-table"},{bodyCell:m(({column:e,record:s})=>{return["name"===e.key?(r(),i("div",ia,[n("span",ra,c(s.name),1),n("span",na,c(s.description||"No description"),1)])):o("",!0),"variables"===e.key?(r(),i("div",oa,[B(s).length>0?(r(),i("div",ua,[n("div",ca,[(r(!0),i(d,null,v(B(s),(e,a)=>(r(),i("span",{key:e.name},[n("span",da,c(e.name)+" ("+c(e.count)+")",1),a<B(s).length-1?(r(),i("span",va," Ã— ")):o("",!0)]))),128)),n("span",pa," = "+c($(P(s)))+" cases",1)])])):(r(),i("span",ma,"None"))])):o("",!0),"tokens"===e.key?(r(),i(d,{key:2},[s.tokenEstimate?(r(),i("div",fa,[n("div",ba," Per-prompt: ~"+c(s.tokenEstimate.avgTokens),1),P(s)>1?(r(),i("div",ga," Ã— "+c(P(s))+" = ~"+c($(P(s)*s.tokenEstimate.avgTokens)),1)):o("",!0)])):(r(),i("span",ya,"-"))],64)):o("",!0),"stats"===e.key?(r(),i("div",ha,[n("div",null,c(s.usedInTrials||0)+" trials",1),n("div",null,c(s.totalApiCalls||0)+" calls",1)])):o("",!0),"created"===e.key?(r(),i("div",_a,c((b=s.created,y(b))),1)):o("",!0),"actions"===e.key?(r(),i("div",ka,[u(t,{size:"small",type:"primary",onClick:e=>j(s.id)},{default:m(()=>a[12]||(a[12]=[f(" Edit ")])),_:2,__:[12]},1032,["onClick"]),u(t,{size:"small",type:"primary",onClick:e=>{return a=s.id,void p.push({path:"/trials",query:{designId:a}});var a}},{default:m(()=>a[13]||(a[13]=[f(" New Trial ")])),_:2,__:[13]},1032,["onClick"]),u(t,{size:"small",onClick:e=>async function(e){try{j(await l.duplicateDesign(e))}catch(a){console.error("Failed to duplicate design:",a)}}(s.id)},{default:m(()=>a[14]||(a[14]=[f(" Copy ")])),_:2,__:[14]},1032,["onClick"]),u(t,{size:"small",danger:"",onClick:e=>async function(e){if(confirm("Are you sure you want to delete this design?"))try{await l.deleteDesign(e)}catch(a){console.error("Failed to delete design:",a),alert(a instanceof Error?a.message:"Failed to delete design")}}(s.id)},{default:m(()=>a[15]||(a[15]=[f(" Delete ")])),_:2,__:[15]},1032,["onClick"])])):o("",!0)];var b}),_:1},8,["columns","data-source","scroll"])])])),_.value?(r(),b($e,{key:4,modelValue:_.value,"onUpdate:modelValue":[a[3]||(a[3]=e=>_.value=e),a[4]||(a[4]=e=>{e||(k.value=void 0)})],"design-id":k.value,onSaved:z},null,8,["modelValue","design-id"])):o("",!0),u(ea,{modelValue:x.value,"onUpdate:modelValue":a[5]||(a[5]=e=>x.value=e),onImported:F},null,8,["modelValue"])])}}}),[["__scopeId","data-v-48c74d04"]]);export{xa as default};
