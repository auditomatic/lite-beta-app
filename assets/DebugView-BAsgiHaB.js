import{d as a,f as t,c as e,o as s,a2 as l,Y as n,a5 as i,F as o,a4 as r,W as c,a3 as u,q as d,a7 as p}from"./vendor-BxfGckcK.js";import{d as b,_ as v}from"./index-JX8mTFJZ.js";import{u as m}from"./designs-db-Cu90pWLg.js";import{u as f}from"./variables-db-DFlmKEoQ.js";import{u as g}from"./trials-db-By9dbEH8.js";import"./db-COX2g2xv.js";import"./registry-aRYPBFJZ.js";import"./settings-db-BVOtWTBg.js";const w={class:"debug-view"},y={class:"section"},k={class:"info-grid"},C={class:"info-item"},h={class:"info-item"},x={class:"info-item"},D={class:"info-item"},S={class:"section"},j={class:"table-header"},_={class:"table-actions"},L=["onClick"],I=["onClick"],A=["onClick","disabled"],O={key:0,class:"table-content"},U={class:"table-controls"},E=["onUpdate:modelValue"],R=["onClick"],V={class:"table-data"},T=["onClick"],P=v(a({__name:"DebugView",setup(a){const v=m(),P=f(),$=g(),M=t(new Set),J=t({}),N=t({}),z=t(""),F=t(),q=e(()=>({dbVersion:"1.0.0",totalRecords:Object.values(N.value).reduce((a,t)=>a+t.length,0),storageUsed:"Calculating...",lastUpdated:(new Date).toLocaleString()})),B=e(()=>[{name:"designs",count:N.value.designs?.length||0},{name:"variableLists",count:N.value.variableLists?.length||0},{name:"trials",count:N.value.trials?.length||0},{name:"models",count:N.value.models?.length||0},{name:"apiCalls",count:N.value.apiCalls?.length||0},{name:"settings",count:N.value.settings?.length||0}]);async function W(){try{N.value={designs:await b.designs.toArray(),variableLists:await b.variableLists.toArray(),trials:await b.trials.toArray(),models:await b.models.toArray(),apiCalls:await b.apiCalls.toArray(),settings:await b.settings.toArray()}}catch(a){console.error("Failed to load table data:",a)}}function Y(a){const t=N.value[a]||[],e=J.value[a]?.toLowerCase()||"";if(!e)return JSON.stringify(t.slice(0,10),null,2);const s=t.filter(a=>JSON.stringify(a).toLowerCase().includes(e));return JSON.stringify(s.slice(0,10),null,2)}async function Z(){ca({version:"1.0.0",exported:(new Date).toISOString(),data:N.value},`auditomatic_full_export_${Date.now()}.json`)}async function G(){const a=N.value.designs||[],t=N.value.variableLists||[];ca({version:"1.0.0",exported:(new Date).toISOString(),designs:a,variableLists:t},`designs_variables_export_${Date.now()}.json`)}async function H(){const a=N.value.trials||[],t=N.value.apiCalls||[];ca({version:"1.0.0",exported:(new Date).toISOString(),trials:a,apiCalls:t},`trials_export_${Date.now()}.json`)}async function K(){ca(N.value.models||[],`models_export_${Date.now()}.json`)}async function Q(){ca((N.value.models||[]).map(a=>({id:a.id,provider:a.provider,modelId:a.modelId,enabled:a.enabled})),`model_states_export_${Date.now()}.json`)}function X(){z.value="fullDatabase",F.value?.click()}function aa(){z.value="designsAndVariables",F.value?.click()}function ta(){z.value="trials",F.value?.click()}function ea(){z.value="models",F.value?.click()}function sa(){z.value="modelStates",F.value?.click()}async function la(a){const t=a.target.files?.[0];if(t){try{const a=await t.text(),e=JSON.parse(a);switch(z.value){case"fullDatabase":await async function(a){if(a.data)for(const[t,e]of Object.entries(a.data))await na(t,e)}(e);break;case"designsAndVariables":await async function(a){a.designs&&await b.designs.bulkPut(a.designs);a.variableLists&&await b.variableLists.bulkPut(a.variableLists)}(e);break;case"trials":await async function(a){a.trials&&await b.trials.bulkPut(a.trials);a.apiCalls&&await b.apiCalls.bulkPut(a.apiCalls)}(e);break;case"models":await async function(a){await b.models.bulkPut(a)}(e);break;case"modelStates":await async function(a){for(const t of a)await b.models.update(t.id,{enabled:t.enabled})}(e);break;default:N.value[z.value]&&await na(z.value,e)}await W(),alert("Import completed successfully!")}catch(e){console.error("Import failed:",e),alert("Import failed: "+(e instanceof Error?e.message:"Unknown error"))}F.value&&(F.value.value="")}}async function na(a,t){const e=b[a];e&&await e.bulkPut(t)}async function ia(){confirm("Are you sure you want to clear ALL data? This cannot be undone.")&&(await b.delete(),await b.open(),await W())}async function oa(){confirm("Reset all settings to defaults? This will clear all data.")&&(await ia(),await Promise.all([v.initialize(),P.initialize(),$.initialize()]))}async function ra(){confirm("Regenerate database? This will clear all data and rebuild.")&&(await b.delete(),await b.open(),await W())}function ca(a,t){const e=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),s=URL.createObjectURL(e),l=document.createElement("a");l.href=s,l.download=t,document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s)}return s(async()=>{await W()}),(a,t)=>(c(),l("div",w,[t[14]||(t[14]=n("div",{class:"header"},[n("h1",null,"Debug & Data Management"),n("p",null,"System diagnostics, database viewer, and import/export tools")],-1)),n("div",y,[t[4]||(t[4]=n("h2",null,"System Information",-1)),n("div",k,[n("div",C,[t[0]||(t[0]=n("label",null,"Database Version:",-1)),n("span",null,i(q.value.dbVersion),1)]),n("div",h,[t[1]||(t[1]=n("label",null,"Records Count:",-1)),n("span",null,i(q.value.totalRecords),1)]),n("div",x,[t[2]||(t[2]=n("label",null,"Storage Used:",-1)),n("span",null,i(q.value.storageUsed),1)]),n("div",D,[t[3]||(t[3]=n("label",null,"Last Updated:",-1)),n("span",null,i(q.value.lastUpdated),1)])])]),n("div",S,[t[5]||(t[5]=n("h2",null,"Database Tables",-1)),(c(!0),l(o,null,r(B.value,a=>(c(),l("div",{key:a.name,class:"table-section"},[n("div",j,[n("h3",null,i(a.name)+" ("+i(a.count)+" records)",1),n("div",_,[n("button",{onClick:t=>async function(a){ca(N.value[a]||[],`${a}_export.json`)}(a.name),class:"export-btn"},"Export",8,L),n("button",{onClick:t=>{return e=a.name,z.value=e,void F.value?.click();var e},class:"import-btn"},"Import",8,I),n("button",{onClick:t=>async function(a){if(!confirm(`Are you sure you want to clear all ${a} data? This cannot be undone.`))return;const t=b[a];t&&(await t.clear(),await W())}(a.name),class:"clear-btn",disabled:0===a.count}," Clear All ",8,A)])]),M.value.has(a.name)?(c(),l("div",O,[n("div",U,[d(n("input",{"onUpdate:modelValue":t=>J.value[a.name]=t,placeholder:"Search records...",class:"search-input"},null,8,E),[[p,J.value[a.name]]]),n("button",{onClick:t=>async function(){await W()}(a.name),class:"refresh-btn"},"Refresh",8,R)]),n("div",V,[n("pre",null,i(Y(a.name)),1)])])):u("",!0),n("button",{onClick:t=>{return e=a.name,void(M.value.has(e)?M.value.delete(e):M.value.add(e));var e},class:"toggle-btn"},i(M.value.has(a.name)?"Collapse":"Expand"),9,T)]))),128))]),n("div",{class:"section"},[t[12]||(t[12]=n("h2",null,"Import/Export Tools",-1)),n("div",{class:"export-group"},[t[6]||(t[6]=n("h3",null,"Complete Database",-1)),n("div",{class:"export-actions"},[n("button",{onClick:Z,class:"export-all-btn"},"Export All Data"),n("button",{onClick:X,class:"import-all-btn"},"Import All Data")])]),n("div",{class:"export-group"},[t[7]||(t[7]=n("h3",null,"Designs & Variables",-1)),t[8]||(t[8]=n("p",{class:"export-desc"},"Exports designs with their linked variable lists",-1)),n("div",{class:"export-actions"},[n("button",{onClick:G,class:"export-btn"},"Export Designs+Variables"),n("button",{onClick:aa,class:"import-btn"},"Import Designs+Variables")])]),n("div",{class:"export-group"},[t[9]||(t[9]=n("h3",null,"Trials",-1)),t[10]||(t[10]=n("p",{class:"export-desc"},"Exports trials with configuration snapshots and results",-1)),n("div",{class:"export-actions"},[n("button",{onClick:H,class:"export-btn"},"Export Trials"),n("button",{onClick:ta,class:"import-btn"},"Import Trials")])]),n("div",{class:"export-group"},[t[11]||(t[11]=n("h3",null,"Models",-1)),n("div",{class:"export-actions"},[n("button",{onClick:K,class:"export-btn"},"Export All Models"),n("button",{onClick:ea,class:"import-btn"},"Import All Models")]),n("div",{class:"export-actions"},[n("button",{onClick:Q,class:"export-state-btn"},"Export Model States Only"),n("button",{onClick:sa,class:"import-state-btn"},"Import Model States Only")])])]),n("div",{class:"section danger-zone"},[t[13]||(t[13]=n("h2",null,"Danger Zone",-1)),n("div",{class:"danger-actions"},[n("button",{onClick:ia,class:"danger-btn"},"Clear All Data"),n("button",{onClick:oa,class:"danger-btn"},"Reset to Defaults"),n("button",{onClick:ra,class:"danger-btn"},"Regenerate Database")])]),n("input",{ref_key:"fileInput",ref:F,type:"file",accept:".json",onChange:la,style:{display:"none"}},null,544)]))}}),[["__scopeId","data-v-12b9464a"]]);export{P as default};
