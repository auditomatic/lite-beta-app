import{I as e,m as a,F as t,E as l,_ as s,x as r,l as n,J as o,o as i,a as c,b as u}from"./index-BuGV-_FV.js";import{k as d,d as p,f as v,aa as m,a0 as f,Y as h,_ as g,Z as b,$ as y,u as w,a2 as _,G as x,a3 as S,c as C,ah as k,w as E,F as D,ab as N,n as V,X as P,W as $}from"./vendor-BsQOyEiA.js";import{read as z,utils as I}from"./xlsx-C4WhbwXR.js";import{a as A,T as j}from"./TrialCreationModalNew-Wh1Ya2Me.js";import"./db-CL8uhZCz.js";import"./BaseModal.vue_vue_type_style_index_0_lang-BT4Y_nhz.js";import"./useEnvironmentalCost-DGdu4Owe.js";import"./token-calculation.service-C9fO8KQR.js";import"./variable.service-DTZaWEqM.js";import"./cost-formatting-Bv_drrqY.js";import"./GenericModelSelectorModal-tt9go7LT.js";var T={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"};function U(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),l.forEach(function(a){F(e,a,t[a])})}return e}function F(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var L=function(a,t){var l=U({},a,t.attrs);return d(e,U({},l,{icon:T}),null)};function O(){function e(e){const a=[];let t="",l=!1;for(let s=0;s<e.length;s++){const r=e[s],n=e[s+1];'"'===r?l&&'"'===n?(t+='"',s++):l=!l:","!==r||l?t+=r:(a.push(t),t="")}return a.push(t),a}async function a(e){return new Promise((a,t)=>{try{const l=z(e,{type:"string",raw:!1,dateNF:"yyyy-mm-dd"}),s=l.SheetNames[0],r=l.Sheets[s],n=I.sheet_to_json(r,{raw:!1,defval:"",header:1});if(0===n.length)return void t(new Error("No data found"));const o=n[0].map(e=>String(e||"").trim()),i=[];for(let e=1;e<n.length;e++){const a={};o.forEach((t,l)=>{a[t]=n[e][l]||""}),i.push(a)}a({data:i,columns:o})}catch(l){try{const l=e.trim().split("\n").filter(e=>e.trim());if(0===l.length)return void t(new Error("No data found"));const s=l[0];let r="\t";s.includes("\t")||(s.includes(",")?r=",":s.includes(";")?r=";":s.includes("|")&&(r="|"));const n=l[0].split(r).map(e=>e.trim().replace(/^["']|["']$/g,"")),o=[];for(let e=1;e<l.length;e++){const a=l[e].split(r).map(e=>e.trim().replace(/^["']|["']$/g,"")),t={};n.forEach((e,l)=>{t[e]=a[l]||""}),o.push(t)}a({data:o,columns:n})}catch(s){t(l)}}})}function t(e){return e.map(e=>{let a=e.replace(/[^a-zA-Z0-9_]/g,"_");return/^[a-zA-Z]/.test(a)||(a="col_"+a),a=a.replace(/_+/g,"_"),a=a.replace(/_+$/,""),a})}return{parseCSV:async function(a){return new Promise((t,l)=>{try{const s=a.trim().split("\n").filter(e=>e.trim());if(0===s.length)return void l(new Error("No data found"));const r=e(s[0]).map(e=>e.trim()),n=[];for(let a=1;a<s.length;a++){const t=e(s[a]),l={};r.forEach((e,a)=>{l[e]=t[a]||""}),n.push(l)}t({data:n,columns:r})}catch(s){l(s)}})},parseExcel:async function(e){return new Promise((a,t)=>{const l=new FileReader;l.onload=e=>{try{const l=e.target?.result,s=z(l,{type:"binary"}),r=s.SheetNames[0],n=s.Sheets[r],o=I.sheet_to_json(n,{raw:!1,defval:""});if(0===o.length)return void t(new Error("No data found in Excel file"));const i=Object.keys(o[0]);a({data:o,columns:i})}catch(l){t(l)}},l.onerror=()=>{t(new Error("Failed to read file"))},l.readAsBinaryString(e)})},parseTabDelimited:a,parseClipboardData:async function(e){return new Promise((l,s)=>{try{const r=e.getData("text/html");if(r){const e=z(r,{type:"string",raw:!1,dateNF:"yyyy-mm-dd"}),a=e.SheetNames[0],s=e.Sheets[a],n=I.sheet_to_json(s,{raw:!1,defval:"",header:1});if(n.length>0){const e=t(n[0].map(e=>String(e||"").trim())),a=[];for(let t=1;t<n.length;t++){const l={};e.forEach((e,a)=>{l[e]=n[t][a]||""}),a.push(l)}return void l({data:a,columns:e})}}const n=e.getData("text/plain");n?a(n).then(l).catch(s):s(new Error("No suitable data found in clipboard"))}catch(r){s(r)}})},validateColumns:function(e){const a=[],t=/^[a-zA-Z][a-zA-Z0-9_]*$/,l=["if","else","for","while","function","return","var","let","const"];e.forEach(e=>{t.test(e)||a.push(`Column "${e}" contains invalid characters. Variable names must start with a letter and contain only letters, numbers, and underscores.`),l.includes(e.toLowerCase())&&a.push(`Column "${e}" is a reserved word and cannot be used as a variable name.`)});const s=new Set;return e.forEach(e=>{s.has(e.toLowerCase())&&a.push(`Duplicate column name: "${e}"`),s.add(e.toLowerCase())}),{valid:0===a.length,errors:a}},sanitizeColumnNames:t}}L.displayName="CloudUploadOutlined",L.inheritAttrs=!1;const R={class:"spreadsheet-import"},M={class:"upload-section"},W={class:"ant-upload-drag-icon"},G={key:0,class:"file-info"},H={class:"paste-section"},B={key:0,class:"paste-placeholder"},J={key:1,class:"pasted-preview"},K={class:"paste-actions"},Z={class:"sample-data"},q=s(p({__name:"SpreadsheetImport",emits:["data-imported","columns-detected"],setup(e,{emit:s}){const r=s,n=v("upload"),o=v(null),i=v(""),c=v(),{parseCSV:u,parseExcel:p,parseTabDelimited:C,parseClipboardData:k}=O();async function E(e){try{let t;if(o.value=e,e.name.endsWith(".csv")){const a=await e.text();t=await u(a)}else{if(!e.name.endsWith(".xlsx")&&!e.name.endsWith(".xls"))throw new Error("Unsupported file format");t=await p(e)}if(!(t.data.length>0))throw new Error("No data found in file");r("data-imported",t.data),r("columns-detected",t.columns),a.success(`Successfully imported ${t.data.length} rows`),setTimeout(()=>{window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"})},100)}catch(t){a.error(`Import failed: ${t instanceof Error?t.message:"Unknown error"}`),o.value=null}return!1}function D(){o.value=null}function N(){i.value="",c.value&&(c.value.textContent="")}async function V(e){if(e.preventDefault(),e.clipboardData)try{const t=await k(e.clipboardData);if(!(t.data.length>0))throw new Error("No valid data found in clipboard");i.value=e.clipboardData.getData("text/plain"),r("data-imported",t.data),r("columns-detected",t.columns),a.success(`Successfully processed ${t.data.length} rows from clipboard`),setTimeout(()=>{window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"})},100)}catch(t){const l=e.clipboardData.getData("text/plain");l?(i.value=l,a.info('Data pasted - click "Process Data" to continue')):a.error(`Paste failed: ${t instanceof Error?t.message:"Unknown error"}`)}else a.error("Clipboard access not available")}function P(e){const a=e.target;i.value=a.textContent||""}async function $(){if(i.value.trim())try{const e=await C(i.value);if(!(e.data.length>0))throw new Error("No valid data found");r("data-imported",e.data),r("columns-detected",e.columns),a.success(`Successfully processed ${e.data.length} rows`),setTimeout(()=>{window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"})},100)}catch(e){a.error(`Processing failed: ${e instanceof Error?e.message:"Unknown error"}`)}else a.warning("Please paste some data first")}function z(){i.value="Name\tAge\tCity\tDepartment\nJohn Smith\t32\tNew York\tEngineering\nSarah Johnson\t28\tSan Francisco\tMarketing\nMichael Brown\t45\tChicago\tSales\nEmily Davis\t31\tBoston\tHR\nRobert Wilson\t39\tSeattle\tEngineering",n.value="paste",a.info('Sample data loaded - click "Process Data" to continue')}return(e,a)=>{const s=h("a-upload-dragger"),r=h("a-button"),u=h("a-tab-pane"),p=h("a-tabs");return b(),m("div",R,[d(p,{activeKey:n.value,"onUpdate:activeKey":a[0]||(a[0]=e=>n.value=e)},{default:g(()=>[d(u,{key:"upload",tab:"Upload File"},{default:g(()=>[f("div",M,[d(s,{"before-upload":E,accept:".csv,.xlsx,.xls","show-upload-list":!1,class:"upload-area"},{default:g(()=>[f("p",W,[d(w(L))]),a[1]||(a[1]=f("p",{class:"ant-upload-text"}," Click or drag CSV/Excel file to upload ",-1)),a[2]||(a[2]=f("p",{class:"ant-upload-hint"}," Supports .csv, .xlsx, .xls files. First row will be used as column headers. ",-1))]),_:1,__:[1,2]}),o.value?(b(),m("div",G,[d(w(t)),f("span",null,_(o.value.name),1),d(r,{type:"link",danger:"",size:"small",onClick:D},{default:g(()=>a[3]||(a[3]=[x(" Remove ")])),_:1,__:[3]})])):y("",!0)])]),_:1}),d(u,{key:"paste",tab:"Paste Data"},{default:g(()=>[f("div",H,[a[6]||(a[6]=f("p",{class:"paste-hint"}," Copy data from Excel, Google Sheets, or any spreadsheet and paste it here. First row will be used as column headers. ",-1)),f("div",{ref_key:"pasteArea",ref:c,class:S(["paste-area",{"has-content":i.value}]),contenteditable:"true",onPaste:V,onInput:P},[i.value?(b(),m("pre",J,_(i.value),1)):(b(),m("div",B," Click here and paste your data (Ctrl+V or Cmd+V) "))],34),f("div",K,[d(r,{size:"large",onClick:N},{default:g(()=>a[4]||(a[4]=[x("Clear")])),_:1,__:[4]}),d(r,{type:"primary",size:"large",onClick:$,disabled:!i.value},{default:g(()=>a[5]||(a[5]=[x(" Process Data ")])),_:1,__:[5]},8,["disabled"])])])]),_:1})]),_:1},8,["activeKey"]),f("div",Z,[d(r,{type:"link",size:"large",onClick:z},{default:g(()=>[d(w(l)),a[7]||(a[7]=x(" Load Sample Data "))]),_:1,__:[7]})])])}}}),[["__scopeId","data-v-ff814767"]]),Y={class:"spreadsheet-grid"},X={class:"grid-header"},Q={class:"grid-info"},ee={class:"row-count"},ae={class:"column-count"},te={class:"grid-actions"},le={class:"grid-container"},se={class:"column-header"},re={class:"column-name"},ne=["title"],oe={key:0,class:"preview-notice"},ie={class:"preview-text"},ce={key:0,class:"preview-actions"},ue={key:1,class:"grid-footer"},de=s(p({__name:"SpreadsheetGrid",props:{data:{},columns:{}},setup(e){const a=e,t=v(!1),l=C(()=>t.value?a.data:a.data.slice(0,10)),s=C(()=>a.columns.map(e=>({title:e,dataIndex:e,key:e,width:150,ellipsis:!0,sorter:(a,t)=>{const l=a[e],s=t[e];return isNaN(Number(l))||isNaN(Number(s))?String(l||"").localeCompare(String(s||"")):Number(l)-Number(s)}})));function n(){t.value=!t.value}function o(e,a){const t=String(e||"");return t.length<=a?t:t.substring(0,a)+"..."}return(e,a)=>{const i=h("a-button"),c=h("a-tag"),u=h("a-table");return b(),m("div",Y,[f("div",X,[f("div",Q,[f("span",ee,_(e.data.length)+" rows",1),f("span",ae,_(e.columns.length)+" columns",1)]),f("div",te,[d(i,{size:"large",onClick:n},{default:g(()=>[x(_(t.value?"Show Preview":"Show All Data"),1)]),_:1})])]),f("div",le,[d(u,{columns:s.value,"data-source":l.value,pagination:!1,scroll:{x:150*e.columns.length,y:400},size:"small",bordered:"",class:"data-grid"},{headerCell:g(({column:e})=>[f("div",se,[f("span",re,_(e.title),1),d(c,{size:"small",color:"blue"},{default:g(()=>[x(_(e.dataIndex),1)]),_:2},1024)])]),bodyCell:g(({text:e})=>[f("div",{class:"cell-content",title:String(e||"")},_(o(e,100)),9,ne)]),_:1},8,["columns","data-source","scroll"])]),!t.value&&e.data.length>10?(b(),m("div",oe,[f("div",ie,[d(w(r)),x(" Showing first "+_(10)+' rows. Click "Show All Data" to see all '+_(e.data.length)+" rows. ",1)]),e.$slots.actions?(b(),m("div",ce,[k(e.$slots,"actions",{},void 0,!0)])):y("",!0)])):e.$slots.actions?(b(),m("div",ue,[k(e.$slots,"actions",{},void 0,!0)])):y("",!0)])}}}),[["__scopeId","data-v-d7d049b7"]]),pe={class:"variable-preview"},ve={class:"variable-list"},me=["onClick"],fe={class:"variable-header"},he={class:"variable-name"},ge={class:"variable-stats"},be={class:"stat-item"},ye={class:"stat-value"},we={key:0,class:"stat-item"},_e={class:"stat-value example"},xe={class:"variable-hint"},Se=["textContent"],Ce=s(p({__name:"SpreadsheetVariablePreview",props:{variables:{}},emits:["insert-variable"],setup(e,{emit:a}){const t=e,l=a;return n.info("SpreadsheetVariablePreview mounted with variables:",t.variables),E(()=>t.variables,e=>{n.info("SpreadsheetVariablePreview variables updated",{variables:e})},{immediate:!0,deep:!0}),(e,a)=>{const t=h("a-tag");return b(),m("div",pe,[f("div",ve,[(b(!0),m(D,null,N(e.variables,e=>{return b(),m("div",{key:e.name,class:"variable-item",onClick:a=>{return t=e.name,n.info("SpreadsheetVariablePreview: Variable clicked",{name:t}),void l("insert-variable",t);var t}},[f("div",fe,[f("code",he,_(e.name),1),d(t,{size:"small",color:(r=e.type,{text:"blue",number:"green",date:"orange",mixed:"purple"}[r]||"default")},{default:g(()=>[x(_(e.type),1)]),_:2},1032,["color"])]),f("div",ge,[f("span",be,[a[0]||(a[0]=f("span",{class:"stat-label"},"Values:",-1)),f("span",ye,_(e.uniqueCount),1)]),e.examples.length>0?(b(),m("span",we,[a[1]||(a[1]=f("span",{class:"stat-label"},"Example:",-1)),f("span",_e,_(e.examples[0]),1)])):y("",!0)]),f("div",xe,[a[2]||(a[2]=x(" Click to insert ")),f("code",{textContent:_((s=e.name,`{{${s}}}`))},null,8,Se)])],8,me);var s,r}),128))])])}}}),[["__scopeId","data-v-8c045d15"]]),ke={class:"design-editor"},Ee={class:"editor-header"},De={class:"editor-content"},Ne={class:"editor-toolbar"},Ve={class:"toolbar-section"},Pe={class:"toolbar-info"},$e={key:0,class:"extractors-section"},ze={class:"extractor-list"},Ie={class:"extractor-info"},Ae={class:"extractor-name"},je={class:"preview-section"},Te=s(p({__name:"SpreadsheetDesignEditor",props:{prompt:{},extractors:{},variables:{},spreadsheetData:{}},emits:["update:prompt","update:extractors"],setup(e,{expose:a,emit:t}){const l=e,s=t,c=v(),u=v(l.prompt),p=v([...l.extractors]),S=v(!1),k=v({name:"",type:"regex",pattern:""}),$=v(!0),z=C(()=>{const e=[...u.value.matchAll(/\{\{(\w+)\}\}/g)];return[...new Set(e.map(e=>e[1]))]});function I(){s("update:prompt",u.value)}function j(e){const a=`{{${e}}}`;n.info("SpreadsheetDesignEditor.insertVariable called",{variableName:e});let t=null;if(c.value)try{c.value.$el&&(t=c.value.$el.querySelector("textarea")),!t&&c.value.resizableTextArea&&(t=c.value.resizableTextArea.textArea),!t&&c.value.textarea&&(t=c.value.textarea),n.info("Found textarea element",{found:!!t})}catch(l){n.warn("Error accessing textarea element",{error:l})}if(t&&"number"==typeof t.selectionStart){const e=t.selectionStart,l=t.selectionEnd,s=u.value;u.value=s.substring(0,e)+a+s.substring(l),V(()=>{if(t){t.focus();const l=e+a.length;t.setSelectionRange(l,l)}})}else u.value=u.value+(u.value?" ":"")+a,n.info("Using fallback insertion method");s("update:prompt",u.value)}function T(e){j(e)}function U(){k.value.name&&k.value.pattern&&(p.value.push({...k.value}),s("update:extractors",p.value),k.value={name:"",type:"regex",pattern:""},S.value=!1)}return E(()=>l.prompt,e=>{u.value=e}),E(()=>l.extractors,e=>{p.value=[...e]},{deep:!0}),a({insertVariable:j}),(e,a)=>{const t=h("a-button"),l=h("a-textarea"),n=h("a-select-option"),v=h("a-select"),C=h("a-tag"),E=h("a-input"),V=h("a-form-item"),j=h("a-radio"),F=h("a-radio-group"),L=h("a-form"),O=h("a-modal");return b(),m("div",ke,[f("div",Ee,[a[8]||(a[8]=f("h3",null,"Prompt Template",-1)),d(t,{size:"small",type:"link",onClick:a[0]||(a[0]=e=>S.value=!0)},{default:g(()=>[d(w(o)),a[7]||(a[7]=x(" Add Extractor "))]),_:1,__:[7]})]),f("div",De,[d(l,{ref_key:"textareaRef",ref:c,value:u.value,"onUpdate:value":a[1]||(a[1]=e=>u.value=e),placeholder:"Enter your prompt template here. Use {{variable}} to insert variables from your spreadsheet.",rows:15,class:"prompt-editor",onChange:I},null,8,["value"]),f("div",Ne,[f("div",Ve,[a[9]||(a[9]=f("span",{class:"toolbar-label"},"Insert Variable:",-1)),d(v,{placeholder:"Select variable",size:"small",style:{width:"200px"},onChange:T},{default:g(()=>[(b(!0),m(D,null,N(e.variables,e=>(b(),P(n,{key:e.name,value:e.name},{default:g(()=>[x(_(e.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),f("div",Pe,[d(w(r)),f("span",null,_(z.value.length)+" variables used",1)])])]),p.value.length>0?(b(),m("div",$e,[a[10]||(a[10]=f("h4",null,"Response Extractors",-1)),f("div",ze,[(b(!0),m(D,null,N(p.value,(e,a)=>(b(),m("div",{key:`${e.name}-${e.type}-${a}`,class:"extractor-item"},[f("div",Ie,[f("code",Ae,_(e.name),1),d(C,{size:"small"},{default:g(()=>[x(_(e.type),1)]),_:2},1024)]),d(t,{type:"text",danger:"",size:"small",onClick:e=>function(e){p.value.splice(e,1),s("update:extractors",p.value)}(a)},{default:g(()=>[d(w(i))]),_:2},1032,["onClick"])]))),128))])])):y("",!0),f("div",je,[a[11]||(a[11]=f("h4",null,"Preview with First Row",-1)),d(A,{template:u.value,"tabular-data":e.spreadsheetData,cycling:!0,"cycling-paused":$.value,"show-controls":"pause-play","display-mode":"block","show-legend":!0,"onUpdate:cyclingPaused":a[2]||(a[2]=e=>$.value=e)},null,8,["template","tabular-data","cycling-paused"])]),d(O,{open:S.value,"onUpdate:open":a[6]||(a[6]=e=>S.value=e),title:"Add Response Extractor",onOk:U},{default:g(()=>[d(L,{layout:"vertical"},{default:g(()=>[d(V,{label:"Extractor Name"},{default:g(()=>[d(E,{value:k.value.name,"onUpdate:value":a[3]||(a[3]=e=>k.value.name=e),placeholder:"e.g., sentiment, category"},null,8,["value"])]),_:1}),d(V,{label:"Pattern Type"},{default:g(()=>[d(F,{value:k.value.type,"onUpdate:value":a[4]||(a[4]=e=>k.value.type=e)},{default:g(()=>[d(j,{value:"regex"},{default:g(()=>a[12]||(a[12]=[x("Regular Expression")])),_:1,__:[12]}),d(j,{value:"keyword"},{default:g(()=>a[13]||(a[13]=[x("Keyword Match")])),_:1,__:[13]})]),_:1},8,["value"])]),_:1}),d(V,{label:"Pattern"},{default:g(()=>[d(E,{value:k.value.pattern,"onUpdate:value":a[5]||(a[5]=e=>k.value.pattern=e),placeholder:"Enter pattern"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),[["__scopeId","data-v-2b696615"]]);function Ue(){const e=v([]),{sanitizeColumnNames:a}=O();function t(e){const a=new Set;return e.forEach(e=>{if(null==e||""===e)return;const t=String(e).trim();isNaN(Number(t))||""===t?!function(e){const a=new Date(e);return!isNaN(a.getTime())&&null!==e.match(/\d{1,4}[-/]\d{1,2}[-/]\d{1,4}/)}(t)?a.add("text"):a.add("date"):a.add("number")}),0===a.size?"text":1===a.size?Array.from(a)[0]:"mixed"}return{availableVariables:e,generateVariableLists:function(e,l){n.info("generateVariableLists called with:",{columns:e,dataLength:l.length});const s=a(e);n.info("Sanitized columns:",s);const r=s.map((a,s)=>{const r=e[s],o=l.map(e=>e[r]),i=Array.from(new Set(o.filter(e=>null!=e&&""!==e))),c={name:a,type:t(o),uniqueCount:i.length,examples:i.slice(0,3).map(e=>String(e))};return n.info("Generated variable:",c),c});return n.info("All generated variables:",r),r},convertToVariableLists:function(e,a){const t={};return e.forEach(e=>{const l=a.map(a=>a[e.name]);t[e.name]={type:"simple",name:e.name,values:l}}),t},generateCombinations:function(e){return e}}}const Fe={class:"spreadsheet-view"},Le={class:"step-content"},Oe={key:0,class:"import-step"},Re={key:1,class:"design-step"},Me={class:"design-layout"},We={class:"variables-panel"},Ge={key:0,class:"no-variables"},He={class:"editor-panel"},Be={class:"step-actions"},Je={key:2,class:"configure-step"},Ke={class:"step-actions"},Ze=s(p({__name:"SpreadsheetView",setup(e){const t=$(),l=v(),s=v(0),o=v([]),i=v([]),p=v(""),S=v([]),k=v([]),{generateVariableLists:E}=Ue(),{generatedDesign:D,createDesignFromSpreadsheet:N}=function(){const e=c(),a=u(),t=v(null);return{generatedDesign:t,createDesignFromSpreadsheet:async function(l){try{const s=await a.createList({name:`${l.name} - Dataset`,description:"Imported spreadsheet data",category:"tabular",tabularData:{columns:l.variables.map(e=>e.name),rows:JSON.parse(JSON.stringify(l.data))},itemCount:l.data.length});if(!s)throw new Error("Failed to create tabular variable list");const r=await e.createSpreadsheet({name:l.name,description:"Created from spreadsheet import",promptPattern:l.prompt,datasetId:s,outputConfig:{outputType:"text",extractPattern:l.extractors.length>0?l.extractors[0].pattern:void 0,refusalWords:void 0,refusalWordsListRef:void 0,rejectRefusalWords:!1}});if(r){const a=await e.getSpreadsheet(r);return t.value=a||null,a||null}return null}catch(s){return n.error("Failed to create spreadsheet prompt from data:",s),null}},validatePromptVariables:function(e,a){const t=[...e.matchAll(/\{\{(\w+)\}\}/g)],l=[...new Set(t.map(e=>e[1]))],s=l.filter(e=>!a.includes(e)),r=a.filter(e=>!l.includes(e));return{valid:0===s.length,missingVariables:s,unusedVariables:r}}}}(),z=C(()=>{switch(s.value){case 0:return o.value.length>0&&i.value.length>0;case 1:return p.value.trim().length>0;case 2:return!0;default:return!1}}),I=C(()=>({currentStep:s.value,importedDataLength:o.value.length,detectedColumns:i.value,availableVariablesLength:k.value.length,availableVariables:k.value}));function A(e){o.value=e,a.success(`Imported ${e.length} rows`)}function T(e){n.info("SpreadsheetView: handleColumnsDetected called",{columns:e}),i.value=e;const a=E(e,o.value);n.info("SpreadsheetView: Generated variables",{generated:a}),k.value=a,n.info("SpreadsheetView: availableVariables set",{variables:k.value})}async function U(){if(0===s.value)s.value++;else if(1===s.value){const e=await N({name:`Spreadsheet Import - ${(new Date).toLocaleDateString()}`,prompt:p.value,extractors:S.value,variables:k.value,data:o.value});e&&(D.value=e,s.value++)}}function F(e){a.success("Trial created successfully!"),t.push(`/trials/${e}`)}function L(e){a.success("Trial created and started!"),t.push(`/trials/${e}`)}return(e,a)=>{const t=h("a-step"),c=h("a-steps"),u=h("a-button"),v=h("a-tooltip");return b(),m("div",Fe,[a[11]||(a[11]=f("div",{class:"page-header"},[f("div",{class:"header-content"},[f("h1",null,"Spreadsheet Import"),f("p",{class:"description"}," Import data from CSV/Excel and create prompts using column variables. Unlike classic designs that generate all variable combinations (cartesian product), spreadsheet designs execute one API call per row - perfect for specific test cases where each row represents a complete, explainable scenario. ")])],-1)),d(c,{current:s.value,class:"workflow-steps"},{default:g(()=>[d(t,{title:"Import Data",description:"Upload or paste spreadsheet data"}),d(t,{title:"Design Prompt",description:"Create template using variables"}),d(t,{title:"Configure Trial",description:"Select models and settings"})]),_:1},8,["current"]),f("div",Le,[0===s.value?(b(),m("div",Oe,[d(q,{onDataImported:A,onColumnsDetected:T}),o.value.length>0?(b(),P(de,{key:0,data:o.value,columns:i.value,class:"preview-grid"},{actions:g(()=>[d(u,{type:"primary",size:"large",onClick:U,disabled:!z.value},{default:g(()=>a[5]||(a[5]=[x(" Next ")])),_:1,__:[5]},8,["disabled"])]),_:1},8,["data","columns"])):y("",!0)])):y("",!0),1===s.value?(b(),m("div",Re,[f("div",Me,[f("div",We,[f("h3",null,[a[6]||(a[6]=x(" Available Variables ")),d(v,{title:"These variables are extracted from your spreadsheet columns. Click any variable to insert it into your prompt."},{default:g(()=>[d(w(r),{class:"info-icon"})]),_:1})]),0===k.value.length?(b(),m("div",Ge,[a[7]||(a[7]=f("p",null,"No variables detected. Please import data first.",-1)),f("pre",null,_(JSON.stringify(I.value,null,2)),1)])):(b(),P(Ce,{key:1,variables:k.value,onInsertVariable:a[0]||(a[0]=e=>{w(n).info("SpreadsheetView: Received insert-variable event",{variable:e}),function(e){if(n.info("Inserting variable",{variable:e}),!l.value)return n.error("Design editor ref not available"),void V(()=>{l.value?l.value.insertVariable(e):n.error("Design editor ref still not available after nextTick")});l.value.insertVariable(e)}(e)})},null,8,["variables"]))]),f("div",He,[d(Te,{ref_key:"designEditor",ref:l,prompt:p.value,"onUpdate:prompt":a[1]||(a[1]=e=>p.value=e),extractors:S.value,"onUpdate:extractors":a[2]||(a[2]=e=>S.value=e),variables:k.value,"spreadsheet-data":o.value},null,8,["prompt","extractors","variables","spreadsheet-data"])])]),f("div",Be,[d(u,{size:"large",onClick:a[3]||(a[3]=e=>s.value--)},{default:g(()=>a[8]||(a[8]=[x(" Previous ")])),_:1,__:[8]}),d(u,{type:"primary",size:"large",onClick:U,disabled:!z.value},{default:g(()=>a[9]||(a[9]=[x(" Next ")])),_:1,__:[9]},8,["disabled"])])])):y("",!0),2===s.value?(b(),m("div",Je,[w(D)?(b(),P(j,{key:0,"initial-design-id":w(D).id,"is-tab-mode":!0,class:"trial-creation-wrapper",onCreated:F,onCreatedAndStarted:L},null,8,["initial-design-id"])):y("",!0),f("div",Ke,[d(u,{size:"large",onClick:a[4]||(a[4]=e=>s.value--)},{default:g(()=>a[10]||(a[10]=[x(" Previous ")])),_:1,__:[10]})])])):y("",!0)])])}}}),[["__scopeId","data-v-873ce359"]]);export{Ze as default};
