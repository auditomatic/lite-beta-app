import{l as r}from"./db-CL8uhZCz.js";import{l as e}from"./index-COu0csOc.js";import{s as n,f as o,b as a}from"./vendor-CdfxntmD.js";const t={debounce:100,onError:r=>e.error("LiveDataSingle error:",r),trackPerformance:!1};function l(l,u={}){const c={...t,...u},i=n(null),s=o(!0),f=o(null);let m=null,v=null,d=!1;const b=c.trackPerformance?performance.now():0;(()=>{if(d||m)return;const e=r(l);m=e.subscribe({next:r=>{d||(v&&clearTimeout(v),v=window.setTimeout(()=>{d||(i.value=r||null,s.value=!1,f.value=null)},c.debounce))},error:r=>{if(d)return;const e=r instanceof Error?r:new Error(String(r));f.value=e,s.value=!1,c.onError(e)}})})();const w=()=>{d=!0,v&&(clearTimeout(v),v=null),m&&(m.unsubscribe(),m=null)};return a(w),{data:i,loading:s,error:f,refresh:async()=>{await(async()=>{if(!d)try{s.value=!0,f.value=null;const r=await l();if(d)return;if(i.value=r||null,c.trackPerformance&&b){const r=performance.now()-b;e.debug(`LiveDataSingle query completed in ${r.toFixed(2)}ms`)}}catch(r){if(d)return;const e=r instanceof Error?r:new Error(String(r));f.value=e,c.onError(e)}finally{d||(s.value=!1)}})()},destroy:w}}export{l as u};
