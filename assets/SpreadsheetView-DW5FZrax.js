import{k as e,d as a,f as t,a9 as l,a0 as s,Y as r,_ as n,Z as o,$ as i,u as c,a2 as u,G as d,ac as p,c as v,ag as m,w as f,F as h,aa as g,n as b,X as y,W as w}from"./vendor-B9vlzAYn.js";import{read as _,utils as x}from"./xlsx-C4WhbwXR.js";import{I as C,j as S,F as k,E,_ as D,w as N,G as P,m as $,u as z,a as V}from"./index-mBQkrP6K.js";import{a as A,T as I}from"./TrialCreationModalNew--VREMolS.js";import"./db-CL8uhZCz.js";import"./BaseModal.vue_vue_type_style_index_0_lang-DjxfwE8g.js";import"./useEnvironmentalCost-CuVfAX4z.js";import"./cost-formatting-Bv_drrqY.js";import"./GenericModelSelectorModal-BCtARSu3.js";var T={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"};function j(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),l.forEach(function(a){U(e,a,t[a])})}return e}function U(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var F=function(a,t){var l=j({},a,t.attrs);return e(C,j({},l,{icon:T}),null)};function O(){function e(e){const a=[];let t="",l=!1;for(let s=0;s<e.length;s++){const r=e[s],n=e[s+1];'"'===r?l&&'"'===n?(t+='"',s++):l=!l:","!==r||l?t+=r:(a.push(t),t="")}return a.push(t),a}async function a(e){return new Promise((a,t)=>{try{const l=_(e,{type:"string",raw:!1,dateNF:"yyyy-mm-dd"}),s=l.SheetNames[0],r=l.Sheets[s],n=x.sheet_to_json(r,{raw:!1,defval:"",header:1});if(0===n.length)return void t(new Error("No data found"));const o=n[0].map(e=>String(e||"").trim()),i=[];for(let e=1;e<n.length;e++){const a={};o.forEach((t,l)=>{a[t]=n[e][l]||""}),i.push(a)}a({data:i,columns:o})}catch(l){try{const l=e.trim().split("\n").filter(e=>e.trim());if(0===l.length)return void t(new Error("No data found"));const s=l[0];let r="\t";s.includes("\t")||(s.includes(",")?r=",":s.includes(";")?r=";":s.includes("|")&&(r="|"));const n=l[0].split(r).map(e=>e.trim().replace(/^["']|["']$/g,"")),o=[];for(let e=1;e<l.length;e++){const a=l[e].split(r).map(e=>e.trim().replace(/^["']|["']$/g,"")),t={};n.forEach((e,l)=>{t[e]=a[l]||""}),o.push(t)}a({data:o,columns:n})}catch(s){t(l)}}})}function t(e){return e.map(e=>{let a=e.replace(/[^a-zA-Z0-9_]/g,"_");return/^[a-zA-Z]/.test(a)||(a="col_"+a),a=a.replace(/_+/g,"_"),a=a.replace(/_+$/,""),a})}return{parseCSV:async function(a){return new Promise((t,l)=>{try{const s=a.trim().split("\n").filter(e=>e.trim());if(0===s.length)return void l(new Error("No data found"));const r=e(s[0]).map(e=>e.trim()),n=[];for(let a=1;a<s.length;a++){const t=e(s[a]),l={};r.forEach((e,a)=>{l[e]=t[a]||""}),n.push(l)}t({data:n,columns:r})}catch(s){l(s)}})},parseExcel:async function(e){return new Promise((a,t)=>{const l=new FileReader;l.onload=e=>{try{const l=e.target?.result,s=_(l,{type:"binary"}),r=s.SheetNames[0],n=s.Sheets[r],o=x.sheet_to_json(n,{raw:!1,defval:""});if(0===o.length)return void t(new Error("No data found in Excel file"));const i=Object.keys(o[0]);a({data:o,columns:i})}catch(l){t(l)}},l.onerror=()=>{t(new Error("Failed to read file"))},l.readAsBinaryString(e)})},parseTabDelimited:a,parseClipboardData:async function(e){return new Promise((l,s)=>{try{const r=e.getData("text/html");if(r){const e=_(r,{type:"string",raw:!1,dateNF:"yyyy-mm-dd"}),a=e.SheetNames[0],s=e.Sheets[a],n=x.sheet_to_json(s,{raw:!1,defval:"",header:1});if(n.length>0){const e=t(n[0].map(e=>String(e||"").trim())),a=[];for(let t=1;t<n.length;t++){const l={};e.forEach((e,a)=>{l[e]=n[t][a]||""}),a.push(l)}return void l({data:a,columns:e})}}const n=e.getData("text/plain");n?a(n).then(l).catch(s):s(new Error("No suitable data found in clipboard"))}catch(r){s(r)}})},validateColumns:function(e){const a=[],t=/^[a-zA-Z][a-zA-Z0-9_]*$/,l=["if","else","for","while","function","return","var","let","const"];e.forEach(e=>{t.test(e)||a.push(`Column "${e}" contains invalid characters. Variable names must start with a letter and contain only letters, numbers, and underscores.`),l.includes(e.toLowerCase())&&a.push(`Column "${e}" is a reserved word and cannot be used as a variable name.`)});const s=new Set;return e.forEach(e=>{s.has(e.toLowerCase())&&a.push(`Duplicate column name: "${e}"`),s.add(e.toLowerCase())}),{valid:0===a.length,errors:a}},sanitizeColumnNames:t}}F.displayName="CloudUploadOutlined",F.inheritAttrs=!1;const L={class:"spreadsheet-import"},R={class:"upload-section"},M={class:"ant-upload-drag-icon"},H={key:0,class:"file-info"},W={class:"paste-section"},B={key:0,class:"paste-placeholder"},G={key:1,class:"pasted-preview"},J={class:"paste-actions"},Z={class:"sample-data"},K=D(a({__name:"SpreadsheetImport",emits:["data-imported","columns-detected"],setup(a,{emit:v}){const m=v,f=t("upload"),h=t(null),g=t(""),b=t(),{parseCSV:y,parseExcel:w,parseTabDelimited:_,parseClipboardData:x}=O();async function C(e){try{let a;if(h.value=e,e.name.endsWith(".csv")){const t=await e.text();a=await y(t)}else{if(!e.name.endsWith(".xlsx")&&!e.name.endsWith(".xls"))throw new Error("Unsupported file format");a=await w(e)}if(!(a.data.length>0))throw new Error("No data found in file");m("data-imported",a.data),m("columns-detected",a.columns),S.success(`Successfully imported ${a.data.length} rows`),setTimeout(()=>{window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"})},100)}catch(a){S.error(`Import failed: ${a instanceof Error?a.message:"Unknown error"}`),h.value=null}return!1}function D(){h.value=null}function N(){g.value="",b.value&&(b.value.textContent="")}async function P(e){if(e.preventDefault(),e.clipboardData)try{const a=await x(e.clipboardData);if(!(a.data.length>0))throw new Error("No valid data found in clipboard");g.value=e.clipboardData.getData("text/plain"),m("data-imported",a.data),m("columns-detected",a.columns),S.success(`Successfully processed ${a.data.length} rows from clipboard`),setTimeout(()=>{window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"})},100)}catch(a){const t=e.clipboardData.getData("text/plain");t?(g.value=t,S.info('Data pasted - click "Process Data" to continue')):S.error(`Paste failed: ${a instanceof Error?a.message:"Unknown error"}`)}else S.error("Clipboard access not available")}function $(e){const a=e.target;g.value=a.textContent||""}async function z(){if(g.value.trim())try{const e=await _(g.value);if(!(e.data.length>0))throw new Error("No valid data found");m("data-imported",e.data),m("columns-detected",e.columns),S.success(`Successfully processed ${e.data.length} rows`),setTimeout(()=>{window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"})},100)}catch(e){S.error(`Processing failed: ${e instanceof Error?e.message:"Unknown error"}`)}else S.warning("Please paste some data first")}function V(){g.value="Name\tAge\tCity\tDepartment\nJohn Smith\t32\tNew York\tEngineering\nSarah Johnson\t28\tSan Francisco\tMarketing\nMichael Brown\t45\tChicago\tSales\nEmily Davis\t31\tBoston\tHR\nRobert Wilson\t39\tSeattle\tEngineering",f.value="paste",S.info('Sample data loaded - click "Process Data" to continue')}return(a,t)=>{const v=r("a-upload-dragger"),m=r("a-button"),y=r("a-tab-pane"),w=r("a-tabs");return o(),l("div",L,[e(w,{activeKey:f.value,"onUpdate:activeKey":t[0]||(t[0]=e=>f.value=e)},{default:n(()=>[e(y,{key:"upload",tab:"Upload File"},{default:n(()=>[s("div",R,[e(v,{"before-upload":C,accept:".csv,.xlsx,.xls","show-upload-list":!1,class:"upload-area"},{default:n(()=>[s("p",M,[e(c(F))]),t[1]||(t[1]=s("p",{class:"ant-upload-text"}," Click or drag CSV/Excel file to upload ",-1)),t[2]||(t[2]=s("p",{class:"ant-upload-hint"}," Supports .csv, .xlsx, .xls files. First row will be used as column headers. ",-1))]),_:1,__:[1,2]}),h.value?(o(),l("div",H,[e(c(k)),s("span",null,u(h.value.name),1),e(m,{type:"link",danger:"",size:"small",onClick:D},{default:n(()=>t[3]||(t[3]=[d(" Remove ")])),_:1,__:[3]})])):i("",!0)])]),_:1}),e(y,{key:"paste",tab:"Paste Data"},{default:n(()=>[s("div",W,[t[6]||(t[6]=s("p",{class:"paste-hint"}," Copy data from Excel, Google Sheets, or any spreadsheet and paste it here. First row will be used as column headers. ",-1)),s("div",{ref_key:"pasteArea",ref:b,class:p(["paste-area",{"has-content":g.value}]),contenteditable:"true",onPaste:P,onInput:$},[g.value?(o(),l("pre",G,u(g.value),1)):(o(),l("div",B," Click here and paste your data (Ctrl+V or Cmd+V) "))],34),s("div",J,[e(m,{size:"large",onClick:N},{default:n(()=>t[4]||(t[4]=[d("Clear")])),_:1,__:[4]}),e(m,{type:"primary",size:"large",onClick:z,disabled:!g.value},{default:n(()=>t[5]||(t[5]=[d(" Process Data ")])),_:1,__:[5]},8,["disabled"])])])]),_:1})]),_:1},8,["activeKey"]),s("div",Z,[e(m,{type:"link",size:"large",onClick:V},{default:n(()=>[e(c(E)),t[7]||(t[7]=d(" Load Sample Data "))]),_:1,__:[7]})])])}}}),[["__scopeId","data-v-ff814767"]]),q={class:"spreadsheet-grid"},Y={class:"grid-header"},X={class:"grid-info"},Q={class:"row-count"},ee={class:"column-count"},ae={class:"grid-actions"},te={class:"grid-container"},le={class:"column-header"},se={class:"column-name"},re=["title"],ne={key:0,class:"preview-notice"},oe={class:"preview-text"},ie={key:0,class:"preview-actions"},ce={key:1,class:"grid-footer"},ue=D(a({__name:"SpreadsheetGrid",props:{data:{},columns:{}},setup(a){const p=a,f=t(!1),h=v(()=>f.value?p.data:p.data.slice(0,10)),g=v(()=>p.columns.map(e=>({title:e,dataIndex:e,key:e,width:150,ellipsis:!0,sorter:(a,t)=>{const l=a[e],s=t[e];return isNaN(Number(l))||isNaN(Number(s))?String(l||"").localeCompare(String(s||"")):Number(l)-Number(s)}})));function b(){f.value=!f.value}function y(e,a){const t=String(e||"");return t.length<=a?t:t.substring(0,a)+"..."}return(a,t)=>{const p=r("a-button"),v=r("a-tag"),w=r("a-table");return o(),l("div",q,[s("div",Y,[s("div",X,[s("span",Q,u(a.data.length)+" rows",1),s("span",ee,u(a.columns.length)+" columns",1)]),s("div",ae,[e(p,{size:"large",onClick:b},{default:n(()=>[d(u(f.value?"Show Preview":"Show All Data"),1)]),_:1})])]),s("div",te,[e(w,{columns:g.value,"data-source":h.value,pagination:!1,scroll:{x:150*a.columns.length,y:400},size:"small",bordered:"",class:"data-grid"},{headerCell:n(({column:a})=>[s("div",le,[s("span",se,u(a.title),1),e(v,{size:"small",color:"blue"},{default:n(()=>[d(u(a.dataIndex),1)]),_:2},1024)])]),bodyCell:n(({text:e})=>[s("div",{class:"cell-content",title:String(e||"")},u(y(e,100)),9,re)]),_:1},8,["columns","data-source","scroll"])]),!f.value&&a.data.length>10?(o(),l("div",ne,[s("div",oe,[e(c(N)),d(" Showing first "+u(10)+' rows. Click "Show All Data" to see all '+u(a.data.length)+" rows. ",1)]),a.$slots.actions?(o(),l("div",ie,[m(a.$slots,"actions",{},void 0,!0)])):i("",!0)])):a.$slots.actions?(o(),l("div",ce,[m(a.$slots,"actions",{},void 0,!0)])):i("",!0)])}}}),[["__scopeId","data-v-d7d049b7"]]),de={class:"variable-preview"},pe={class:"variable-list"},ve=["onClick"],me={class:"variable-header"},fe={class:"variable-name"},he={class:"variable-stats"},ge={class:"stat-item"},be={class:"stat-value"},ye={key:0,class:"stat-item"},we={class:"stat-value example"},_e={class:"variable-hint"},xe=["textContent"],Ce=D(a({__name:"SpreadsheetVariablePreview",props:{variables:{}},emits:["insert-variable"],setup(a,{emit:t}){const c=a,p=t;return c.variables,f(()=>c.variables,e=>{},{immediate:!0,deep:!0}),(a,t)=>{const c=r("a-tag");return o(),l("div",de,[s("div",pe,[(o(!0),l(h,null,g(a.variables,a=>{return o(),l("div",{key:a.name,class:"variable-item",onClick:e=>{return t=a.name,void p("insert-variable",t);var t}},[s("div",me,[s("code",fe,u(a.name),1),e(c,{size:"small",color:(v=a.type,{text:"blue",number:"green",date:"orange",mixed:"purple"}[v]||"default")},{default:n(()=>[d(u(a.type),1)]),_:2},1032,["color"])]),s("div",he,[s("span",ge,[t[0]||(t[0]=s("span",{class:"stat-label"},"Values:",-1)),s("span",be,u(a.uniqueCount),1)]),a.examples.length>0?(o(),l("span",ye,[t[1]||(t[1]=s("span",{class:"stat-label"},"Example:",-1)),s("span",we,u(a.examples[0]),1)])):i("",!0)]),s("div",_e,[t[2]||(t[2]=d(" Click to insert ")),s("code",{textContent:u((r=a.name,`{{${r}}}`))},null,8,xe)])],8,ve);var r,v}),128))])])}}}),[["__scopeId","data-v-39955e52"]]),Se={class:"design-editor"},ke={class:"editor-header"},Ee={class:"editor-content"},De={class:"editor-toolbar"},Ne={class:"toolbar-section"},Pe={class:"toolbar-info"},$e={key:0,class:"extractors-section"},ze={class:"extractor-list"},Ve={class:"extractor-info"},Ae={class:"extractor-name"},Ie={class:"preview-section"},Te=D(a({__name:"SpreadsheetDesignEditor",props:{prompt:{},extractors:{},variables:{},spreadsheetData:{}},emits:["update:prompt","update:extractors"],setup(a,{expose:p,emit:m}){const w=a,_=m,x=t(),C=t(w.prompt),S=t([...w.extractors]),k=t(!1),E=t({name:"",type:"regex",pattern:""}),D=t(!0),z=v(()=>{const e=[...C.value.matchAll(/\{\{(\w+)\}\}/g)];return[...new Set(e.map(e=>e[1]))]});function V(){_("update:prompt",C.value)}function I(e){const a=`{{${e}}}`;let t=null;if(x.value)try{x.value.$el&&(t=x.value.$el.querySelector("textarea")),!t&&x.value.resizableTextArea&&(t=x.value.resizableTextArea.textArea),!t&&x.value.textarea&&(t=x.value.textarea)}catch(l){console.warn("Error accessing textarea element:",l)}if(t&&"number"==typeof t.selectionStart){const e=t.selectionStart,l=t.selectionEnd,s=C.value;C.value=s.substring(0,e)+a+s.substring(l),b(()=>{if(t){t.focus();const l=e+a.length;t.setSelectionRange(l,l)}})}else C.value=C.value+(C.value?" ":"")+a;_("update:prompt",C.value)}function T(e){I(e)}function j(){E.value.name&&E.value.pattern&&(S.value.push({...E.value}),_("update:extractors",S.value),E.value={name:"",type:"regex",pattern:""},k.value=!1)}return f(()=>w.prompt,e=>{C.value=e}),f(()=>w.extractors,e=>{S.value=[...e]},{deep:!0}),p({insertVariable:I}),(a,t)=>{const p=r("a-button"),v=r("a-textarea"),m=r("a-select-option"),f=r("a-select"),b=r("a-tag"),w=r("a-input"),I=r("a-form-item"),U=r("a-radio"),F=r("a-radio-group"),O=r("a-form"),L=r("a-modal");return o(),l("div",Se,[s("div",ke,[t[8]||(t[8]=s("h3",null,"Prompt Template",-1)),e(p,{size:"small",type:"link",onClick:t[0]||(t[0]=e=>k.value=!0)},{default:n(()=>[e(c(P)),t[7]||(t[7]=d(" Add Extractor "))]),_:1,__:[7]})]),s("div",Ee,[e(v,{ref_key:"textareaRef",ref:x,value:C.value,"onUpdate:value":t[1]||(t[1]=e=>C.value=e),placeholder:"Enter your prompt template here. Use {{variable}} to insert variables from your spreadsheet.",rows:15,class:"prompt-editor",onChange:V},null,8,["value"]),s("div",De,[s("div",Ne,[t[9]||(t[9]=s("span",{class:"toolbar-label"},"Insert Variable:",-1)),e(f,{placeholder:"Select variable",size:"small",style:{width:"200px"},onChange:T},{default:n(()=>[(o(!0),l(h,null,g(a.variables,e=>(o(),y(m,{key:e.name,value:e.name},{default:n(()=>[d(u(e.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),s("div",Pe,[e(c(N)),s("span",null,u(z.value.length)+" variables used",1)])])]),S.value.length>0?(o(),l("div",$e,[t[10]||(t[10]=s("h4",null,"Response Extractors",-1)),s("div",ze,[(o(!0),l(h,null,g(S.value,(a,t)=>(o(),l("div",{key:`${a.name}-${a.type}-${t}`,class:"extractor-item"},[s("div",Ve,[s("code",Ae,u(a.name),1),e(b,{size:"small"},{default:n(()=>[d(u(a.type),1)]),_:2},1024)]),e(p,{type:"text",danger:"",size:"small",onClick:e=>function(e){S.value.splice(e,1),_("update:extractors",S.value)}(t)},{default:n(()=>[e(c($))]),_:2},1032,["onClick"])]))),128))])])):i("",!0),s("div",Ie,[t[11]||(t[11]=s("h4",null,"Preview with First Row",-1)),e(A,{template:C.value,"tabular-data":a.spreadsheetData,cycling:!0,"cycling-paused":D.value,"show-controls":"pause-play","display-mode":"block","show-legend":!0,"onUpdate:cyclingPaused":t[2]||(t[2]=e=>D.value=e)},null,8,["template","tabular-data","cycling-paused"])]),e(L,{open:k.value,"onUpdate:open":t[6]||(t[6]=e=>k.value=e),title:"Add Response Extractor",onOk:j},{default:n(()=>[e(O,{layout:"vertical"},{default:n(()=>[e(I,{label:"Extractor Name"},{default:n(()=>[e(w,{value:E.value.name,"onUpdate:value":t[3]||(t[3]=e=>E.value.name=e),placeholder:"e.g., sentiment, category"},null,8,["value"])]),_:1}),e(I,{label:"Pattern Type"},{default:n(()=>[e(F,{value:E.value.type,"onUpdate:value":t[4]||(t[4]=e=>E.value.type=e)},{default:n(()=>[e(U,{value:"regex"},{default:n(()=>t[12]||(t[12]=[d("Regular Expression")])),_:1,__:[12]}),e(U,{value:"keyword"},{default:n(()=>t[13]||(t[13]=[d("Keyword Match")])),_:1,__:[13]})]),_:1},8,["value"])]),_:1}),e(I,{label:"Pattern"},{default:n(()=>[e(w,{value:E.value.pattern,"onUpdate:value":t[5]||(t[5]=e=>E.value.pattern=e),placeholder:"Enter pattern"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),[["__scopeId","data-v-22c1495a"]]);function je(){const e=t([]),{sanitizeColumnNames:a}=O();function l(e){const a=new Set;return e.forEach(e=>{if(null==e||""===e)return;const t=String(e).trim();isNaN(Number(t))||""===t?!function(e){const a=new Date(e);return!isNaN(a.getTime())&&null!==e.match(/\d{1,4}[-/]\d{1,2}[-/]\d{1,4}/)}(t)?a.add("text"):a.add("date"):a.add("number")}),0===a.size?"text":1===a.size?Array.from(a)[0]:"mixed"}return{availableVariables:e,generateVariableLists:function(e,t){return t.length,a(e).map((a,s)=>{const r=e[s],n=t.map(e=>e[r]),o=Array.from(new Set(n.filter(e=>null!=e&&""!==e)));return{name:a,type:l(n),uniqueCount:o.length,examples:o.slice(0,3).map(e=>String(e))}})},convertToVariableLists:function(e,a){const t={};return e.forEach(e=>{const l=a.map(a=>a[e.name]);t[e.name]={type:"simple",name:e.name,values:l}}),t},generateCombinations:function(e){return e}}}const Ue={class:"spreadsheet-view"},Fe={class:"step-content"},Oe={key:0,class:"import-step"},Le={key:1,class:"design-step"},Re={class:"design-layout"},Me={class:"variables-panel"},He={key:0,class:"no-variables"},We={class:"editor-panel"},Be={class:"step-actions"},Ge={key:2,class:"configure-step"},Je={class:"step-actions"},Ze=D(a({__name:"SpreadsheetView",setup(a){const p=w(),m=t(),f=t(0),h=t([]),g=t([]),_=t(""),x=t([]),C=t([]),{generateVariableLists:k}=je(),{generatedDesign:E,createDesignFromSpreadsheet:D}=function(){const e=z(),a=V(),l=t(null);return{generatedDesign:l,createDesignFromSpreadsheet:async function(t){try{const s=await a.createList({name:`${t.name} - Spreadsheet Data`,description:"Imported from spreadsheet",category:"tabular",tabularData:{columns:t.variables.map(e=>e.name),rows:JSON.parse(JSON.stringify(t.data))},itemCount:t.data.length});if(!s)throw new Error("Failed to create tabular variable list");const r=await e.createDesign({name:t.name,description:"Created from spreadsheet import",promptTemplate:t.prompt,variableBindings:{__tabular__:{type:"list",listId:s}},executionMode:"aligned",outputType:"text",extractPattern:t.extractors.length>0?t.extractors[0].pattern:"",refusalWords:[],rejectRefusalWords:!1});if(r){const a=await e.getDesign(r);return l.value=a||null,a||null}return null}catch(s){return console.error("Failed to create design from spreadsheet:",s),null}},validatePromptVariables:function(e,a){const t=[...e.matchAll(/\{\{(\w+)\}\}/g)],l=[...new Set(t.map(e=>e[1]))],s=l.filter(e=>!a.includes(e)),r=a.filter(e=>!l.includes(e));return{valid:0===s.length,missingVariables:s,unusedVariables:r}}}}(),P=v(()=>{switch(f.value){case 0:return h.value.length>0&&g.value.length>0;case 1:return _.value.trim().length>0;case 2:return!0;default:return!1}}),$=v(()=>({currentStep:f.value,importedDataLength:h.value.length,detectedColumns:g.value,availableVariablesLength:C.value.length,availableVariables:C.value}));function A(e){h.value=e,S.success(`Imported ${e.length} rows`)}function T(e){g.value=e;const a=k(e,h.value);C.value=a,C.value}async function j(){if(0===f.value)f.value++;else if(1===f.value){const e=await D({name:`Spreadsheet Import - ${(new Date).toLocaleDateString()}`,prompt:_.value,extractors:x.value,variables:C.value,data:h.value});e&&(E.value=e,f.value++)}}function U(e){S.success("Trial created successfully!"),p.push(`/trials/${e}`)}function F(e){S.success("Trial created and started!"),p.push(`/trials/${e}`)}return(a,t)=>{const p=r("a-step"),v=r("a-steps"),w=r("a-button"),S=r("a-tooltip");return o(),l("div",Ue,[t[11]||(t[11]=s("div",{class:"page-header"},[s("div",{class:"header-content"},[s("h1",null,"Spreadsheet Import"),s("p",{class:"description"}," Import data from CSV/Excel and create prompts using column variables. Unlike classic designs that generate all variable combinations (cartesian product), spreadsheet designs execute one API call per row - perfect for specific test cases where each row represents a complete, explainable scenario. ")])],-1)),e(v,{current:f.value,class:"workflow-steps"},{default:n(()=>[e(p,{title:"Import Data",description:"Upload or paste spreadsheet data"}),e(p,{title:"Design Prompt",description:"Create template using variables"}),e(p,{title:"Configure Trial",description:"Select models and settings"})]),_:1},8,["current"]),s("div",Fe,[0===f.value?(o(),l("div",Oe,[e(K,{onDataImported:A,onColumnsDetected:T}),h.value.length>0?(o(),y(ue,{key:0,data:h.value,columns:g.value,class:"preview-grid"},{actions:n(()=>[e(w,{type:"primary",size:"large",onClick:j,disabled:!P.value},{default:n(()=>t[5]||(t[5]=[d(" Next ")])),_:1,__:[5]},8,["disabled"])]),_:1},8,["data","columns"])):i("",!0)])):i("",!0),1===f.value?(o(),l("div",Le,[s("div",Re,[s("div",Me,[s("h3",null,[t[6]||(t[6]=d(" Available Variables ")),e(S,{title:"These variables are extracted from your spreadsheet columns. Click any variable to insert it into your prompt."},{default:n(()=>[e(c(N),{class:"info-icon"})]),_:1})]),0===C.value.length?(o(),l("div",He,[t[7]||(t[7]=s("p",null,"No variables detected. Please import data first.",-1)),s("pre",null,u(JSON.stringify($.value,null,2)),1)])):(o(),y(Ce,{key:1,variables:C.value,onInsertVariable:t[0]||(t[0]=e=>{!function(e){if(!m.value)return console.error("Design editor ref not available"),void b(()=>{m.value?m.value.insertVariable(e):console.error("Design editor ref still not available after nextTick")});m.value.insertVariable(e)}(e)})},null,8,["variables"]))]),s("div",We,[e(Te,{ref_key:"designEditor",ref:m,prompt:_.value,"onUpdate:prompt":t[1]||(t[1]=e=>_.value=e),extractors:x.value,"onUpdate:extractors":t[2]||(t[2]=e=>x.value=e),variables:C.value,"spreadsheet-data":h.value},null,8,["prompt","extractors","variables","spreadsheet-data"])])]),s("div",Be,[e(w,{size:"large",onClick:t[3]||(t[3]=e=>f.value--)},{default:n(()=>t[8]||(t[8]=[d(" Previous ")])),_:1,__:[8]}),e(w,{type:"primary",size:"large",onClick:j,disabled:!P.value},{default:n(()=>t[9]||(t[9]=[d(" Next ")])),_:1,__:[9]},8,["disabled"])])])):i("",!0),2===f.value?(o(),l("div",Ge,[c(E)?(o(),y(I,{key:0,"initial-design-id":c(E).id,"is-tab-mode":!0,class:"trial-creation-wrapper",onCreated:U,onCreatedAndStarted:F},null,8,["initial-design-id"])):i("",!0),s("div",Je,[e(w,{size:"large",onClick:t[4]||(t[4]=e=>f.value--)},{default:n(()=>t[10]||(t[10]=[d(" Previous ")])),_:1,__:[10]})])])):i("",!0)])])}}}),[["__scopeId","data-v-5ccb9cec"]]);export{Ze as default};
