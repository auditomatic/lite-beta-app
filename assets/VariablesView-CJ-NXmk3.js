import{_ as e,u as t}from"./BaseButton.vue_vue_type_style_index_0_lang-B6iUBvQJ.js";import{b as a,l,_ as s,T as i,O as r,H as o,m as n}from"./index-B93zjiLf.js";import{r as u,f as d,c,w as m,u as p,n as v,d as b,aa as y,Z as g,$ as f,a0 as h,G as V,a2 as k,a3 as _,q as w,F as C,ab as x,ac as K,ag as S,B as L,k as E,Y as I,O as A,_ as D,o as $,X as U,z as T,ah as O}from"./vendor-B8IWC-3k.js";import{v as z}from"./variable.service-uRVQK8pP.js";import{_ as j}from"./BaseModal.vue_vue_type_style_index_0_lang-Ba6DaieS.js";import{Q as B}from"./vue3-datagrid-BHTiShsb.js";import"./db-CL8uhZCz.js";function R(e){const t=a(),s=u({name:"",description:"",category:"simple",values:[],attributeKeys:[],items:[],tabularData:void 0}),i=d(!1),r=d(!1),o=d([]),n=d(!1),b=d(""),y=d(!1),g=c(()=>"simple"===s.category||"refusal"===s.category?s.values.length:"attributed"===s.category?s.items.length:"tabular"===s.category&&s.tabularData?.rows.length||0),f=c(()=>{const e=[];if(s.name.trim()||e.push("Name is required"),"simple"===s.category||"refusal"===s.category){0===s.values.length&&e.push("At least one value is required");new Set(s.values.map(e=>e.toLowerCase().trim())).size<s.values.length&&e.push("Duplicate values detected")}else if("attributed"===s.category){0===s.attributeKeys.length&&e.push("At least one attribute key is required"),0===s.items.length&&e.push("At least one item is required");const t=z.validateAttributedList(s.items,s.attributeKeys);t.isValid||e.push(...t.errors)}return{isValid:0===e.length,errors:e}}),h=c(()=>"attributed"!==s.category?{}:z.getAttributeStats(s.items));return m(()=>s.category,(e,t)=>{l.debug("Category watcher triggered",{newCategory:e,oldCategory:t,isLoadingData:y.value}),e===t||void 0===t||y.value?l.debug("Not clearing data - category change is during load or initial"):(l.debug("Clearing data due to category change"),s.values.splice(0,s.values.length),s.attributeKeys.splice(0,s.attributeKeys.length),s.items.splice(0,s.items.length))}),m(()=>p(e),a=>{l.debug("ListId watcher triggered",{newId:a}),a?(l.debug("Calling load() for listId",{newId:a}),async function(){const a=p(e);if(l.debug("Loading list with ID",{currentListId:a}),a){r.value=!0,y.value=!0;try{const e=await t.getList(a);if(l.debug("Loaded list from store",{list:e}),!e)throw new Error("Variable list not found");l.debug("Setting form.name",{name:e.name}),s.name=e.name,l.debug("form.name is now",{name:s.name}),l.debug("Setting form.description",{description:e.description??""}),s.description=e.description??"",l.debug("form.description is now",{description:s.description}),l.debug("Setting form.category",{category:e.category}),s.category=e.category,l.debug("form.category is now",{category:s.category}),await v(),"simple"===e.category||"refusal"===e.category?(l.debug("Loading simple/refusal values",{values:e.values}),s.values.splice(0,s.values.length,...e.values||[]),l.debug("form.values is now",{values:s.values,length:s.values.length})):"attributed"===e.category?(l.debug("Loading attributed data - attributeKeys",{attributeKeys:e.attributeKeys}),s.attributeKeys.splice(0,s.attributeKeys.length,...e.attributeKeys||[]),l.debug("form.attributeKeys is now",{attributeKeys:s.attributeKeys,length:s.attributeKeys.length}),l.debug("Loading attributed data - items",{itemCount:e.items?.length}),s.items.splice(0,s.items.length,...e.items?e.items.map(e=>({value:e.value,attributes:{...e.attributes}})):[]),l.debug("form.items is now",{itemCount:s.items.length})):"tabular"===e.category&&(l.debug("Loading tabular data",{columns:e.tabularData?.columns,rowCount:e.tabularData?.rows.length}),s.tabularData=e.tabularData?{columns:[...e.tabularData.columns],rows:e.tabularData.rows.map(e=>({...e}))}:void 0),l.debug("Final form state",{name:s.name,description:s.description,category:s.category,valuesLength:s.values.length,attributeKeysLength:s.attributeKeys.length,itemsLength:s.items.length}),await v()}catch(i){l.error("Error loading list",i)}finally{r.value=!1,y.value=!1,l.debug("Load complete, isLoadingData set to false")}}}()):(l.debug("Resetting form for new list"),s.name="",s.description="",s.category="simple",s.values.splice(0,s.values.length),s.attributeKeys.splice(0,s.attributeKeys.length),s.items.splice(0,s.items.length),l.debug("Form reset complete"))},{immediate:!0}),{form:s,isSaving:i,isLoading:r,errors:o,showImportDialog:n,importText:b,itemCount:g,validation:f,attributeStats:h,save:async function(){if(!f.value.isValid)throw o.value=f.value.errors,new Error(f.value.errors[0]);i.value=!0,o.value=[];try{const a={name:s.name.trim(),description:s.description.trim()||void 0,category:s.category,values:"simple"===s.category||"refusal"===s.category?[...s.values]:void 0,attributeKeys:"attributed"===s.category?[...s.attributeKeys]:void 0,items:"attributed"===s.category?s.items.map(e=>({value:e.value,attributes:{...e.attributes}})):void 0,tabularData:"tabular"===s.category?s.tabularData:void 0,itemCount:g.value},l=p(e);return l?(await t.updateList(l,a),l):await t.createList(a)}finally{i.value=!1}},addValue:function(e){const t=e.trim();t&&(s.values.includes(t)||s.values.push(t))},removeValue:function(e){s.values.splice(e,1)},addAttributeKey:function(e){const t=e.trim();t&&(s.attributeKeys.includes(t)||(s.attributeKeys.push(t),s.items.forEach(e=>{t in e.attributes||(e.attributes[t]="")})))},removeAttributeKey:function(e){const t=s.attributeKeys.indexOf(e);-1!==t&&(s.attributeKeys.splice(t,1),s.items.forEach(t=>{delete t.attributes[e]}))},addItem:function(e){const t={value:e.value,attributes:{}};s.attributeKeys.forEach(a=>{t.attributes[a]=e.attributes[a]??""}),s.items.push(t)},removeItem:function(e){s.items.splice(e,1)},importData:async function(){try{const e=b.value.trim();if(!e)return;if(e.startsWith("[")||e.startsWith("{")){const t=z.parseJSON(e);if("simple"===s.category){if(!Array.isArray(t))throw new Error("For simple lists, JSON must be an array");s.values=t.map(e=>"string"==typeof e?e:e.value||e.name||String(e)).filter(Boolean)}else{const e=Array.isArray(t)?t:[t],a=new Set;e.forEach(e=>{Object.keys(e).forEach(e=>{"value"!==e&&"name"!==e&&a.add(e)})}),s.attributeKeys=Array.from(a),s.items=e.map(e=>({value:String(e.value||e.name||""),attributes:s.attributeKeys.reduce((t,a)=>(t[a]=String(e[a]||""),t),{})})).filter(e=>e.value)}}else{const t=z.parseCSV(e);if("simple"===s.category)s.values=t.rows.map(e=>Object.values(e)[0]).filter(Boolean);else{const e=z.csvToAttributedItems(t),a=t.headers.filter(e=>"value"!==e.toLowerCase()&&"name"!==e.toLowerCase());s.attributeKeys=a,s.items=e}}n.value=!1,b.value=""}catch(e){throw l.error("Import failed",e),e}},exportData:function(){return"simple"===s.category?`value\n${s.values.join("\n")}`:z.exportToCSV(s.items)}}}const F={class:"tag-input","data-testid":"tag-input-component"},q={key:0,class:"tag-input-label"},N={key:0,class:"required"},J={class:"tags"},M=["onClick","aria-label"],W=["placeholder","aria-label","onKeydown"],P={key:1,class:"helper-text"},G=s(b({__name:"TagInput",props:{modelValue:{},label:{},placeholder:{default:"Add a value..."},helperText:{},required:{type:Boolean}},emits:["update:modelValue"],setup(e,{expose:t,emit:a}){const l=e,s=a,i=d(),r=d(""),o=d(!1);function n(){const e=r.value.trim();e&&(l.modelValue.includes(e)||s("update:modelValue",[...l.modelValue,e]),r.value="")}function u(e){const t=[...l.modelValue];t.splice(e,1),s("update:modelValue",t)}function c(){""===r.value&&l.modelValue.length>0&&u(l.modelValue.length-1)}function m(e){","!==e.key&&188!==e.keyCode||(e.preventDefault(),n())}function p(e){e.preventDefault();const t=e.clipboardData?.getData("text");if(!t)return;const a=t.split(/[\n,\t]+/).map(e=>e.trim()).filter(Boolean),i=[...new Set([...l.modelValue,...a])];s("update:modelValue",i),r.value=""}function v(){r.value.trim()&&n(),o.value=!1}return t({focus:()=>i.value?.focus()}),(e,t)=>(g(),y("div",F,[e.label?(g(),y("label",q,[V(k(e.label)+" ",1),e.required?(g(),y("span",N,"*")):f("",!0)])):f("",!0),h("div",{class:_(["tag-input-container",{focused:o.value}])},[h("div",J,[(g(!0),y(C,null,x(e.modelValue,(e,t)=>(g(),y("span",{key:`${e}-${t}`,class:"tag"},[V(k(e)+" ",1),h("button",{type:"button",class:"tag-remove",onClick:e=>u(t),"aria-label":`Remove ${e}`}," Ã— ",8,M)]))),128)),w(h("input",{ref_key:"inputRef",ref:i,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),placeholder:e.placeholder,class:"tag-input-field","data-testid":"tag-input-field","aria-label":e.label||"Enter tags",onKeydown:[S(L(n,["prevent"]),["enter"]),S(c,["backspace"]),m],onPaste:p,onFocus:t[1]||(t[1]=e=>o.value=!0),onBlur:v},null,40,W),[[K,r.value]])])],2),e.helperText?(g(),y("div",P,k(e.helperText),1)):f("",!0)]))}}),[["__scopeId","data-v-613f6ba9"]]),H={class:"list-textarea","data-testid":"list-textarea-component"},Y={key:0,class:"list-textarea-label"},X={key:0,class:"required"},Z={class:"list-stats"},Q={class:"item-count"},ee={key:0,class:"helper-text"},te=s(b({__name:"ListTextArea",props:{modelValue:{},label:{},placeholder:{default:"Enter values, one per line\nOr paste from spreadsheet"},helperText:{},required:{type:Boolean},dataTestId:{default:"list-textarea-field"}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=t,s=c({get:()=>a.modelValue.join("\n"),set:e=>{const t=e.split("\n").map(e=>e.trim()).filter(e=>e.length>0),a=[...new Set(t)];l("update:modelValue",a)}});function i(){s.value=s.value}function r(){s.value=s.value}return(e,t)=>{const a=I("a-textarea");return g(),y("div",H,[e.label?(g(),y("label",Y,[V(k(e.label)+" ",1),e.required?(g(),y("span",X,"*")):f("",!0)])):f("",!0),E(a,{value:s.value,"onUpdate:value":t[0]||(t[0]=e=>s.value=e),placeholder:e.placeholder,"auto-size":{minRows:8,maxRows:20},class:"list-textarea-input","data-testid":e.dataTestId,"aria-label":e.label||"Enter list values",onChange:i,onBlur:r},null,8,["value","placeholder","data-testid","aria-label"]),h("div",Z,[h("span",Q,k(e.modelValue.length)+" items",1),e.helperText?(g(),y("span",ee,k(e.helperText),1)):f("",!0)])])}}}),[["__scopeId","data-v-298ae26a"]]),ae={class:"variable-card-editor","data-testid":"variable-card-editor"},le={key:0,class:"editor-label"},se={key:0,class:"required"},ie={class:"variables-grid"},re=["data-testid"],oe=["onClick","aria-label"],ne={class:"variable-content"},ue={class:"editor-stats"},de={class:"item-count"},ce={key:0,class:"helper-text"},me={class:"bulk-add-hint"},pe=s(b({__name:"VariableCardEditor",props:{modelValue:{},label:{},placeholder:{default:"Enter values"},helperText:{},required:{type:Boolean},dataTestId:{default:"variable-card-editor"}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=t,s=d(!1),u=d("");function c(e){const t=[...a.modelValue];t.splice(e,1),l("update:modelValue",t)}function m(e,t){const s=[...a.modelValue];s[e]=t,l("update:modelValue",s)}function v(e){e===a.modelValue.length-1&&a.modelValue[e].trim()&&function(){const e=[...a.modelValue,""];l("update:modelValue",e),setTimeout(()=>{const e=document.querySelectorAll(".variable-card input"),t=e[e.length-1];t&&t.focus()},50)}()}function b(){u.value="",s.value=!0}function _(){const e=u.value.split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(0===e.length)return void n.warning("Please enter at least one value");const t=new Set(a.modelValue),i=[...a.modelValue];let r=0;for(const a of e)t.has(a)||(i.push(a),t.add(a),r++);l("update:modelValue",i),r>0?n.success(`Added ${r} new item${r>1?"s":""}`):n.info("All values were already in the list"),s.value=!1}return(e,t)=>{const l=I("a-input"),n=I("a-textarea"),d=I("a-modal");return g(),y("div",ae,[e.label?(g(),y("label",le,[V(k(e.label)+" ",1),e.required?(g(),y("span",se,"*")):f("",!0)])):f("",!0),h("div",ie,[E(A,{name:"card-transition"},{default:D(()=>[(g(!0),y(C,null,x(e.modelValue,(e,t)=>(g(),y("div",{key:`var-${t}-${e}`,class:"variable-card","data-testid":`variable-card-${t}`},[h("button",{class:"remove-btn",onClick:e=>c(t),"aria-label":`Remove ${e}`,"data-testid":"remove-btn"},[E(p(i))],8,oe),h("div",ne,[E(l,{value:e,onInput:e=>m(t,e.target.value),onKeydown:S(e=>v(t),["enter"]),onBlur:e=>function(e){const t=a.modelValue[e];t&&t.trim()?m(e,t.trim()):c(e)}(t),placeholder:"Enter value",size:"small"},null,8,["value","onInput","onKeydown","onBlur"])])],8,re))),128)),h("div",{key:"add-card",class:"add-card",onClick:b,"data-testid":"add-variable-card"},[E(p(r),{class:"add-icon"}),t[3]||(t[3]=h("span",null,"Add Variable",-1))])]),_:1})]),h("div",ue,[h("span",de,k(e.modelValue.length)+" items",1),e.helperText?(g(),y("span",ce,k(e.helperText),1)):f("",!0)]),E(d,{open:s.value,"onUpdate:open":t[1]||(t[1]=e=>s.value=e),title:"Add Multiple Variables",onOk:_,onCancel:t[2]||(t[2]=e=>s.value=!1),width:"600px"},{default:D(()=>[E(n,{value:u.value,"onUpdate:value":t[0]||(t[0]=e=>u.value=e),placeholder:"Enter values, one per line\nOr paste from spreadsheet","auto-size":{minRows:8,maxRows:20},class:"bulk-add-textarea"},null,8,["value"]),h("div",me,[E(p(o)),t[4]||(t[4]=h("span",null,"Tip: You can paste from Excel or Google Sheets. Duplicate values will be ignored.",-1))])]),_:1},8,["open"])])}}}),[["__scopeId","data-v-5e82d820"]]),ve={class:"revogrid-spreadsheet"},be=s(b({__name:"RevoGridSpreadsheet",props:{modelValue:{},columns:{}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=t,s=d(),i=d([]);function r(){a.columns&&a.columns.length>0?i.value=a.columns.map((e,t)=>({prop:e,name:e,size:0===t?150:100})):i.value=Array.from({length:26},(e,t)=>({prop:String.fromCharCode(65+t),name:String.fromCharCode(65+t),size:0===t?150:100}))}const o=d([]);function n(){const e=o.value.filter(e=>Object.values(e).some(e=>""!==e&&null!=e)).map(e=>{const t={};return Object.entries(e).forEach(([e,a])=>{a&&(t[e]=a)}),t});l("update:modelValue",e)}function u(){o.value=Array.from({length:1e3},()=>{const e={};return i.value.forEach(t=>{e[t.prop]=""}),e})}return m(()=>a.modelValue,e=>{e&&e.length>0&&(o.value.forEach(e=>{Object.keys(e).forEach(t=>{e[t]=""})}),e.forEach((e,t)=>{o.value[t]&&Object.entries(e).forEach(([e,a])=>{o.value[t].hasOwnProperty(e)&&(o.value[t][e]=a)})}))},{immediate:!0}),$(()=>{r(),u(),m(()=>a.columns,()=>{r(),u()})}),(e,t)=>(g(),y("div",ve,[E(p(B),{ref_key:"grid",ref:s,source:o.value,columns:i.value,theme:"compact","row-size":32,range:!0,clipboard:!0,resize:!0,"auto-size-column":!0,onAfteredit:n,style:{height:"100%","min-height":"400px"}},null,8,["source","columns"])]))}}),[["__scopeId","data-v-e309ce18"]]),ye={class:"attributed-items-grid"},ge={key:0,class:"grid-header"},fe={class:"grid-actions"},he=["disabled"],Ve={key:1,class:"add-row"},ke=["onUpdate:modelValue","placeholder","data-testid","aria-label"],_e={key:2,class:"grid-container"},we={class:"items-table"},Ce={key:0,class:"actions-column"},xe=["data-testid","data-item-value"],Ke={key:0,class:"actions-column"},Se=["onClick","data-testid","aria-label"],Le={key:0,class:"placeholder-row"},Ee={class:"placeholder-text"},Ie={key:3,class:"empty-state"},Ae={key:4,class:"empty-state"},De=s(b({__name:"AttributedItemsGrid",props:{modelValue:{},attributeKeys:{},showStructure:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=t,s=d(!1),i=d(),r=d([]),o=u({value:"",attributes:{}});function n(){if(!o.value.trim())return;const e={value:o.value.trim(),attributes:{...o.attributes}};l("update:modelValue",[...a.modelValue,e]),o.value="",a.attributeKeys.forEach(e=>{o.attributes[e]=""}),s.value=!1}function c(){o.value="",a.attributeKeys.forEach(e=>{o.attributes[e]=""}),s.value=!1}function p(e){const t=e.toLowerCase();return t.includes("age")?"25":t.includes("gender")||t.includes("sex")?"Female":t.includes("price")||t.includes("cost")?"$19.99":t.includes("category")||t.includes("type")?"Technology":t.includes("color")||t.includes("colour")?"Blue":t.includes("size")?"Medium":t.includes("country")?"USA":t.includes("city")?"Seattle":"Sample Value"}function v(){s.value=!0,setTimeout(()=>{i.value?.focus()},50)}function b(e){}function V(){const e=document.activeElement;if(e===i.value&&r.value.length>0)return void r.value[0]?.focus();const t=r.value.findIndex(t=>t===e);t>=0&&t<r.value.length-1?r.value[t+1]?.focus():(n(),v())}return m(()=>a.attributeKeys,e=>{o.attributes={},e.forEach(e=>{o.attributes[e]=""})},{immediate:!0}),(e,t)=>(g(),y("div",ye,[e.attributeKeys.length>0?(g(),y("div",ge,[h("div",fe,[h("button",{type:"button",class:"add-button",disabled:0===e.attributeKeys.length,onClick:v,"data-testid":"btn-add-attributed-item","aria-label":"Add new attributed item"}," + Add Item ",8,he),t[1]||(t[1]=h("span",{class:"hint-text"},"Enter value first, then Tab through attributes, press Enter to save",-1))])])):f("",!0),s.value?(g(),y("div",Ve,[w(h("input",{ref_key:"valueInput",ref:i,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),placeholder:"Enter name/value first, then press Tab",class:"grid-input primary-input",onKeyup:S(V,["enter"]),onKeydown:S(b,["tab"]),"data-testid":"input-item-value","aria-label":"Item value"},null,544),[[K,o.value]]),(g(!0),y(C,null,x(e.attributeKeys,(e,t)=>w((g(),y("input",{key:e,ref_for:!0,ref:e=>r.value[t]=e,"onUpdate:modelValue":t=>o.attributes[e]=t,placeholder:`${e} (press Tab)`,class:"grid-input attribute-input",onKeyup:S(V,["enter"]),onKeydown:S(b,["tab"]),"data-testid":`input-attribute-${e}`,"aria-label":`${e} attribute value`},null,40,ke)),[[K,o.attributes[e]]])),128)),h("div",{class:"row-actions"},[h("button",{type:"button",class:"save-button",onClick:n,"data-testid":"btn-save-attributed-item","aria-label":"Save attributed item (or press Enter)",title:"Save (Enter)"}," âœ“ "),h("button",{type:"button",class:"cancel-button",onClick:c,"data-testid":"btn-cancel-attributed-item","aria-label":"Cancel adding item",title:"Cancel"}," Ã— ")])])):f("",!0),e.modelValue.length>0||e.showStructure&&e.attributeKeys.length>0?(g(),y("div",_e,[h("table",we,[h("thead",null,[h("tr",null,[t[2]||(t[2]=h("th",null,"Value",-1)),(g(!0),y(C,null,x(e.attributeKeys,e=>(g(),y("th",{key:e},k(e),1))),128)),e.modelValue.length>0?(g(),y("th",Ce)):f("",!0)])]),h("tbody",null,[(g(!0),y(C,null,x(e.modelValue,(t,s)=>(g(),y("tr",{key:`item-${t.value}-${s}`,"data-testid":`attributed-item-row-${s}`,"data-item-value":t.value},[h("td",null,k(t.value),1),(g(!0),y(C,null,x(e.attributeKeys,e=>(g(),y("td",{key:e},k(t.attributes[e]||"-"),1))),128)),e.modelValue.length>0?(g(),y("td",Ke,[h("button",{type:"button",class:"remove-button",onClick:e=>function(e){const t=[...a.modelValue];t.splice(e,1),l("update:modelValue",t)}(s),"data-testid":`btn-remove-item-${s}`,"aria-label":`Remove item ${t.value}`}," Ã— ",8,Se)])):f("",!0)],8,xe))),128)),0===e.modelValue.length&&e.showStructure&&e.attributeKeys.length>0?(g(),y("tr",Le,[t[3]||(t[3]=h("td",{class:"placeholder-cell"},"Sample Name",-1)),(g(!0),y(C,null,x(e.attributeKeys,e=>(g(),y("td",{key:`placeholder-${e}`,class:"placeholder-cell"},[h("span",Ee,k(p(e)),1)]))),128))])):f("",!0)])])])):0===e.attributeKeys.length?(g(),y("div",Ie,t[4]||(t[4]=[h("div",{class:"empty-icon"},"ðŸ“‹",-1),h("p",{class:"empty-title"},"Ready for Attributes",-1),h("p",{class:"empty-subtitle"},"Define attributes above to see the data structure here",-1)]))):(g(),y("div",Ae,t[5]||(t[5]=[h("div",{class:"empty-icon"},"ðŸ“",-1),h("p",{class:"empty-title"},"Ready for Data",-1),h("p",{class:"empty-subtitle"},'Click "Add Item" to start entering your data',-1)])))]))}}),[["__scopeId","data-v-d9c9a00c"]]),$e={class:"import-content"},Ue={class:"import-help"},Te={key:0,class:"format-examples"},Oe=["placeholder"],ze=s(b({__name:"ImportDialog",props:{category:{}},emits:["close","import"],setup(t,{emit:a}){const l=t,s=a,i=d(""),r=c(()=>"simple"===l.category?"Apple\nBanana\nCherry\n\nOR\n\nApple, Banana, Cherry":"Paste CSV or JSON data here...");function o(){i.value.trim()?s("import",i.value):alert("Please paste some data to import")}return(t,a)=>(g(),U(j,{"model-value":!0,title:"Import Data","onUpdate:modelValue":a[2]||(a[2]=e=>t.$emit("close"))},{footer:D(()=>[E(e,{variant:"ghost",onClick:a[1]||(a[1]=e=>t.$emit("close"))},{default:D(()=>a[4]||(a[4]=[V(" Cancel ")])),_:1,__:[4]}),E(e,{onClick:o},{default:D(()=>a[5]||(a[5]=[V(" Import ")])),_:1,__:[5]})]),default:D(()=>[h("div",$e,[h("p",Ue,["simple"===t.category?(g(),y(C,{key:0},[V(" Paste values, one per line or comma-separated. ")],64)):(g(),y(C,{key:1},[V(" Paste CSV or JSON data. For CSV, first row should be headers. ")],64))]),"attributed"===t.category?(g(),y("div",Te,a[3]||(a[3]=[h("details",null,[h("summary",null,"CSV Example"),h("pre",null,"value,race,gender\nJohn Smith,White,Male\nMaria Garcia,Hispanic,Female\nWei Chen,Asian,Male")],-1),h("details",null,[h("summary",null,"JSON Example"),h("pre",null,'[\n  {"value": "John Smith", "race": "White", "gender": "Male"},\n  {"value": "Maria Garcia", "race": "Hispanic", "gender": "Female"}\n]')],-1)]))):f("",!0),w(h("textarea",{"onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e),class:"import-textarea",placeholder:r.value,rows:"15"},null,8,Oe),[[K,i.value]])])]),_:1}))}}),[["__scopeId","data-v-f851c3b3"]]),je={class:"form-container"},Be={class:"name-desc-row"},Re={class:"form-field"},Fe={class:"form-field"},qe={class:"type-row","data-testid":"variable-type-selector"},Ne={class:"radio-group-inline"},Je={class:"radio-label-inline"},Me=["disabled"],We={class:"radio-label-inline"},Pe=["disabled"],Ge={class:"radio-label-inline"},He=["disabled"],Ye={key:0,class:"form-section"},Xe={key:1,class:"form-section"},Ze={class:"import-actions"},Qe={key:2,class:"form-section"},et={class:"attributed-inline"},tt={class:"attributes-content"},at={class:"items-section"},lt={class:"items-content"},st={class:"import-section"},it={key:3,class:"error-banner"},rt={class:"footer-content"},ot={class:"stats"},nt={class:"actions"},ut=s(b({__name:"VariableListEditor",props:{modelValue:{type:Boolean},listId:{}},emits:["update:modelValue","saved"],setup(t,{emit:a}){const s=a,i=R(T(t,"listId")),r=d("grid"),o=c({get:()=>i.form.items.map(e=>({value:e.value,...e.attributes})),set:e=>{i.form.items=e.map(e=>{const{value:t,...a}=e;return{value:t,attributes:a}})}});async function n(){try{const e=await i.save();s("saved",e),s("update:modelValue",!1)}catch(e){l.error("Failed to save variable list",e)}}async function u(e){try{i.importText.value=e,await i.importData(),i.showImportDialog.value=!1}catch(t){l.error("Failed to import data",t),alert("Failed to import: "+(t instanceof Error?t.message:"Unknown error"))}}return m(()=>i.form.name,e=>{l.debug("VariableListEditor: form.name changed",{name:e})}),m(()=>i.form.category,e=>{l.debug("VariableListEditor: form.category changed",{category:e})}),m(()=>i.form.values,e=>{l.debug("VariableListEditor: form.values changed",{values:e,length:e.length})},{deep:!0}),m(()=>i.form.attributeKeys,e=>{l.debug("VariableListEditor: form.attributeKeys changed",{keys:e,length:e.length})},{deep:!0}),m(()=>i.form.items,e=>{l.debug("VariableListEditor: form.items changed",{itemCount:e.length})},{deep:!0}),(t,a)=>{const l=I("a-tag"),s=I("a-tab-pane"),d=I("a-tabs");return g(),U(j,{"model-value":t.modelValue,title:t.listId?"Edit Variable List":"Create Variable List",size:"full","data-testid":"modal-variable-editor","onUpdate:modelValue":a[15]||(a[15]=e=>t.$emit("update:modelValue",e))},{footer:D(()=>[h("div",rt,[h("div",ot,k(p(i).itemCount.value)+" items ",1),h("div",nt,[E(e,{variant:"ghost",onClick:a[13]||(a[13]=e=>t.$emit("update:modelValue",!1))},{default:D(()=>a[34]||(a[34]=[V(" Cancel ")])),_:1,__:[34]}),E(e,{type:"submit",loading:p(i).isSaving.value,disabled:!p(i).validation.value.isValid,onClick:n},{default:D(()=>[V(k(t.listId?"Update":"Create"),1)]),_:1},8,["loading","disabled"])])])]),default:D(()=>[h("div",je,[h("form",{onSubmit:L(n,["prevent"]),class:"form-content"},[h("div",Be,[a[16]||(a[16]=h("label",{class:"inline-field-label"},"Name",-1)),h("div",Re,[w(h("input",{id:"name","onUpdate:modelValue":a[0]||(a[0]=e=>p(i).form.name=e),type:"text",class:"form-input large",placeholder:"Enter list name","data-testid":"input-variable-list-name","aria-label":"Variable list name",required:""},null,512),[[K,p(i).form.name]])]),a[17]||(a[17]=h("label",{class:"inline-field-label"},"Description",-1)),h("div",Fe,[w(h("input",{id:"description","onUpdate:modelValue":a[1]||(a[1]=e=>p(i).form.description=e),type:"text",class:"form-input large",placeholder:"Optional description","data-testid":"input-variable-list-description","aria-label":"Variable list description"},null,512),[[K,p(i).form.description]])])]),h("div",qe,[a[25]||(a[25]=h("label",{class:"inline-field-label"},"Type",-1)),h("div",Ne,[h("label",Je,[w(h("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>p(i).form.category=e),type:"radio",value:"simple",disabled:!!t.listId,"data-testid":"radio-simple-list","aria-label":"Simple variable list type"},null,8,Me),[[O,p(i).form.category]]),a[18]||(a[18]=h("span",{class:"radio-text"},"Simple List",-1)),a[19]||(a[19]=h("span",{class:"radio-example"},"(colors, names, countries)",-1))]),h("label",We,[w(h("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>p(i).form.category=e),type:"radio",value:"attributed",disabled:!!t.listId,"data-testid":"radio-attributed-list","aria-label":"Attributed variable list type"},null,8,Pe),[[O,p(i).form.category]]),a[21]||(a[21]=h("span",{class:"radio-text"},"Attributed List",-1)),E(l,{size:"small",color:"orange",style:{"margin-left":"8px"}},{default:D(()=>a[20]||(a[20]=[V("Beta")])),_:1,__:[20]}),a[22]||(a[22]=h("span",{class:"radio-example"},"(names with gender/ethnicity, cities with region/size)",-1))]),h("label",Ge,[w(h("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>p(i).form.category=e),type:"radio",value:"refusal",disabled:!!t.listId},null,8,He),[[O,p(i).form.category]]),a[23]||(a[23]=h("span",{class:"radio-text"},"Refusal Words",-1)),a[24]||(a[24]=h("span",{class:"radio-example"},"(cannot, unable, refuse)",-1))])])]),"simple"===p(i).form.category?(g(),y("div",Ye,[a[26]||(a[26]=h("h3",null,"Values",-1)),E(pe,{modelValue:p(i).form.values,"onUpdate:modelValue":a[5]||(a[5]=e=>p(i).form.values=e),label:"List Values",placeholder:"Enter value","helper-text":"Click 'Add Variable' or use the bulk add to paste from spreadsheet. Duplicates are automatically removed.","data-testid":"simple-list-values"},null,8,["modelValue"])])):f("",!0),"refusal"===p(i).form.category?(g(),y("div",Xe,[a[28]||(a[28]=h("h3",null,"Refusal Words",-1)),E(te,{modelValue:p(i).form.values,"onUpdate:modelValue":a[6]||(a[6]=e=>p(i).form.values=e),label:"Refusal Words",placeholder:"Enter refusal words, one per line\nExamples:\ncannot\nunable\nrefuse\nnot appropriate","helper-text":"Words or phrases that indicate model refusal","data-testid":"refusal-list-values"},null,8,["modelValue"]),h("div",Ze,[E(e,{variant:"secondary",size:"small",onClick:a[7]||(a[7]=e=>p(i).showImportDialog.value=!0)},{default:D(()=>a[27]||(a[27]=[V(" Import CSV ")])),_:1,__:[27]})])])):f("",!0),"attributed"===p(i).form.category?(g(),y("div",Qe,[h("div",et,[a[29]||(a[29]=h("label",{class:"inline-field-label"},"Attributes",-1)),h("div",tt,[E(G,{modelValue:p(i).form.attributeKeys,"onUpdate:modelValue":a[8]||(a[8]=e=>p(i).form.attributeKeys=e),label:"",placeholder:"Add attribute (e.g., gender, ethnicity, region, size)...","helper-text":"Define properties/columns that each item will have"},null,8,["modelValue"])])]),h("div",at,[a[32]||(a[32]=h("label",{class:"inline-field-label"},"Data",-1)),h("div",lt,[E(d,{activeKey:r.value,"onUpdate:activeKey":a[12]||(a[12]=e=>r.value=e),type:"card"},{default:D(()=>[E(s,{key:"grid",tab:"Manual Entry"},{default:D(()=>[E(De,{modelValue:p(i).form.items,"onUpdate:modelValue":a[9]||(a[9]=e=>p(i).form.items=e),"attribute-keys":p(i).form.attributeKeys,"show-structure":!0},null,8,["modelValue","attribute-keys"])]),_:1}),E(s,{key:"spreadsheet",tab:"Spreadsheet"},{default:D(()=>[E(be,{modelValue:o.value,"onUpdate:modelValue":a[10]||(a[10]=e=>o.value=e),columns:["value",...p(i).form.attributeKeys]},null,8,["modelValue","columns"])]),_:1}),E(s,{key:"import",tab:"Import"},{default:D(()=>[h("div",st,[a[31]||(a[31]=h("p",null,"Import data from CSV, JSON, or paste from Excel/Google Sheets",-1)),E(e,{variant:"primary",onClick:a[11]||(a[11]=e=>p(i).showImportDialog.value=!0)},{default:D(()=>a[30]||(a[30]=[V(" Import CSV/JSON File ")])),_:1,__:[30]})])]),_:1})]),_:1},8,["activeKey"])])])])):f("",!0),p(i).errors.value.length>0?(g(),y("div",it,[a[33]||(a[33]=h("strong",null,"Please fix the following errors:",-1)),h("ul",null,[(g(!0),y(C,null,x(p(i).errors.value,e=>(g(),y("li",{key:e},k(e),1))),128))])])):f("",!0)],32)]),p(i).showImportDialog.value?(g(),U(ze,{key:0,category:"tabular"===p(i).form.category?"simple":p(i).form.category,onClose:a[14]||(a[14]=e=>p(i).showImportDialog.value=!1),onImport:u},null,8,["category"])):f("",!0)]),_:1},8,["model-value","title"])}}}),[["__scopeId","data-v-7d5b5bff"]]),dt={class:"variables-view","data-testid":"page-variables"},ct={class:"page-header"},mt={key:3},pt={class:"scientific-table-container"},vt={class:"scientific-table-wrapper"},bt={key:0,class:"table-info-cell"},yt={class:"table-info-title"},gt={class:"table-info-subtitle"},ft={key:3,class:"table-cell-ellipsis"},ht={key:4,class:"date-cell"},Vt={key:5,class:"table-actions-grid"},kt=s(b({__name:"VariablesView",setup(e){const s=a(),{getVisibleColumns:i,formatDateTime:o,createVariableColumns:n}=t(),u=d(!1),m=d(),v=d("all"),b=i(n()),_=c(()=>s.lists.filter(e=>"tabular"!==e.category&&void 0!==e.category)),w=c(()=>s.lists.filter(e=>"tabular"===e.category||!e.category)),x=c(()=>{switch(v.value){case"simple":return s.simpleLists;case"attributed":return s.attributedLists;case"refusal":return s.refusalLists;case"spreadsheet":return w.value;default:return _.value}});function K(){m.value=void 0,u.value=!1}function S(e){if("simple"===e.category||"refusal"===e.category){const t=e.values||[],a=t.slice(0,3).join(", ");return t.length>3?`${a}, ...`:a}const t=e.items||[],a=t.slice(0,2).map(e=>e.name||e.value).join(", ");return t.length>2?`${a}, ...`:a}return $(()=>{s.initialize()}),(e,t)=>{const a=I("a-button"),i=I("a-spin"),n=I("a-alert"),d=I("a-empty"),c=I("a-tab-pane"),L=I("a-tabs"),A=I("a-tag"),$=I("a-table");return g(),y("div",dt,[h("div",ct,[t[6]||(t[6]=h("div",{class:"header-content"},[h("h1",null,"Variable Lists"),h("p",{class:"description"},"Manage reusable variable lists for prompt templates")],-1)),E(a,{type:"primary",onClick:t[0]||(t[0]=e=>u.value=!0),"data-testid":"btn-create-variable-list","aria-label":"Create new variable list"},{icon:D(()=>[E(p(r))]),default:D(()=>[t[5]||(t[5]=V(" Create List "))]),_:1,__:[5]})]),p(s).isLoading?(g(),U(i,{key:0,size:"large",tip:"Loading variable lists..."},{default:D(()=>t[7]||(t[7]=[h("div",{style:{"min-height":"200px"}},null,-1)])),_:1,__:[7]})):p(s).error?(g(),U(n,{key:1,type:"error",message:p(s).error,class:"error-alert"},null,8,["message"])):0===p(s).lists.length?(g(),U(d,{key:2,description:"No variable lists yet. Create lists to use in your prompt designs."},{image:D(()=>t[8]||(t[8]=[h("div",{class:"empty-state-icon"},"ðŸ“ƒ",-1)])),default:D(()=>[E(a,{type:"primary",onClick:t[1]||(t[1]=e=>u.value=!0)},{default:D(()=>t[9]||(t[9]=[V(" Create Your First List ")])),_:1,__:[9]})]),_:1})):(g(),y("div",mt,[E(L,{activeKey:v.value,"onUpdate:activeKey":t[2]||(t[2]=e=>v.value=e),size:"small",class:"list-tabs"},{default:D(()=>[E(c,{key:"all",tab:`All Lists (${_.value.length})`},null,8,["tab"]),E(c,{key:"simple",tab:`Simple (${p(s).simpleLists.length})`},null,8,["tab"]),E(c,{key:"attributed",tab:`Attributed (${p(s).attributedLists.length})`},null,8,["tab"]),E(c,{key:"refusal",tab:`Refusal (${p(s).refusalLists.length})`},null,8,["tab"]),E(c,{key:"spreadsheet",tab:`Spreadsheet Lists (${w.value.length})`},null,8,["tab"])]),_:1},8,["activeKey"]),h("div",pt,[h("div",vt,[E($,{columns:p(b),"data-source":x.value,pagination:!1,size:"small",scroll:{y:"calc(100vh - 180px)"},"row-key":"id",class:"scientific-table"},{bodyCell:D(({column:e,record:i})=>{return["name"===e.key?(g(),y("div",bt,[h("span",yt,k(i.name),1),h("span",gt,k(i.description||"No description"),1)])):f("",!0),"category"===e.key?(g(),U(A,{key:1,size:"small",color:"simple"===i.category?"blue":"attributed"===i.category?"green":"red"},{default:D(()=>[V(k(i.category),1)]),_:2},1032,["color"])):f("",!0),"itemCount"===e.key?(g(),y(C,{key:2},[V(k((n=i,"simple"===n.category||"refusal"===n.category?n.values?.length||0:n.items?.length||0)),1)],64)):f("",!0),"description"===e.key?(g(),y("div",ft,k(S(i)),1)):f("",!0),"created"===e.key?(g(),y("div",ht,k((r=i.created,o(r))),1)):f("",!0),"actions"===e.key?(g(),y("div",Vt,[E(a,{size:"small",type:"primary",onClick:e=>{return t=i.id,m.value=t,void(u.value=!0);var t}},{default:D(()=>t[10]||(t[10]=[V(" Edit ")])),_:2,__:[10]},1032,["onClick"]),E(a,{size:"small",class:"btn-success",onClick:e=>async function(e){const t=e.id;try{const e=await s.getList(t);if(!e)return;let a,l;"simple"===e.category||"refusal"===e.category?(a=`value\n${e.values?.join("\n")??""}`,l=`${e.name.replace(/\s+/g,"-")}-values.csv`):(a=JSON.stringify(e.items,null,2),l=`${e.name.replace(/\s+/g,"-")}-attributed.json`);const i=new Blob([a],{type:"text/plain"}),r=URL.createObjectURL(i),o=document.createElement("a");o.href=r,o.download=l,o.click(),URL.revokeObjectURL(r)}catch(a){l.error("Failed to export list",a),alert("Failed to export list")}}(i)},{default:D(()=>t[11]||(t[11]=[V(" Export ")])),_:2,__:[11]},1032,["onClick"]),E(a,{size:"small",danger:"",onClick:e=>async function(e){if(confirm("Are you sure you want to delete this list?"))try{await s.deleteList(e)}catch(t){l.error("Failed to delete list",t),alert(t instanceof Error?t.message:"Failed to delete list")}}(i.id)},{default:D(()=>t[12]||(t[12]=[V(" Delete ")])),_:2,__:[12]},1032,["onClick"])])):f("",!0)];var r,n}),_:1},8,["columns","data-source"])])])])),u.value?(g(),U(ut,{key:4,modelValue:u.value,"onUpdate:modelValue":[t[3]||(t[3]=e=>u.value=e),t[4]||(t[4]=e=>{e||(m.value=void 0)})],"list-id":m.value,onSaved:K},null,8,["modelValue","list-id"])):f("",!0)])}}}),[["__scopeId","data-v-f8c0ef9d"]]);export{kt as default};
