const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-qi1cGAr3.js","./vendor-CdfxntmD.js","./db-CL8uhZCz.js","./index-C_P6KAyw.css"])))=>i.map(i=>d[i]);
var e=Object.defineProperty,t=(t,a,r)=>((t,a,r)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[a]=r)(t,"symbol"!=typeof a?a+"":a,r);import{_ as a}from"./BaseModal.vue_vue_type_style_index_0_lang-DY82666A.js";import{k as r,d as i,ab as s,_ as o,a0 as n,a1 as l,aj as d,f as c,c as p,o as u,b as m,w as g,a4 as v,Y as f,F as h,Z as y,$ as w,a3 as b,ag as C,ac as T,G as P,u as S,af as k,n as I,e as _,J as x,l as $}from"./vendor-CdfxntmD.js";import{I as D,d as E,l as A,J as M,_ as O,w as N,x as L,T as j,K as V,a8 as F,a9 as z,p as U,aa as q,E as R,i as B,b as K,e as H,ab as J,a1 as G}from"./index-qi1cGAr3.js";import{u as Y}from"./useLiveData-gB4mnUxo.js";import"./papaparse.min-DYvV7_qI.js";import{c as W,a as Z}from"./cost-formatting-DSpbVMtV.js";import{u as Q}from"./useEnvironmentalCost-CuTrIS15.js";import{G as X}from"./GenericModelSelectorModalV2-BRreagYa.js";var ee={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM514.1 580.1l-61.8-102.4c-2.2-3.6-6.1-5.8-10.3-5.8h-38.4c-2.3 0-4.5.6-6.4 1.9-5.6 3.5-7.3 10.9-3.7 16.6l82.3 130.4-83.4 132.8a12.04 12.04 0 0010.2 18.4h34.5c4.2 0 8-2.2 10.2-5.7L510 664.8l62.3 101.4c2.2 3.6 6.1 5.7 10.2 5.7H620c2.3 0 4.5-.7 6.5-1.9 5.6-3.6 7.2-11 3.6-16.6l-84-130.4 85.3-132.5a12.04 12.04 0 00-10.1-18.5h-35.7c-4.2 0-8.1 2.2-10.3 5.8l-61.2 102.3z"}}]},name:"file-excel",theme:"outlined"};function te(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?Object(arguments[t]):{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter(function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),r.forEach(function(t){ae(e,t,a[t])})}return e}function ae(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var re=function(e,t){var a=te({},e,t.attrs);return r(D,te({},a,{icon:ee}),null)};re.displayName="FileExcelOutlined",re.inheritAttrs=!1;class ie{constructor(){t(this,"events",new Map)}on(e,t){this.events.has(e)||this.events.set(e,new Set),this.events.get(e).add(t)}off(e,t){const a=this.events.get(e);a&&a.delete(t)}emit(e,t){const a=this.events.get(e);a&&a.forEach(a=>{try{a(t)}catch(r){console.error(`Error in event handler for ${e}:`,r)}})}removeAllListeners(e){e?this.events.delete(e):this.events.clear()}}const se=new class extends ie{async createTrial(e){const t={...e,id:e.id||crypto.randomUUID(),createdAt:new Date,status:"draft",progress:e.progress||{completed:0,networkErrors:0,total:0}};return await E.trials.add(t),A.info("Trial created",{id:t.id,name:t.name,progressTotal:t.progress.total}),this.emit("trial:created",{trial:t}),t.id}async updateTrialStatus(e,t){const a=await E.trials.get(e);if(!a)throw new Error(`Trial not found: ${e}`);const r=new Date,i={status:t};switch(t){case"running":i.started=r;break;case"completed":i.completed=r,a.started||(i.started=r);break;case"cancelled":case"failed":i.completed=r}await E.trials.update(e,i),A.info("Trial status updated",{id:e,status:t}),this.emit("trial:status-changed",{id:e,status:t,previousStatus:a.status})}async updateTrialProgress(e,t){const a=await E.trials.get(e);if(!a)throw new Error(`Trial not found: ${e}`);const r={...a.progress,...t};await E.trials.update(e,{progress:r});(r.completed||0)+(r.networkErrors||0)>=r.total&&await this.updateTrialStatus(e,"completed"),this.emit("trial:progress",{id:e,progress:r})}async startTrial(e){await this.updateTrialStatus(e,"running")}async pauseTrial(e){await this.updateTrialStatus(e,"paused")}async resumeTrial(e){await this.updateTrialStatus(e,"running")}async cancelTrial(e){await this.updateTrialStatus(e,"cancelled")}async executeTrialWithConfirmation(e,t=!1){const a=await this.getRunningTrials();return a.length>0&&!t?{needsConfirmation:!0,runningTrial:a[0]}:(await this.executeTrial(e),{needsConfirmation:!1})}async executeTrial(e){const t=await E.trials.get(e);if(!t)throw new Error(`Trial not found: ${e}`);if("draft"!==t.status)throw new Error(`Cannot execute trial with status: ${t.status}. Only draft trials can be executed.`);const a=await E.apiCalls.where("trialId").equals(e).count();if(a>0)throw new Error(`Trial already has ${a} tasks. Cannot execute again.`);const{providerRegistry:r}=await M(async()=>{const{providerRegistry:e}=await import("./index-qi1cGAr3.js").then(e=>e.ai);return{providerRegistry:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),{useSettingsStore:i}=await M(async()=>{const{useSettingsStore:e}=await import("./index-qi1cGAr3.js").then(e=>e.aj);return{useSettingsStore:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),{TrialExecutionServiceV2:s}=await M(async()=>{const{TrialExecutionServiceV2:e}=await import("./index-qi1cGAr3.js").then(e=>e.am);return{TrialExecutionServiceV2:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),o=i(),n=new Set;for(const c of t.configurationSnapshots||[])r.requiresApiKey(c.provider)&&n.add(c.provider);const l=[];for(const c of n)o.getApiKey(c)||l.push(c);if(l.length>0)throw A.warn(`Missing API keys for providers: ${l.join(", ")}`),new Error(`Missing API keys for: ${l.join(", ")}. Please configure them in Settings.`);try{const a=new s({getApiKey:()=>"",getBaseUrl:()=>"",onProgress:()=>{},onError:()=>{}}).generateAPICallsFromTrial(t);await E.apiCalls.bulkPut(a),A.info("Generated API calls for trial",{trialId:t.id,taskCount:a.length}),await E.transaction("rw",E.trials,async()=>{const t=await E.trials.where("status").equals("running").toArray();for(const e of t)await E.trials.update(e.id,{status:"paused",pausedAt:new Date,pausedReason:"auto_paused_for_new_trial"}),A.info(`Auto-paused trial "${e.name}" to start new trial`);await E.trials.update(e,{status:"running",started:new Date})}),A.info(`Trial ${e} executed successfully`),this.emit("trial:started",{id:e})}catch(d){throw A.error("Failed to execute trial",d),await E.trials.update(e,{status:"failed"}),d}}async deleteTrial(e){await E.transaction("rw",E.trials,E.apiCalls,async()=>{await E.apiCalls.where("trialId").equals(e).delete(),await E.trials.delete(e)}),A.info("Trial deleted",{id:e}),this.emit("trial:deleted",{id:e})}async getActiveTrials(){return await E.trials.where("status").anyOf(["running","paused"]).toArray()}async getRunningTrials(){return await E.trials.where("status").equals("running").toArray()}async getTrialsByStatus(e){return await E.trials.where("status").equals(e).toArray()}async getTrialStats(e){if(!(await E.trials.get(e)))throw new Error(`Trial not found: ${e}`);const t=await E.apiCalls.where("trialId").equals(e).toArray(),a=t.filter(e=>"completed"===e.status).length,r=t.filter(e=>"failed"===e.status).length,i=[],s=i.length>0?i.reduce((e,t)=>e+t,0)/i.length:0,o=[].reduce((e,t)=>e+t,0);return{totalCalls:t.length,completedCalls:a,failedCalls:r,successRate:t.length>0?a/t.length:0,avgLatency:Math.round(s),totalCost:o}}async hasRunningTrial(){return await E.trials.where("status").equals("running").count()>0}async cleanupOrphanedTrials(e=864e5){const t=new Date(Date.now()-e);let a=0;const r=await E.trials.where("status").equals("running").toArray();for(const i of r)(!i.started||i.started<t)&&(await this.updateTrialStatus(i.id,"failed"),a++,A.warn("Cleaned up orphaned trial",{id:i.id,name:i.name,started:i.started}));return a}},oe={class:"modal-footer"},ne={key:0,class:"footer-left"},le={class:"footer-actions"},de=O(i({__name:"ModalFooter",setup:e=>(e,t)=>(o(),s("div",oe,[e.$slots.left?(o(),s("div",ne,[d(e.$slots,"left",{},void 0,!0)])):n("",!0),l("div",le,[d(e.$slots,"default",{},void 0,!0)])]))}),[["__scopeId","data-v-1215184f"]]),ce={key:0,class:"preview-controls"},pe={key:0,class:"cycle-info"},ue=["innerHTML"],me={key:1,class:"variable-legend"},ge={class:"variable-value"},ve=O(i({__name:"TemplatePreviewV2",props:{prompt:{},template:{},variables:{},tabularData:{},cycling:{type:Boolean,default:!0},cyclingPaused:{type:Boolean,default:!1},cyclingSpeed:{default:1e3},showControls:{default:"none"},displayMode:{default:"block"},showLegend:{type:Boolean,default:!1},maxHeight:{default:"300px"},previewMode:{type:Boolean,default:!1}},emits:["update:cyclingPaused","update:previewMode"],setup(e,{emit:t}){const a=e,i=t,{data:d}=Y(()=>E.variableLists.toArray(),{debounce:100});const k=c(0);let I=null;const _=["variable-highlight-blue","variable-highlight-green","variable-highlight-purple","variable-highlight-orange","variable-highlight-pink","variable-highlight-teal"],x=p(()=>{if(a.prompt){if("template"===a.prompt.type)return a.prompt.template;if("spreadsheet"===a.prompt.type)return a.prompt.promptPattern}return a.template||""}),$=p(()=>{if(a.tabularData&&a.tabularData.length>0)return a.tabularData.map(e=>{const t={};return Object.keys(e).forEach(a=>{let r=a.replace(/[^a-zA-Z0-9_]/g,"_");/^[a-zA-Z]/.test(r)||(r="col_"+r),r=r.replace(/_+/g,"_"),r=r.replace(/_+$/,""),t[r]=String(e[a]||"")}),t});if(a.prompt&&"spreadsheet"===a.prompt.type){const e=a.prompt,t=(d.value||[]).find(t=>t.id===e.datasetId);if("tabular"===t?.category&&t.tabularData&&t.tabularData.rows)return t.tabularData.rows.map(e=>{const t={};return Object.keys(e).forEach(a=>{t[a]=String(e[a]||"")}),t})}const e=[];if("template"===a.prompt?.type&&a.prompt.variables)for(const[r,i]of Object.entries(a.prompt.variables))if("direct"===i.type&&i.values)e.push({name:r,values:[...i.values]});else if("list"===i.type&&i.listId){const t=(d.value||[]).find(e=>e.id===i.listId);t&&("simple"===t.category&&t.values?e.push({name:r,values:[...t.values]}):"attributed"===t.category&&t.items&&e.push({name:r,values:t.items.map(e=>e.value)}))}if(a.variables)for(const[r,i]of Object.entries(a.variables))i.length>0&&e.push({name:r,values:[...i]});if(0===e.length)return[];const t=e.map(e=>e.values);return t.reduce((e,t)=>e.flatMap(e=>t.map(t=>[...e,t])),[[]]).map(t=>{const a={};return e.forEach((e,r)=>{a[e.name]=t[r]}),a})}),D=p(()=>$.value.length),A=p(()=>0===$.value.length?null:$.value[k.value]||$.value[0]),M=p(()=>{const e=x.value;if(!e)return"";if("editor-mode"===a.showControls&&!a.previewMode)return j(e).replace(/\n/g,"<br>");const t=A.value;if(!t||0===Object.keys(t).length)return j(e).replace(/\n/g,"<br>");let r=j(e);return Object.keys(t).sort((e,t)=>t.length-e.length).forEach((e,a)=>{const i=j(t[e]),s=O(a),o=new RegExp(`{{\\s*${n=e,n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}\\s*}}`,"g");var n;r=r.replace(o,`<span class="${s} variable-value">${i}</span>`)}),r=r.replace(/\n/g,"<br>"),r});function O(e){return _[e%_.length]}function j(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function V(){i("update:cyclingPaused",!a.cyclingPaused)}function F(){i("update:previewMode",!a.previewMode)}function z(){!a.cycling||a.cyclingPaused||D.value<=1||(I=setInterval(()=>{k.value=(k.value+1)%D.value},a.cyclingSpeed))}function U(){I&&(clearInterval(I),I=null)}return u(()=>{a.cycling&&!a.cyclingPaused&&z()}),m(()=>{U()}),g(()=>a.cyclingPaused,e=>{e||!a.cycling?U():z()}),g(()=>a.cycling,e=>{e?a.cyclingPaused||z():(U(),k.value=0)}),g(()=>a.cyclingSpeed,()=>{a.cycling&&!a.cyclingPaused&&(U(),z())}),g(D,()=>{k.value=0}),(e,t)=>{const a=y("a-button");return o(),s("div",{class:v(["template-preview",[`preview-${e.displayMode}`,{"preview-cycling":e.cycling&&!e.cyclingPaused}]])},["none"!==e.showControls?(o(),s("div",ce,["pause-play"===e.showControls?(o(),s(h,{key:0},[r(a,{onClick:V,size:"small",type:e.cyclingPaused?"default":"primary",disabled:!e.cycling||D.value<=1},{default:w(()=>[P(b(e.cyclingPaused?"Start":"Pause")+" Variable Substitution ",1)]),_:1},8,["type","disabled"]),e.cycling&&D.value>1?(o(),s("span",pe,b(k.value+1)+" / "+b(D.value),1)):n("",!0)],64)):"editor-mode"===e.showControls?(o(),f(a,{key:1,type:e.previewMode?"default":"primary",onClick:F},{default:w(()=>[e.previewMode?(o(),f(S(L),{key:1})):(o(),f(S(N),{key:0})),P(" "+b(e.previewMode?"Return to Editor":"Preview Filled-In Prompts"),1)]),_:1},8,["type"])):n("",!0)])):n("",!0),l("div",{class:"preview-content",innerHTML:M.value,style:C({maxHeight:e.maxHeight})},null,12,ue),e.showLegend&&A.value&&Object.keys(A.value).length>0?(o(),s("div",me,[(o(!0),s(h,null,T(A.value,(e,t,a)=>(o(),s("div",{key:t,class:"legend-item"},[l("span",{class:v(O(a))},b(t),3),l("span",ge,b(e),1)]))),128))])):n("",!0)],2)}}}),[["__scopeId","data-v-396f7244"]]),fe={class:"design-selection-step"},he={class:"step-body"},ye={class:"design-selector","data-testid":"design-selector"},we={key:0,class:"no-designs-state"},be={class:"no-designs-content"},Ce={key:1,class:"design-list","data-testid":"design-list"},Te=["data-template-id","data-template-name","onClick"],Pe={class:"design-header"},Se={class:"design-title-section"},ke={class:"design-name"},Ie={key:0,class:"design-inline-description"},_e={class:"design-date"},xe={class:"design-stats"},$e={class:"stat-item"},De={class:"stat-value"},Ee={class:"stat-item"},Ae={class:"stat-value"},Me={class:"stat-item"},Oe={class:"stat-value"},Ne={class:"design-selector","data-testid":"spreadsheet-design-selector"},Le={key:0,class:"no-designs-state"},je={class:"no-designs-content"},Ve={key:1,class:"design-list","data-testid":"spreadsheet-design-list"},Fe=["data-spreadsheet-id","data-spreadsheet-name","onClick"],ze={class:"design-header"},Ue={class:"design-title-section"},qe={class:"design-name"},Re={key:0,class:"design-inline-description"},Be={class:"design-date"},Ke={class:"design-stats"},He={class:"stat-item"},Je={class:"stat-value"},Ge={class:"stat-item"},Ye={class:"stat-value"},We={class:"stat-item"},Ze={class:"stat-value"},Qe=O(i({__name:"DesignSelectionStep",props:{templatePrompts:{},spreadsheetPrompts:{},searchTerm:{},countVariables:{type:Function},formatLastEditDate:{type:Function},getOutputTypeColor:{type:Function},getCombinationCount:{type:Function}},emits:["select","create-new","create-spreadsheet"],setup(e){const t=e;u(()=>{A.info("ðŸŽ¯ DesignSelectionStep mounted",{templatePromptsLength:t.templatePrompts?.length||0,spreadsheetPromptsLength:t.spreadsheetPrompts?.length||0,templatePrompts:t.templatePrompts})});const a=c("classic"),i=c(""),{templatePrompts:d,spreadsheetPrompts:p,countVariables:m,formatLastEditDate:g,getOutputTypeColor:v,getCombinationCount:f}=t;return(e,t)=>{const c=y("a-input"),u=y("a-button"),C=y("a-tag"),k=y("a-tab-pane"),I=y("a-tabs");return o(),s("div",fe,[l("div",he,[r(I,{activeKey:a.value,"onUpdate:activeKey":t[6]||(t[6]=e=>a.value=e),type:"card",class:"design-tabs"},{default:w(()=>[r(k,{key:"classic",tab:"Classic Designs (permutes through all variable combinations)"},{default:w(()=>[l("div",ye,[r(c,{value:i.value,"onUpdate:value":t[0]||(t[0]=e=>i.value=e),placeholder:"Search classic designs...",size:"large",class:"design-search","data-testid":"input-design-search",allowClear:""},{prefix:w(()=>[r(S(j))]),_:1},8,["value"]),0===S(d).length?(o(),s("div",we,[l("div",be,[t[8]||(t[8]=l("p",null,"No classic designs found",-1)),r(u,{onClick:t[1]||(t[1]=t=>e.$emit("create-new"))},{default:w(()=>t[7]||(t[7]=[P("Create Template")])),_:1,__:[7]})])])):(o(),s("div",Ce,[(o(!0),s(h,null,T(S(d),a=>(o(),s("div",{key:a.id,class:"design-item","data-testid":"template-item","data-template-id":a.id,"data-template-name":a.name,onClick:t=>e.$emit("select",a)},[l("div",Pe,[l("div",Se,[l("h4",ke,[P(b(a.name)+" ",1),a.description?(o(),s("span",Ie,"- "+b(a.description),1)):n("",!0)])]),l("span",_e,b(S(g)(a.updated)),1)]),r(ve,{prompt:a,cycling:!0,"show-controls":"none","display-mode":"inline","max-height":"none",class:"design-description"},null,8,["prompt"]),l("div",xe,[r(C,{size:"small",color:S(v)(a.outputConfig.outputType),class:"output-type-tag"},{default:w(()=>[P(b(a.outputConfig.outputType||"text"),1)]),_:2},1032,["color"]),l("span",$e,[l("span",De,b(S(m)(a)),1),t[9]||(t[9]=l("span",{class:"stat-label"},"vars",-1))]),t[12]||(t[12]=l("span",{class:"stat-divider"},"â€¢",-1)),l("span",Ee,[l("span",Ae,b(S(f)(a)),1),t[10]||(t[10]=l("span",{class:"stat-label"},"combos",-1))]),t[13]||(t[13]=l("span",{class:"stat-divider"},"â€¢",-1)),l("span",Me,[l("span",Oe,b(a.tokenEstimate?.avgTokens||"?"),1),t[11]||(t[11]=l("span",{class:"stat-label"},"tokens",-1))])])],8,Te))),128)),l("div",{class:"design-card design-card-create","data-testid":"btn-create-design",onClick:t[2]||(t[2]=t=>e.$emit("create-new"))},[r(S(V),{style:{"font-size":"24px"}}),t[14]||(t[14]=l("span",null,"Create New Design",-1))])]))])]),_:1}),r(k,{key:"spreadsheet",tab:"Spreadsheet Designs (one API call per row)"},{default:w(()=>[l("div",Ne,[r(c,{value:i.value,"onUpdate:value":t[3]||(t[3]=e=>i.value=e),placeholder:"Search spreadsheet designs...",size:"large",class:"design-search","data-testid":"input-spreadsheet-search",allowClear:""},{prefix:w(()=>[r(S(j))]),_:1},8,["value"]),0===S(p).length?(o(),s("div",Le,[l("div",je,[t[16]||(t[16]=l("p",null,"No spreadsheet designs found",-1)),r(u,{type:"primary",onClick:t[4]||(t[4]=t=>e.$emit("create-spreadsheet"))},{default:w(()=>[r(S(re)),t[15]||(t[15]=P(" Create Spreadsheet Design "))]),_:1,__:[15]})])])):(o(),s("div",Ve,[(o(!0),s(h,null,T(S(p),a=>(o(),s("div",{key:a.id,class:"design-item","data-testid":"spreadsheet-design-item","data-spreadsheet-id":a.id,"data-spreadsheet-name":a.name,onClick:t=>e.$emit("select",a)},[l("div",ze,[l("div",Ue,[l("h4",qe,[P(b(a.name)+" ",1),a.description?(o(),s("span",Re,"- "+b(a.description),1)):n("",!0)])]),l("span",Be,b(S(g)(a.updated)),1)]),r(ve,{prompt:a,cycling:!0,"show-controls":"none","display-mode":"inline","max-height":"none",class:"design-description"},null,8,["prompt"]),l("div",Ke,[r(C,{size:"small",color:"orange",class:"output-type-tag"},{default:w(()=>t[17]||(t[17]=[P(" spreadsheet ")])),_:1,__:[17]}),l("span",He,[l("span",Je,b(S(m)(a)),1),t[18]||(t[18]=l("span",{class:"stat-label"},"vars",-1))]),t[21]||(t[21]=l("span",{class:"stat-divider"},"â€¢",-1)),l("span",Ge,[l("span",Ye,b(S(f)(a)),1),t[19]||(t[19]=l("span",{class:"stat-label"},"rows",-1))]),t[22]||(t[22]=l("span",{class:"stat-divider"},"â€¢",-1)),l("span",We,[l("span",Ze,b(a.tokenEstimate?.avgTokens||"?"),1),t[20]||(t[20]=l("span",{class:"stat-label"},"tokens",-1))])])],8,Fe))),128)),l("div",{class:"design-card design-card-create","data-testid":"btn-create-spreadsheet-design",onClick:t[5]||(t[5]=t=>e.$emit("create-spreadsheet"))},[r(S(re),{style:{"font-size":"24px"}}),t[23]||(t[23]=l("span",null,"Create Spreadsheet Design",-1))])]))])]),_:1})]),_:1},8,["activeKey"])])])}}}),[["__scopeId","data-v-39b4f4d8"]]),Xe={class:"trial-metadata-form"},et={class:"form-section"},tt={class:"trial-name-section"},at={class:"repeat-section"},rt={class:"form-stats"},it={class:"stat-item"},st={class:"stat-value"},ot={class:"stat-item"},nt={class:"stat-value"},lt=O(i({__name:"TrialMetadataForm",props:{modelValue:{},totalCombinations:{}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,i=t;function n(e){i("update:modelValue",{...a.modelValue,trialName:e})}function d(e){i("update:modelValue",{...a.modelValue,repeatCount:e||1})}return(e,t)=>{const a=y("a-input"),i=y("a-input-number");return o(),s("div",Xe,[l("div",et,[l("div",tt,[t[0]||(t[0]=l("label",{class:"form-label"},"Trial Name:",-1)),r(a,{value:e.modelValue.trialName,"onUpdate:value":n,placeholder:"Enter trial name",class:"trial-name-input","data-testid":"input-trial-name",size:"large"},null,8,["value"])]),l("div",at,[t[1]||(t[1]=l("label",{class:"form-label"},"Repeat Each Prompt:",-1)),r(i,{value:e.modelValue.repeatCount,"onUpdate:value":d,min:1,max:10,size:"large",class:"repeat-count-input"},null,8,["value"]),t[2]||(t[2]=l("span",{class:"repeat-suffix"},"times",-1))])]),l("div",rt,[l("div",it,[t[3]||(t[3]=l("span",{class:"stat-label"},"Total Combinations:",-1)),l("span",st,b(e.totalCombinations),1)]),l("div",ot,[t[4]||(t[4]=l("span",{class:"stat-label"},"API Calls per Model:",-1)),l("span",nt,b(e.totalCombinations*e.modelValue.repeatCount),1)])])])}}}),[["__scopeId","data-v-50707609"]]);const dt=new class{constructor(e=F,t=z){this.templateService=e,this.spreadsheetService=t}async getPrompt(e){if("template"===e.type){return await this.templateService.get(e.id)||null}return await this.spreadsheetService.get(e.id)||null}async listPrompts(e){if("template"===e)return this.templateService.list();if("spreadsheet"===e)return this.spreadsheetService.list();{const[e,t]=await Promise.all([this.templateService.list(),this.spreadsheetService.list()]);return[...e,...t]}}async calculateCombinations(e){if("template"===e.type){let t=1;const a=await this.resolveVariableValues(e.variables);for(const[,e]of Object.entries(a))t*=e.length;return t}{const t=await E.variableLists.get(e.datasetId);return t?.itemCount||0}}async estimateTokens(e){const t=await this.calculateCombinations(e);if(e.tokenEstimate){const a=e.tokenEstimate.avgTokens;return{min:e.tokenEstimate.minTokens,max:e.tokenEstimate.maxTokens,avg:e.tokenEstimate.avgTokens,total:a*t,perPrompt:a}}const a="template"===e.type?e.template.length:e.promptPattern.length,r=Math.ceil(a/4);return{min:Math.ceil(.8*r),max:Math.ceil(1.5*r),avg:r,total:r*t,perPrompt:r}}async generatePreview(e,t=5){const a=await this.calculateCombinations(e),r=Math.min(t,a);if("template"===e.type){const t=await this.templateService.previewPrompts(e,r);return{prompts:t,totalCount:a,previewCount:t.length}}{const t=await this.spreadsheetService.previewPrompts(e,r);return{prompts:t,totalCount:a,previewCount:t.length}}}async createPrompt(e,t){if("template"===e){return{type:"template",id:await this.templateService.create(t)}}return{type:"spreadsheet",id:await this.spreadsheetService.create(t)}}async updatePrompt(e,t){"template"===e.type?await this.templateService.update(e.id,t):await this.spreadsheetService.update(e.id,t)}async duplicatePrompt(e){const t=await this.getPrompt(e);if(!t)throw new Error("Prompt not found");const a={...t,name:`${t.name} (Copy)`,id:void 0,created:void 0,updated:void 0};if("template"===e.type){return{type:"template",id:await this.templateService.create(a)}}return{type:"spreadsheet",id:await this.spreadsheetService.create(a)}}async deletePrompt(e){"template"===e.type?await this.templateService.delete(e.id):await this.spreadsheetService.delete(e.id)}async resolveVariableValues(e){const t={};for(const[a,r]of Object.entries(e))if("direct"===r.type&&r.values)t[a]=r.values;else if("list"===r.type&&r.listId){const e=await E.variableLists.get(r.listId);e?"simple"===e.category?t[a]=e.values||[]:"attributed"===e.category&&e.items&&(t[a]=e.items.map(e=>e.value||e)):t[a]=[]}return t}async getVariableCount(e){if("direct"===e.type&&e.values)return e.values.length;if("list"===e.type&&e.listId){const t=await E.variableLists.get(e.listId);return t?.itemCount||0}return 0}async isPromptInUse(e){return await E.trials.where("template"===e.type?"templateId":"spreadsheetId").equals(e.id).count()>0}async getPromptUsageStats(e){const t=await E.trials.where("template"===e.type?"templateId":"spreadsheetId").equals(e.id).toArray(),a=t.map(e=>e.id);let r=0;a.length>0&&(r=await E.apiCalls.where("trialId").anyOf(a).count());const i=t.map(e=>e.created).sort((e,t)=>t.getTime()-e.getTime())[0];return{trialCount:t.length,apiCallCount:r,lastUsed:i}}};const ct=new class{async buildConfiguration(e,t){const a={...await this.getDefaultParameters(e.provider,e.modelId),...t};return{name:`${e.displayName} Configuration`,provider:e.provider,modelId:e.modelId,parameters:a}}async getDefaultParameters(e,t){const a=U.getParametersForModel(e,t),r={};for(const[i,s]of Object.entries(a))if(void 0!==s.default)r[i]=s.default;else if(s.required)switch(s.type){case"number":case"integer":r[i]=s.min??0;break;case"boolean":r[i]=!1;break;case"string":r[i]="";break;case"array":r[i]=[];break;case"object":r[i]={}}return r}async createConfigurationSnapshot(e){const t=U.getProvider(e.provider);if(!t)throw new Error(`Provider not found: ${e.provider}`);const a=await E.models.get(`${e.provider}:${e.modelId}`);if(!a)throw new Error(`Model not found: ${e.provider}:${e.modelId}`);return{name:e.name,provider:e.provider,modelId:e.modelId,parameters:{...e.parameters},providerSnapshot:JSON.parse(JSON.stringify(t)),modelSnapshot:JSON.parse(JSON.stringify(a))}}async validateConfiguration(e){const t=[],a=[];if(!U.getProvider(e.provider))return t.push(`Provider not found: ${e.provider}`),{valid:!1,errors:t};if(!(await E.models.get(`${e.provider}:${e.modelId}`)))return t.push(`Model not found: ${e.modelId}`),{valid:!1,errors:t};const r=await this.validateParameters(e.provider,e.modelId,e.parameters);return t.push(...r.errors),r.warnings&&a.push(...r.warnings),{valid:0===t.length,errors:t,warnings:a.length>0?a:void 0}}async validateParameters(e,t,a){const r=U.validateParameters(e,t,a);return{valid:r.valid,errors:r.errors,warnings:[]}}calculateCostPerCall(e,t){const a=`${e.provider}:${e.modelId}`;if(!E.models.get(a))return 0;const r=this.getOutputTokenParameter(e.provider,e.modelId,e.parameters);return W(t,r,3e-5,6e-5)}calculateTotalCost(e,t,a){let r=0;for(const i of e){r+=this.calculateCostPerCall(i,100)*(t*a)}return r}async getCostBreakdown(e,t,a){const r=await E.models.get(`${e.provider}:${e.modelId}`);if(!r?.capabilities)return{perCall:0,total:0};const i=(r.capabilities.inputCostPerToken||0)*t,s=(r.capabilities.outputCostPerToken||0)*a,o=i+s;return{perCall:o,total:o,breakdown:{inputCost:i,outputCost:s}}}getOutputTokenParameter(e,t,a){const r=U.getParametersForModel(e,t);for(const[s,o]of Object.entries(r))if(o.is_output_length&&void 0!==a[s])return a[s];const i=["max_tokens","max_output_tokens","max_new_tokens","maxTokens"];for(const s of i)if(void 0!==a[s])return a[s];return 1e3}async hasRequiredApiKeys(e){if(!U.requiresApiKey(e.provider))return!0;const t=await E.settings.get("main");if(!t?.apiKeys)return!1;const a=U.getProviderGroup(e.provider);return!!t.apiKeys[a]}async savePreset(e,t,a){const r={id:crypto.randomUUID()};return A.info("Configuration preset saved",{id:r.id,name:e}),r.id}async loadPreset(e){throw new Error("Preset loading not yet implemented")}async listPresets(){return[]}async deletePreset(e){A.info("Configuration preset deleted",{id:e})}async getSuggestedPresets(){const e=await E.trials.orderBy("created").reverse().limit(20).toArray(),t=new Map;for(const a of e)if(a.configurationSnapshots)for(const e of a.configurationSnapshots){const a=`${e.provider}:${e.modelId}`;t.has(a)||t.set(a,{name:e.name,provider:e.provider,modelId:e.modelId,parameters:e.parameters})}return Array.from(t.values()).slice(0,5)}};const pt=new class{constructor(e=dt,t=ct,a=se){this.promptSvc=e,this.configSvc=t,this.trialSvc=a}async validateTrialData(e){const t=[],a=[];e.name&&0!==e.name.trim().length||t.push("Trial name is required");const r={type:e.prompt.type,id:e.prompt.id},i=await this.promptSvc.getPrompt(r);if(i||t.push("Selected prompt no longer exists"),e.configurations&&0!==e.configurations.length)for(const l of e.configurations){const e=await this.configSvc.validateConfiguration(l);e.valid||t.push(`Configuration "${l.name}": ${e.errors.join(", ")}`),e.warnings&&a.push(...e.warnings)}else t.push("At least one model configuration is required");let s,o,n;if(e.repeatCount<1?t.push("Repeat count must be at least 1"):e.repeatCount>100&&a.push("High repeat count may result in many API calls"),0===t.length&&i){const t=await this.promptSvc.calculateCombinations(e.prompt);o=t*e.configurations.length*e.repeatCount,s=this.configSvc.calculateTotalCost(e.configurations,t,e.repeatCount),n=2*o}return{valid:0===t.length,errors:t,warnings:a.length>0?a:void 0,costEstimate:s,totalApiCalls:o,estimatedDuration:n}}async createDraftTrial(e){const t=await this.validateTrialData(e);if(!t.valid)throw new Error(`Invalid trial data: ${t.errors.join("; ")}`);const a=await this.buildTrialData(e),r=await this.trialSvc.createTrial(a);return A.info("Created draft trial",{trialId:r,name:e.name}),r}async createAndStartTrial(e,t=!1){const a=await this.createDraftTrial(e),r=await this.trialSvc.getRunningTrials();return r.length>0&&!t?{trialId:a,status:"created",needsConfirmation:!0,runningTrial:r[0]}:(await this.trialSvc.executeTrial(a),{trialId:a,status:"started"})}async createAndExportTrial(e){const t=await this.createDraftTrial(e),a=await E.trials.get(t);if(!a)throw new Error("Failed to retrieve created trial");return a}async duplicateTrial(e,t){const a=await E.trials.get(e);if(!a)throw new Error("Trial not found");let r=null;if("template"===a.type&&a.templateId){r=await E.templatePrompts.get(a.templateId)||null}else if("spreadsheet"===a.type&&a.spreadsheetId){r=await E.spreadsheetPrompts.get(a.spreadsheetId)||null}if(!r)throw new Error("Original prompt not found");const i=a.configurationSnapshots.map(e=>({name:e.name,provider:e.provider,modelId:e.modelId,parameters:e.parameters})),s={name:t?.name||`${a.name} (Copy)`,prompt:t?.prompt||r,configurations:t?.configurations||i,repeatCount:t?.repeatCount||a.repeatConfig?.callsPerPrompt||1};return this.createDraftTrial(s)}async estimateTotalCost(e,t,a){const r=await this.promptSvc.calculateCombinations(e),i=await this.promptSvc.estimateTokens(e),s=[];let o=0;for(const l of t){const e=this.configSvc.calculateCostPerCall(l,i.avg)*(r*a);s.push({config:l,cost:e}),o+=e}const n=r*t.length*a;return{total:o,perConfiguration:s,breakdown:{promptCombinations:r,totalApiCalls:n,avgCostPerCall:n>0?o/n:0}}}async previewTrial(e){const t=await this.promptSvc.calculateCombinations(e.prompt),a=await this.promptSvc.estimateTokens(e.prompt),r=await this.promptSvc.generatePreview(e.prompt,3),i=t*e.configurations.length*e.repeatCount,s=await this.estimateTotalCost(e.prompt,e.configurations,e.repeatCount),o=[];for(const l of e.configurations){const e=await E.models.get(`${l.provider}:${l.modelId}`),t=U.getProvider(l.provider);o.push({config:l,model:e,provider:t})}let n=0;for(const l of e.configurations){n+=this.configSvc.getOutputTokenParameter(l.provider,l.modelId,l.parameters)*i/e.configurations.length}return{totalApiCalls:i,estimatedCost:s.total,estimatedTokens:{input:a.total,output:n},samplePrompts:r.prompts,configurationDetails:o}}async checkTrialReadiness(e){const t=[],a=await E.trials.get(e);if(!a)return t.push("Trial not found"),{ready:!1,issues:t,runningTrials:[]};"draft"!==a.status&&t.push(`Trial is ${a.status}, not draft`);for(const i of a.configurationSnapshots){await this.configSvc.hasRequiredApiKeys(i)||t.push(`Missing API key for ${i.provider}`)}const r=await this.trialSvc.getRunningTrials();return r.length>0&&t.push(`${r.length} trial(s) already running`),{ready:0===t.length,issues:t,runningTrials:r}}async buildTrialData(e){const t=e.prompt;for(const a of e.configurations)await this.configSvc.createConfigurationSnapshot(a);if("template"===t.type){return await q.createTemplateTrial({name:e.name,templatePrompt:t,configurations:e.configurations.map(e=>({name:e.name,provider:e.provider,modelId:e.modelId,parameters:e.parameters})),repeatConfig:{callsPerPrompt:e.repeatCount}})}{const a=await E.variableLists.get(t.datasetId);if(!a)throw new Error("Dataset not found for spreadsheet prompt");return await q.createSpreadsheetTrial({name:e.name,spreadsheetPrompt:t,dataset:a,configurations:e.configurations.map(e=>({name:e.name,provider:e.provider,modelId:e.modelId,parameters:e.parameters})),repeatConfig:{callsPerPrompt:e.repeatCount}})}}},ut={class:"model-configuration-section"},mt={class:"quick-add-row"},gt={class:"quick-add-section"},vt={class:"quick-add-buttons"},ft={key:0,class:"quick-cost"},ht={key:0,class:"config-table","data-testid":"model-config-table"},yt=["data-config-index","data-provider","data-model"],wt={class:"col-model"},bt={class:"model-name"},Ct={class:"model-provider"},Tt={class:"col-params"},Pt={class:"params-text"},St={class:"col-calls"},kt={class:"calls-breakdown"},It={class:"calls-value"},_t={class:"col-cost"},xt={class:"cost-breakdown"},$t={key:0,class:"cost-value"},Dt={key:1,class:"env-cost"},Et={class:"col-total"},At={class:"cost-breakdown"},Mt={key:0,class:"cost-value total-cost"},Ot={key:1,class:"env-cost"},Nt={class:"col-actions"},Lt={key:0,class:"table-summary-row"},jt={class:"col-model"},Vt={class:"summary-label"},Ft={class:"col-calls"},zt={class:"summary-calls"},Ut={class:"col-total"},qt={key:0,class:"summary-cost"},Rt={key:1,class:"empty-config-state"},Bt=O(i({__name:"ModelConfigurationSectionV2",props:{configurations:{},prompt:{},totalCombinations:{},repeatCount:{}},emits:["show-model-selector","add","remove"],setup(e,{emit:t}){const a=e,i=t,{data:d}=Y(()=>E.models.where("enabled").equals(1).toArray(),{debounce:100}),{data:m}=Y(async()=>{const e=await E.settings.get("main");return e?[e]:[]},{debounce:100}),{data:g}=Y(()=>E.trials.orderBy("created").reverse().toArray(),{debounce:100}),v=p(()=>d.value||[]),C=p(()=>m.value?.[0]),_=p(()=>g.value||[]),{hasDataForModel:x}=Q(),$=c(!1);u(async()=>{try{await U.waitForReady(),$.value=!0,A.debug("Provider registry ready in ModelConfigurationSection")}catch(e){A.error("Failed to initialize provider registry",e)}});const D=p(()=>C.value?.financialCostsEnabled??!0),M=p(()=>C.value?.environmentalCostsEnabled??!1),O=p(()=>a.totalCombinations*a.configurations.length*a.repeatCount),N=p(()=>{let e=0;for(const t of a.configurations)e+=q(t)*a.totalCombinations*a.repeatCount;return e}),L=p(()=>{if(!$.value)return[];const e=e=>{const t=U.getProviderGroup(e);return!!C.value?.apiKeys?.[t]},t=(e,t)=>!!v.value.find(a=>a.provider===e&&a.modelId===t&&a.enabled),a=[],r=new Set;for(const l of _.value){if(a.length>=5)break;for(const i of l.configurationSnapshots||[]){if(a.length>=5)break;const s=`${i.provider}:${i.modelId}:${JSON.stringify(i.parameters)}`;if(!r.has(s)&&e(i.provider)&&t(i.provider,i.modelId)){const e=U.getParametersForModel(i.provider,i.modelId);if(!e)continue;if(Object.keys(i.parameters).some(t=>!(t in e)))continue;r.add(s),a.push({provider:i.provider,modelId:i.modelId,displayName:i.modelId,parameters:i.parameters,outputType:"text"})}}}const i=[{provider:"openai-chat",modelId:"gpt-4.1-nano",displayName:"gpt-4.1-nano",parameters:{temperature:0,max_tokens:128},outputType:"text"},{provider:"anthropic",modelId:"claude-3-haiku-20240307",displayName:"claude-3-haiku-20240307",parameters:{temperature:0,max_tokens:128},outputType:"text"}],s=new Set(a.map(e=>`${e.provider}:${e.modelId}:${JSON.stringify(e.parameters)}`));for(const l of i){const r=`${l.provider}:${l.modelId}:${JSON.stringify(l.parameters)}`;!s.has(r)&&e(l.provider)&&t(l.provider,l.modelId)&&a.push(l)}const o=[],n=new Set;for(const l of a){const e=`${l.provider}:${l.modelId}`;n.has(e)||(n.add(e),o.push(l))}return o.slice(0,7)});function j(e,t=""){const a=[];for(const[r,i]of Object.entries(e))if(null!=i){const e=t?`${t}.${r}`:r;if("object"!=typeof i||Array.isArray(i)){const t=Array.isArray(i)?JSON.stringify(i):i;a.push(`${e}=${t}`)}else{const t=j(i,e);t&&"Default settings"!==t&&a.push(...t.split(", "))}}return a.length>0?a.join(", "):t?"":"Default settings"}function F(e){return a.configurations.some(t=>t.provider===e.provider&&t.modelId===e.modelId&&JSON.stringify(t.parameters)===JSON.stringify(e.parameters))}function z(e){const t=a.prompt?.tokenEstimate?.avgTokens||100;return ct.calculateCostPerCall({name:e.displayName,provider:e.provider,modelId:e.modelId,parameters:e.parameters},t)*a.totalCombinations*a.repeatCount}function q(e){const t=a.prompt?.tokenEstimate?.avgTokens||100;return ct.calculateCostPerCall(e,t)}function R(e){return q(e)*a.totalCombinations*a.repeatCount}function B(e){return x(e.provider,e.modelId)}function K(e,t){return"per-call"===t?"<1mg COâ‚‚e":"~10mg COâ‚‚e"}return(e,t)=>{const a=y("a-button");return o(),s("div",ut,[l("div",mt,[r(a,{onClick:t[0]||(t[0]=t=>e.$emit("show-model-selector")),type:"primary",size:"large",class:"big-add-model-btn","data-testid":"btn-add-model","aria-label":"Add Model Configuration"},{default:w(()=>[r(S(V)),t[1]||(t[1]=P(" Add Model "))]),_:1,__:[1]}),t[3]||(t[3]=l("div",{class:"separator-bar"},null,-1)),l("div",gt,[t[2]||(t[2]=l("div",{class:"quick-add-label"},"Quick add recent/popular models (with default temperature=0, max response length = 128):",-1)),l("div",vt,[(o(!0),s(h,null,T(L.value,e=>(o(),f(a,{key:`${e.provider}:${e.modelId}:${JSON.stringify(e.parameters)}`,onClick:t=>function(e){if(F(e))return void A.warn("ðŸš« Preset model already added, skipping",e);const t={name:e.displayName,provider:e.provider,modelId:e.modelId,parameters:e.parameters};A.info("ðŸŽ¯ Emitting add event from ModelConfigurationSectionV2",{preset:e,configToAdd:t}),i("add",t),I(()=>{const e=document.querySelector(".ant-modal-body");e&&e.scrollTo({top:e.scrollHeight,behavior:"smooth"})})}(e),size:"small",class:"quick-preset-btn",disabled:F(e),"data-testid":"quick-add-model","data-provider":e.provider,"data-model":e.modelId,"aria-label":`Quick add ${e.displayName} model`},{default:w(()=>[P(b(e.displayName)+" ",1),D.value?(o(),s("span",ft,b(S(Z)(z(e))),1)):n("",!0)]),_:2},1032,["onClick","disabled","data-provider","data-model","aria-label"]))),128))])])]),e.configurations.length>0?(o(),s("div",ht,[t[8]||(t[8]=k('<div class="table-header" data-v-55c5e243><div class="col-model" data-v-55c5e243>Model</div><div class="col-params" data-v-55c5e243>Parameters</div><div class="col-calls" data-v-55c5e243>API Calls</div><div class="col-cost" data-v-55c5e243>Cost per Call</div><div class="col-total" data-v-55c5e243>Total Cost</div><div class="col-actions" data-v-55c5e243>Actions</div></div>',1)),(o(!0),s(h,null,T(e.configurations,(i,d)=>(o(),s("div",{key:`model-config-${i.provider}-${i.modelId}-${d}`,class:"table-row","data-testid":"model-config-row","data-config-index":d,"data-provider":i.provider,"data-model":i.modelId},[l("div",wt,[l("div",bt,b(i.provider)+":"+b(i.modelId),1),l("div",Ct,b(i.provider),1)]),l("div",Tt,[l("span",Pt,b(j(i.parameters)),1)]),l("div",St,[l("span",kt,b(e.totalCombinations)+" Ã— "+b(e.repeatCount)+" = ",1),l("span",It,b(e.totalCombinations*e.repeatCount),1)]),l("div",_t,[l("div",xt,[D.value?(o(),s("span",$t,b(S(Z)(q(i))),1)):n("",!0),M.value&&B(i)?(o(),s("small",Dt,b(K(0,"per-call")),1)):n("",!0)])]),l("div",Et,[l("div",At,[D.value?(o(),s("span",Mt,b(S(Z)(R(i))),1)):n("",!0),M.value&&B(i)?(o(),s("small",Ot,b(K(0,"total")),1)):n("",!0)])]),l("div",Nt,[r(a,{type:"text",size:"small",danger:"",onClick:t=>e.$emit("remove",d),class:"remove-btn","data-testid":"remove-model-config","data-config-index":d,"aria-label":`Remove ${i.provider} ${i.modelId} configuration`},{default:w(()=>t[4]||(t[4]=[P("Remove")])),_:2,__:[4]},1032,["onClick","data-config-index","aria-label"])])],8,yt))),128)),e.configurations.length>1?(o(),s("div",Lt,[l("div",jt,[l("div",Vt,"TOTAL ("+b(e.configurations.length)+" models)",1)]),t[5]||(t[5]=l("div",{class:"col-params"},null,-1)),l("div",Ft,[l("span",zt,b(O.value),1)]),t[6]||(t[6]=l("div",{class:"col-cost"},null,-1)),l("div",Ut,[D.value?(o(),s("span",qt,b(S(Z)(N.value)),1)):n("",!0)]),t[7]||(t[7]=l("div",{class:"col-actions"},null,-1))])):n("",!0)])):(o(),s("div",Rt,t[9]||(t[9]=[l("p",null,"No models configured yet. Add at least one model to continue.",-1)])))])}}}),[["__scopeId","data-v-55c5e243"]]),Kt={class:"selected-design-with-template"},Ht={class:"unified-header"},Jt={class:"combinations-count"},Gt={class:"header-controls"},Yt={class:"design-stats"},Wt={class:"stat-item"},Zt={class:"stat-value"},Qt={class:"stat-item"},Xt={class:"stat-value"},ea={class:"stat-item"},ta={class:"stat-value"},aa=O(i({__name:"PromptConfiguredViewV2",props:{selectedPrompt:{},totalCombinations:{},templateCyclingPaused:{type:Boolean}},emits:["toggle-template-cycling","update:cycling-paused"],setup(e){const t=e,{data:a}=Y(()=>E.variableLists.toArray(),{debounce:100}),i=p(()=>("template"===t.selectedPrompt.type||"spreadsheet"===t.selectedPrompt.type)&&t.selectedPrompt.outputConfig?.outputType||"text");function n(e){if("template"===e.type)return Object.keys(e.variables).length;{const t=(a.value||[]).find(t=>t.id===e.datasetId);return t?.items?.length||0}}return(e,t)=>{const a=y("a-button"),d=y("a-tag");return o(),s("div",Kt,[l("div",Ht,[l("h4",null,b(e.selectedPrompt.name),1),l("span",Jt,b(e.totalCombinations)+" combinations",1),l("div",Gt,[r(a,{onClick:t[0]||(t[0]=t=>e.$emit("toggle-template-cycling")),size:"small",type:e.templateCyclingPaused?"default":"primary",class:"pause-btn"},{default:w(()=>[P(b(e.templateCyclingPaused?"Start Variable Substitution":"Pause Variable Substitution"),1)]),_:1},8,["type"])])]),r(ve,{prompt:e.selectedPrompt,cycling:!0,"cycling-paused":e.templateCyclingPaused,"show-controls":"none","display-mode":"inline","max-height":"none",class:"step2-preview","onUpdate:cyclingPaused":t[1]||(t[1]=t=>e.$emit("update:cycling-paused",t))},null,8,["prompt","cycling-paused"]),l("div",Yt,[r(d,{size:"small",color:(c=i.value,{text:"blue",number:"green",boolean:"purple",json:"orange"}[c]||"default"),class:"output-type-tag"},{default:w(()=>[P(b(i.value),1)]),_:1},8,["color"]),l("span",Wt,[l("span",Zt,b(n(e.selectedPrompt)),1),t[2]||(t[2]=l("span",{class:"stat-label"},"vars",-1))]),t[5]||(t[5]=l("span",{class:"stat-divider"},"â€¢",-1)),l("span",Qt,[l("span",Xt,b(e.totalCombinations),1),t[3]||(t[3]=l("span",{class:"stat-label"},"combos",-1))]),t[6]||(t[6]=l("span",{class:"stat-divider"},"â€¢",-1)),l("span",ea,[l("span",ta,b(e.selectedPrompt.tokenEstimate?.avgTokens||"?"),1),t[4]||(t[4]=l("span",{class:"stat-label"},"tokens",-1))])])]);var c}}}),[["__scopeId","data-v-c942480d"]]),ra={class:"streamlined-content"},ia={class:"content-section"},sa={class:"section-header"},oa={class:"section-body"},na={key:0,class:"content-section","data-testid":"trial-config-section"},la={class:"section-body"},da={class:"model-section"},ca=O(i({__name:"TrialSetupSteps",props:{selectedPrompt:{},filteredTemplatePrompts:{},filteredSpreadsheetPrompts:{},promptSearch:{},trialName:{},repeatCount:{},configurations:{},totalCombinations:{},templateCyclingPaused:{type:Boolean},countVariables:{type:Function},formatLastEditDate:{type:Function},getOutputTypeColor:{type:Function},getCombinationCount:{type:Function}},emits:["change-template","prompt-selected","create-new-template","create-spreadsheet-template","toggle-template-cycling","update:template-cycling-paused","update-metadata","show-model-selector","add-configuration","remove-configuration"],setup:e=>(e,t)=>{const a=y("a-button");return o(),s("div",ra,[l("section",ia,[l("div",sa,[t[11]||(t[11]=l("h3",null,"What are you testing?",-1)),e.selectedPrompt?(o(),f(a,{key:0,onClick:t[0]||(t[0]=t=>e.$emit("change-template")),size:"small",class:"back-button",style:{"margin-left":"2em"}},{default:w(()=>t[10]||(t[10]=[P(" â† Back to Select Template ")])),_:1,__:[10]})):n("",!0)]),l("div",oa,[e.selectedPrompt?(o(),f(aa,{key:1,"selected-prompt":e.selectedPrompt,"total-combinations":e.totalCombinations,"template-cycling-paused":e.templateCyclingPaused,onToggleTemplateCycling:t[4]||(t[4]=t=>e.$emit("toggle-template-cycling")),"onUpdate:cyclingPaused":t[5]||(t[5]=t=>e.$emit("update:template-cycling-paused",t))},null,8,["selected-prompt","total-combinations","template-cycling-paused"])):(o(),f(Qe,{key:0,"template-prompts":e.filteredTemplatePrompts,"spreadsheet-prompts":e.filteredSpreadsheetPrompts,"search-term":e.promptSearch,"count-variables":e.countVariables,"format-last-edit-date":e.formatLastEditDate,"get-output-type-color":e.getOutputTypeColor,"get-combination-count":e.getCombinationCount,onSelect:t[1]||(t[1]=t=>e.$emit("prompt-selected",t)),onCreateNew:t[2]||(t[2]=t=>e.$emit("create-new-template")),onCreateSpreadsheet:t[3]||(t[3]=t=>e.$emit("create-spreadsheet-template"))},null,8,["template-prompts","spreadsheet-prompts","search-term","count-variables","format-last-edit-date","get-output-type-color","get-combination-count"]))])]),e.selectedPrompt?(o(),s("section",na,[t[13]||(t[13]=l("h3",null,"Trial Configuration",-1)),l("div",la,[r(lt,{"model-value":{trialName:e.trialName,repeatCount:e.repeatCount},"total-combinations":e.totalCombinations,"onUpdate:modelValue":t[6]||(t[6]=t=>e.$emit("update-metadata",t))},null,8,["model-value","total-combinations"]),l("div",da,[t[12]||(t[12]=l("h4",null,"Model Configuration",-1)),r(Bt,{configurations:e.configurations,prompt:e.selectedPrompt,"total-combinations":e.totalCombinations,"repeat-count":e.repeatCount,onShowModelSelector:t[7]||(t[7]=t=>e.$emit("show-model-selector")),onAdd:t[8]||(t[8]=t=>e.$emit("add-configuration",t)),onRemove:t[9]||(t[9]=t=>e.$emit("remove-configuration",t))},null,8,["configurations","prompt","total-combinations","repeat-count"])])])])):n("",!0)])}}),[["__scopeId","data-v-fb59bdd7"]]),pa={class:"footer-actions"},ua=O(i({__name:"TrialSubmitActions",props:{canProceed:{type:Boolean},creating:{type:[String,Boolean]},isTabMode:{type:Boolean,default:!1}},emits:["create-draft","export-python","create-and-start"],setup(e){const t=e.isTabMode?"-tab":"";return(e,a)=>{const i=y("a-button");return o(),s("div",pa,[r(i,{size:"large",onClick:a[0]||(a[0]=t=>e.$emit("create-draft")),loading:"draft"===e.creating,disabled:!e.canProceed,"data-testid":`btn-create-draft${S(t)}`,"aria-label":"Create trial as draft"},{default:w(()=>a[3]||(a[3]=[P(" Create as Draft ")])),_:1,__:[3]},8,["loading","disabled","data-testid"]),r(i,{size:"large",onClick:a[1]||(a[1]=t=>e.$emit("export-python")),loading:"export"===e.creating,disabled:!e.canProceed,"data-testid":`btn-export-python${S(t)}`,"aria-label":"Export trial to Python"},{default:w(()=>a[4]||(a[4]=[P(" Export to Python ")])),_:1,__:[4]},8,["loading","disabled","data-testid"]),r(i,{type:"primary",size:"large",onClick:a[2]||(a[2]=t=>e.$emit("create-and-start")),loading:"start"===e.creating,disabled:!e.canProceed,"data-testid":`btn-create-and-start${S(t)}`,"aria-label":"Create and start trial execution"},{default:w(()=>[r(S(R)),a[5]||(a[5]=P(" Create and Start "))]),_:1,__:[5]},8,["loading","disabled","data-testid"])])}}}),[["__scopeId","data-v-460adceb"]]);class ma{static formatLastEditDate(e){const t=new Date,a=t.getTime()-e.getTime(),r=Math.floor(a/864e5);if(0===r)return"Today";if(1===r)return"Yesterday";if(r<7)return`${r} days ago`;if(r<30){const e=Math.floor(r/7);return`${e} week${e>1?"s":""} ago`}return e.toLocaleDateString("en-US",{month:"short",day:"numeric",year:e.getFullYear()!==t.getFullYear()?"numeric":void 0})}static getOutputTypeColor(e){return{text:"blue",number:"green",boolean:"purple",json:"orange"}[e]||"default"}static countVariables(e,t){if("template"===e.type)return Object.keys(e.variables).length;{const a=t.lists.find(t=>t.id===e.datasetId);return a?.items?.length||0}}static getCombinationCount(e,t){if("template"===e.type){let a=1;for(const r of Object.values(e.variables))if("direct"===r.type&&r.values)a*=r.values.length;else if("list"===r.type&&r.listId){const e=t.lists.find(e=>e.id===r.listId);a*=e?.itemCount||1}return a>1e3?`${(a/1e3).toFixed(1)}k`:a.toString()}{const a=t.lists.find(t=>t.id===e.datasetId);return a?.itemCount?.toString()||"0"}}static getPromptOutputType(e){return e?"template"===e.type||"spreadsheet"===e.type?e.outputConfig?.outputType||"text":e.outputType||"text":"text"}static getPromptTokenEstimate(e){if(e)return e.tokenEstimate?.avgTokens}}class ga{static extractDuplicationData(e,t=!1){const a={promptSource:null,trialName:t?e.name:`${e.name} (Copy)`,repeatCount:e.repeatConfig?.callsPerPrompt||1,configurations:[]};return B(e)?a.promptSource={type:"template",id:e.templateId}:K(e)?a.promptSource={type:"spreadsheet",id:e.spreadsheetId}:A.warn("Unknown trial type for duplication",{trialId:e.id,trialType:e.type}),e.configurationSnapshots&&e.configurationSnapshots.length>0&&(a.configurations=e.configurationSnapshots.map(e=>({name:e.name||e.modelId,provider:e.provider,modelId:e.modelId,parameters:e.parameters||{}}))),a}static canDuplicateTrial(e){return B(e)||K(e)?e.configurationSnapshots&&0!==e.configurationSnapshots.length?{valid:!0}:{valid:!1,error:"Trial has no model configurations to duplicate"}:{valid:!1,error:"Unknown trial type - cannot duplicate this trial"}}static getTrialPromptType(e){return B(e)?"template":K(e)?"spreadsheet":"unknown"}}const va={key:0,class:"trial-creation-form"},fa={key:0,class:"loading-container"},ha={class:"tab-footer"},ya={key:0,class:"loading-container"},wa=O(i({__name:"TrialCreationModalNew",props:{initialTemplateId:{},initialPromptSource:{},trialToDuplicate:{},isEditMode:{type:Boolean},isTabMode:{type:Boolean}},emits:["close","created","created-and-started","export-trial"],setup(e,{emit:t}){const i=e,n=t,d=p(()=>({type:i.isEditMode?"edit":i.trialToDuplicate?"duplicate":"create",initialTemplateId:i.initialTemplateId,sourceTrial:i.trialToDuplicate||void 0})),{data:m,loading:v}=Y(()=>E.variableLists.toArray(),{debounce:100}),{data:h,loading:b}=Y(()=>E.templatePrompts.toArray(),{debounce:100}),{data:C,loading:T}=Y(()=>E.spreadsheetPrompts.toArray(),{debounce:100}),P=function(e){const t=_("promptService",dt),a=_("modelConfigurationService",ct),r=_("trialCreationService",pt),{data:i}=Y(()=>E.templatePrompts.orderBy("updated").reverse().toArray(),{debounce:100}),{data:s}=Y(()=>E.spreadsheetPrompts.orderBy("updated").reverse().toArray(),{debounce:100}),{data:o}=Y(()=>E.variableLists.toArray(),{debounce:100}),{data:n}=Y(()=>E.models.where("enabled").equals(1).toArray(),{debounce:100}),{data:l}=Y(async()=>{const e=await E.settings.get("main");return e?[e]:[]},{debounce:100}),d=p(()=>i.value||[]),u=p(()=>s.value||[]),m=p(()=>o.value||[]),g=p(()=>n.value||[]),v=p(()=>l.value?.[0]),f=c(null),h=c(""),y=c(1),w=c([]),b=c(!1),C=c(),T=c(!1),P=c(!1),S=c(!1);function k(e){if(!f.value)return 0;const t=g.value.find(t=>t.provider===e.provider&&t.modelId===e.modelId);if(!t?.capabilities)return 0;const r=f.value?.tokenEstimate?.avgTokens||100,i=a.getOutputTokenParameter(e.provider,e.modelId,e.parameters);return(t.capabilities.inputCostPerToken||0)*r+(t.capabilities.outputCostPerToken||0)*i}const I=p(()=>{if(!f.value)return 0;if("template"===f.value.type){const e=f.value;if(!e.variables)return 1;let t=1;for(const a of Object.values(e.variables))if("direct"===a.type)t*=a.values?.length||1;else if(a.listId){const e=m.value.find(e=>e.id===a.listId);t*=e?.itemCount||1}return t}{const e=f.value,t=m.value.find(t=>t.id===e.datasetId);return t?.itemCount||0}}),$=p(()=>I.value*w.value.length*y.value),D=p(()=>{let e=0;for(const t of w.value)e+=k(t)*I.value*y.value;return e}),M=p(()=>null!==f.value&&w.value.length>0);function O(e){A.info("ðŸŽ¯ Prompt selected for trial creation",{promptId:e.id,promptName:e.name,promptType:e.type}),f.value=e,h.value=N(e),P.value=!0,C.value={type:e.type,id:e.id}}function N(e){return e||f.value?`${e?.name||f.value?.name||"Trial"} - ${(new Date).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}`:"New Trial"}return{selectedPrompt:f,trialName:h,repeatCount:y,configurations:w,creating:b,showModelSelector:T,liveUpdatePaused:P,showPlaceholders:S,promptSource:C,totalCombinations:I,totalExperiments:$,totalCost:D,canProceed:M,selectPrompt:O,selectDesign:function(e){A.warn("selectDesign is deprecated, use selectPrompt instead"),O(e)},generateTrialName:N,addConfiguration:function(e){A.info("ðŸ”§ Adding configuration to trial",{config:e,existingConfigs:w.value.length,existingConfigNames:w.value.map(e=>e.name),newConfigName:e.name}),w.value.push(e),A.info("ðŸ“Š Configuration added, total now:",{count:w.value.length})},removeConfiguration:function(e){w.value.splice(e,1)},getConfigCostPerCall:k,createDraftTrial:async function(){if(f.value&&0!==w.value.length){A.info("ðŸ—ï¸ Creating draft trial"),b.value="draft";try{const e={name:h.value||N(),prompt:x(f.value),configurations:x(w.value),repeatCount:y.value},t=await r.createDraftTrial(e);return A.info("âœ… Draft trial created successfully",{trialId:t}),H.success("Trial created as draft!"),t}catch(e){throw A.error("Failed to create draft trial",e),H.error(e instanceof Error?e.message:"Failed to create draft trial"),e}finally{b.value=!1}}},createAndStartTrial:async function(){if(f.value&&0!==w.value.length){b.value="start";try{const e={name:h.value||N(),prompt:x(f.value),configurations:x(w.value),repeatCount:y.value},t=await r.createAndStartTrial(e);return t.needsConfirmation?{trialId:t.trialId,runningTrial:t.runningTrial}:(H.success("Trial created and started!"),{trialId:t.trialId})}catch(e){throw A.error("Failed to create and start trial",e),H.error(e instanceof Error?e.message:"Failed to create trial"),e}finally{b.value=!1}}},createAndExportTrial:async function(){if(f.value&&0!==w.value.length){b.value="export";try{const e={name:h.value||N(),prompt:x(f.value),configurations:x(w.value),repeatCount:y.value},t=await r.createAndExportTrial(e);return H.success("Trial created! Opening export options..."),t}catch(e){throw A.error("Failed to create trial for export",e),H.error(e instanceof Error?e.message:"Failed to create trial"),e}finally{b.value=!1}}},initialize:async function(){const a=e.value;if(a.initialDesignId){A.debug("ðŸ” Looking for initial prompt",{initialDesignId:a.initialDesignId});const e=5e3,r=Date.now();for(;!d.value.length&&!u.value.length&&Date.now()-r<e;)await new Promise(e=>setTimeout(e,100));const i={type:"unknown",id:a.initialDesignId},s=await t.getPrompt(i);if(s)O(s);else{const e=d.value.find(e=>e.id===a.initialDesignId),t=u.value.find(e=>e.id===a.initialDesignId);e?O(e):t?O(t):A.warn("âŒ Initial prompt not found",{requestedId:a.initialDesignId})}}if(a.sourceTrial){const e=a.sourceTrial;if(h.value="edit"===a.type?e.name:`Copy of ${e.name}`,B(e)||K(e))if(e.repeatConfig?.callsPerPrompt&&(y.value=e.repeatConfig.callsPerPrompt),e.configurationSnapshots&&e.configurationSnapshots.length>0&&(w.value=e.configurationSnapshots.map(e=>({name:e.name||e.modelId,provider:e.provider,modelId:e.modelId,parameters:e.parameters||{}}))),"template"===e.type&&e.templateId){const t=await E.templatePrompts.get(e.templateId);t&&O(t)}else if("spreadsheet"===e.type&&e.spreadsheetId){const t=await E.spreadsheetPrompts.get(e.spreadsheetId);t&&O(t)}P.value=!0}},templatePromptsStore:{templates:d,initialize:async()=>{}},spreadsheetPromptsStore:{spreadsheets:u,initialize:async()=>{}},variableListsStore:{lists:m,initialize:async()=>{}},modelsStore:{enabledModels:g,initialize:async()=>{}},settingsStore:{settings:v,getApiKey:e=>{const t=U.getProviderGroup(e);return v.value?.apiKeys?.[t]},initialize:async()=>{}}}}(d),S=c(""),k=p(()=>b.value||T.value||v.value),I=p(()=>{const e=h.value||[];if(A.debug("ðŸ” Computing filteredTemplatePrompts",{templatesLength:e.length,promptSearch:S.value}),!S.value)return e;const t=S.value.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t)||e.template.toLowerCase().includes(t))}),D=p(()=>{const e=C.value||[];if(A.debug("ðŸ” Computing filteredSpreadsheetPrompts",{spreadsheetsLength:e.length,promptSearch:S.value}),!S.value)return e;const t=S.value.toLowerCase();return e.filter(e=>e.name.toLowerCase().includes(t)||e.promptPattern.toLowerCase().includes(t))}),M=e=>{const t={lists:m.value||[]};return ma.countVariables(e,t)},O=e=>ma.formatLastEditDate(e),N=e=>ma.getOutputTypeColor(e),L=e=>{const t={lists:m.value||[]};return ma.getCombinationCount(e,t)},j=c(!0),V=p(()=>P.selectedPrompt.value),F=p({get:()=>P.trialName.value,set:e=>{P.trialName.value=e}}),z=p({get:()=>P.repeatCount.value,set:e=>{P.repeatCount.value=e}}),q=p(()=>P.configurations.value),R=p({get:()=>P.showModelSelector.value,set:e=>{P.showModelSelector.value=e}}),W=p(()=>P.creating.value),Z=p(()=>P.totalCombinations.value),Q=e=>ma.getPromptTokenEstimate(e);function ee(e){if(e)return{totalCombinations:Z.value,avgTokens:Q(e)||150}}const te=c(),ae=p(()=>i.isEditMode&&i.trialToDuplicate?`Edit Trial: ${i.trialToDuplicate.name}`:i.trialToDuplicate?`Duplicate Trial: ${i.trialToDuplicate.name}`:"Create New Trial"),re=p(()=>P.canProceed.value);async function ie(e){A.info("ðŸŽ¯ TrialCreationModalNew.onPromptSelected called",{promptId:e.id,promptName:e.name,promptType:e.type,variableListsCount:m.value?.length||0}),A.debug("Calling trialCreation.selectPrompt",{prompt:e}),P.selectPrompt(e),A.info("ðŸ” After selectPrompt call",{selectedPromptId:P.selectedPrompt.value?.id,selectedPromptName:P.selectedPrompt.value?.name,totalCombinations:P.totalCombinations.value}),j.value=!0}async function oe(){if(i.initialPromptSource)try{const e=await J.resolve(i.initialPromptSource.id);if(!e)throw new Error("Prompt source not found");let t;if("template"===e.type?t=await E.templatePrompts.get(e.id):"spreadsheet"===e.type&&(t=await E.spreadsheetPrompts.get(e.id)),!t)throw new Error(`${e.type} prompt not found in V2 stores`);te.value={type:e.type,id:e.id},P.selectPrompt(t),A.debug("Loaded prompt source",{type:e.type,id:e.id})}catch(e){A.error("Failed to load prompt source",e),G.error({title:"Failed to load prompt source",content:e instanceof Error?e.message:"Unknown error"})}}function ne(){P.selectedPrompt.value=null,P.configurations.value=[],te.value=void 0}async function le(){n("close"),window.location.href="#/templates"}async function ce(){n("close"),window.location.href="#/spreadsheet"}function pe(e){P.trialName.value=e.trialName,P.repeatCount.value=e.repeatCount}function ue(e){P.addConfiguration(e)}function me(e){P.removeConfiguration(e)}function ge(e){ue(e),P.showModelSelector.value=!1}async function ve(){try{te.value&&(P.promptSource.value=te.value);const e=await P.createDraftTrial();e&&(n("created",e),n("close"))}catch(e){}}async function fe(){try{te.value&&(P.promptSource.value=te.value);const e=await P.createAndExportTrial();e&&(n("export-trial",e),n("close"))}catch(e){}}async function he(){try{te.value&&(P.promptSource.value=te.value);const e=await P.createAndStartTrial();e&&(e.runningTrial?G.confirm({title:"Another trial is already running",content:$("div",{style:"font-size: 14px; line-height: 1.6;"},[$("p",{style:"font-weight: 600; margin-bottom: 12px;"},`The trial "${e.runningTrial.name}" is currently executing.`),$("p",{style:"margin-bottom: 16px;"},"You can only run one trial at a time. Here are your options:"),$("ul",{style:"margin: 0 0 16px 20px; padding: 0;"},[$("li",{style:"margin-bottom: 8px;"},[$("strong","Start new trial: "),"This will automatically pause the current trial. You can resume it later from the Trials page."]),$("li",{style:"margin-bottom: 8px;"},[$("strong","Create as draft: "),"Save this trial configuration without starting it. You can run it later when the current trial completes."]),$("li",[$("strong","Keep current trial: "),"Cancel this action and let the current trial continue running."])]),$("div",{style:"background: #f0f2f5; padding: 12px; border-radius: 6px; margin-top: 16px;"},[$("p",{style:"margin: 0; font-size: 13px; color: #666;"},[$("strong","ðŸ’¡ Tip: "),"Paused trials retain their progress and can be resumed anytime. All completed API calls are saved."])])]),width:600,okText:"Start new trial (pause current)",cancelText:"Keep current trial running",onOk:async()=>{try{await se.executeTrial(e.trialId),n("created-and-started",e.trialId),n("close")}catch(t){A.error("Failed to start trial after confirmation",t),H.error("Failed to start trial")}},onCancel:async()=>{try{await se.deleteTrial(e.trialId)}catch(t){A.error("Failed to delete trial after cancellation",t)}}}):(n("created-and-started",e.trialId),n("close")))}catch(e){}}function ye(){j.value=!j.value}async function we(){i.initialTemplateId&&await async function(e){try{const t=await E.templatePrompts.get(e);if(t)return te.value={type:"template",id:e},void P.selectPrompt(t);const a=await E.spreadsheetPrompts.get(e);if(a)return te.value={type:"spreadsheet",id:e},void P.selectPrompt(a);throw new Error("Design not found in V2 stores")}catch(t){A.error("Failed to load design",t),G.error({title:"Failed to load design",content:t instanceof Error?t.message:"Unknown error"})}}(i.initialTemplateId)}return u(async()=>{if(A.info("ðŸš€ TrialCreationModalNew mounting",{isLoadingData:k.value,loadingTemplates:b.value,loadingSpreadsheets:T.value,loadingVariableLists:v.value}),await P.initialize(),k.value){A.info("â³ Waiting for data to load...");let e=0;for(;k.value&&e<2e3;)await new Promise(e=>setTimeout(e,100)),e+=100}A.info("ðŸ“Š Data after waiting",{isLoadingData:k.value,templatePromptsCount:h.value?.length||0,spreadsheetPromptsCount:C.value?.length||0,variableListsCount:m.value?.length||0,templatePromptIds:h.value?.map(e=>e.id)||[],spreadsheetPromptIds:C.value?.map(e=>e.id)||[]}),A.debug("Variable lists count",{count:m.value?.length||0}),i.initialPromptSource&&await oe()}),g(()=>i.trialToDuplicate,()=>{i.trialToDuplicate&&async function(){if(i.trialToDuplicate)try{const e=ga.canDuplicateTrial(i.trialToDuplicate);if(!e.valid)throw new Error(e.error);const t=ga.extractDuplicationData(i.trialToDuplicate,i.isEditMode);t.promptSource&&(te.value=t.promptSource,await oe()),P.trialName.value=t.trialName,P.repeatCount.value=t.repeatCount,P.configurations.value=t.configurations}catch(e){A.error("Failed to initialize duplication",e),G.error({title:"Failed to load trial data",content:e instanceof Error?e.message:"Unknown error"})}}()},{immediate:!0}),g(()=>i.initialTemplateId,()=>{i.initialTemplateId&&!i.trialToDuplicate&&we()},{immediate:!0}),(e,t)=>{const i=y("a-spin");return e.isTabMode?(o(),s("div",va,[k.value?(o(),s("div",fa,[r(i,{size:"large",tip:"Loading templates and data..."})])):(o(),f(ca,{key:1,"selected-prompt":V.value,"filtered-template-prompts":I.value,"filtered-spreadsheet-prompts":D.value,"prompt-search":S.value,"trial-name":F.value,"repeat-count":z.value,configurations:q.value,"total-combinations":Z.value,"template-cycling-paused":j.value,"count-variables":M,"format-last-edit-date":O,"get-output-type-color":N,"get-combination-count":L,onChangeTemplate:ne,onPromptSelected:ie,onCreateNewTemplate:le,onCreateSpreadsheetTemplate:ce,onToggleTemplateCycling:ye,"onUpdate:templateCyclingPaused":t[0]||(t[0]=e=>j.value=e),onUpdateMetadata:pe,onShowModelSelector:t[1]||(t[1]=e=>R.value=!0),onAddConfiguration:ue,onRemoveConfiguration:me},null,8,["selected-prompt","filtered-template-prompts","filtered-spreadsheet-prompts","prompt-search","trial-name","repeat-count","configurations","total-combinations","template-cycling-paused"])),l("div",ha,[r(ua,{"can-proceed":re.value,creating:W.value,"is-tab-mode":!0,onCreateDraft:ve,onExportPython:fe,onCreateAndStart:he},null,8,["can-proceed","creating"])]),r(X,{open:R.value&&!!V.value,mode:"trial","trial-context":V.value?ee(V.value):void 0,"existing-configurations":q.value,onClose:t[2]||(t[2]=e=>R.value=!1),onAddConfiguration:ge},null,8,["open","trial-context","existing-configurations"])])):(o(),f(a,{key:1,"model-value":!0,title:ae.value,size:"full","data-testid":"modal-trial-creation","onUpdate:modelValue":t[6]||(t[6]=t=>e.$emit("close"))},{footer:w(()=>[r(de,null,{default:w(()=>[r(ua,{"can-proceed":re.value,creating:W.value,"is-tab-mode":!1,onCreateDraft:ve,onExportPython:fe,onCreateAndStart:he},null,8,["can-proceed","creating"])]),_:1})]),default:w(()=>[k.value?(o(),s("div",ya,[r(i,{size:"large",tip:"Loading templates and data..."})])):(o(),f(ca,{key:1,"selected-prompt":V.value,"filtered-template-prompts":I.value,"filtered-spreadsheet-prompts":D.value,"prompt-search":S.value,"trial-name":F.value,"repeat-count":z.value,configurations:q.value,"total-combinations":Z.value,"template-cycling-paused":j.value,"count-variables":M,"format-last-edit-date":O,"get-output-type-color":N,"get-combination-count":L,onChangeTemplate:ne,onPromptSelected:ie,onCreateNewTemplate:le,onCreateSpreadsheetTemplate:ce,onToggleTemplateCycling:ye,"onUpdate:templateCyclingPaused":t[3]||(t[3]=e=>j.value=e),onUpdateMetadata:pe,onShowModelSelector:t[4]||(t[4]=e=>R.value=!0),onAddConfiguration:ue,onRemoveConfiguration:me},null,8,["selected-prompt","filtered-template-prompts","filtered-spreadsheet-prompts","prompt-search","trial-name","repeat-count","configurations","total-combinations","template-cycling-paused"])),r(X,{open:R.value&&!!V.value,mode:"trial","trial-context":V.value?ee(V.value):void 0,"existing-configurations":q.value,onClose:t[5]||(t[5]=e=>R.value=!1),onAddConfiguration:ge},null,8,["open","trial-context","existing-configurations"])]),_:1},8,["title"]))}}}),[["__scopeId","data-v-8c6d8338"]]);export{re as F,wa as T,ve as a,se as t};
