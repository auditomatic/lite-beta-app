const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./PythonExportModal.vue_vue_type_style_index_0_lang-BKaFWCp2.js","./vendor-DImCB_rW.js","./index-Dynr8V5n.js","./db-CL8uhZCz.js","./index-lzLChbdF.css","./BaseModal.vue_vue_type_style_index_0_lang-D3rbY83j.js","./BaseModal-DbTyIa7L.css","./designs-db-b5FxS9e9.js","./defaultData-BR5V2V3r.js","./variable.service-DGu7U4d3.js","./variables-db-DLw3DExB.js","./models-db-ClcV8tSQ.js","./useEnvironmentalCost-CfIURcPO.js","./cost-formatting-Bv_drrqY.js","./GenericModelSelectorModal-B1wj_vmD.js","./GenericModelSelectorModal-DrDcF-66.css","./PythonExportModal-DSxWLbl9.css"])))=>i.map(i=>d[i]);
import{T as a,R as e,g as t,d as l,l as s,_ as r,u as i,G as o,c as n}from"./index-Dynr8V5n.js";import{d as c,f as u,c as d,a6 as p,_ as f,k as v,V as m,a1 as g,W as y,Z as h,u as b,l as _,Y as k,G as w,F as x,a8 as C,a0 as E,ab as T,B as j,w as R,o as D,X as P}from"./vendor-DImCB_rW.js";import{E as S,T as $}from"./TrialAnalysisView-BMFjn9z7.js";import{u as I}from"./useResponsiveTable-Cw1RaX8o.js";import{_ as M,T as z}from"./PythonExportModal.vue_vue_type_style_index_0_lang-BKaFWCp2.js";import{_ as A}from"./TrialDetailModal.vue_vue_type_style_index_0_lang-D0h6YZnI.js";import"./db-CL8uhZCz.js";import"./feature-flags-DaxAZY-J.js";import"./BaseModal.vue_vue_type_style_index_0_lang-D3rbY83j.js";import"./designs-db-b5FxS9e9.js";import"./defaultData-BR5V2V3r.js";import"./variable.service-DGu7U4d3.js";import"./variables-db-DLw3DExB.js";import"./models-db-ClcV8tSQ.js";import"./useEnvironmentalCost-CfIURcPO.js";import"./cost-formatting-Bv_drrqY.js";import"./GenericModelSelectorModal-B1wj_vmD.js";const F={class:"results-table-container full-width","data-testid":"results-table-container"},V={class:"results-header"},B={class:"header-actions"},U={class:"scientific-table-container"},q={class:"scientific-table-wrapper"},G={key:0,class:"trial-info-cell"},K={class:"trial-header"},L={class:"trial-name"},N={class:"trial-design"},O={class:"text-secondary"},Y={class:"trial-created"},H={class:"text-secondary"},W={key:1,class:"progress-summary"},X={class:"progress-stats"},Z={class:"stat successful"},J={class:"stat failed"},Q={class:"stat total"},aa={class:"progress-text"},ea={key:0,class:"error-indicator"},ta={key:2,class:"success-rate-cell"},la={class:"rate-value"},sa={key:3,class:"performance-cell"},ra={class:"metric"},ia={class:"metric-value"},oa={class:"metric"},na={class:"metric-value"},ca={key:4,class:"configurations-cell"},ua={class:"config-details"},da={class:"text-secondary"},pa={key:5,class:"cost-summary"},fa={key:1,class:"text-secondary"},va={key:0,class:"cost-per-call"},ma={key:6,class:"table-actions-grid table-actions-grid-3"},ga=r(c({__name:"ResultsTable",props:{trials:{},loading:{type:Boolean,default:!1}},emits:["view-results","export-trial","duplicate-trial","delete-trial","trial-details","refresh-trials","export-all","status-filter-changed"],setup(r,{emit:i}){const o=r,n=i,c=u("all"),R=u(!1),D=u(null),P=u([]),$=[{key:"all",label:"All"},{key:"completed",label:"Completed"},{key:"failed",label:"Failed"},{key:"running",label:"Running"},{key:"cancelled",label:"Cancelled"}],{getVisibleColumns:M,createResultColumns:z}=I(),A=M(z()),ga=d(()=>"all"===c.value?o.trials:o.trials.filter(a=>a.status===c.value)),ya=d(()=>o.trials.filter(a=>"completed"===a.status));function ha(a){c.value=a,n("status-filter-changed",a)}function ba(a){n("view-results",a)}function _a(a){return"all"===a?o.trials.length:o.trials.filter(e=>e.status===a).length}function ka(a){return 0===a.progress.total?0:Math.round(a.progress.completed/a.progress.total*100)}function wa(a){if(0===a.progress.completed)return 0;const e=a.progress.completed-a.progress.networkErrors;return Math.round(e/a.progress.completed*100)}function xa(a){const e=wa(a);return e>=95?"#52c41a":e>=80?"#faad14":"#ff4d4f"}function Ca(a){return a.progress.completed>0?"1,234":"-"}function Ea(a){return a.progress.completed>0?"2.5":"-"}function Ta(a){if(0===a.progress.total||0===a.estimatedCost)return"-";return(Math.abs(a.estimatedCost)/a.progress.total).toFixed(4)}function ja(a){const e=[];return"completed"===a.status&&e.push("status-completed"),"failed"===a.status&&e.push("status-failed"),"running"===a.status&&e.push("status-running"),e.join(" ")}function Ra(a){const e=(new Date).getTime()-a.getTime(),t=Math.floor(e/864e5);return 0===t?"Today":1===t?"Yesterday":t<7?`${t} days ago`:t<30?`${Math.floor(t/7)} weeks ago`:a.toLocaleDateString()}function Da(){n("refresh-trials")}async function Pa(){const a=ya.value;if(0!==a.length)try{const e=[];for(const t of a){const a=await l.apiCalls.where("trialId").equals(t.id).toArray();e.push(...a)}D.value={id:"all-trials",name:`All Completed Trials (${a.length} trials)`,status:"completed",created:new Date,updated:new Date,designSnapshot:{originalName:"Multiple Designs"},configurationSnapshots:[],variableSnapshots:{},progress:{completed:e.filter(a=>"completed"===a.status).length,total:e.length,networkErrors:e.filter(a=>"failed"===a.status&&"network_error_no_response"===a.result?.errorType).length},totalCombinations:e.length,estimatedCost:a.reduce((a,e)=>a+e.estimatedCost,0)},P.value=e,R.value=!0}catch(e){s.error("Failed to load API calls",e)}}function Sa(e){return _("div",{class:"expanded-trial-details"},[_("h4",{style:{margin:"0 0 12px 0",fontSize:"13px"}},"Configuration Breakdown"),_(a,{columns:[{title:"Model",dataIndex:"model",key:"model",width:200},{title:"Parameters",dataIndex:"parameters",key:"parameters",width:300},{title:"Calls",dataIndex:"calls",key:"calls",width:80,align:"center"},{title:"Success Rate",dataIndex:"successRate",key:"successRate",width:100,align:"center"},{title:"Avg Latency",dataIndex:"latency",key:"latency",width:100,align:"center"},{title:"Cost",dataIndex:"cost",key:"cost",width:80,align:"right"}],dataSource:(t=e,(t.configurationSnapshots||[]).map((a,e)=>({id:e,model:`${a.provider}:${a.modelId}`,parameters:Object.entries(a.parameters).map(([a,e])=>`${a}:${e}`).join(", "),calls:Math.floor(t.progress.total/(t.configurationSnapshots?.length||1)),successRate:`${wa(t)}%`,latency:Ca(t)+"ms",cost:`$${Ta(t)}`}))),pagination:!1,size:"small",rowKey:"id"})]);var t}return(a,r)=>{const i=y("a-button"),o=y("a-space"),u=y("a-tab-pane"),d=y("a-tabs"),_=y("a-tag"),I=y("a-progress"),M=y("a-table");return k(),p("div",F,[f("div",V,[r[4]||(r[4]=f("div",{class:"header-content"},[f("h2",null,"Trial Results"),f("p",{class:"description"}," Analyze and export completed experimental results ")],-1)),f("div",B,[v(o,null,{default:h(()=>[v(i,{onClick:Da,"data-testid":"btn-refresh-trials","aria-label":"Refresh trial results"},{icon:h(()=>[v(b(e))]),default:h(()=>[r[2]||(r[2]=w(" Refresh "))]),_:1,__:[2]}),v(i,{type:"primary",onClick:Pa,disabled:0===ya.value.length,"data-testid":"btn-export-all-data","aria-label":"Export all trial data"},{icon:h(()=>[v(b(t))]),default:h(()=>[r[3]||(r[3]=w(" Export All Data "))]),_:1,__:[3]},8,["disabled"])]),_:1})])]),v(d,{activeKey:c.value,"onUpdate:activeKey":r[0]||(r[0]=a=>c.value=a),size:"small",class:"status-tabs","data-testid":"tabs-status-filter",onChange:ha},{default:h(()=>[(k(),p(x,null,C($,a=>v(u,{key:a.key,tab:`${a.label} (${_a(a.key)})`},null,8,["tab"])),64))]),_:1},8,["activeKey"]),f("div",U,[f("div",q,[v(M,{columns:b(A),"data-source":ga.value,pagination:!1,size:"small",scroll:{y:"calc(100vh - 200px)"},"row-key":"id","row-class-name":ja,class:"scientific-table",onRowClick:ba,"expand-row-by-click":!1,"expanded-row-render":Sa},{bodyCell:h(({column:a,record:e})=>{return["trial"===a.key?(k(),p("div",G,[f("div",K,[f("strong",L,E(e.name),1),v(_,{color:(o=e.status,{completed:"success",failed:"error",running:"processing",cancelled:"default",draft:"default",pending:"processing",paused:"warning"}[o]||"default"),size:"small",class:"trial-status-tag"},{default:h(()=>[w(E(e.status.toUpperCase()),1)]),_:2},1032,["color"])]),f("div",N,[f("small",O," Design: "+E(e.designSnapshot?.originalName||"Unknown Design"),1)]),f("div",Y,[f("small",H," Created "+E(Ra(e.created)),1)])])):g("",!0),"progress"===a.key?(k(),p("div",W,[f("div",X,[f("span",Z,E(e.progress.completed)+" ✓",1),f("span",J,E(e.progress.networkErrors)+" ✗",1),f("span",Q,"/ "+E(e.progress.total),1)]),v(I,{percent:ka(e),size:"small",status:(t=e,"failed"===t.status?"exception":"completed"===t.status?"success":t.progress.networkErrors>0?"exception":"normal"),"show-info":!1,class:"progress-bar"},null,8,["percent","status"]),f("div",aa,[w(E(ka(e))+"% complete ",1),e.progress.networkErrors>0?(k(),p("span",ea," ("+E(e.progress.networkErrors)+" errors) ",1)):g("",!0)])])):g("",!0),"success_rate"===a.key?(k(),p("div",ta,[f("div",la,E(wa(e))+"%",1),v(I,{percent:wa(e),size:"small","show-info":!1,"stroke-color":xa(e),class:"success-rate-bar"},null,8,["percent","stroke-color"])])):g("",!0),"performance"===a.key?(k(),p("div",sa,[f("div",ra,[r[5]||(r[5]=f("small",{class:"metric-label"},"Avg Latency",-1)),f("strong",ia,E(Ca(e))+"ms",1)]),f("div",oa,[r[6]||(r[6]=f("small",{class:"metric-label"},"Throughput",-1)),f("strong",na,E(Ea(e))+"/min",1)])])):g("",!0),"configurations"===a.key?(k(),p("div",ca,[v(_,{size:"small",color:"blue"},{default:h(()=>[w(E(e.configurationSnapshots?.length||0)+" configs ",1)]),_:2},1024),e.repeatConfig?.callsPerPrompt&&e.repeatConfig.callsPerPrompt>1?(k(),m(_,{key:0,size:"small",color:"purple",style:{"margin-left":"4px"}},{default:h(()=>[w(E(e.repeatConfig.callsPerPrompt)+"× repeat ",1)]),_:2},1024)):g("",!0),f("div",ua,[f("small",da,E(e.totalCombinations)+" variables ",1)])])):g("",!0),"cost"===a.key?(k(),p("div",pa,[f("span",{class:T(["cost-value",{negative:e.estimatedCost<0}])},[Math.abs(e.estimatedCost)>0?(k(),p(x,{key:0},[w(" $"+E(Math.abs(e.estimatedCost).toFixed(3)),1)],64)):(k(),p("span",fa,"-"))],2),e.progress.total>0?(k(),p("small",va," $"+E(Ta(e))+"/call ",1)):g("",!0)])):g("",!0),"actions"===a.key?(k(),p("div",ma,[v(i,{size:"small",onClick:j(a=>function(a){n("view-results",a)}(e),["stop"]),"data-testid":"btn-view-results","data-trial-id":e.id,"aria-label":`View results for trial ${e.name}`},{default:h(()=>r[7]||(r[7]=[w(" View Results ")])),_:2,__:[7]},1032,["onClick","data-trial-id","aria-label"]),v(i,{size:"small",onClick:j(a=>async function(a){D.value=a;try{P.value=await l.apiCalls.where("trialId").equals(a.id).toArray(),R.value=!0}catch(e){s.error("Failed to load API calls",e)}}(e),["stop"]),"data-testid":"btn-data-export","data-trial-id":e.id,"aria-label":`Export data for trial ${e.name}`},{default:h(()=>r[8]||(r[8]=[w(" Data Export ")])),_:2,__:[8]},1032,["onClick","data-trial-id","aria-label"]),v(i,{size:"small",onClick:j(a=>function(a){n("export-trial",a,"python")}(e),["stop"]),"data-testid":"btn-python-export","data-trial-id":e.id,"aria-label":`Export Python code for trial ${e.name}`},{default:h(()=>r[9]||(r[9]=[w(" Python Export ")])),_:2,__:[9]},1032,["onClick","data-trial-id","aria-label"])])):g("",!0)];var t,o}),_:1},8,["columns","data-source"])])]),R.value&&D.value?(k(),m(S,{key:0,trial:D.value,"api-calls":P.value,onClose:r[1]||(r[1]=a=>R.value=!1)},null,8,["trial","api-calls"])):g("",!0)])}}}),[["__scopeId","data-v-b51774fe"]]),ya={class:"results-view full-width","data-testid":"page-results"},ha={key:0,class:"results-table-view"},ba={key:1,class:"analysis-view"},_a={class:"analysis-header"},ka={class:"analysis-title"},wa=r(c({__name:"ResultsView",setup(a){const e=i(),r=P(),c=u("table"),d=u(null),_=u(null),x=u([]),C=u([]),T=u(!1),j=u(!1),S=u("all"),I=u(!1),F=u(!1),V=u(!1),B=u(null),U=u(null);async function q(){T.value=!0;try{await e.initialize(),x.value=e.trials}catch(a){s.error("Failed to load trials",a)}finally{T.value=!1}}async function G(a){!function(a){d.value=a.id,_.value=a}(a),c.value="analysis",await async function(){if(d.value){j.value=!0;try{C.value=await l.apiCalls.where("trialId").equals(d.value).toArray()}catch(a){s.error("Failed to load results",a)}finally{j.value=!1}}}()}function K(){c.value="table",d.value=null,_.value=null,C.value=[]}function L(a,e){B.value=a,"python"===e?I.value=!0:J(a)}function N(a){U.value=a,V.value=!0}function O(a){_.value=a,F.value=!0}function Y(){s.info("Exporting all results")}function H(a){S.value=a}function W(a){s.info("Results exported",{filename:a}),I.value=!1,B.value=null}function X(){q()}function Z(a){s.info("Trial duplicated",{trialId:a}),V.value=!1,U.value=null,q()}async function J(a){try{const{PythonExportService:e}=await n(async()=>{const{PythonExportService:a}=await import("./PythonExportModal.vue_vue_type_style_index_0_lang-BKaFWCp2.js").then(a=>a.p);return{PythonExportService:a}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url);await e.downloadPythonScript(a)}catch(e){s.error("Export failed",e),alert("Export failed: "+(e instanceof Error?e.message:"Unknown error"))}}async function Q(a){if(confirm(`Delete trial "${a.name}"? This cannot be undone.`))try{await e.deleteTrial(a.id),d.value===a.id&&K()}catch(t){s.error("Failed to delete trial",t),alert("Failed to delete trial")}}return R(x,async a=>{a.length>0&&await async function(){const a=r.query.trialId;if(a&&x.value.length>0){const e=x.value.find(e=>e.id===a);e&&await G(e)}}()},{immediate:!0}),D(async()=>{await q()}),(a,e)=>{const l=y("a-button"),s=y("a-tag"),r=y("a-space");return k(),p("div",ya,["table"===c.value?(k(),p("div",ha,[v(ga,{trials:x.value,loading:T.value,onViewResults:G,onExportTrial:L,onDuplicateTrial:N,onDeleteTrial:Q,onTrialDetails:O,onRefreshTrials:q,onExportAll:Y,onStatusFilterChanged:H},null,8,["trials","loading"])])):"analysis"===c.value&&_.value?(k(),p("div",ba,[f("div",_a,[v(l,{onClick:K,type:"default",class:"back-button","data-testid":"btn-back-to-results","aria-label":"Go back to results table"},{icon:h(()=>[v(b(o))]),default:h(()=>[e[4]||(e[4]=w(" Back to Results "))]),_:1,__:[4]}),f("div",ka,[f("h2",null,E(_.value.name),1),v(s,{color:(i=_.value.status,{completed:"success",failed:"error",running:"processing",cancelled:"default",draft:"default",pending:"processing",paused:"warning"}[i]||"default"),size:"small"},{default:h(()=>[w(E(_.value.status.toUpperCase()),1)]),_:1},8,["color"])]),v(r,null,{default:h(()=>[v(l,{class:"btn-success",onClick:e[0]||(e[0]=a=>J(_.value)),"data-testid":"btn-export-trial-results","aria-label":"Export trial results"},{icon:h(()=>[v(b(t))]),default:h(()=>[e[5]||(e[5]=w(" Export Results "))]),_:1,__:[5]})]),_:1})]),v($,{trial:_.value,"api-calls":C.value,loading:j.value,onBackToSelection:K,onExportTrial:J},null,8,["trial","api-calls","loading"])])):g("",!0),I.value&&B.value?(k(),m(M,{key:2,trial:B.value,onClose:e[1]||(e[1]=a=>{I.value=!1,B.value=null}),onExported:W},null,8,["trial"])):g("",!0),F.value&&_.value?(k(),m(A,{key:3,trial:_.value,onClose:e[2]||(e[2]=a=>F.value=!1),onUpdated:X},null,8,["trial"])):g("",!0),V.value?(k(),m(z,{key:4,trialToDuplicate:U.value||void 0,onClose:e[3]||(e[3]=a=>{V.value=!1,U.value=null}),onCreated:Z},null,8,["trialToDuplicate"])):g("",!0)]);var i}}}),[["__scopeId","data-v-af3b6073"]]);export{wa as default};
