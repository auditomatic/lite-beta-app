var e=Object.defineProperty,t=(t,o,a)=>((t,o,a)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a)(t,"symbol"!=typeof o?o+"":o,a);import{d as o}from"./index-CGLWf6d2.js";import{p as a}from"./registry-CxaPevFZ.js";import"./vendor-l9j4AUWK.js";import"./db-CL8uhZCz.js";const i=["amazon/nova-lite-v1","amazon/nova-micro-v1","amazon/nova-pro-v1","anthropic/claude-3-haiku","anthropic/claude-3.5-haiku","anthropic/claude-3.5-sonnet","anthropic/claude-3.7-sonnet","anthropic/claude-3.7-sonnet:thinking","anthropic/claude-opus-4","anthropic/claude-sonnet-4","cohere/command-a","cohere/command-r","cohere/command-r-plus","deepseek/deepseek-chat","deepseek/deepseek-r1","google/gemini-2.0-flash-001","google/gemini-2.0-flash-lite-001","google/gemini-2.5-flash","google/gemini-2.5-flash-preview","google/gemini-2.5-flash-preview:thinking","google/gemini-2.5-pro","google/gemini-2.5-pro-preview","google/gemini-flash-1.5","google/gemini-flash-1.5-8b","google/gemini-pro-1.5","google/gemma-2-27b-it","google/gemma-2-9b-it","google/gemma-3-12b-it","google/gemma-3-27b-it","google/gemma-3-4b-it","meta-llama/llama-3-70b-instruct","meta-llama/llama-3-8b-instruct","meta-llama/llama-3.1-405b-instruct","meta-llama/llama-3.1-70b-instruct","meta-llama/llama-3.1-8b-instruct","meta-llama/llama-3.2-1b-instruct","meta-llama/llama-3.2-3b-instruct","meta-llama/llama-3.3-70b-instruct","meta-llama/llama-4-maverick","meta-llama/llama-4-scout","microsoft/phi-3-medium-128k-instruct","microsoft/phi-3-mini-128k-instruct","microsoft/phi-3.5-mini-128k-instruct","microsoft/phi-4","microsoft/phi-4-reasoning-plus","microsoft/wizardlm-2-8x22b","mistralai/ministral-3b","mistralai/ministral-8b","mistralai/mistral-7b-instruct-v0.3","mistralai/mistral-large","mistralai/mistral-large-2407","mistralai/mistral-large-2411","mistralai/mistral-small-24b-instruct-2501","mistralai/mistral-small-3.1-24b-instruct","mistralai/mistral-small-3.2-24b-instruct","mistralai/mistral-tiny","mistralai/mixtral-8x22b-instruct","mistralai/mixtral-8x7b-instruct","nvidia/llama-3.1-nemotron-70b-instruct","nvidia/llama-3.1-nemotron-ultra-253b-v1","nvidia/llama-3.3-nemotron-super-49b-v1","openai/gpt-3.5-turbo-0613","openai/gpt-4-0314","openai/gpt-4-1106-preview","openai/gpt-4.1","openai/gpt-4.1-mini","openai/gpt-4.1-nano","openai/gpt-4.5-preview","openai/gpt-4o-2024-05-13","openai/gpt-4o-2024-08-06","openai/gpt-4o-2024-11-20","openai/gpt-4o-mini-2024-07-18","openai/o1-mini-2024-09-12","openai/o1-preview-2024-09-12","openai/o1-pro","openai/o3","openai/o3-mini","openai/o3-mini-high","openai/o3-pro","openai/o4-mini","openai/o4-mini-high","perplexity/r1-1776","perplexity/sonar","perplexity/sonar-deep-research","perplexity/sonar-pro","perplexity/sonar-reasoning","perplexity/sonar-reasoning-pro","qwen/qwen-2-72b-instruct","qwen/qwen-2.5-72b-instruct","qwen/qwen-2.5-7b-instruct","qwen/qwen-2.5-vl-7b-instruct","qwen/qwen-max","qwen/qwen-plus","qwen/qwen-turbo","qwen/qwen3-14b","qwen/qwen3-235b-a22b","qwen/qwen3-32b","qwen/qwen3-8b","qwen/qwq-32b","x-ai/grok-2-1212","x-ai/grok-3","x-ai/grok-3-beta","x-ai/grok-3-mini","x-ai/grok-3-mini-beta","x-ai/grok-4"];class r{constructor(){t(this,"LITELLM_URL","https://raw.githubusercontent.com/BerriAI/litellm/main/model_prices_and_context_window.json")}async refreshAll(){(await Promise.allSettled([this.refreshLiteLLM(),this.refreshOllama(),this.refreshOpenRouter()])).forEach((e,t)=>{"rejected"===e.status&&console.warn(`Model source ${t} failed:`,e.reason)})}async refreshLiteLLM(){try{const e=await fetch(this.LITELLM_URL);if(!e.ok)throw new Error(`HTTP ${e.status}`);const t=await e.json();await this.processLiteLLMData(t)}catch(e){console.error("Failed to refresh LiteLLM:",e)}}async processLiteLLMData(e){const t=[],i=new Date,r={openai:["openai-chat","openai-responses"],anthropic:["anthropic"]};for(const[o,n]of Object.entries(e)){const e=n.litellm_provider;if(e&&r[e])for(const s of r[e]){if(("openai-chat"===s||"openai-responses"===s)&&o.match(/(ft|image|dall|embedding|moderation|whisper|tts|transcribe|audio|realtime|search)/i))continue;const e=a.getProvider(s);if(!e)continue;const r=e.modelRules.find(e=>new RegExp(e.pattern).test(o));if(!r)continue;const l=this.extractCapabilities(o,n);t.push({id:`${s}:${o}`,provider:s,modelId:o,displayName:o,enabled:!0,source:"litellm",discoveredAt:i,modifiedAt:i,...l,parameterRules:r?{allows:"*",requires:r.requiredParams||[],forbids:r.forbidden||[],defaults:{}}:void 0,capabilities:l,userModified:!1})}}await o.models.bulkPut(t),t.length}async refreshOllama(){try{const e=await o.settings.get("main"),t=e?.customBaseUrls["ollama-chat"]||"http://localhost:11434",i=await fetch(`${t}/api/tags`,{signal:AbortSignal.timeout(3e3)});if(!i.ok)return;const r=await i.json(),n=[],s=new Date;for(const o of r.models||[])for(const e of["ollama-chat","ollama-generate"]){const t=a.getProvider(e);if(!t)continue;const i=t.modelRules.find(e=>new RegExp(e.pattern).test(o.name));n.push({id:`${e}:${o.name}`,provider:e,modelId:o.name,displayName:o.name,enabled:!0,source:"ollama",discoveredAt:s,modifiedAt:s,parameterRules:i?{allows:"*",requires:i.requiredParams||[],forbids:i.forbidden||[],defaults:{}}:void 0,capabilities:{inputCostPerToken:0,outputCostPerToken:0},userModified:!1})}await o.models.bulkPut(n),n.length}catch(e){}}async refreshOpenRouter(){try{const e=0===await o.models.where("provider").equals("openrouter").count(),t=new Set(i),r=await fetch("https://openrouter.ai/api/v1/models");if(!r.ok)throw new Error(`HTTP ${r.status}`);const n=await r.json(),s=[],l=new Date,p=a.getProvider("openrouter");if(!p)return;for(const o of n.data||[]){const a=p.modelRules.find(e=>new RegExp(e.pattern).test(o.id)),i=parseFloat(o.pricing?.prompt||"0"),r=parseFloat(o.pricing?.completion||"0"),n=e&&t.has(o.id);s.push({id:`openrouter:${o.id}`,provider:"openrouter",modelId:o.id,displayName:o.id,enabled:n,source:"openrouter",discoveredAt:l,modifiedAt:l,capabilities:{contextWindow:o.context_length||4096,maxTokens:o.top_provider?.max_completion_tokens,inputCostPerToken:i,outputCostPerToken:r,supportsJsonMode:o.supported_parameters?.includes("response_format")||!1,supportsFunctionCalling:o.supported_parameters?.includes("tools")||!1,supportsStreaming:!0},parameterRules:a?{allows:"*",requires:a.requiredParams||[],forbids:a.forbidden||[],defaults:{}}:void 0,userModified:!1})}await o.models.bulkPut(s),s.length}catch(e){console.error("Failed to fetch OpenRouter models:",e)}}async enableOpenRouterFavorites(){try{const e=new Set(i),t=(await o.models.where("provider").equals("openrouter").toArray()).map(t=>({key:t.id,changes:{enabled:e.has(t.modelId),modifiedAt:new Date}}));await o.models.bulkUpdate(t),e.size}catch(e){throw console.error("Failed to enable OpenRouter favorites:",e),e}}extractCapabilities(e,t){return{contextWindow:t.max_input_tokens||t.max_tokens,maxTokens:t.max_tokens,maxInputTokens:t.max_input_tokens,maxOutputTokens:t.max_output_tokens||t.max_tokens,inputCostPerToken:t.input_cost_per_token?parseFloat(t.input_cost_per_token):0,outputCostPerToken:t.output_cost_per_token?parseFloat(t.output_cost_per_token):0,supportsFunctionCalling:t.supports_function_calling||!1,supportsVision:t.supports_vision||!1,supportsParallelFunctionCalling:t.supports_parallel_function_calling||!1,supportsResponseSchema:t.supports_response_schema||!1,supportsJsonMode:this.inferJsonModeSupport(e,t),supportsStreaming:"bedrock"!==t.litellm_provider}}inferJsonModeSupport(e,t){return"openai"===t.litellm_provider&&(e.includes("gpt-4")||e.includes("gpt-3.5-turbo"))}}const n=new r;export{r as ModelDiscovery,n as modelDiscovery};
