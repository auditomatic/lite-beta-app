const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-COu0csOc.js","./vendor-CdfxntmD.js","./db-CL8uhZCz.js","./index-C3dOhsog.css"])))=>i.map(i=>d[i]);
import{u as e}from"./useLiveData-D-xinmMz.js";import{J as a,a6 as t,l as s,p as l,_ as o,m as n,a7 as r,n as i,d,y as u}from"./index-COu0csOc.js";import{r as p,C as c}from"./api-key-redactor-C-kHvaBo.js";import{f as m,V as v,d as g,r as f,o as y,c as h,w as b,ab as k,a1 as _,k as x,Z as C,$ as w,_ as P,a0 as $,Y as F,F as I,ac as L,G as A,a3 as E,af as j,ag as R,a4 as M,q as O,u as S,A as D}from"./vendor-CdfxntmD.js";import{T as z}from"./TemplateEditor-0N5BOzn-.js";import{G as V}from"./GenericModelSelectorModalV2-BJG2ctZj.js";import{M as N}from"./ModelCostDisplayV2-Dyx8rAYg.js";import{t as T}from"./token-calculation.service-DxLNJTZv.js";import"./db-CL8uhZCz.js";import"./useLiveDataSingle-X0OuE1-_.js";import"./cost-formatting-DSpbVMtV.js";import"./variable.service-p5oZZ_-F.js";const U={class:"parameter-panel"},q={class:"panel-content"},W={key:0,class:"params-section"},H={key:0,class:"reasoning-warning"},J={key:5,class:"param-description"},B={key:4,class:"param-description"},K={key:2,class:"params-section"},G={class:"logprobs-controls"},Y={class:"panel-actions"},X=o(g({__name:"ParameterPanel",props:{model:{},modelValue:{}},emits:["update:modelValue","change"],setup(e,{emit:a}){const t=e,o=a,n=f({}),r=m(!1),i=m(3),d=m(!1);y(async()=>{try{await l.waitForReady(),d.value=!0,s.debug("Provider registry ready in ParameterPanel")}catch(e){s.error("Failed to initialize provider registry",e)}});const u=h(()=>{if(!t.model||!d.value)return{};const e=l.getParametersForModel(t.model.provider,t.model.modelId),a={},s=(e,t="")=>{Object.entries(e).forEach(([e,l])=>{const o=t?`${t}.${e}`:e;"object"===l.type&&l.properties?s(l.properties,o):a[o]=l})};s(e);const o={};for(const[t,l]of Object.entries(a))l.basic&&(o[t]=l);const n={},r=o.temperature?"temperature":o["options.temperature"]?"options.temperature":null;r&&(n[r]=o[r]);for(const[t,l]of Object.entries(o))t!==r&&(n[t]=l);return n}),p=h(()=>{if(!t.model||!d.value)return{};const e=l.getParametersForModel(t.model.provider,t.model.modelId),a={},s=(e,t="")=>{Object.entries(e).forEach(([e,l])=>{const o=t?`${t}.${e}`:e;"object"===l.type&&l.properties?s(l.properties,o):a[o]=l})};s(e);const o={};for(const[t,l]of Object.entries(a))l.basic||(o[t]=l);return o}),c=h(()=>!!t.model&&(("openai-chat"===t.model.provider||"openai-responses"===t.model.provider)&&t.model.modelId.match(/^o[0-9]/))),v=h(()=>!(!t.model||!d.value)&&l.supportsLogprobs(t.model.provider,t.model.modelId)),g=h(()=>t.model&&d.value?l.getLogprobsParameters(t.model.provider,t.model.modelId):{}),j=h(()=>!!g.value.topLogprobs);function R(e,a){n[e]=a,o("update:modelValue",{...n}),o("change",{...n})}function M(e){return e.replace(/\./g," › ").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}function O(e){r.value=e,D()}function S(e){i.value=e||3,D()}function D(){const e=g.value;if(Object.keys(n).forEach(e=>{(e.includes("logprobs")||"include"===e)&&delete n[e]}),r.value){if(e.enableParams)for(const a of e.enableParams)if("boolean"===a.type)if(a.name.includes(".")){const e=a.name.split(".");let t=n;for(let a=0;a<e.length-1;a++)t[e[a]]||(t[e[a]]={}),t=t[e[a]];t[e[e.length-1]]=a.value}else n[a.name]=a.value;else"array"===a.type&&(n[a.name]||(n[a.name]=[]),n[a.name].includes(a.value)||n[a.name].push(a.value));if(e.topLogprobs)if(e.topLogprobs.includes(".")){const a=e.topLogprobs.split(".");let t=n;for(let e=0;e<a.length-1;e++)t[a[e]]||(t[a[e]]={}),t=t[a[e]];t[a[a.length-1]]=i.value}else n[e.topLogprobs]=i.value}else if(e.enableParams)for(const a of e.enableParams)"array"===a.type&&n[a.name]&&(n[a.name]=n[a.name].filter(e=>e!==a.value),0===n[a.name].length&&delete n[a.name]);o("update:modelValue",{...n}),o("change",{...n})}function z(){if(!t.model||!d.value)return;Object.keys(n).forEach(e=>delete n[e]);const e=l.supportsLogprobs(t.model.provider,t.model.modelId);r.value=e,i.value=3;const a=(e,t="")=>{Object.entries(e).forEach(([e,s])=>{const l=t?`${t}.${e}`:e;"object"===s.type&&s.properties?a(s.properties,l):void 0!==s.default&&(n[l]=s.default)})},s=l.getParametersForModel(t.model.provider,t.model.modelId);a(s),e&&D(),o("update:modelValue",{...n}),o("change",{...n})}return b(()=>t.model,e=>{if(e){const a=l.supportsLogprobs(e.provider,e.modelId);r.value=a,i.value=3,z(),a&&D()}},{immediate:!0}),b(()=>t.modelValue,e=>{Object.assign(n,e)},{immediate:!0,deep:!0}),(e,a)=>{const t=C("a-alert"),s=C("a-input-number"),l=C("a-switch"),o=C("a-select-option"),d=C("a-select"),m=C("a-input"),g=C("a-form-item"),f=C("a-collapse-panel"),y=C("a-collapse"),h=C("a-button"),b=C("a-form");return P(),k("div",U,[a[6]||(a[6]=_("div",{class:"panel-header"},[_("h3",null,"Parameters")],-1)),_("div",q,[x(b,{layout:"vertical"},{default:w(()=>[Object.keys(u.value).length>0?(P(),k("div",W,[a[1]||(a[1]=_("h4",null,"Basic Parameters",-1)),c.value?(P(),k("div",H,[x(t,{message:"O* reasoning models do not support temperature",type:"info",size:"small","show-icon":"",closable:!1})])):$("",!0),(P(!0),k(I,null,L(u.value,(e,t)=>(P(),F(g,{key:t,label:M(t)},{default:w(()=>["number"===e.type?(P(),F(s,{key:0,value:n[t],onChange:e=>R(t,e),min:e.min,max:e.max,step:e.step||.1,placeholder:String(e.default),size:"large",style:{width:"100%"}},null,8,["value","onChange","min","max","step","placeholder"])):"integer"===e.type?(P(),F(s,{key:1,value:n[t],onChange:e=>R(t,e),min:e.min,max:e.max,placeholder:String(e.default),size:"large",style:{width:"100%"}},null,8,["value","onChange","min","max","placeholder"])):"boolean"===e.type?(P(),F(l,{key:2,checked:n[t],onChange:e=>R(t,e),"checked-children":"true","un-checked-children":"false"},null,8,["checked","onChange"])):"string"===e.type&&e.enum?(P(),F(d,{key:3,value:n[t],onChange:e=>R(t,e),placeholder:e.default?String(e.default):"<not set>",size:"large",style:{width:"100%"},allowClear:""},{default:w(()=>[x(o,{value:void 0},{default:w(()=>a[0]||(a[0]=[_("span",{style:{color:"#999"}},"<not set>",-1)])),_:1,__:[0]}),(P(!0),k(I,null,L(e.enum,e=>(P(),F(o,{key:e,value:e},{default:w(()=>[A(E(e),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onChange","placeholder"])):(P(),F(m,{key:4,value:n[t],onChange:e=>R(t,e.target.value),placeholder:String(e.default),size:"large"},null,8,["value","onChange","placeholder"])),e.description?(P(),k("div",J,E(e.description),1)):$("",!0)]),_:2},1032,["label"]))),128))])):$("",!0),Object.keys(p.value).length>0?(P(),F(y,{key:1,ghost:""},{default:w(()=>[x(f,{key:"advanced",header:"Advanced Parameters"},{default:w(()=>[(P(!0),k(I,null,L(p.value,(e,t)=>(P(),F(g,{key:t,label:M(t)},{default:w(()=>["number"===e.type||"integer"===e.type?(P(),F(s,{key:0,value:n[t],onChange:e=>R(t,e),min:e.min,max:e.max,step:"number"===e.type?e.step||.1:1,placeholder:String(e.default),size:"large",style:{width:"100%"}},null,8,["value","onChange","min","max","step","placeholder"])):"boolean"===e.type?(P(),F(l,{key:1,checked:n[t],onChange:e=>R(t,e),"checked-children":"true","un-checked-children":"false"},null,8,["checked","onChange"])):"string"===e.type&&e.enum?(P(),F(d,{key:2,value:n[t],onChange:e=>R(t,e),placeholder:e.default?String(e.default):"<not set>",size:"large",style:{width:"100%"},allowClear:""},{default:w(()=>[x(o,{value:void 0},{default:w(()=>a[2]||(a[2]=[_("span",{style:{color:"#999"}},"<not set>",-1)])),_:1,__:[2]}),(P(!0),k(I,null,L(e.enum,e=>(P(),F(o,{key:e,value:e},{default:w(()=>[A(E(e),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onChange","placeholder"])):(P(),F(m,{key:3,value:n[t],onChange:e=>R(t,e.target.value),placeholder:String(e.default),size:"large"},null,8,["value","onChange","placeholder"])),e.description?(P(),k("div",B,E(e.description),1)):$("",!0)]),_:2},1032,["label"]))),128))]),_:1})]),_:1})):$("",!0),v.value?(P(),k("div",K,[a[4]||(a[4]=_("h4",null,"Log Probabilities",-1)),_("div",G,[x(g,{label:"Enable Logprobs"},{default:w(()=>[x(l,{checked:r.value,onChange:O,"checked-children":"On","un-checked-children":"Off"},null,8,["checked"])]),_:1}),r.value&&j.value?(P(),F(g,{key:0,label:"Top Alternatives"},{default:w(()=>[x(s,{value:i.value,onChange:S,min:0,max:20,size:"large",style:{width:"100%"},placeholder:"3"},null,8,["value"]),a[3]||(a[3]=_("div",{class:"param-description"}," Number of alternative tokens to show (0-20) ",-1))]),_:1,__:[3]})):$("",!0)])])):$("",!0),_("div",Y,[x(h,{onClick:z,size:"small"},{default:w(()=>a[5]||(a[5]=[A(" Reset to Defaults ")])),_:1,__:[5]})])]),_:1})])])}}}),[["__scopeId","data-v-556aa9fa"]]),Q={class:"logprobs-display"},Z={key:0,class:"color-legend"},ee={key:1,class:"tokens-container"},ae=["onMouseenter"],te={key:2,class:"regular-text"},se={class:"tooltip-header"},le={class:"token-text"},oe={class:"token-probability"},ne={key:0,class:"alternatives"},re={class:"alt-text"},ie={class:"alt-probability"},de={class:"logprob-raw"},ue=o(g({__name:"LogprobsDisplay",props:{text:{},logprobsData:{}},setup(e){const a=e,t=m({visible:!1,token:{text:"",logprob:0},style:{}}),s=h(()=>a.logprobsData?a.logprobsData.map(e=>({text:e.token,logprob:e.logprob,bytes:e.bytes,topLogprobs:e.top_logprobs})):[]),l=["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#abd9e9","#74add1","#4575b4","#313695"];function o(e){const a=100*Math.exp(e.logprob),t=Math.min(Math.floor(a/(100/(l.length-1))),l.length-1);return{color:l[t],cursor:"pointer",transition:"all 0.2s ease"}}function n(e){return(100*Math.exp(e)).toFixed(2)}function r(){t.value.visible=!1}return(e,a)=>(P(),k("div",Q,[s.value.length>0?(P(),k("div",Z,a[1]||(a[1]=[j('<span class="legend-label" data-v-07949b98>Token Confidence:</span><div class="legend-gradient" data-v-07949b98><span class="legend-low" data-v-07949b98>Low</span><div class="gradient-bar" data-v-07949b98></div><span class="legend-high" data-v-07949b98>High</span></div>',2)]))):$("",!0),s.value.length>0?(P(),k("div",ee,[(P(!0),k(I,null,L(s.value,(e,s)=>(P(),k("span",{key:`token-${s}-${e.text}`,class:"token",style:R(o(e)),onMouseenter:a=>function(e,a,s){t.value={visible:!0,token:e,style:{position:"fixed",left:`${s.clientX+10}px`,top:s.clientY-10+"px",zIndex:"1000"}}}(e,0,a),onMouseleave:r,onMousemove:a[0]||(a[0]=e=>{return a=e,void(t.value.visible&&(t.value.style={...t.value.style,left:`${a.clientX+10}px`,top:a.clientY-10+"px"}));var a})},E(e.text),45,ae))),128))])):(P(),k("div",te,E(e.text),1)),t.value.visible?(P(),k("div",{key:3,class:"token-tooltip",style:R(t.value.style)},[_("div",se,[_("span",le,'"'+E(t.value.token.text)+'"',1),_("span",oe,E(n(t.value.token.logprob))+"%",1)]),t.value.token.topLogprobs&&t.value.token.topLogprobs.length>0?(P(),k("div",ne,[a[2]||(a[2]=_("div",{class:"alternatives-header"},"Alternative tokens:",-1)),(P(!0),k(I,null,L(t.value.token.topLogprobs?.slice(0,5),(e,a)=>(P(),k("div",{key:`alt-${a}-${e.token}`,class:"alternative-token"},[_("span",re,'"'+E(e.token)+'"',1),_("span",ie,E(n(e.logprob))+"%",1)]))),128))])):$("",!0),_("div",de," Raw logprob: "+E(t.value.token.logprob.toFixed(6)),1)],4)):$("",!0)]))}}),[["__scopeId","data-v-07949b98"]]),pe={class:"feature-content-renderer"},ce={key:0,class:"reasoning-content"},me={class:"reasoning-text"},ve={key:1,class:"tool-calls-content"},ge={class:"tool-call-header"},fe={class:"tool-name"},ye={class:"tool-type"},he={class:"tool-call-arguments"},be={key:2,class:"search-results-content"},ke={class:"search-result-title"},_e={class:"search-result-snippet"},xe={key:0,class:"search-result-url"},Ce=["href"],we={key:3,class:"images-content"},Pe={class:"image-gallery"},$e=["src","alt","onClick"],Fe={key:1,class:"image-caption"},Ie={key:4,class:"array-content"},Le={key:0},Ae={key:1},Ee={key:5,class:"object-content"},je={key:6,class:"text-content"},Re=o(g({__name:"FeatureContentRenderer",props:{featureName:{},content:{},config:{}},setup(e){function a(e){if(!e)return"";if("string"==typeof e)try{return JSON.stringify(JSON.parse(e),null,2)}catch{return e}return JSON.stringify(e,null,2)}return(e,t)=>(P(),k("div",pe,["reasoning"===e.featureName&&"string"==typeof e.content?(P(),k("div",ce,[_("pre",me,E(e.content),1)])):"tool_calls"===e.featureName&&Array.isArray(e.content)?(P(),k("div",ve,[(P(!0),k(I,null,L(e.content,(e,t)=>(P(),k("div",{key:`tool-call-${t}-${e.name||e.function?.name}`,class:"tool-call-item"},[_("div",ge,[_("span",fe,E(e.name||e.function?.name||"Unknown Tool"),1),_("span",ye,E(e.type||"function"),1)]),_("div",he,[_("pre",null,E(a(e.arguments||e.function?.arguments)),1)])]))),128))])):"search_results"===e.featureName&&Array.isArray(e.content)?(P(),k("div",be,[(P(!0),k(I,null,L(e.content,(e,a)=>(P(),k("div",{key:`search-result-${a}-${e.title||e.url}`,class:"search-result-item"},[_("div",ke,E(e.title||`Result ${a+1}`),1),_("div",_e,E(e.snippet||e.content),1),e.url?(P(),k("div",xe,[_("a",{href:e.url,target:"_blank",rel:"noopener"},E(e.url),9,Ce)])):$("",!0)]))),128))])):"images"===e.featureName&&Array.isArray(e.content)?(P(),k("div",we,[_("div",Pe,[(P(!0),k(I,null,L(e.content,(e,a)=>(P(),k("div",{key:`image-${a}-${e.url||e.image_url}`,class:"image-item"},[e.url||e.image_url?(P(),k("img",{key:0,src:e.url||e.image_url,alt:e.alt||`Image ${a+1}`,onClick:a=>function(e){s.info("Show image modal:",e)}(e)},null,8,$e)):$("",!0),e.caption?(P(),k("div",Fe,E(e.caption),1)):$("",!0)]))),128))])])):Array.isArray(e.content)?(P(),k("div",Ie,[(P(!0),k(I,null,L(e.content,(e,t)=>(P(),k("div",{key:`array-item-${t}-${"object"==typeof e?JSON.stringify(e).substring(0,50):e}`,class:"array-item"},["object"==typeof e?(P(),k("div",Le,[_("pre",null,E(a(e)),1)])):(P(),k("div",Ae,E(e),1))]))),128))])):"object"==typeof e.content?(P(),k("div",Ee,[_("pre",null,E(a(e.content)),1)])):(P(),k("div",je,E(e.content),1))]))}}),[["__scopeId","data-v-b34d2904"]]),Me={key:0,class:"feature-display-container"},Oe={class:"feature-header"},Se={key:0,class:"feature-icon"},De={class:"feature-label"},ze={key:1,class:"feature-static"},Ve={class:"feature-header"},Ne={key:0,class:"feature-icon"},Te={class:"feature-label"},Ue=o(g({__name:"FeatureDisplay",props:{features:{},provider:{}},setup(e){const a=e,t=m(!1);y(async()=>{try{await l.waitForReady(),t.value=!0,s.debug("Provider registry ready in FeatureDisplay")}catch(e){s.error("Failed to initialize provider registry",e)}});const o=h(()=>a.provider&&t.value&&l.getResponseFeatures(a.provider)||{});function n(e){return o.value[e]}function r(e){return e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}return(e,a)=>{const t=C("a-collapse-panel"),s=C("a-collapse");return e.features&&e.features.size>0?(P(),k("div",Me,[(P(!0),k(I,null,L(e.features,([e,a])=>(P(),k("div",{key:e,class:M(["feature-item",[`position-${n(e)?.displayConfig.position||"after-content"}`]])},[!1!==n(e)?.displayConfig.collapsible?(P(),F(s,{key:0,"default-active-key":n(e)?.displayConfig.defaultCollapsed?[]:[e],ghost:""},{default:w(()=>[(P(),F(t,{key:e},{header:w(()=>[_("div",Oe,[n(e)?.displayConfig.icon?(P(),k("span",Se,E(n(e)?.displayConfig.icon),1)):$("",!0),_("span",De,E(n(e)?.displayConfig.label||r(e)),1)])]),default:w(()=>[_("div",{class:M(["feature-content",[`styling-${n(e)?.displayConfig.styling||"standard"}`]]),style:R({maxHeight:n(e)?.displayConfig.maxHeight||"none"})},[x(Re,{"feature-name":e,content:a,config:n(e)},null,8,["feature-name","content","config"])],6)]),_:2},1024))]),_:2},1032,["default-active-key"])):(P(),k("div",ze,[_("div",Ve,[n(e)?.displayConfig.icon?(P(),k("span",Ne,E(n(e)?.displayConfig.icon),1)):$("",!0),_("span",Te,E(n(e)?.displayConfig.label||r(e)),1)]),_("div",{class:M(["feature-content",[`styling-${n(e)?.displayConfig.styling||"standard"}`]]),style:R({maxHeight:n(e)?.displayConfig.maxHeight||"none"})},[x(Re,{"feature-name":e,content:a,config:n(e)},null,8,["feature-name","content","config"])],6)]))],2))),128))])):$("",!0)}}}),[["__scopeId","data-v-7b3f3ea8"]]),qe={class:"response-display"},We={key:0,class:"loading-state"},He={key:1,class:"error-state"},Je={class:"error-details"},Be={key:2,class:"response-content"},Ke={class:"response-text"},Ge={class:"expand-icon"},Ye={class:"metadata-content"},Xe={class:"metadata-grid"},Qe={class:"metadata-item"},Ze={class:"value"},ea={key:0,class:"metadata-item"},aa={class:"value"},ta={key:1,class:"metadata-item"},sa={class:"value"},la={class:"cost-amount"},oa={class:"cost-amount"},na={class:"cost-amount"},ra={class:"metadata-item"},ia={class:"value env-costs"},da={class:"env-item"},ua={class:"env-item"},pa={class:"env-item"},ca={class:"raw-response"},ma={class:"raw-response"},va={key:3,class:"empty-state"},ga=o(g({__name:"ResponseDisplay",props:{response:{},isLoading:{type:Boolean},error:{}},setup(e){const a=e,t=n(),o=m(!1),d=m(!1);y(async()=>{try{await l.waitForReady(),d.value=!0,s.debug("Provider registry ready in ResponseDisplay")}catch(e){s.error("Failed to initialize provider registry",e)}});const u=h(()=>!(!a.response?.features||!a.response.model)&&v("before-content").size>0),p=h(()=>!(!a.response?.features||!a.response.model)&&v("after-content").size>0);function v(e){if(!a.response?.features||!a.response.model||!d.value)return new Map;const t=l.getResponseFeatures(a.response.model.provider);if(!t)return new Map;const s=new Map;for(const[l,o]of a.response.features){const a=t[l];a?.displayConfig.position===e&&s.set(l,o)}return s}function g(e){return e<1e-4?e.toFixed(6):e<.01?e.toFixed(4):e.toFixed(3)}function f(e){if(!e)return"No raw response data";try{return JSON.stringify(e,null,2)}catch{return String(e)}}function b(e){if(!e)return"No error details available";try{return JSON.stringify(e,null,2)}catch{return String(e)}}function I(e,s){if(!t.environmentalCostsEnabled)return"??";if(!a.response?.model)return"-";if(!i.hasDataForModel(a.response.model.provider,a.response.model.modelId))return"-";const l=s||0;if(0===l)return"-";const o=i.calculateEnvironmentalCostUnsafe(a.response.model.provider,a.response.model.modelId,l)[e];if(0===o)return"-";switch(e){case"carbon":return o<.001?"<1μg":o<1?`${(1e3*o).toFixed(0)}μg`:o<1e3?`${o.toFixed(1)}mg`:`${(o/1e3).toFixed(1)}g`;case"water":return o<.001?"<1nL":o<1?`${(1e3*o).toFixed(0)}nL`:o<1e3?`${o.toFixed(1)}μL`:`${(o/1e3).toFixed(1)}mL`;case"energy":return o<.001?"<1μWh":o<1?`${(1e3*o).toFixed(0)}μWh`:o<1e3?`${o.toFixed(1)}mWh`:`${(o/1e3).toFixed(1)}Wh`;default:return"-"}}return(e,a)=>{const t=C("a-spin"),s=C("a-alert"),l=C("a-collapse-panel"),n=C("a-collapse");return P(),k("div",qe,[e.isLoading?(P(),k("div",We,[x(t,{size:"large"},{tip:w(()=>a[1]||(a[1]=[A("Generating response...")])),_:1})])):e.error?(P(),k("div",He,[x(s,{type:"error",message:e.error.message||"API Error",description:e.error.details,"show-icon":""},null,8,["message","description"]),e.error.response?(P(),F(n,{key:0,ghost:"",style:{"margin-top":"16px"}},{default:w(()=>[x(l,{key:"details",header:"Full API Request/Response"},{default:w(()=>[_("pre",Je,E(b(e.error.response)),1)]),_:1})]),_:1})):$("",!0)])):e.response?(P(),k("div",Be,[u.value?(P(),F(Ue,{key:0,features:v("before-content"),provider:e.response.model?.provider,class:"features-before"},null,8,["features","provider"])):$("",!0),_("div",Ke,[x(ue,{text:e.response.content,"logprobs-data":e.response.logprobs},null,8,["text","logprobs-data"])]),p.value?(P(),F(Ue,{key:1,features:v("after-content"),provider:e.response.model?.provider,class:"features-after"},null,8,["features","provider"])):$("",!0),_("div",{class:M(["response-metadata",{expanded:o.value}])},[_("h3",{class:"metadata-header",onClick:a[0]||(a[0]=e=>o.value=!o.value)},[_("span",Ge,[o.value?(P(),F(S(r),{key:1})):(P(),F(S(c),{key:0}))]),a[2]||(a[2]=A(" Response Details "))]),O(_("div",Ye,[_("div",Xe,[_("div",Qe,[a[3]||(a[3]=_("span",{class:"label"},"Latency:",-1)),_("span",Ze,E(e.response.latency)+"ms",1)]),e.response.tokens?(P(),k("div",ea,[a[4]||(a[4]=_("span",{class:"label"},"Token Usage:",-1)),_("span",aa,E(e.response.tokens.prompt_tokens||"?")+" input + "+E(e.response.tokens.completion_tokens||"?")+" output = "+E(e.response.tokens.total_tokens||"?")+" total tokens ",1)])):$("",!0),e.response.cost?(P(),k("div",ta,[a[8]||(a[8]=_("span",{class:"label"},"Cost Estimate:",-1)),_("span",sa,[_("span",la,"$"+E(g(e.response.cost.input)),1),a[5]||(a[5]=A(" input + ")),_("span",oa,"$"+E(g(e.response.cost.output)),1),a[6]||(a[6]=A(" output = ")),_("span",na,"$"+E(g(e.response.cost.total)),1),a[7]||(a[7]=A(" total "))])])):$("",!0),_("div",ra,[a[9]||(a[9]=_("span",{class:"label"},"Environmental:",-1)),_("span",ia,[_("span",da,"CO₂ 🏭: "+E(I("carbon",e.response.tokens?.total_tokens))+"  ",1),_("span",ua,"Water 💧: "+E(I("water",e.response.tokens?.total_tokens))+"  ",1),_("span",pa,"Energy ⚡: "+E(I("energy",e.response.tokens?.total_tokens)),1)])])]),x(n,{ghost:"",style:{"margin-top":"16px"}},{default:w(()=>[x(l,{key:"raw",header:"Raw API Response"},{default:w(()=>[_("pre",ca,E(f(e.response.raw)),1)]),_:1})]),_:1}),e.response.debug?(P(),F(n,{key:0,ghost:"",style:{"margin-top":"8px"}},{default:w(()=>[x(l,{key:"debug",header:"API Request Details"},{default:w(()=>[_("pre",ma,E(f(e.response.debug)),1)]),_:1})]),_:1})):$("",!0)],512),[[D,o.value]])],2)])):(P(),k("div",va,a[10]||(a[10]=[_("div",{class:"empty-content"},[_("div",{class:"empty-icon"},"💬"),_("p",null,"Response will appear here after running a prompt")],-1)])))])}}}),[["__scopeId","data-v-66478036"]]),fa={class:"playground-view","data-testid":"page-playground"},ya={class:"page-header"},ha={class:"header-actions"},ba={key:0,class:"cost-estimate"},ka={class:"cost-tooltip"},_a={class:"playground-content"},xa={class:"left-panel"},Ca={class:"panel-section"},wa={key:0,class:"model-info"},Pa={class:"info-header"},$a={class:"model-name"},Fa={class:"provider-badge"},Ia={key:0,class:"info-details"},La={class:"detail-item"},Aa={class:"value"},Ea={class:"detail-item"},ja={class:"value"},Ra={class:"dollar-amount"},Ma={class:"detail-item"},Oa={class:"value"},Sa={class:"dollar-amount"},Da={class:"detail-item"},za={class:"value"},Va={class:"detail-item"},Na={class:"value"},Ta={class:"detail-item"},Ua={class:"value"},qa={class:"panel-section"},Wa={class:"action-buttons"},Ha={key:0,class:"panel-section"},Ja={class:"template-buttons"},Ba={class:"center-panel"},Ka={class:"prompt-section"},Ga={class:"section-header"},Ya={class:"character-count"},Xa={key:0,class:"response-section"},Qa={class:"section-header"},Za={key:0,class:"response-meta"},et={class:"response-container"},at={key:0,class:"right-panel"},tt={class:"design-list"},st=["onClick"],lt={class:"design-name"},ot={class:"design-description"},nt={class:"design-preview"},rt={class:"design-type"},it=o(g({__name:"PlaygroundView",setup(l){const{data:o}=e(()=>d.templatePrompts.toArray(),{debounce:100}),{data:n}=e(()=>d.spreadsheetPrompts.toArray(),{debounce:100}),{data:r}=e(async()=>{const e=await d.settings.get("main");return e?[e]:[]},{debounce:100}),c=h(()=>r.value?.[0]),{data:g}=e(()=>d.models.where("enabled").equals(1).toArray(),{debounce:100}),f=h(()=>[...(o.value||[]).map(e=>({id:e.id,name:e.name,description:e.description,text:e.template,type:"template"})),...(n.value||[]).map(e=>({id:e.id,name:e.name,description:e.description,text:e.promptPattern,type:"spreadsheet"}))]),b=m(null),F=m(""),j=m({}),R=m(!1),M=m(!1),O=m(!1),{isExecuting:D,lastResponse:U,lastError:q,executePrompt:W}=function(){const e=m(!1),l=m(null),o=m(null),n=m([]);return{isExecuting:v(e),lastResponse:v(l),lastError:v(o),executionHistory:v(n),executePrompt:async function(r){if(e.value)throw new Error("Execution already in progress");e.value=!0,l.value=null,o.value=null;const i={timestamp:new Date,model:`${r.model.provider}:${r.model.modelId}`,prompt:r.prompt,parameters:{...r.parameters}};try{const{APICallExecutor:e}=await a(async()=>{const{APICallExecutor:e}=await import("./index-COu0csOc.js").then(e=>e.am);return{APICallExecutor:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),o=new e({getApiKey:r.getApiKey,getBaseUrl:r.getBaseUrl}),n={id:Date.now().toString(),variables:{},prompt:r.prompt,status:"pending",created:new Date},{providerRegistry:d}=await a(async()=>{const{providerRegistry:e}=await import("./index-COu0csOc.js").then(e=>e.aj);return{providerRegistry:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),u=d.getProvider(r.model.provider),c={provider:r.model.provider,modelId:r.model.modelId,name:r.model.displayName,parameters:r.parameters,providerSnapshot:u||{},modelSnapshot:r.model},m=Date.now(),v=await o.executeAPICall(n,c),g=v.response?.latencyMs||Date.now()-m,f=v.response?.body;if(!v.response||v.response.status>=400){const e=new Error(v.result?.error||"API request failed");throw e.fullResponse={request:v.request,response:v.response},e}const y=v.result?.content||f?.choices?.[0]?.message?.content||"",{parameterAdapter:h}=await a(async()=>{const{parameterAdapter:e}=await import("./index-COu0csOc.js").then(e=>e.al);return{parameterAdapter:e}},__vite__mapDeps([0,1,2,3]),import.meta.url),b=h.extractUsageInfo(r.model.provider,f);let k,_;if(d.supportsLogprobs(r.model.provider,r.model.modelId)&&f){const e=d.getLogprobsParameters(r.model.provider,r.model.modelId);let a=!1;if(e.enableParams)for(const t of e.enableParams)if("boolean"===t.type&&r.parameters[t.name]===t.value){a=!0;break}if(a){const e=d.getLogprobsResponsePath(r.model.provider);e&&(k=t.getValueAtPath(f,e))}}if(r.model.capabilities&&(b.prompt_tokens||b.completion_tokens)){const e=b.prompt_tokens||0,a=b.completion_tokens||0,t=(r.model.capabilities.inputCostPerToken||0)*e,s=(r.model.capabilities.outputCostPerToken||0)*a;_={input:t,output:s,total:t+s}}const x={content:y,latency:g,tokens:b,cost:_,logprobs:k,features:new Map,raw:f,debug:{request:v.request?{url:v.request.url,method:v.request.method,headers:p({headers:v.request.headers},r.model.provider).headers,body:v.request.body}:void 0,response:v.response?{status:v.response.status,statusText:"OK",headers:v.response.headers||{}}:void 0},model:r.model};l.value=x,i.response=x,s.info("Playground execution successful",{model:r.model.modelId,latency:g,tokens:b.total_tokens})}catch(d){const e={message:d instanceof Error?d.message:String(d),details:d instanceof Error?d.stack:void 0,response:d.fullResponse};throw o.value=e,i.error=e,s.error("Playground execution failed",d,{model:r.model.modelId,error:e.message,fullResponse:e.response}),d}finally{e.value=!1,n.value.unshift(i),n.value.length>10&&(n.value=n.value.slice(0,10))}},clearResults:function(){l.value=null,o.value=null},clearHistory:function(){n.value=[]}}}(),H=[{name:"Creative",prompt:"Write a creative short story about:"},{name:"Analysis",prompt:"Analyze the following text and provide insights:"},{name:"Explain",prompt:"Explain this concept in simple terms:"},{name:"Summarize",prompt:"Summarize the following content:"}],J=h(()=>b.value&&F.value.trim().length>0&&!D.value),B=h(()=>{if(!F.value)return 0;const e=Math.ceil(F.value.length/4);return s.debug("PlaygroundView estimated input token count",{tokenCount:e,promptLength:F.value.length}),e}),K=h(()=>{if(!b.value)return 256;const e=T.getOutputTokenLimit(b.value.provider,b.value.modelId,j.value);return s.debug("Output token limit",{provider:b.value.provider,modelId:b.value.modelId,parameters:j.value,limit:e}),e});function G(e){j.value={...e}}function Y(){R.value=!0}function Q(){F.value=""}function Z(e){b.value=e,M.value=!1,j.value={}}function ee(e){return e<.01?e.toFixed(4):e<1?e.toFixed(3):e.toFixed(2)}function ae(e){if(!b.value||!c.value?.environmentalCostsEnabled)return"??";if(!i.hasDataForModel(b.value.provider,b.value.modelId))return"-";const a=i.calculateEnvironmentalCostUnsafe(b.value.provider,b.value.modelId,1e3)[e];if(0===a)return"-";switch(e){case"carbon":return a<.001?"<1μg":a<1?`${(1e3*a).toFixed(0)}μg`:a<1e3?`${a.toFixed(1)}mg`:`${(a/1e3).toFixed(1)}g`;case"water":return a<.001?"<1nL":a<1?`${(1e3*a).toFixed(0)}nL`:a<1e3?`${a.toFixed(1)}μL`:`${(a/1e3).toFixed(1)}mL`;case"energy":return a<.001?"<1μWh":a<1?`${(1e3*a).toFixed(0)}μWh`:a<1e3?`${a.toFixed(1)}mWh`:`${(a/1e3).toFixed(1)}Wh`;default:return"-"}}async function te(){J.value&&b.value&&(O.value=!0,await W({model:b.value,prompt:F.value,parameters:j.value,getApiKey:e=>c.value?.apiKeys?.[e]||"",getBaseUrl:e=>c.value?.customBaseUrls?.[e]||""}))}return y(async()=>{setTimeout(()=>{g.value&&g.value.length>0&&(b.value=g.value[0])},100)}),(e,a)=>{const t=C("a-tooltip"),s=C("a-button"),l=C("a-modal");return P(),k("div",fa,[_("div",ya,[a[8]||(a[8]=_("div",{class:"header-content"},[_("h1",null,"LLM Playground"),_("p",{class:"description"},"Test prompts and explore model responses interactively")],-1)),_("div",ha,[b.value?(P(),k("div",ba,[x(t,{placement:"bottom"},{title:w(()=>[_("div",ka,[a[5]||(a[5]=_("div",null,"Cost estimate based on:",-1)),_("div",null,"• Input: "+E(B.value)+" tokens",1),_("div",null,"• Output: 10 - "+E(K.value)+" tokens",1),a[6]||(a[6]=_("div",null,"• Min assumes 10 token response",-1)),a[7]||(a[7]=_("div",null,"• Max assumes full response limit",-1))])]),default:w(()=>[x(S(u),{class:"info-icon"})]),_:1}),x(N,{model:b.value,mode:"range","input-tokens":B.value,"min-output-tokens":10,"max-output-tokens":K.value,layout:"inline",size:"medium"},null,8,["model","input-tokens","max-output-tokens"])])):$("",!0),x(s,{type:"primary",onClick:te,disabled:!J.value,loading:S(D)},{default:w(()=>[A(E(S(D)?"Running...":"Run"),1)]),_:1},8,["disabled","loading"])])]),_("div",_a,[_("div",xa,[_("div",Ca,[a[18]||(a[18]=_("h3",null,"Select Model",-1)),x(s,{type:"primary",size:"large",style:{width:"100%"},onClick:a[0]||(a[0]=e=>M.value=!0)},{default:w(()=>a[9]||(a[9]=[A(" Select Model ")])),_:1,__:[9]}),b.value?(P(),k("div",wa,[_("div",Pa,[_("span",$a,E(b.value.displayName),1),_("span",Fa,E(b.value.provider),1)]),b.value.capabilities?(P(),k("div",Ia,[_("div",La,[a[10]||(a[10]=_("span",{class:"label"},"Context:",-1)),_("span",Aa,E((o=b.value.capabilities.contextWindow,o?o>=1e6?(o/1e6).toFixed(1)+"M":o>=1e3?(o/1e3).toFixed(0)+"k":o.toString():"N/A"))+" tokens",1)]),_("div",Ea,[a[12]||(a[12]=_("span",{class:"label"},"Input:",-1)),_("span",ja,[_("span",Ra,"$"+E(ee(1e3*(b.value.capabilities.inputCostPerToken||0))),1),a[11]||(a[11]=A("/1k"))])]),_("div",Ma,[a[14]||(a[14]=_("span",{class:"label"},"Output:",-1)),_("span",Oa,[_("span",Sa,"$"+E(ee(1e3*(b.value.capabilities.outputCostPerToken||0))),1),a[13]||(a[13]=A("/1k"))])]),_("div",Da,[a[15]||(a[15]=_("span",{class:"label"},"CO₂: 🏭",-1)),_("span",za,E(ae("carbon")),1)]),_("div",Va,[a[16]||(a[16]=_("span",{class:"label"},"Water: 💧",-1)),_("span",Na,E(ae("water")),1)]),_("div",Ta,[a[17]||(a[17]=_("span",{class:"label"},"Energy: ⚡",-1)),_("span",Ua,E(ae("energy")),1)])])):$("",!0)])):$("",!0)]),_("div",qa,[a[21]||(a[21]=_("h3",null,"Actions",-1)),_("div",Wa,[x(s,{type:"default",onClick:Y,disabled:!f.value.length,block:""},{default:w(()=>a[19]||(a[19]=[A(" Load from Design ")])),_:1,__:[19]},8,["disabled"]),x(s,{type:"default",onClick:Q,disabled:!F.value,block:""},{default:w(()=>a[20]||(a[20]=[A(" Clear Prompt ")])),_:1,__:[20]},8,["disabled"])])]),b.value?(P(),k("div",Ha,[a[22]||(a[22]=_("h3",null,"Quick Templates",-1)),_("div",Ja,[(P(),k(I,null,L(H,e=>x(s,{key:e.name,size:"small",onClick:a=>function(e){F.value=e}(e.prompt)},{default:w(()=>[A(E(e.name),1)]),_:2},1032,["onClick"])),64))])])):$("",!0)]),_("div",Ba,[_("div",Ka,[_("div",Ga,[a[23]||(a[23]=_("h3",null,"Prompt",-1)),_("span",Ya,E(F.value.length)+" characters",1)]),x(z,{modelValue:F.value,"onUpdate:modelValue":a[1]||(a[1]=e=>F.value=e),rows:6,placeholder:"Enter your prompt here...","data-testid":"playground-prompt-editor"},null,8,["modelValue"])]),O.value?(P(),k("div",Xa,[_("div",Qa,[a[24]||(a[24]=_("h3",null,"Response",-1)),S(U)?(P(),k("div",Za,[_("span",null,E(S(U).latency)+"ms",1),_("span",null,E(S(U).tokens?.total_tokens||"?")+" tokens",1)])):$("",!0)]),_("div",et,[x(ga,{response:S(U),"is-loading":S(D),error:S(q)},null,8,["response","is-loading","error"])])])):$("",!0)]),b.value?(P(),k("div",at,[x(X,{model:b.value,modelValue:j.value,"onUpdate:modelValue":a[2]||(a[2]=e=>j.value=e),onChange:G},null,8,["model","modelValue"])])):$("",!0)]),x(l,{open:R.value,"onUpdate:open":a[3]||(a[3]=e=>R.value=e),title:"Load from Design",width:"800px",footer:null},{default:w(()=>[_("div",tt,[(P(!0),k(I,null,L(f.value,e=>(P(),k("div",{key:e.id,class:"design-item",onClick:a=>function(e){F.value=e.text,R.value=!1}(e)},[_("div",lt,E(e.name),1),_("div",ot,E(e.description||"No description"),1),_("div",nt,E(e.text.substring(0,100))+"...",1),_("div",rt,E(e.type),1)],8,st))),128))])]),_:1},8,["open"]),x(V,{open:M.value,mode:"playground",title:"Select Model",onClose:a[4]||(a[4]=e=>M.value=!1),onSelectModel:Z},null,8,["open"])]);var o}}}),[["__scopeId","data-v-2f8e51b0"]]);export{it as default};
