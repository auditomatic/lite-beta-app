import{d as a,f as e,c as t,o as l,aa as s,a0 as n,F as i,ab as o,a2 as r,Z as d,$ as c,q as u,ac as b}from"./vendor-BKA9Ybw0.js";import{u as p,a as v,b as m,d as f,p as g,l as w,f as h,_ as k}from"./index-BTLG4nFQ.js";import{s as y}from"./storage-calculation.service-CjQOfDnp.js";import{p as C,a as x,b as I,c as D,d as S,e as $}from"./import-helpers-C7Z5_EcJ.js";import"./db-CL8uhZCz.js";const L={class:"debug-view","data-testid":"page-debug"},_={class:"section"},A={class:"endpoint-grid"},U=["value","onInput","placeholder","disabled","data-testid","aria-label"],E={class:"section"},R={class:"info-grid"},j={class:"info-item"},O={class:"info-item"},P={class:"info-item"},V={class:"info-item"},T={class:"section"},J={class:"table-header"},N={class:"table-actions"},M=["onClick","data-testid","aria-label"],z=["onClick","data-testid","aria-label"],B=["onClick","disabled","data-testid","aria-label"],F={key:0,class:"table-content"},Z={class:"table-controls"},q=["onUpdate:modelValue","data-testid","aria-label"],G=["onClick","data-testid","aria-label"],H={class:"table-data"},K=["onClick","data-testid","aria-label","aria-expanded"],Q=k(a({__name:"DebugView",setup(a){const k=p(),Q=v(),W=m(),X=f(),Y=e(new Set),aa=e({}),ea=e({}),ta=e(""),la=e(),sa=e(null),na=e([]),ia=t(()=>({dbVersion:"1.0.0",totalRecords:Object.values(ea.value).reduce((a,e)=>a+e.length,0),storageUsed:sa.value?sa.value.formattedUsed:"Calculating...",lastUpdated:(new Date).toLocaleString()})),oa=t(()=>[{name:"designs",count:ea.value.designs?.length||0},{name:"variableLists",count:ea.value.variableLists?.length||0},{name:"trials",count:ea.value.trials?.length||0},{name:"models",count:ea.value.models?.length||0},{name:"apiCalls",count:ea.value.apiCalls?.length||0},{name:"settings",count:ea.value.settings?.length||0}]);async function ra(){try{ea.value={designs:await h.designs.toArray(),variableLists:await h.variableLists.toArray(),trials:await h.trials.toArray(),models:await h.models.toArray(),apiCalls:await h.apiCalls.toArray(),settings:await h.settings.toArray()}}catch(a){w.error("Failed to load table data",a)}}function da(a){const e=ea.value[a]||[],t=aa.value[a]?.toLowerCase()||"";if(!t)return JSON.stringify(e.slice(0,10),null,2);const l=e.filter(a=>JSON.stringify(a).toLowerCase().includes(t));return JSON.stringify(l.slice(0,10),null,2)}async function ca(){Da({version:"1.0.0",exported:(new Date).toISOString(),data:ea.value},`auditomatic_full_export_${Date.now()}.json`)}async function ua(){const a=ea.value.designs||[],e=ea.value.variableLists||[];Da({version:"1.0.0",exported:(new Date).toISOString(),designs:a,variableLists:e},`designs_variables_export_${Date.now()}.json`)}async function ba(){const a=ea.value.trials||[],e=ea.value.apiCalls||[];Da({version:"1.0.0",exported:(new Date).toISOString(),trials:a,apiCalls:e},`trials_export_${Date.now()}.json`)}async function pa(){Da(ea.value.models||[],`models_export_${Date.now()}.json`)}async function va(){Da((ea.value.models||[]).map(a=>({id:a.id,provider:a.provider,modelId:a.modelId,enabled:a.enabled})),`model_states_export_${Date.now()}.json`)}function ma(){ta.value="fullDatabase",la.value?.click()}function fa(){ta.value="designsAndVariables",la.value?.click()}function ga(){ta.value="trials",la.value?.click()}function wa(){ta.value="models",la.value?.click()}function ha(){ta.value="modelStates",la.value?.click()}async function ka(a){const e=a.target.files?.[0];if(e){try{const a=await e.text(),t=JSON.parse(a);switch(ta.value){case"fullDatabase":await async function(a){const e=C(a);if(e.data)for(const[t,l]of Object.entries(e.data))await ya(t,l)}(t);break;case"designsAndVariables":await async function(a){if(a.designs){const e=x(a.designs);await h.designs.bulkPut(e)}if(a.variableLists){const e=I(a.variableLists);await h.variableLists.bulkPut(e)}}(t);break;case"trials":await async function(a){if(a.trials){const e=D(a.trials);await h.trials.bulkPut(e)}if(a.apiCalls){const e=S(a.apiCalls);await h.apiCalls.bulkPut(e)}}(t);break;case"models":await async function(a){const e=$(a);await h.models.bulkPut(e)}(t);break;case"modelStates":await async function(a){for(const e of a)await h.models.update(e.id,{enabled:e.enabled})}(t);break;default:ea.value[ta.value]&&await ya(ta.value,t)}await ra(),alert("Import completed successfully!")}catch(t){w.error("Import failed",t),alert("Import failed: "+(t instanceof Error?t.message:"Unknown error"))}la.value&&(la.value.value="")}}async function ya(a,e){const t=h[a];if(t){let l=e;switch(a){case"trials":l=D(e);break;case"designs":l=x(e);break;case"variableLists":l=I(e);break;case"models":l=$(e);break;case"apiCalls":l=S(e)}await t.bulkPut(l)}}async function Ca(){confirm("Are you sure you want to clear ALL data? This cannot be undone.")&&(await h.delete(),await h.open(),await ra())}async function xa(){confirm("Reset all settings to defaults? This will clear all data.")&&(await Ca(),await Promise.all([k.initialize(),Q.initialize(),W.initialize()]))}async function Ia(){confirm("Regenerate database? This will clear all data and rebuild.")&&(await h.delete(),await h.open(),await ra())}function Da(a,e){const t=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),l=URL.createObjectURL(t),s=document.createElement("a");s.href=l,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(l)}function Sa(a){const e=na.value.find(e=>e.id===a);return e?.api.baseUrl||""}function $a(a){return X.isProviderEnabled(a)}return l(async()=>{await ra(),await g.waitForReady(),na.value=[...g.getAllProviders()];try{sa.value=await y.getStorageInfo()}catch(a){w.warn("Failed to get storage info",{error:a})}}),(a,e)=>(d(),s("div",L,[n("div",_,[e[0]||(e[0]=n("h2",null,"Provider Endpoints",-1)),e[1]||(e[1]=n("p",{class:"section-desc"},"Configure base URLs for API providers",-1)),n("div",A,[(d(!0),s(i,null,o(na.value,a=>{return d(),s("div",{key:a.id,class:"endpoint-item"},[n("label",null,r(a.name),1),n("input",{value:(e=a.id,X.getBaseUrl(e)||""),onInput:e=>function(a,e){const t=e.target.value;X.setBaseUrl(a,t)}(a.id,e),placeholder:Sa(a.id),disabled:!$a(a.id),class:"endpoint-input","data-testid":`input-endpoint-${a.id}`,"aria-label":`${a.name} endpoint URL`},null,40,U)]);var e}),128))])]),n("div",E,[e[6]||(e[6]=n("h2",null,"System Information",-1)),n("div",R,[n("div",j,[e[2]||(e[2]=n("label",null,"Database Version:",-1)),n("span",null,r(ia.value.dbVersion),1)]),n("div",O,[e[3]||(e[3]=n("label",null,"Records Count:",-1)),n("span",null,r(ia.value.totalRecords),1)]),n("div",P,[e[4]||(e[4]=n("label",null,"Storage Used:",-1)),n("span",null,r(ia.value.storageUsed),1)]),n("div",V,[e[5]||(e[5]=n("label",null,"Last Updated:",-1)),n("span",null,r(ia.value.lastUpdated),1)])])]),n("div",T,[e[7]||(e[7]=n("h2",null,"Database Tables",-1)),(d(!0),s(i,null,o(oa.value,a=>(d(),s("div",{key:a.name,class:"table-section"},[n("div",J,[n("h3",null,r(a.name)+" ("+r(a.count)+" records)",1),n("div",N,[n("button",{onClick:e=>async function(a){Da(ea.value[a]||[],`${a}_export.json`)}(a.name),class:"export-btn","data-testid":`btn-export-table-${a.name}`,"aria-label":`Export ${a.name} table`},"Export",8,M),n("button",{onClick:e=>{return t=a.name,ta.value=t,void la.value?.click();var t},class:"import-btn","data-testid":`btn-import-table-${a.name}`,"aria-label":`Import ${a.name} table`},"Import",8,z),n("button",{onClick:e=>async function(a){if(!confirm(`Are you sure you want to clear all ${a} data? This cannot be undone.`))return;const e=h[a];e&&(await e.clear(),await ra())}(a.name),class:"clear-btn",disabled:0===a.count,"data-testid":`btn-clear-table-${a.name}`,"aria-label":`Clear all ${a.name} data`}," Clear All ",8,B)])]),Y.value.has(a.name)?(d(),s("div",F,[n("div",Z,[u(n("input",{"onUpdate:modelValue":e=>aa.value[a.name]=e,placeholder:"Search records...",class:"search-input","data-testid":`input-search-${a.name}`,"aria-label":`Search ${a.name} records`},null,8,q),[[b,aa.value[a.name]]]),n("button",{onClick:e=>async function(){await ra()}(a.name),class:"refresh-btn","data-testid":`btn-refresh-${a.name}`,"aria-label":`Refresh ${a.name} table`},"Refresh",8,G)]),n("div",H,[n("pre",null,r(da(a.name)),1)])])):c("",!0),n("button",{onClick:e=>{return t=a.name,void(Y.value.has(t)?Y.value.delete(t):Y.value.add(t));var t},class:"toggle-btn","data-testid":`btn-toggle-${a.name}`,"aria-label":`${Y.value.has(a.name)?"Collapse":"Expand"} ${a.name} table`,"aria-expanded":Y.value.has(a.name)},r(Y.value.has(a.name)?"Collapse":"Expand"),9,K)]))),128))]),n("div",{class:"section"},[e[14]||(e[14]=n("h2",null,"Import/Export Tools",-1)),n("div",{class:"export-group"},[e[8]||(e[8]=n("h3",null,"Complete Database",-1)),n("div",{class:"export-actions"},[n("button",{onClick:ca,class:"export-all-btn","data-testid":"btn-export-full-database","aria-label":"Export complete database"},"Export All Data"),n("button",{onClick:ma,class:"import-all-btn","data-testid":"btn-import-full-database","aria-label":"Import complete database"},"Import All Data")])]),n("div",{class:"export-group"},[e[9]||(e[9]=n("h3",null,"Designs & Variables",-1)),e[10]||(e[10]=n("p",{class:"export-desc"},"Exports designs with their linked variable lists",-1)),n("div",{class:"export-actions"},[n("button",{onClick:ua,class:"export-btn","data-testid":"btn-export-designs-variables","aria-label":"Export designs and variables"},"Export Designs+Variables"),n("button",{onClick:fa,class:"import-btn","data-testid":"btn-import-designs-variables","aria-label":"Import designs and variables"},"Import Designs+Variables")])]),n("div",{class:"export-group"},[e[11]||(e[11]=n("h3",null,"Trials",-1)),e[12]||(e[12]=n("p",{class:"export-desc"},"Exports trials with configuration snapshots and results",-1)),n("div",{class:"export-actions"},[n("button",{onClick:ba,class:"export-btn"},"Export Trials"),n("button",{onClick:ga,class:"import-btn"},"Import Trials")])]),n("div",{class:"export-group"},[e[13]||(e[13]=n("h3",null,"Models",-1)),n("div",{class:"export-actions"},[n("button",{onClick:pa,class:"export-btn"},"Export All Models"),n("button",{onClick:wa,class:"import-btn"},"Import All Models")]),n("div",{class:"export-actions"},[n("button",{onClick:va,class:"export-state-btn"},"Export Model States Only"),n("button",{onClick:ha,class:"import-state-btn"},"Import Model States Only")])])]),n("div",{class:"section danger-zone"},[e[15]||(e[15]=n("h2",null,"Danger Zone",-1)),n("div",{class:"danger-actions"},[n("button",{onClick:Ca,class:"danger-btn","data-testid":"btn-clear-all-data","aria-label":"Clear all application data"},"Clear All Data"),n("button",{onClick:xa,class:"danger-btn","data-testid":"btn-reset-defaults","aria-label":"Reset application to default settings"},"Reset to Defaults"),n("button",{onClick:Ia,class:"danger-btn","data-testid":"btn-regenerate-database","aria-label":"Regenerate database structure"},"Regenerate Database")])]),n("input",{ref_key:"fileInput",ref:la,type:"file",accept:".json",onChange:ka,style:{display:"none"},"data-testid":"input-file-import","aria-label":"Select JSON file to import"},null,544)]))}}),[["__scopeId","data-v-98537a02"]]);export{Q as default};
