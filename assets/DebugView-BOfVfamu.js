import{d as a,f as e,c as t,o as l,aa as s,a0 as n,F as i,ab as o,a2 as r,Z as d,$ as c,q as u,ac as b}from"./vendor-BsQOyEiA.js";import{u as p,a as v,b as m,c as f,e as g,p as w,l as h,g as k,_ as y}from"./index-Du1WcLqe.js";import{s as x}from"./storage-calculation.service-CIIMcVY0.js";import{e as C,c as I,b as D,d as S,p as $,a as L}from"./import-helpers-R1GGtEJc.js";import"./db-CL8uhZCz.js";const A={class:"debug-view","data-testid":"page-debug"},_={class:"section"},U={class:"endpoint-grid"},E=["value","onInput","placeholder","disabled","data-testid","aria-label"],R={class:"section"},j={class:"info-grid"},O={class:"info-item"},P={class:"info-item"},V={class:"info-item"},T={class:"info-item"},z={class:"section"},J={class:"table-header"},N={class:"table-actions"},M=["onClick","data-testid","aria-label"],F=["onClick","data-testid","aria-label"],B=["onClick","disabled","data-testid","aria-label"],Z={key:0,class:"table-content"},q={class:"table-controls"},G=["onUpdate:modelValue","data-testid","aria-label"],H=["onClick","data-testid","aria-label"],K={class:"table-data"},Q=["onClick","data-testid","aria-label","aria-expanded"],W=y(a({__name:"DebugView",setup(a){const y=p(),W=v(),X=m(),Y=f(),aa=g(),ea=e(new Set),ta=e({}),la=e({}),sa=e(""),na=e(),ia=e(null),oa=e([]),ra=t(()=>({dbVersion:"1.0.0",totalRecords:Object.values(la.value).reduce((a,e)=>a+e.length,0),storageUsed:ia.value?ia.value.formattedUsed:"Calculating...",lastUpdated:(new Date).toLocaleString()})),da=t(()=>[{name:"designs",count:la.value.designs?.length||0},{name:"variableLists",count:la.value.variableLists?.length||0},{name:"trials",count:la.value.trials?.length||0},{name:"models",count:la.value.models?.length||0},{name:"apiCalls",count:la.value.apiCalls?.length||0},{name:"settings",count:la.value.settings?.length||0}]);async function ca(){try{la.value={designs:await k.designs.toArray(),variableLists:await k.variableLists.toArray(),trials:await k.trials.toArray(),models:await k.models.toArray(),apiCalls:await k.apiCalls.toArray(),settings:await k.settings.toArray()}}catch(a){h.error("Failed to load table data",a)}}function ua(a){const e=la.value[a]||[],t=ta.value[a]?.toLowerCase()||"";if(!t)return JSON.stringify(e.slice(0,10),null,2);const l=e.filter(a=>JSON.stringify(a).toLowerCase().includes(t));return JSON.stringify(l.slice(0,10),null,2)}async function ba(){$a({version:"1.0.0",exported:(new Date).toISOString(),data:la.value},`auditomatic_full_export_${Date.now()}.json`)}async function pa(){const a=la.value.designs||[],e=la.value.variableLists||[];$a({version:"1.0.0",exported:(new Date).toISOString(),designs:a,variableLists:e},`designs_variables_export_${Date.now()}.json`)}async function va(){const a=la.value.trials||[],e=la.value.apiCalls||[];$a({version:"1.0.0",exported:(new Date).toISOString(),trials:a,apiCalls:e},`trials_export_${Date.now()}.json`)}async function ma(){$a(la.value.models||[],`models_export_${Date.now()}.json`)}async function fa(){$a((la.value.models||[]).map(a=>({id:a.id,provider:a.provider,modelId:a.modelId,enabled:a.enabled})),`model_states_export_${Date.now()}.json`)}function ga(){sa.value="fullDatabase",na.value?.click()}function wa(){sa.value="designsAndVariables",na.value?.click()}function ha(){sa.value="trials",na.value?.click()}function ka(){sa.value="models",na.value?.click()}function ya(){sa.value="modelStates",na.value?.click()}async function xa(a){const e=a.target.files?.[0];if(e){try{const a=await e.text(),t=JSON.parse(a);switch(sa.value){case"fullDatabase":await async function(a){const e=C(a);if(e.data)for(const[t,l]of Object.entries(e.data))await Ca(t,l)}(t);break;case"designsAndVariables":await async function(a){if(a.designs){const e=I(a.designs);await k.designs.bulkPut(e)}if(a.variableLists){const e=D(a.variableLists);await k.variableLists.bulkPut(e)}}(t);break;case"trials":await async function(a){if(a.trials){const e=S(a.trials);await k.trials.bulkPut(e)}if(a.apiCalls){const e=$(a.apiCalls);await k.apiCalls.bulkPut(e)}}(t);break;case"models":await async function(a){const e=L(a);await k.models.bulkPut(e)}(t);break;case"modelStates":await async function(a){for(const e of a)await k.models.update(e.id,{enabled:e.enabled})}(t);break;default:la.value[sa.value]&&await Ca(sa.value,t)}await ca(),alert("Import completed successfully!")}catch(t){h.error("Import failed",t),alert("Import failed: "+(t instanceof Error?t.message:"Unknown error"))}na.value&&(na.value.value="")}}async function Ca(a,e){const t=k[a];if(t){let l=e;switch(a){case"trials":l=S(e);break;case"designs":l=I(e);break;case"variableLists":l=D(e);break;case"models":l=L(e);break;case"apiCalls":l=$(e)}await t.bulkPut(l)}}async function Ia(){confirm("Are you sure you want to clear ALL data? This cannot be undone.")&&(await k.delete(),await k.open(),await ca())}async function Da(){confirm("Reset all settings to defaults? This will clear all data.")&&(await Ia(),await Promise.all([y.initialize(),W.initialize(),X.initialize(),Y.initialize()]))}async function Sa(){confirm("Regenerate database? This will clear all data and rebuild.")&&(await k.delete(),await k.open(),await ca())}function $a(a,e){const t=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),l=URL.createObjectURL(t),s=document.createElement("a");s.href=l,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(l)}function La(a){const e=oa.value.find(e=>e.id===a);return e?.api.baseUrl||""}function Aa(a){return aa.isProviderEnabled(a)}return l(async()=>{await ca(),await w.waitForReady(),oa.value=[...w.getAllProviders()];try{ia.value=await x.getStorageInfo()}catch(a){h.warn("Failed to get storage info",{error:a})}}),(a,e)=>(d(),s("div",A,[n("div",_,[e[0]||(e[0]=n("h2",null,"Provider Endpoints",-1)),e[1]||(e[1]=n("p",{class:"section-desc"},"Configure base URLs for API providers",-1)),n("div",U,[(d(!0),s(i,null,o(oa.value,a=>{return d(),s("div",{key:a.id,class:"endpoint-item"},[n("label",null,r(a.name),1),n("input",{value:(e=a.id,aa.getBaseUrl(e)||""),onInput:e=>function(a,e){const t=e.target.value;aa.setBaseUrl(a,t)}(a.id,e),placeholder:La(a.id),disabled:!Aa(a.id),class:"endpoint-input","data-testid":`input-endpoint-${a.id}`,"aria-label":`${a.name} endpoint URL`},null,40,E)]);var e}),128))])]),n("div",R,[e[6]||(e[6]=n("h2",null,"System Information",-1)),n("div",j,[n("div",O,[e[2]||(e[2]=n("label",null,"Database Version:",-1)),n("span",null,r(ra.value.dbVersion),1)]),n("div",P,[e[3]||(e[3]=n("label",null,"Records Count:",-1)),n("span",null,r(ra.value.totalRecords),1)]),n("div",V,[e[4]||(e[4]=n("label",null,"Storage Used:",-1)),n("span",null,r(ra.value.storageUsed),1)]),n("div",T,[e[5]||(e[5]=n("label",null,"Last Updated:",-1)),n("span",null,r(ra.value.lastUpdated),1)])])]),n("div",z,[e[7]||(e[7]=n("h2",null,"Database Tables",-1)),(d(!0),s(i,null,o(da.value,a=>(d(),s("div",{key:a.name,class:"table-section"},[n("div",J,[n("h3",null,r(a.name)+" ("+r(a.count)+" records)",1),n("div",N,[n("button",{onClick:e=>async function(a){$a(la.value[a]||[],`${a}_export.json`)}(a.name),class:"export-btn","data-testid":`btn-export-table-${a.name}`,"aria-label":`Export ${a.name} table`},"Export",8,M),n("button",{onClick:e=>{return t=a.name,sa.value=t,void na.value?.click();var t},class:"import-btn","data-testid":`btn-import-table-${a.name}`,"aria-label":`Import ${a.name} table`},"Import",8,F),n("button",{onClick:e=>async function(a){if(!confirm(`Are you sure you want to clear all ${a} data? This cannot be undone.`))return;const e=k[a];e&&(await e.clear(),await ca())}(a.name),class:"clear-btn",disabled:0===a.count,"data-testid":`btn-clear-table-${a.name}`,"aria-label":`Clear all ${a.name} data`}," Clear All ",8,B)])]),ea.value.has(a.name)?(d(),s("div",Z,[n("div",q,[u(n("input",{"onUpdate:modelValue":e=>ta.value[a.name]=e,placeholder:"Search records...",class:"search-input","data-testid":`input-search-${a.name}`,"aria-label":`Search ${a.name} records`},null,8,G),[[b,ta.value[a.name]]]),n("button",{onClick:e=>async function(){await ca()}(a.name),class:"refresh-btn","data-testid":`btn-refresh-${a.name}`,"aria-label":`Refresh ${a.name} table`},"Refresh",8,H)]),n("div",K,[n("pre",null,r(ua(a.name)),1)])])):c("",!0),n("button",{onClick:e=>{return t=a.name,void(ea.value.has(t)?ea.value.delete(t):ea.value.add(t));var t},class:"toggle-btn","data-testid":`btn-toggle-${a.name}`,"aria-label":`${ea.value.has(a.name)?"Collapse":"Expand"} ${a.name} table`,"aria-expanded":ea.value.has(a.name)},r(ea.value.has(a.name)?"Collapse":"Expand"),9,Q)]))),128))]),n("div",{class:"section"},[e[14]||(e[14]=n("h2",null,"Import/Export Tools",-1)),n("div",{class:"export-group"},[e[8]||(e[8]=n("h3",null,"Complete Database",-1)),n("div",{class:"export-actions"},[n("button",{onClick:ba,class:"export-all-btn","data-testid":"btn-export-full-database","aria-label":"Export complete database"},"Export All Data"),n("button",{onClick:ga,class:"import-all-btn","data-testid":"btn-import-full-database","aria-label":"Import complete database"},"Import All Data")])]),n("div",{class:"export-group"},[e[9]||(e[9]=n("h3",null,"Designs & Variables",-1)),e[10]||(e[10]=n("p",{class:"export-desc"},"Exports designs with their linked variable lists",-1)),n("div",{class:"export-actions"},[n("button",{onClick:pa,class:"export-btn","data-testid":"btn-export-designs-variables","aria-label":"Export designs and variables"},"Export Designs+Variables"),n("button",{onClick:wa,class:"import-btn","data-testid":"btn-import-designs-variables","aria-label":"Import designs and variables"},"Import Designs+Variables")])]),n("div",{class:"export-group"},[e[11]||(e[11]=n("h3",null,"Trials",-1)),e[12]||(e[12]=n("p",{class:"export-desc"},"Exports trials with configuration snapshots and results",-1)),n("div",{class:"export-actions"},[n("button",{onClick:va,class:"export-btn"},"Export Trials"),n("button",{onClick:ha,class:"import-btn"},"Import Trials")])]),n("div",{class:"export-group"},[e[13]||(e[13]=n("h3",null,"Models",-1)),n("div",{class:"export-actions"},[n("button",{onClick:ma,class:"export-btn"},"Export All Models"),n("button",{onClick:ka,class:"import-btn"},"Import All Models")]),n("div",{class:"export-actions"},[n("button",{onClick:fa,class:"export-state-btn"},"Export Model States Only"),n("button",{onClick:ya,class:"import-state-btn"},"Import Model States Only")])])]),n("div",{class:"section danger-zone"},[e[15]||(e[15]=n("h2",null,"Danger Zone",-1)),n("div",{class:"danger-actions"},[n("button",{onClick:Ia,class:"danger-btn","data-testid":"btn-clear-all-data","aria-label":"Clear all application data"},"Clear All Data"),n("button",{onClick:Da,class:"danger-btn","data-testid":"btn-reset-defaults","aria-label":"Reset application to default settings"},"Reset to Defaults"),n("button",{onClick:Sa,class:"danger-btn","data-testid":"btn-regenerate-database","aria-label":"Regenerate database structure"},"Regenerate Database")])]),n("input",{ref_key:"fileInput",ref:na,type:"file",accept:".json",onChange:xa,style:{display:"none"},"data-testid":"input-file-import","aria-label":"Select JSON file to import"},null,544)]))}}),[["__scopeId","data-v-84750192"]]);export{W as default};
