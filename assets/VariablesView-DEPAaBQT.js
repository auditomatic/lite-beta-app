import{_ as e,u as t}from"./BaseButton.vue_vue_type_style_index_0_lang-q26YUuHo.js";import{a,H as l,l as i,_ as s,G as r}from"./index-mBQkrP6K.js";import{r as o,f as n,c as u,w as d,u as c,n as m,d as p,a9 as b,Z as v,$ as y,a0 as g,G as f,a2 as h,ac as V,q as k,F as w,aa as _,ab as C,ae as K,B as L,X as S,_ as x,k as I,z as D,af as A,o as E,Y as $}from"./vendor-B9vlzAYn.js";import{_ as U}from"./BaseModal.vue_vue_type_style_index_0_lang-DjxfwE8g.js";import"./db-CL8uhZCz.js";function z(e){const t=a(),s=o({name:"",description:"",category:"simple",values:[],attributeKeys:[],items:[],tabularData:void 0}),r=n(!1),p=n(!1),b=n([]),v=n(!1),y=n(""),g=n(!1),f=u(()=>"simple"===s.category||"refusal"===s.category?s.values.length:"attributed"===s.category?s.items.length:"tabular"===s.category&&s.tabularData?.rows.length||0),h=u(()=>{const e=[];if(s.name.trim()||e.push("Name is required"),"simple"===s.category||"refusal"===s.category){0===s.values.length&&e.push("At least one value is required");new Set(s.values.map(e=>e.toLowerCase().trim())).size<s.values.length&&e.push("Duplicate values detected")}else if("attributed"===s.category){0===s.attributeKeys.length&&e.push("At least one attribute key is required"),0===s.items.length&&e.push("At least one item is required");const t=l.validateAttributedList(s.items,s.attributeKeys);t.isValid||e.push(...t.errors)}return{isValid:0===e.length,errors:e}}),V=u(()=>"attributed"!==s.category?{}:l.getAttributeStats(s.items));return d(()=>s.category,(e,t)=>{i.debug("Category watcher triggered",{newCategory:e,oldCategory:t,isLoadingData:g.value}),e===t||void 0===t||g.value?i.debug("Not clearing data - category change is during load or initial"):(i.debug("Clearing data due to category change"),s.values.splice(0,s.values.length),s.attributeKeys.splice(0,s.attributeKeys.length),s.items.splice(0,s.items.length))}),d(()=>c(e),a=>{i.debug("ListId watcher triggered",{newId:a}),a?(i.debug("Calling load() for listId",{newId:a}),async function(){const a=c(e);if(i.debug("Loading list with ID",{currentListId:a}),a){p.value=!0,g.value=!0;try{const e=await t.getList(a);if(i.debug("Loaded list from store",{list:e}),!e)throw new Error("Variable list not found");i.debug("Setting form.name",{name:e.name}),s.name=e.name,i.debug("form.name is now",{name:s.name}),i.debug("Setting form.description",{description:e.description??""}),s.description=e.description??"",i.debug("form.description is now",{description:s.description}),i.debug("Setting form.category",{category:e.category}),s.category=e.category,i.debug("form.category is now",{category:s.category}),await m(),"simple"===e.category||"refusal"===e.category?(i.debug("Loading simple/refusal values",{values:e.values}),s.values.splice(0,s.values.length,...e.values||[]),i.debug("form.values is now",{values:s.values,length:s.values.length})):"attributed"===e.category?(i.debug("Loading attributed data - attributeKeys",{attributeKeys:e.attributeKeys}),s.attributeKeys.splice(0,s.attributeKeys.length,...e.attributeKeys||[]),i.debug("form.attributeKeys is now",{attributeKeys:s.attributeKeys,length:s.attributeKeys.length}),i.debug("Loading attributed data - items",{itemCount:e.items?.length}),s.items.splice(0,s.items.length,...e.items?e.items.map(e=>({value:e.value,attributes:{...e.attributes}})):[]),i.debug("form.items is now",{itemCount:s.items.length})):"tabular"===e.category&&(i.debug("Loading tabular data",{columns:e.tabularData?.columns,rowCount:e.tabularData?.rows.length}),s.tabularData=e.tabularData?{columns:[...e.tabularData.columns],rows:e.tabularData.rows.map(e=>({...e}))}:void 0),i.debug("Final form state",{name:s.name,description:s.description,category:s.category,valuesLength:s.values.length,attributeKeysLength:s.attributeKeys.length,itemsLength:s.items.length}),await m()}catch(l){i.error("Error loading list",l)}finally{p.value=!1,g.value=!1,i.debug("Load complete, isLoadingData set to false")}}}()):(i.debug("Resetting form for new list"),s.name="",s.description="",s.category="simple",s.values.splice(0,s.values.length),s.attributeKeys.splice(0,s.attributeKeys.length),s.items.splice(0,s.items.length),i.debug("Form reset complete"))},{immediate:!0}),{form:s,isSaving:r,isLoading:p,errors:b,showImportDialog:v,importText:y,itemCount:f,validation:h,attributeStats:V,save:async function(){if(!h.value.isValid)throw b.value=h.value.errors,new Error(h.value.errors[0]);r.value=!0,b.value=[];try{const a={name:s.name.trim(),description:s.description.trim()||void 0,category:s.category,values:"simple"===s.category||"refusal"===s.category?[...s.values]:void 0,attributeKeys:"attributed"===s.category?[...s.attributeKeys]:void 0,items:"attributed"===s.category?s.items.map(e=>({value:e.value,attributes:{...e.attributes}})):void 0,tabularData:"tabular"===s.category?s.tabularData:void 0,itemCount:f.value},l=c(e);return l?(await t.updateList(l,a),l):await t.createList(a)}finally{r.value=!1}},addValue:function(e){const t=e.trim();t&&(s.values.includes(t)||s.values.push(t))},removeValue:function(e){s.values.splice(e,1)},addAttributeKey:function(e){const t=e.trim();t&&(s.attributeKeys.includes(t)||(s.attributeKeys.push(t),s.items.forEach(e=>{t in e.attributes||(e.attributes[t]="")})))},removeAttributeKey:function(e){const t=s.attributeKeys.indexOf(e);-1!==t&&(s.attributeKeys.splice(t,1),s.items.forEach(t=>{delete t.attributes[e]}))},addItem:function(e){const t={value:e.value,attributes:{}};s.attributeKeys.forEach(a=>{t.attributes[a]=e.attributes[a]??""}),s.items.push(t)},removeItem:function(e){s.items.splice(e,1)},importData:async function(){try{const e=y.value.trim();if(!e)return;if(e.startsWith("[")||e.startsWith("{")){const t=l.parseJSON(e);if("simple"===s.category){if(!Array.isArray(t))throw new Error("For simple lists, JSON must be an array");s.values=t.map(e=>"string"==typeof e?e:e.value||e.name||String(e)).filter(Boolean)}else{const e=Array.isArray(t)?t:[t],a=new Set;e.forEach(e=>{Object.keys(e).forEach(e=>{"value"!==e&&"name"!==e&&a.add(e)})}),s.attributeKeys=Array.from(a),s.items=e.map(e=>({value:String(e.value||e.name||""),attributes:s.attributeKeys.reduce((t,a)=>(t[a]=String(e[a]||""),t),{})})).filter(e=>e.value)}}else{const t=l.parseCSV(e);if("simple"===s.category)s.values=t.rows.map(e=>Object.values(e)[0]).filter(Boolean);else{const e=l.csvToAttributedItems(t),a=t.headers.filter(e=>"value"!==e.toLowerCase()&&"name"!==e.toLowerCase());s.attributeKeys=a,s.items=e}}v.value=!1,y.value=""}catch(e){throw i.error("Import failed",e),e}},exportData:function(){return"simple"===s.category?`value\n${s.values.join("\n")}`:l.exportToCSV(s.items)}}}const F={class:"tag-input","data-testid":"tag-input-component"},B={key:0,class:"tag-input-label"},R={key:0,class:"required"},j={class:"tags"},O=["onClick","aria-label"],N=["placeholder","aria-label","onKeydown"],T={key:1,class:"helper-text"},q=s(p({__name:"TagInput",props:{modelValue:{},label:{},placeholder:{default:"Add a value..."},helperText:{},required:{type:Boolean}},emits:["update:modelValue"],setup(e,{expose:t,emit:a}){const l=e,i=a,s=n(),r=n(""),o=n(!1);function u(){const e=r.value.trim();e&&(l.modelValue.includes(e)||i("update:modelValue",[...l.modelValue,e]),r.value="")}function d(e){const t=[...l.modelValue];t.splice(e,1),i("update:modelValue",t)}function c(){""===r.value&&l.modelValue.length>0&&d(l.modelValue.length-1)}function m(e){","!==e.key&&188!==e.keyCode||(e.preventDefault(),u())}function p(e){e.preventDefault();const t=e.clipboardData?.getData("text");if(!t)return;const a=t.split(/[\n,\t]+/).map(e=>e.trim()).filter(Boolean),s=[...new Set([...l.modelValue,...a])];i("update:modelValue",s),r.value=""}function S(){r.value.trim()&&u(),o.value=!1}return t({focus:()=>s.value?.focus()}),(e,t)=>(v(),b("div",F,[e.label?(v(),b("label",B,[f(h(e.label)+" ",1),e.required?(v(),b("span",R,"*")):y("",!0)])):y("",!0),g("div",{class:V(["tag-input-container",{focused:o.value}])},[g("div",j,[(v(!0),b(w,null,_(e.modelValue,(e,t)=>(v(),b("span",{key:`${e}-${t}`,class:"tag"},[f(h(e)+" ",1),g("button",{type:"button",class:"tag-remove",onClick:e=>d(t),"aria-label":`Remove ${e}`}," × ",8,O)]))),128)),k(g("input",{ref_key:"inputRef",ref:s,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),placeholder:e.placeholder,class:"tag-input-field","data-testid":"tag-input-field","aria-label":e.label||"Enter tags",onKeydown:[K(L(u,["prevent"]),["enter"]),K(c,["backspace"]),m],onPaste:p,onFocus:t[1]||(t[1]=e=>o.value=!0),onBlur:S},null,40,N),[[C,r.value]])])],2),e.helperText?(v(),b("div",T,h(e.helperText),1)):y("",!0)]))}}),[["__scopeId","data-v-613f6ba9"]]),J={class:"attributed-items-grid"},W={key:0,class:"grid-header"},M={class:"grid-actions"},P=["disabled"],G={key:1,class:"add-row"},H=["onUpdate:modelValue","placeholder","data-testid","aria-label"],Y={key:2,class:"grid-container"},X={class:"items-table"},Z={key:0,class:"actions-column"},Q=["data-testid","data-item-value"],ee={key:0,class:"actions-column"},te=["onClick","data-testid","aria-label"],ae={key:0,class:"placeholder-row"},le={class:"placeholder-text"},ie={key:3,class:"empty-state"},se={key:4,class:"empty-state"},re=s(p({__name:"AttributedItemsGrid",props:{modelValue:{},attributeKeys:{},showStructure:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=t,i=n(!1),s=o({value:"",attributes:{}});function r(){if(!s.value.trim())return;const e={value:s.value.trim(),attributes:{...s.attributes}};l("update:modelValue",[...a.modelValue,e]),s.value="",a.attributeKeys.forEach(e=>{s.attributes[e]=""}),i.value=!1}function u(){s.value="",a.attributeKeys.forEach(e=>{s.attributes[e]=""}),i.value=!1}function c(e){const t=e.toLowerCase();return t.includes("age")?"25":t.includes("gender")||t.includes("sex")?"Female":t.includes("price")||t.includes("cost")?"$19.99":t.includes("category")||t.includes("type")?"Technology":t.includes("color")||t.includes("colour")?"Blue":t.includes("size")?"Medium":t.includes("country")?"USA":t.includes("city")?"Seattle":"Sample Value"}return d(()=>a.attributeKeys,e=>{s.attributes={},e.forEach(e=>{s.attributes[e]=""})},{immediate:!0}),(e,t)=>(v(),b("div",J,[e.attributeKeys.length>0?(v(),b("div",W,[g("div",M,[g("button",{type:"button",class:"add-button",disabled:0===e.attributeKeys.length,onClick:t[0]||(t[0]=e=>i.value=!0),"data-testid":"btn-add-attributed-item","aria-label":"Add new attributed item"}," + Add Item ",8,P)])])):y("",!0),i.value?(v(),b("div",G,[k(g("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.value=e),placeholder:"Value",class:"grid-input",onKeyup:K(r,["enter"]),"data-testid":"input-item-value","aria-label":"Item value"},null,544),[[C,s.value]]),(v(!0),b(w,null,_(e.attributeKeys,e=>k((v(),b("input",{key:e,"onUpdate:modelValue":t=>s.attributes[e]=t,placeholder:e,class:"grid-input",onKeyup:K(r,["enter"]),"data-testid":`input-attribute-${e}`,"aria-label":`${e} attribute value`},null,40,H)),[[C,s.attributes[e]]])),128)),g("div",{class:"row-actions"},[g("button",{type:"button",class:"save-button",onClick:r,"data-testid":"btn-save-attributed-item","aria-label":"Save attributed item"}," ✓ "),g("button",{type:"button",class:"cancel-button",onClick:u,"data-testid":"btn-cancel-attributed-item","aria-label":"Cancel adding item"}," × ")])])):y("",!0),e.modelValue.length>0||e.showStructure&&e.attributeKeys.length>0?(v(),b("div",Y,[g("table",X,[g("thead",null,[g("tr",null,[t[2]||(t[2]=g("th",null,"Value",-1)),(v(!0),b(w,null,_(e.attributeKeys,e=>(v(),b("th",{key:e},h(e),1))),128)),e.modelValue.length>0?(v(),b("th",Z)):y("",!0)])]),g("tbody",null,[(v(!0),b(w,null,_(e.modelValue,(t,i)=>(v(),b("tr",{key:`item-${t.value}-${i}`,"data-testid":`attributed-item-row-${i}`,"data-item-value":t.value},[g("td",null,h(t.value),1),(v(!0),b(w,null,_(e.attributeKeys,e=>(v(),b("td",{key:e},h(t.attributes[e]||"-"),1))),128)),e.modelValue.length>0?(v(),b("td",ee,[g("button",{type:"button",class:"remove-button",onClick:e=>function(e){const t=[...a.modelValue];t.splice(e,1),l("update:modelValue",t)}(i),"data-testid":`btn-remove-item-${i}`,"aria-label":`Remove item ${t.value}`}," × ",8,te)])):y("",!0)],8,Q))),128)),0===e.modelValue.length&&e.showStructure&&e.attributeKeys.length>0?(v(),b("tr",ae,[t[3]||(t[3]=g("td",{class:"placeholder-cell"},"Sample Name",-1)),(v(!0),b(w,null,_(e.attributeKeys,e=>(v(),b("td",{key:`placeholder-${e}`,class:"placeholder-cell"},[g("span",le,h(c(e)),1)]))),128))])):y("",!0)])])])):0===e.attributeKeys.length?(v(),b("div",ie,t[4]||(t[4]=[g("div",{class:"empty-icon"},"📋",-1),g("p",{class:"empty-title"},"Ready for Attributes",-1),g("p",{class:"empty-subtitle"},"Define attributes above to see the data structure here",-1)]))):(v(),b("div",se,t[5]||(t[5]=[g("div",{class:"empty-icon"},"📝",-1),g("p",{class:"empty-title"},"Ready for Data",-1),g("p",{class:"empty-subtitle"},'Click "Add Item" to start entering your data',-1)])))]))}}),[["__scopeId","data-v-d567fbc5"]]),oe={class:"import-content"},ne={class:"import-help"},ue={key:0,class:"format-examples"},de=["placeholder"],ce=s(p({__name:"ImportDialog",props:{category:{}},emits:["close","import"],setup(t,{emit:a}){const l=t,i=a,s=n(""),r=u(()=>"simple"===l.category?"Apple\nBanana\nCherry\n\nOR\n\nApple, Banana, Cherry":"Paste CSV or JSON data here...");function o(){s.value.trim()?i("import",s.value):alert("Please paste some data to import")}return(t,a)=>(v(),S(U,{"model-value":!0,title:"Import Data","onUpdate:modelValue":a[2]||(a[2]=e=>t.$emit("close"))},{footer:x(()=>[I(e,{variant:"ghost",onClick:a[1]||(a[1]=e=>t.$emit("close"))},{default:x(()=>a[4]||(a[4]=[f(" Cancel ")])),_:1,__:[4]}),I(e,{onClick:o},{default:x(()=>a[5]||(a[5]=[f(" Import ")])),_:1,__:[5]})]),default:x(()=>[g("div",oe,[g("p",ne,["simple"===t.category?(v(),b(w,{key:0},[f(" Paste values, one per line or comma-separated. ")],64)):(v(),b(w,{key:1},[f(" Paste CSV or JSON data. For CSV, first row should be headers. ")],64))]),"attributed"===t.category?(v(),b("div",ue,a[3]||(a[3]=[g("details",null,[g("summary",null,"CSV Example"),g("pre",null,"value,race,gender\nJohn Smith,White,Male\nMaria Garcia,Hispanic,Female\nWei Chen,Asian,Male")],-1),g("details",null,[g("summary",null,"JSON Example"),g("pre",null,'[\n  {"value": "John Smith", "race": "White", "gender": "Male"},\n  {"value": "Maria Garcia", "race": "Hispanic", "gender": "Female"}\n]')],-1)]))):y("",!0),k(g("textarea",{"onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),class:"import-textarea",placeholder:r.value,rows:"15"},null,8,de),[[C,s.value]])])]),_:1}))}}),[["__scopeId","data-v-f851c3b3"]]),me={class:"form-container"},pe={class:"name-desc-row"},be={class:"form-field"},ve={class:"form-field"},ye={class:"type-row","data-testid":"variable-type-selector"},ge={class:"radio-group-inline"},fe={class:"radio-label-inline"},he=["disabled"],Ve={class:"radio-label-inline"},ke=["disabled"],we={class:"radio-label-inline"},_e=["disabled"],Ce={key:0,class:"form-section"},Ke={key:1,class:"form-section"},Le={class:"import-actions"},Se={key:2,class:"form-section"},xe={class:"attributed-inline"},Ie={class:"attributes-content"},De={class:"items-section"},Ae={class:"items-content"},Ee={key:0,class:"import-actions"},$e={key:3,class:"error-banner"},Ue={class:"footer-content"},ze={class:"stats"},Fe={class:"actions"},Be=s(p({__name:"VariableListEditor",props:{modelValue:{type:Boolean},listId:{}},emits:["update:modelValue","saved"],setup(t,{emit:a}){const l=a,s=z(D(t,"listId"));async function r(){try{const e=await s.save();l("saved",e),l("update:modelValue",!1)}catch(e){i.error("Failed to save variable list",e)}}async function o(e){try{s.importText.value=e,await s.importData(),s.showImportDialog.value=!1}catch(t){i.error("Failed to import data",t),alert("Failed to import: "+(t instanceof Error?t.message:"Unknown error"))}}return d(()=>s.form.name,e=>{i.debug("VariableListEditor: form.name changed",{name:e})}),d(()=>s.form.category,e=>{i.debug("VariableListEditor: form.category changed",{category:e})}),d(()=>s.form.values,e=>{i.debug("VariableListEditor: form.values changed",{values:e,length:e.length})},{deep:!0}),d(()=>s.form.attributeKeys,e=>{i.debug("VariableListEditor: form.attributeKeys changed",{keys:e,length:e.length})},{deep:!0}),d(()=>s.form.items,e=>{i.debug("VariableListEditor: form.items changed",{itemCount:e.length})},{deep:!0}),(t,a)=>(v(),S(U,{"model-value":t.modelValue,title:t.listId?"Edit Variable List":"Create Variable List",size:"full","data-testid":"modal-variable-editor","onUpdate:modelValue":a[13]||(a[13]=e=>t.$emit("update:modelValue",e))},{footer:x(()=>[g("div",Ue,[g("div",ze,h(c(s).itemCount.value)+" items ",1),g("div",Fe,[I(e,{variant:"ghost",onClick:a[11]||(a[11]=e=>t.$emit("update:modelValue",!1))},{default:x(()=>a[30]||(a[30]=[f(" Cancel ")])),_:1,__:[30]}),I(e,{type:"submit",loading:c(s).isSaving.value,disabled:!c(s).validation.value.isValid,onClick:r},{default:x(()=>[f(h(t.listId?"Update":"Create"),1)]),_:1},8,["loading","disabled"])])])]),default:x(()=>[g("div",me,[g("form",{onSubmit:L(r,["prevent"])},[g("div",pe,[a[14]||(a[14]=g("label",{class:"inline-field-label"},"Name",-1)),g("div",be,[k(g("input",{id:"name","onUpdate:modelValue":a[0]||(a[0]=e=>c(s).form.name=e),type:"text",class:"form-input large",placeholder:"Enter list name","data-testid":"input-variable-list-name","aria-label":"Variable list name",required:""},null,512),[[C,c(s).form.name]])]),a[15]||(a[15]=g("label",{class:"inline-field-label"},"Description",-1)),g("div",ve,[k(g("input",{id:"description","onUpdate:modelValue":a[1]||(a[1]=e=>c(s).form.description=e),type:"text",class:"form-input large",placeholder:"Optional description","data-testid":"input-variable-list-description","aria-label":"Variable list description"},null,512),[[C,c(s).form.description]])])]),g("div",ye,[a[22]||(a[22]=g("label",{class:"inline-field-label"},"Type",-1)),g("div",ge,[g("label",fe,[k(g("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>c(s).form.category=e),type:"radio",value:"simple",disabled:!!t.listId,"data-testid":"radio-simple-list","aria-label":"Simple variable list type"},null,8,he),[[A,c(s).form.category]]),a[16]||(a[16]=g("span",{class:"radio-text"},"Simple List",-1)),a[17]||(a[17]=g("span",{class:"radio-example"},"(colors, names, countries)",-1))]),g("label",Ve,[k(g("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>c(s).form.category=e),type:"radio",value:"attributed",disabled:!!t.listId,"data-testid":"radio-attributed-list","aria-label":"Attributed variable list type"},null,8,ke),[[A,c(s).form.category]]),a[18]||(a[18]=g("span",{class:"radio-text"},"Attributed List",-1)),a[19]||(a[19]=g("span",{class:"radio-example"},"(names with gender/ethnicity, cities with region/size)",-1))]),g("label",we,[k(g("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>c(s).form.category=e),type:"radio",value:"refusal",disabled:!!t.listId},null,8,_e),[[A,c(s).form.category]]),a[20]||(a[20]=g("span",{class:"radio-text"},"Refusal Words",-1)),a[21]||(a[21]=g("span",{class:"radio-example"},"(cannot, unable, refuse)",-1))])])]),"simple"===c(s).form.category?(v(),b("div",Ce,[a[23]||(a[23]=g("h3",null,"Values",-1)),I(q,{modelValue:c(s).form.values,"onUpdate:modelValue":a[5]||(a[5]=e=>c(s).form.values=e),label:"List Values",placeholder:"Add a value...","helper-text":"Enter values or paste from spreadsheet"},null,8,["modelValue"])])):y("",!0),"refusal"===c(s).form.category?(v(),b("div",Ke,[a[25]||(a[25]=g("h3",null,"Refusal Words",-1)),I(q,{modelValue:c(s).form.values,"onUpdate:modelValue":a[6]||(a[6]=e=>c(s).form.values=e),label:"Refusal Words",placeholder:"Add a refusal word (e.g., 'cannot', 'unable', 'refuse')...","helper-text":"Words or phrases that indicate model refusal"},null,8,["modelValue"]),g("div",Le,[I(e,{variant:"secondary",size:"small",onClick:a[7]||(a[7]=e=>c(s).showImportDialog.value=!0)},{default:x(()=>a[24]||(a[24]=[f(" Import CSV ")])),_:1,__:[24]})])])):y("",!0),"attributed"===c(s).form.category?(v(),b("div",Se,[g("div",xe,[a[26]||(a[26]=g("label",{class:"inline-field-label"},"Attributes",-1)),g("div",Ie,[I(q,{modelValue:c(s).form.attributeKeys,"onUpdate:modelValue":a[8]||(a[8]=e=>c(s).form.attributeKeys=e),label:"",placeholder:"Add attribute (e.g., gender, ethnicity, region, size)...","helper-text":"Define properties first, then add data below"},null,8,["modelValue"])])]),g("div",De,[a[28]||(a[28]=g("label",{class:"inline-field-label"},"Data",-1)),g("div",Ae,[I(re,{modelValue:c(s).form.items,"onUpdate:modelValue":a[9]||(a[9]=e=>c(s).form.items=e),"attribute-keys":c(s).form.attributeKeys,"show-structure":!0},null,8,["modelValue","attribute-keys"]),c(s).form.attributeKeys.length>0?(v(),b("div",Ee,[I(e,{variant:"secondary",size:"small",onClick:a[10]||(a[10]=e=>c(s).showImportDialog.value=!0)},{default:x(()=>a[27]||(a[27]=[f(" Import CSV/JSON ")])),_:1,__:[27]})])):y("",!0)])])])):y("",!0),c(s).errors.value.length>0?(v(),b("div",$e,[a[29]||(a[29]=g("strong",null,"Please fix the following errors:",-1)),g("ul",null,[(v(!0),b(w,null,_(c(s).errors.value,e=>(v(),b("li",{key:e},h(e),1))),128))])])):y("",!0)],32)]),c(s).showImportDialog.value?(v(),S(ce,{key:0,category:"tabular"===c(s).form.category?"simple":c(s).form.category,onClose:a[12]||(a[12]=e=>c(s).showImportDialog.value=!1),onImport:o},null,8,["category"])):y("",!0)]),_:1},8,["model-value","title"]))}}),[["__scopeId","data-v-b78a3e7e"]]),Re={class:"variables-view","data-testid":"page-variables"},je={class:"page-header"},Oe={key:3},Ne={class:"scientific-table-container"},Te={class:"scientific-table-wrapper"},qe={key:0,class:"table-info-cell"},Je={class:"table-info-title"},We={class:"table-info-subtitle"},Me={key:3,class:"table-cell-ellipsis"},Pe={key:4,class:"date-cell"},Ge={key:5,class:"table-actions-grid"},He=s(p({__name:"VariablesView",setup(e){const l=a(),{getVisibleColumns:s,formatDateTime:o,createVariableColumns:d}=t(),m=n(!1),p=n(),V=n("all"),k=s(d()),_=u(()=>l.lists.filter(e=>"tabular"!==e.category&&void 0!==e.category)),C=u(()=>l.lists.filter(e=>"tabular"===e.category||!e.category)),K=u(()=>{switch(V.value){case"simple":return l.simpleLists;case"attributed":return l.attributedLists;case"refusal":return l.refusalLists;case"spreadsheet":return C.value;default:return _.value}});function L(){p.value=void 0,m.value=!1}function D(e){if("simple"===e.category||"refusal"===e.category){const t=e.values||[],a=t.slice(0,3).join(", ");return t.length>3?`${a}, ...`:a}const t=e.items||[],a=t.slice(0,2).map(e=>e.name||e.value).join(", ");return t.length>2?`${a}, ...`:a}return E(()=>{l.initialize()}),(e,t)=>{const a=$("a-button"),s=$("a-spin"),n=$("a-alert"),u=$("a-empty"),d=$("a-tab-pane"),A=$("a-tabs"),E=$("a-tag"),U=$("a-table");return v(),b("div",Re,[g("div",je,[t[6]||(t[6]=g("div",{class:"header-content"},[g("h1",null,"Variable Lists"),g("p",{class:"description"},"Manage reusable variable lists for prompt templates")],-1)),I(a,{type:"primary",onClick:t[0]||(t[0]=e=>m.value=!0),"data-testid":"btn-create-variable-list","aria-label":"Create new variable list"},{icon:x(()=>[I(c(r))]),default:x(()=>[t[5]||(t[5]=f(" Create List "))]),_:1,__:[5]})]),c(l).isLoading?(v(),S(s,{key:0,size:"large",tip:"Loading variable lists..."},{default:x(()=>t[7]||(t[7]=[g("div",{style:{"min-height":"200px"}},null,-1)])),_:1,__:[7]})):c(l).error?(v(),S(n,{key:1,type:"error",message:c(l).error,class:"error-alert"},null,8,["message"])):0===c(l).lists.length?(v(),S(u,{key:2,description:"No variable lists yet. Create lists to use in your prompt designs."},{image:x(()=>t[8]||(t[8]=[g("div",{style:{color:"#bfbfbf","font-size":"48px"}},"📃",-1)])),default:x(()=>[I(a,{type:"primary",onClick:t[1]||(t[1]=e=>m.value=!0)},{default:x(()=>t[9]||(t[9]=[f(" Create Your First List ")])),_:1,__:[9]})]),_:1})):(v(),b("div",Oe,[I(A,{activeKey:V.value,"onUpdate:activeKey":t[2]||(t[2]=e=>V.value=e),size:"small",class:"list-tabs"},{default:x(()=>[I(d,{key:"all",tab:`All Lists (${_.value.length})`},null,8,["tab"]),I(d,{key:"simple",tab:`Simple (${c(l).simpleLists.length})`},null,8,["tab"]),I(d,{key:"attributed",tab:`Attributed (${c(l).attributedLists.length})`},null,8,["tab"]),I(d,{key:"refusal",tab:`Refusal (${c(l).refusalLists.length})`},null,8,["tab"]),I(d,{key:"spreadsheet",tab:`Spreadsheet Lists (${C.value.length})`},null,8,["tab"])]),_:1},8,["activeKey"]),g("div",Ne,[g("div",Te,[I(U,{columns:c(k),"data-source":K.value,pagination:!1,size:"small",scroll:{y:"calc(100vh - 180px)"},"row-key":"id",class:"scientific-table"},{bodyCell:x(({column:e,record:s})=>{return["name"===e.key?(v(),b("div",qe,[g("span",Je,h(s.name),1),g("span",We,h(s.description||"No description"),1)])):y("",!0),"category"===e.key?(v(),S(E,{key:1,size:"small",color:"simple"===s.category?"blue":"attributed"===s.category?"green":"red"},{default:x(()=>[f(h(s.category),1)]),_:2},1032,["color"])):y("",!0),"itemCount"===e.key?(v(),b(w,{key:2},[f(h((n=s,"simple"===n.category||"refusal"===n.category?n.values?.length||0:n.items?.length||0)),1)],64)):y("",!0),"description"===e.key?(v(),b("div",Me,h(D(s)),1)):y("",!0),"created"===e.key?(v(),b("div",Pe,h((r=s.created,o(r))),1)):y("",!0),"actions"===e.key?(v(),b("div",Ge,[I(a,{size:"small",type:"primary",onClick:e=>{return t=s.id,p.value=t,void(m.value=!0);var t}},{default:x(()=>t[10]||(t[10]=[f(" Edit ")])),_:2,__:[10]},1032,["onClick"]),I(a,{size:"small",class:"btn-success",onClick:e=>async function(e){const t=e.id;try{const e=await l.getList(t);if(!e)return;let a,i;"simple"===e.category||"refusal"===e.category?(a=`value\n${e.values?.join("\n")??""}`,i=`${e.name.replace(/\s+/g,"-")}-values.csv`):(a=JSON.stringify(e.items,null,2),i=`${e.name.replace(/\s+/g,"-")}-attributed.json`);const s=new Blob([a],{type:"text/plain"}),r=URL.createObjectURL(s),o=document.createElement("a");o.href=r,o.download=i,o.click(),URL.revokeObjectURL(r)}catch(a){i.error("Failed to export list",a),alert("Failed to export list")}}(s)},{default:x(()=>t[11]||(t[11]=[f(" Export ")])),_:2,__:[11]},1032,["onClick"]),I(a,{size:"small",danger:"",onClick:e=>async function(e){if(confirm("Are you sure you want to delete this list?"))try{await l.deleteList(e)}catch(t){i.error("Failed to delete list",t),alert(t instanceof Error?t.message:"Failed to delete list")}}(s.id)},{default:x(()=>t[12]||(t[12]=[f(" Delete ")])),_:2,__:[12]},1032,["onClick"])])):y("",!0)];var r,n}),_:1},8,["columns","data-source"])])])])),m.value?(v(),S(Be,{key:4,modelValue:m.value,"onUpdate:modelValue":[t[3]||(t[3]=e=>m.value=e),t[4]||(t[4]=e=>{e||(p.value=void 0)})],"list-id":p.value,onSaved:L},null,8,["modelValue","list-id"])):y("",!0)])}}}),[["__scopeId","data-v-e9940aa1"]]);export{He as default};
