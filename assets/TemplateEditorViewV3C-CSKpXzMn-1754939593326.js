import{i as J,r as S,c as N,w as Z,j as v,m as n,k as a,aa as me,ab as G,ac as fe,ad as be,ae as De,_ as X,y as P,b as p,z as y,F as z,A as O,af as le,v as T,t as _,x as $,q,ag as de,ah as Oe,u as ge,o as Ke,D as Y,ai as qe,G as He,aj as ye,X as Ze,n as Ye,a as ae,Y as Ge,M as Je,B as ve}from"./index-BMvx8pDm-1754939593326.js";import{u as Xe}from"./useV4Templates-r992MmW--1754939593326.js";import{u as Qe}from"./useV4TemplateCommands-D7eHuUAa-1754939593326.js";import{a as et}from"./useV4VariableLists-BoLeTX9E-1754939593326.js";import"./useV4LiveQuery-CJ-qgrFo-1754939593326.js";const tt={class:"template-editor"},at=["placeholder","rows","data-testid","aria-label"],lt=J({__name:"TemplateEditorV3C",props:{modelValue:{},label:{},placeholder:{default:"Enter your prompt template..."},required:{type:Boolean},rows:{default:4},variables:{default:()=>[]},variableColors:{default:()=>({})}},emits:["update:modelValue"],setup(K,{expose:M,emit:m}){const F=K,W=m,b=S(),x=S(),B=S(!1),I=N({get:()=>F.modelValue,set:u=>W("update:modelValue",u)}),L=N(()=>{let u=s(I.value);return u=u.replace(/\{\{(\w+)\}\}/g,(f,i)=>{const o=/^\w+$/.test(i),C=F.variableColors[i];return o&&C?`<span class="variable-highlight" style="background-color: ${C.bg}; box-shadow: 0 0 0 1px ${C.bg};">${s(f)}</span>`:o?`<span class="variable-highlight">${s(f)}</span>`:`<span class="variable-error">${s(f)}</span>`}),u=u.replace(/\n/g,"<br>"),u=u.replace(/  /g," &nbsp;"),u.endsWith("<br>")||(u+="<br>"),u});function s(u){const f=document.createElement("div");return f.textContent=u,f.innerHTML}function k(){!b.value||!x.value||(x.value.scrollTop=b.value.scrollTop,x.value.scrollLeft=b.value.scrollLeft)}return Z(I,async()=>{await De(),k()}),M({focus:()=>{var u;return(u=b.value)==null?void 0:u.focus()}}),(u,f)=>{const i=fe("dompurify-html");return n(),v("div",tt,[a("div",{class:me(["editor-container",{focused:B.value}])},[G(a("div",{ref_key:"highlightRef",ref:x,class:"editor-highlight","aria-hidden":"true"},null,512),[[i,L.value,"template"]]),G(a("textarea",{ref_key:"textareaRef",ref:b,"onUpdate:modelValue":f[0]||(f[0]=o=>I.value=o),class:"editor-textarea",placeholder:u.placeholder,rows:u.rows,"data-testid":u.$attrs["data-testid"]||"textarea-template-editor","aria-label":u.$attrs["aria-label"]||"Template editor textarea",onFocus:f[1]||(f[1]=o=>B.value=!0),onBlur:f[2]||(f[2]=o=>B.value=!1),onScroll:k},null,40,at),[[be,I.value]])],2)])}}}),st=X(lt,[["__scopeId","data-v-da627e6e"]]),it={class:"variable-chip-input"},nt={key:0,class:"attributed-list-display"},ot={class:"list-header"},rt={class:"source-name"},ut={key:0,class:"attribute-breakdown"},dt={key:0,class:"separator"},vt={class:"total-conditions"},ct={class:"attributed-chips-container"},pt={class:"item-name"},mt={key:0,class:"attributes-wrapper"},ft={key:1,class:"direct-values"},bt={key:0,class:"simple-list-display"},gt={class:"list-header"},yt={class:"source-name"},_t={class:"tag-input-wrapper"},ht={class:"custom-tag-input"},kt={class:"tag-container tag-container-readonly"},wt=["title"],$t={key:0,class:"readonly-hint"},Ct={key:0,class:"helper-text"},Vt={key:1,class:"tag-input-wrapper"},xt={class:"custom-tag-input"},Lt={class:"tag-container"},Tt={class:"floating-actions"},Rt=["title"],Et=["onClick","data-testid","aria-label"],St=["placeholder","aria-label","onKeydown"],Pt={key:0,class:"helper-text"},It=J({__name:"VariableChipInputV3C",props:{values:{},listRef:{},listName:{},source:{},placeholder:{},attributedSamples:{},attributeBreakdown:{},attributeKeys:{},previewValues:{},totalCount:{}},emits:["update:values","clear-source","clear-list","select-list"],setup(K,{emit:M}){const m=K,F=M,W=S(""),b=S();function x(){return[{bg:"#d1fae5",text:"#166534"},{bg:"#e9d5ff",text:"#7c2d12"},{bg:"#fed7aa",text:"#c2410c"},{bg:"#fce7f3",text:"#be185d"},{bg:"#fef3c7",text:"#92400e"}]}function B(i){return m.attributeKeys?Object.entries(i).map(([o,C])=>{const t=m.attributeKeys.indexOf(o)%5;return{value:C,colorIndex:t}}):[]}function I(i){F("update:values",i),m.source&&F("clear-source")}function L(){const i=W.value.trim();i&&(m.values.includes(i)||I([...m.values,i]),W.value="")}function s(i){var t;i.preventDefault();const C=(((t=i.clipboardData)==null?void 0:t.getData("text"))||"").split(/\r?\n/).map(c=>c.trim()).filter(c=>c.length>0);if(C.length>0){const c=new Set(m.values),V=C.filter(U=>!c.has(U));V.length>0&&I([...m.values,...V]),W.value=""}}function k(i){const o=[...m.values];o.splice(i,1),I(o)}function u(){if(W.value===""&&m.values.length>0){const i=[...m.values];i.pop(),I(i)}}function f(){I([]),m.source&&F("clear-source")}return(i,o)=>{const C=T("a-button");return n(),v("div",it,[i.listRef&&i.attributedSamples?(n(),v("div",nt,[a("div",ot,[o[6]||(o[6]=a("span",{class:"source-label"},"From list:",-1)),a("span",rt,y(i.listName||"Unknown List"),1),i.attributeBreakdown&&i.attributeBreakdown.parts.length>0?(n(),v("div",ut,[(n(!0),v(z,null,O(i.attributeBreakdown.parts,(t,c)=>(n(),v(z,{key:`part-${t.text}-${c}`},[a("span",{class:"attribute-part",style:le({backgroundColor:x()[t.colorIndex].bg,color:x()[t.colorIndex].text})},y(t.text),5),c<i.attributeBreakdown.parts.length-1?(n(),v("span",dt," × ")):P("",!0)],64))),128)),o[4]||(o[4]=a("span",{class:"arrow"}," → ",-1)),a("span",vt,y(i.attributeBreakdown.totalItems)+" conditions",1)])):P("",!0),p(C,{size:"small",danger:"",onClick:o[0]||(o[0]=t=>i.$emit("clear-list")),"data-testid":"btn-remove-list","aria-label":"Remove linked variable list"},{default:_(()=>o[5]||(o[5]=[$(" Remove List ")])),_:1,__:[5]})]),a("div",ct,[o[9]||(o[9]=a("span",{class:"sample-hint"},"Sample values:",-1)),(n(!0),v(z,null,O(i.attributedSamples,t=>(n(),v("div",{key:t.value,class:"attributed-item-chip"},[a("span",pt,y(t.value),1),t.attributes?(n(),v("span",mt,[o[7]||(o[7]=$(" (")),(n(!0),v(z,null,O(B(t.attributes),(c,V)=>(n(),v("span",{key:`attr-${c.value}-${V}`,class:"attribute-value",style:le({backgroundColor:x()[c.colorIndex].bg,color:x()[c.colorIndex].text})},y(c.value),5))),128)),o[8]||(o[8]=$(") "))])):P("",!0)]))),128))])])):(n(),v("div",ft,[i.source?(n(),v("div",bt,[a("div",gt,[o[12]||(o[12]=a("span",{class:"source-label"},"From list:",-1)),a("span",yt,y(i.source.listName),1),o[13]||(o[13]=a("span",{class:"edit-hint"},"(Unlink list to edit)",-1)),p(C,{size:"small",type:"primary",onClick:o[1]||(o[1]=t=>i.$emit("clear-source")),"data-testid":"btn-unlink-list","aria-label":"Unlink list and edit values directly"},{default:_(()=>o[10]||(o[10]=[$(" Unlink List and Edit Directly ")])),_:1,__:[10]}),p(C,{size:"small",danger:"",onClick:f,"data-testid":"btn-clear-values","aria-label":"Remove all values from list"},{default:_(()=>o[11]||(o[11]=[$(" Remove List ")])),_:1,__:[11]})]),a("div",_t,[a("div",ht,[a("div",kt,[(n(!0),v(z,null,O(i.values,(t,c)=>(n(),v("div",{key:`${t}-${c}`,class:"tag tag-readonly"},[a("span",{class:"tag-text",title:t.length>100?t:""},y(t.length>100?t.substring(0,100)+"...":t),9,wt)]))),128)),i.values.length===0?(n(),v("span",$t," Values from linked list will appear here ")):P("",!0)]),i.values.length>0?(n(),v("div",Ct,y(i.values.length)+" values ",1)):P("",!0)])])])):P("",!0),i.source?P("",!0):(n(),v("div",Vt,[a("div",xt,[a("div",Lt,[a("div",Tt,[i.values.length>0?(n(),q(C,{key:0,size:"small",danger:"",onClick:f,"data-testid":"btn-clear-all","aria-label":"Clear all values"},{default:_(()=>o[14]||(o[14]=[$(" Clear ")])),_:1,__:[14]})):P("",!0),p(C,{size:"small",onClick:o[2]||(o[2]=t=>i.$emit("select-list")),"data-testid":"btn-select-list","aria-label":"Replace values with a variable list"},{default:_(()=>o[15]||(o[15]=[$(" Replace with List ")])),_:1,__:[15]})]),(n(!0),v(z,null,O(i.values,(t,c)=>(n(),v("div",{key:`${t}-${c}`,class:"tag"},[a("span",{class:"tag-text",title:t.length>100?t:""},y(t.length>100?t.substring(0,100)+"...":t),9,Rt),a("button",{type:"button",class:"tag-remove",onClick:V=>k(c),"data-testid":`btn-remove-tag-${c}`,"aria-label":`Remove value ${t}`}," × ",8,Et)]))),128)),G(a("input",{ref_key:"inputField",ref:b,"onUpdate:modelValue":o[3]||(o[3]=t=>W.value=t),placeholder:i.placeholder,class:"tag-input-field","data-testid":"input-variable-value","aria-label":i.placeholder||"Enter variable value",onKeydown:[de(Oe(L,["prevent"]),["enter"]),de(u,["backspace"])],onPaste:s},null,40,St),[[be,W.value]])]),i.values.length>0?(n(),v("div",Pt,y(i.values.length)+" values ",1)):P("",!0)])]))]))])}}}),ce=X(It,[["__scopeId","data-v-33f1ece4"]]),Wt={class:"variable-preview-cycler"},Bt={class:"preview-controls"},Ft={key:0,class:"cycle-info","data-testid":"cycle-info",role:"status","aria-live":"polite"},Ut=["aria-label"],At={key:0,class:"preview-content"},Nt={key:0,class:"no-variables"},zt={key:1,class:"single-preview","data-testid":"single-preview"},jt={class:"preview-template","data-testid":"preview-template",role:"region","aria-label":"Preview of filled-in prompt"},Mt={key:2,class:"cycling-preview","data-testid":"cycling-preview"},Dt={class:"preview-template","data-testid":"preview-template-cycling",role:"region","aria-label":"Preview of filled-in prompt with cycling variables"},Ot={class:"variable-legend"},Kt=["data-testid"],qt={class:"variable-value"},Ht=J({__name:"VariablePreviewCyclerV3C",props:{template:{},variableBindings:{},variables:{},variableListRefs:{}},emits:["toggle-preview"],setup(K,{emit:M}){const m=K,F=M,W=ge(),b=S(!1),x=S(0);let B=null;const I=["variable-highlight-blue","variable-highlight-green","variable-highlight-purple","variable-highlight-orange","variable-highlight-pink","variable-highlight-teal"],L=N(()=>{let t=[];if(m.variableBindings?t=Object.keys(m.variableBindings):m.variables&&(t=Object.keys(m.variables)),m.variableListRefs){const c=Object.keys(m.variableListRefs);t=[...new Set([...t,...c])]}return t}),s=N(()=>{if(L.value.length===0)return[];const t=[],c=W.variableLists.value;for(const w of L.value){let R=[];if(m.variableBindings){const E=m.variableBindings[w];if(E.type==="value"&&E.values)R=[...E.values];else if(E.type==="list"&&E.listId){const h=c.find(j=>j.id===E.listId);h&&(h.category==="simple"&&h.values?R=[...h.values]:h.category==="attributed"&&h.items&&(R=h.items.map(j=>j.value)))}}else if(m.variables&&m.variables[w]&&m.variables[w].length>0)R=[...m.variables[w]];else if(m.variableListRefs&&m.variableListRefs[w]){const E=m.variableListRefs[w],h=c.find(j=>j.id===E);h&&(h.category==="simple"&&h.values?R=[...h.values]:h.category==="attributed"&&h.items&&(R=h.items.map(j=>j.value)))}R.length>0&&t.push({name:w,values:R})}if(t.length===0)return[];function V(w){return w.reduce((R,E)=>R.flatMap(h=>E.map(j=>[...h,j])),[[]])}const U=t.map(w=>w.values);return V(U).map(w=>{const R={};return t.forEach((E,h)=>{R[E.name]=w[h]}),R})});function k(){b.value=!b.value,F("toggle-preview",b.value),b.value&&s.value.length>1?u():f()}function u(){f(),B=setInterval(()=>{x.value=(x.value+1)%s.value.length},1e3)}function f(){B&&(clearInterval(B),B=null)}function i(t){return I[t%I.length]}function o(t){let c=C(m.template);return L.value.forEach((V,U)=>{if(t[V]!==void 0){const A=C(V),w=new RegExp(`\\{\\{\\s*${A}\\s*\\}\\}`,"g"),E=`<span class="${i(U)}">${C(String(t[V]))}</span>`;c=c.replace(w,E)}}),c}function C(t){const c=document.createElement("div");return c.textContent=t,c.innerHTML}return Z(()=>m.template,()=>{x.value=0}),Z(s,t=>{t.length===0?f():b.value&&t.length>1&&u(),x.value>=t.length&&(x.value=0)}),Ke(()=>{f()}),(t,c)=>{const V=T("a-button"),U=fe("dompurify-html");return n(),v("div",Wt,[a("div",Bt,[p(V,{type:b.value?"default":"primary",ghost:!b.value,onClick:k,class:"toggle-button","data-testid":"btn-toggle-preview-mode","aria-label":b.value?"Return to editor mode":"Preview filled-in prompts","aria-pressed":b.value},{default:_(()=>[b.value?(n(),q(Y(He),{key:1})):(n(),q(Y(qe),{key:0})),$(" "+y(b.value?"Return to Editor Mode":"Preview Filled-In Prompts"),1)]),_:1},8,["type","ghost","aria-label","aria-pressed"]),b.value&&s.value.length>1?(n(),v("div",Ft,[a("span",{class:"cycle-counter","data-testid":"cycle-counter","aria-label":`Showing combination ${x.value+1} of ${s.value.length}`},y(x.value+1)+" / "+y(s.value.length),9,Ut),c[0]||(c[0]=a("span",{class:"cycle-hint"},"Auto-cycling every second",-1))])):P("",!0)]),b.value?(n(),v("div",At,[s.value.length===0?(n(),v("div",Nt,[p(Y(ye)),c[1]||(c[1]=a("span",null,"No variables detected in template",-1))])):s.value.length===1?(n(),v("div",zt,[G(a("div",jt,null,512),[[U,o(s.value[0]),"template"]])])):(n(),v("div",Mt,[G(a("div",Dt,null,512),[[U,o(s.value[x.value]),"template"]]),a("div",Ot,[(n(!0),v(z,null,O(L.value,(A,w)=>(n(),v("div",{key:A,class:"legend-item","data-testid":`legend-item-${A}`},[a("span",{class:me(i(w))},y(A),3),a("span",qt,y(s.value[x.value][A]),1)],8,Kt))),128))])]))])):P("",!0)])}}}),Zt=X(Ht,[["__scopeId","data-v-2f9c69f3"]]),Yt={class:"list-selector"},Gt={key:0,class:"loading-container"},Jt={key:0,class:"list-grid"},Xt=["onClick"],Qt={class:"list-header"},ea={class:"item-count"},ta={key:0,class:"list-description"},aa={class:"list-preview"},la={key:0,class:"preview-more"},sa={key:1,class:"attributed-badge"},ia={key:1,class:"empty-state"},na=J({__name:"ListSelectorV3C",props:{modelValue:{type:Boolean},listType:{}},emits:["update:modelValue","select"],setup(K,{emit:M}){const m=K,F=M,W=ge(),b=N(()=>W.variableLists.value),x=N(()=>!1),B=N(()=>null),I=N(()=>{if(!b.value)return[];let k=[];return m.listType==="all"?k=b.value.filter(u=>u.category!=="tabular"):m.listType==="simple"?k=b.value.filter(u=>u.category==="simple"):m.listType==="refusal"&&(k=b.value.filter(u=>u.category==="refusal")),k}),L=k=>{var u;return k.category==="attributed"&&k.items?k.items.slice(0,5).map(f=>f.value):((u=k.values)==null?void 0:u.slice(0,5))??[]},s=k=>{F("select",k),F("update:modelValue",!1)};return(k,u)=>{const f=T("a-spin"),i=T("a-alert"),o=T("a-button"),C=T("a-modal");return n(),q(C,{open:k.modelValue,title:"Select List",width:"80vw",style:{maxWidth:"800px"},"onUpdate:open":u[1]||(u[1]=t=>k.$emit("update:modelValue",t)),onCancel:u[2]||(u[2]=t=>k.$emit("update:modelValue",!1))},{footer:_(()=>[p(o,{onClick:u[0]||(u[0]=t=>k.$emit("update:modelValue",!1))},{default:_(()=>u[3]||(u[3]=[$(" Cancel ")])),_:1,__:[3]})]),default:_(()=>[a("div",Yt,[x.value?(n(),v("div",Gt,[p(f,{size:"large",tip:"Loading lists..."})])):B.value?(n(),q(i,{key:1,type:"error",message:B.value.message||"Failed to load lists",class:"error-alert"},null,8,["message"])):(n(),v(z,{key:2},[I.value.length>0?(n(),v("div",Jt,[(n(!0),v(z,null,O(I.value,t=>(n(),v("div",{key:t.id,class:"list-option",onClick:c=>s(t)},[a("div",Qt,[a("h4",null,y(t.name),1),a("span",ea,y(t.itemCount)+" items",1)]),t.description?(n(),v("p",ta,y(t.description),1)):P("",!0),a("div",aa,[(n(!0),v(z,null,O(L(t),(c,V)=>(n(),v("span",{key:`${t.id}-preview-${V}-${c}`,class:"preview-value"},y(c),1))),128)),t.itemCount>5?(n(),v("span",la," +"+y(t.itemCount-5)+" more ",1)):P("",!0)]),t.category==="attributed"?(n(),v("div",sa," Attributed List ")):P("",!0)],8,Xt))),128))])):(n(),v("div",ia," No "+y(k.listType)+" lists available ",1))],64))])]),_:1},8,["open"])}}}),pe=X(na,[["__scopeId","data-v-919c7c67"]]),oa={class:"template-editor-page"},ra={class:"header-content"},ua={class:"page-title"},da={class:"design-form-container"},va={key:0,class:"loading-container"},ca={class:"name-desc-row"},pa={key:0,class:"variable-hint"},ma={key:0,class:"variables-container"},fa={class:"variable-label"},ba={class:"variable-content"},ga={class:"output-row"},ya={class:"refusal-row"},_a={class:"refusal-content"},ha={class:"footer-content"},ka={class:"stats"},wa={class:"actions"},$a={class:"pricing-content"},Ca={key:0,class:"token-stats"},Va={class:"stats-grid"},xa={class:"pricing-placeholder"},La=J({__name:"TemplateEditorViewV3C",setup(K){const M=Ze(),m=Je(),{templates:F,loading:W}=Xe(),{variableLists:b}=et(),{createTemplate:x,updateTemplate:B,isExecuting:I}=Qe(),L=N(()=>M.params.id),s=S({name:"",description:"",template:"",outputType:"text",extractPattern:"",refusalWords:[],refusalWordsListRef:"",refusalWordsSource:null,rejectRefusalWords:!1}),k=N(()=>W.value||I.value),u=S([]),f=S({}),i=S({}),o=S({}),C=S(!1),t=S(!1),c=S("all"),V=S(""),U=S(!1),A=S(null),w=S(null),R=[{label:"First Number",value:"(\\d+(?:\\.\\d+)?)"},{label:"Last Number",value:".*\\b(\\d+(?:\\.\\d+)?)\\b"},{label:"First Dollar Value",value:"\\$([\\d,]+(?:\\.\\d{2})?)"},{label:"Last Dollar Value",value:".*\\$([\\d,]+(?:\\.\\d{2})?)"},{label:"Number After =",value:"=\\s*(\\d+(?:\\.\\d+)?)"},{label:"First Word",value:"\\b(\\w+)\\b"},{label:"Last Word",value:".*\\b(\\w+)\\b"},{label:"First Phrase",value:"^([^.!?]+)"},{label:"Last Phrase",value:"([^.!?]+)[.!?]?$"},{label:"Extract Email",value:"/([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,})/i"},{label:"Extract URL",value:"(https?:\\/\\/[^\\s]+)"},{label:"Extract Yes/No",value:"/\\b(yes|no)\\b/i"},{label:"Extract JSON",value:"(\\{[^}]*\\})"}],E=[{bg:"#E8D5F2",text:"#6B21A8"},{bg:"#D5F2E8",text:"#047857"},{bg:"#FFE4D6",text:"#C2410C"},{bg:"#D6E4FF",text:"#1E40AF"},{bg:"#F3E8D5",text:"#92400E"}],h=N(()=>{if(!s.value.template)return[];const l=/\{\{([^}]+)\}\}/g,e=new Set;let r;for(;(r=l.exec(s.value.template))!==null;){const g=r[1].trim();/^\w+$/.test(g)&&e.add(g)}return Array.from(e)}),j=N(()=>{const l={};return h.value.forEach((e,r)=>{l[e]=E[r%E.length]}),l}),se=N(()=>{let l=1;for(const e of h.value){const r=f.value[e]||[],g=i.value[e];if(g){const D=b.value.find(H=>H.id===g);D&&(l*=D.itemCount||1)}else r.length>0&&(l*=r.length)}return{total:l,formatted:l.toLocaleString()}});function ie(l){const e=h.value.indexOf(l);return E[e%E.length]}function _e(l){return`{{${l}}}`}function he(l){ae.info("Preview mode toggled",{isPreviewMode:l})}function ke(l){const e=i.value[l];if(!e)return;const r=b.value.find(g=>g.id===e);return r==null?void 0:r.name}function we(l){const e=i.value[l];if(!e)return;const r=b.value.find(g=>g.id===e);return r==null?void 0:r.itemCount}function $e(l){const e=i.value[l];if(!e)return;const r=b.value.find(g=>g.id===e);if(!(!r||r.category!=="attributed"||!r.items))return r.items.slice(0,10)}function Ce(l){const e=i.value[l];if(!e)return;const r=b.value.find(D=>D.id===e);if(!r||r.category!=="attributed")return;const g=[];return r.attributeKeys&&g.push(...r.attributeKeys.map((D,H)=>({text:D,colorIndex:H%5}))),{parts:g,totalItems:r.itemCount||0}}function Ve(l){const e=i.value[l];if(!e)return;const r=b.value.find(g=>g.id===e);return r!=null&&r.attributeKeys?[...r.attributeKeys]:void 0}function xe(l){var g;const e=i.value[l];if(!e)return;const r=b.value.find(D=>D.id===e);if(!(!r||r.category!=="simple"))return(g=r.values)==null?void 0:g.slice(0,10)}function Le(l,e){f.value[l]=e}function Te(l){o.value[l]=null}function Re(l){i.value[l]="",f.value[l]=[]}function Ee(l){V.value=l,c.value="all",C.value=!0}function Se(l){V.value&&(l.category==="simple"?(f.value[V.value]=[...l.values||[]],i.value[V.value]="",o.value[V.value]={listId:l.id,listName:l.name}):(i.value[V.value]=l.id,f.value[V.value]=[],o.value[V.value]=null)),C.value=!1}function Pe(){if(!s.value.refusalWordsListRef)return;const l=b.value.find(e=>e.id===s.value.refusalWordsListRef);return l==null?void 0:l.name}function Ie(){s.value.refusalWordsListRef="",s.value.refusalWords=[]}function We(l){(l.category==="simple"||l.category==="refusal")&&l.values&&(s.value.refusalWords=[...l.values],s.value.refusalWordsListRef="",s.value.refusalWordsSource=null),t.value=!1}function Be(){s.value.extractPattern=A.value}Z(()=>s.value.extractPattern,l=>{const e=R.find(r=>r.value===l);A.value=e?e.value:null});function ne(){m.push({name:"templates"})}async function oe(){var l;try{if(u.value=[],!s.value.name.trim()){u.value.push("Template name is required");return}if(!s.value.template.trim()){u.value.push("Template content is required");return}const e={};for(const g of h.value)i.value[g]?e[g]={type:"list",listId:i.value[g]}:((l=f.value[g])==null?void 0:l.length)>0&&(e[g]={type:"value",values:[...f.value[g]]});const r={name:s.value.name,description:s.value.description,template:s.value.template,variables:e,category:"Custom",tags:[],outputType:s.value.outputType,extractPattern:s.value.extractPattern,refusalWords:s.value.refusalWords.length>0?[...s.value.refusalWords]:void 0,rejectRefusalWords:s.value.rejectRefusalWords};if(L.value){const g=await B(L.value,r);if(g.ok)ve.success("Template updated successfully");else{u.value=[g.error.message];return}}else{const g=await x(r);if(g.ok)ve.success("Template created successfully");else{u.value=[g.error.message];return}}m.push({name:"templates"})}catch(e){ae.error("Failed to save template:",e),u.value=[e instanceof Error?e.message:"Failed to save template"]}}function re(){if(!L.value)return;const l=F.value.find(e=>e.id===L.value);if(!l){W.value||(u.value=["Template not found"]);return}s.value.name=l.name,s.value.description=l.description||"",s.value.template=l.template,s.value.outputType=l.outputType||"text",s.value.extractPattern=l.extractPattern||"",s.value.refusalWords=l.refusalWords?[...l.refusalWords]:[],s.value.rejectRefusalWords=l.rejectRefusalWords||!1,f.value={},i.value={},o.value={};for(const[e,r]of Object.entries(l.variables))r.type==="list"&&r.listId?i.value[e]=r.listId:r.type==="value"&&r.values&&(f.value[e]=[...r.values])}return Z(()=>s.value.extractPattern,l=>{const e=R.find(r=>r.value===l);A.value=e?e.value:null},{immediate:!0}),Z(U,async l=>{l&&!w.value&&(w.value={promptTokens:Math.ceil(s.value.template.length/4),totalEstimate:Math.ceil(s.value.template.length/3),variableTokens:{}})}),Ye(()=>{ae.info("TemplateEditorViewV3C mounted with V4 real-time data",{templateId:L.value,isEdit:!!L.value}),L.value&&re();const l=R.find(e=>e.value===s.value.extractPattern);A.value=l?l.value:null}),Z([()=>M.params.id,F],()=>{L.value&&re()},{immediate:!0}),(l,e)=>{const r=T("a-button"),g=T("a-layout-header"),D=T("a-spin"),H=T("a-input"),te=T("a-form-item"),Q=T("a-select-option"),ue=T("a-select"),Fe=T("a-checkbox"),Ue=T("a-alert"),Ae=T("a-form"),Ne=T("a-layout-content"),ze=T("a-layout-footer"),je=T("a-layout"),Me=T("a-modal");return n(),v("div",oa,[p(je,null,{default:_(()=>[p(g,{class:"editor-header"},{default:_(()=>[a("div",ra,[p(r,{type:"text",onClick:ne,class:"back-button","data-testid":"btn-back-to-templates"},{icon:_(()=>[p(Y(Ge))]),default:_(()=>[e[16]||(e[16]=$(" Back to Templates "))]),_:1,__:[16]}),a("h1",ua,y(L.value?"Edit Template":"Create Template"),1)])]),_:1}),p(Ne,{class:"editor-content"},{default:_(()=>[a("div",da,[k.value?(n(),v("div",va,[p(D,{size:"large",tip:"Loading template..."})])):(n(),q(Ae,{key:1,model:s.value,layout:"vertical",onFinish:oe},{default:_(()=>[a("div",ca,[e[17]||(e[17]=a("label",{class:"inline-field-label"},"Name",-1)),p(te,{name:"name",rules:[{required:!0,message:"Required"}],class:"name-field"},{default:_(()=>[p(H,{value:s.value.name,"onUpdate:value":e[0]||(e[0]=d=>s.value.name=d),placeholder:"Enter template name",size:"large","data-testid":"input-template-name","aria-label":"Template name"},null,8,["value"])]),_:1}),e[18]||(e[18]=a("label",{class:"inline-field-label"},"Description",-1)),p(te,{name:"description",class:"desc-field"},{default:_(()=>[p(H,{value:s.value.description,"onUpdate:value":e[1]||(e[1]=d=>s.value.description=d),placeholder:"Optional description",size:"large","data-testid":"input-template-description","aria-label":"Template description"},null,8,["value"])]),_:1})]),p(te,{label:"Template",name:"template",rules:[{required:!0,message:"Required"}],class:"template-form-item"},{default:_(()=>[h.value.length===0?(n(),v("div",pa,[p(Y(ye)),e[19]||(e[19]=a("span",null,[$("Type a prompt and use double curly braces to add a variable with conditions to vary, like "),a("code",null,"{{name}}"),$(" or "),a("code",null,"{{system_prompt}}"),$(". Variable names cannot contain spaces or punctuation except underscores (_).")],-1))])):P("",!0),p(st,{modelValue:s.value.template,"onUpdate:modelValue":e[2]||(e[2]=d=>s.value.template=d),placeholder:"Enter your prompt template... Use {{variable}} for variables",rows:7,variables:h.value,"variable-colors":j.value,"data-testid":"template-editor","aria-label":"Prompt template editor"},null,8,["modelValue","variables","variable-colors"]),h.value.length>0&&s.value.template?(n(),q(Zt,{key:1,template:s.value.template,variables:f.value,"variable-list-refs":i.value,onTogglePreview:he},null,8,["template","variables","variable-list-refs"])):P("",!0)]),_:1}),h.value.length>0?(n(),v("div",ma,[(n(!0),v(z,null,O(h.value,d=>(n(),v("div",{key:d,class:"variable-row"},[a("div",fa,[e[20]||(e[20]=a("span",{class:"variable-text"},"Variable:",-1)),a("span",{style:le({backgroundColor:ie(d).bg,color:ie(d).text}),class:"variable-badge"},y(_e(d)),5)]),a("div",ba,[p(ce,{values:f.value[d]||[],"list-ref":i.value[d],"list-name":ke(d),source:o.value[d]||null,placeholder:`Enter a value for {{${d}}} and hit enter`,"attributed-samples":$e(d),"attribute-breakdown":Ce(d),"attribute-keys":Ve(d),"preview-values":xe(d),"total-count":we(d),"onUpdate:values":ee=>Le(d,ee),onClearSource:ee=>Te(d),onClearList:ee=>Re(d),onSelectList:ee=>Ee(d)},null,8,["values","list-ref","list-name","source","placeholder","attributed-samples","attribute-breakdown","attribute-keys","preview-values","total-count","onUpdate:values","onClearSource","onClearList","onSelectList"])])]))),128))])):P("",!0),a("div",ga,[e[24]||(e[24]=a("label",{class:"row-label"},"Output Format",-1)),p(ue,{value:s.value.outputType,"onUpdate:value":e[3]||(e[3]=d=>s.value.outputType=d),size:"large",style:{width:"calc(var(--spacing-xl) * 7.5)"},"data-testid":"select-output-format","aria-label":"Select output format type"},{default:_(()=>[p(Q,{value:"text"},{default:_(()=>e[21]||(e[21]=[$("Text")])),_:1,__:[21]}),p(Q,{value:"number"},{default:_(()=>e[22]||(e[22]=[$("Number")])),_:1,__:[22]}),p(Q,{value:"boolean"},{default:_(()=>e[23]||(e[23]=[$("Boolean")])),_:1,__:[23]})]),_:1},8,["value"]),e[25]||(e[25]=a("label",{class:"inline-label"},"Parse Preset",-1)),p(ue,{value:A.value,"onUpdate:value":e[4]||(e[4]=d=>A.value=d),size:"large",style:{flex:"1"},placeholder:"Custom regex",onChange:Be,"data-testid":"select-parse-preset","aria-label":"Select parsing preset"},{default:_(()=>[(n(),v(z,null,O(R,d=>p(Q,{key:d.value,value:d.value},{default:_(()=>[$(y(d.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),e[26]||(e[26]=a("label",{class:"inline-label"},"Regex Extract",-1)),p(H,{value:s.value.extractPattern,"onUpdate:value":e[5]||(e[5]=d=>s.value.extractPattern=d),placeholder:"Leave blank for full response",size:"large",style:{flex:"1"},"data-testid":"input-regex-extract","aria-label":"Regular expression extraction pattern"},null,8,["value"])]),a("div",ya,[e[28]||(e[28]=a("label",{class:"row-label"},"Parse Refusals",-1)),a("div",_a,[p(ce,{values:s.value.refusalWords,"list-ref":s.value.refusalWordsListRef,"list-name":Pe(),source:s.value.refusalWordsSource||null,placeholder:"Enter a refusal word and hit enter (e.g., cannot, unable, refuse)","onUpdate:values":e[6]||(e[6]=d=>s.value.refusalWords=d),onClearSource:e[7]||(e[7]=d=>s.value.refusalWordsSource=null),onClearList:e[8]||(e[8]=d=>Ie()),onSelectList:e[9]||(e[9]=d=>t.value=!0)},null,8,["values","list-ref","list-name","source"])]),p(Fe,{checked:s.value.rejectRefusalWords,"onUpdate:checked":e[10]||(e[10]=d=>s.value.rejectRefusalWords=d),class:"reject-checkbox","data-testid":"checkbox-reject-refusals","aria-label":"Reject responses containing refusal words"},{default:_(()=>e[27]||(e[27]=[$(" Reject on match ")])),_:1,__:[27]},8,["checked"])]),u.value.length>0?(n(),q(Ue,{key:1,type:"error","show-icon":"",class:"error-alert"},{message:_(()=>[$(y(u.value.join(", ")),1)]),_:1})):P("",!0)]),_:1},8,["model"]))])]),_:1}),p(ze,{class:"editor-footer"},{default:_(()=>[a("div",ha,[a("div",ka,y(h.value.length)+" variables • "+y(se.value.formatted)+" combinations ",1),a("div",wa,[p(r,{size:"large",onClick:e[11]||(e[11]=d=>U.value=!0),"data-testid":"btn-calculate-pricing","aria-label":"Calculate pricing for this template"},{default:_(()=>e[29]||(e[29]=[$(" Calculate Pricing ")])),_:1,__:[29]}),p(r,{size:"large",onClick:ne,"data-testid":"btn-cancel-template","aria-label":"Cancel and go back to templates"},{default:_(()=>e[30]||(e[30]=[$(" Cancel ")])),_:1,__:[30]}),p(r,{size:"large",type:"primary",onClick:oe,"data-testid":"btn-save-template","aria-label":"Save template and go back to templates"},{default:_(()=>e[31]||(e[31]=[$(" Save ")])),_:1,__:[31]})])])]),_:1})]),_:1}),p(pe,{modelValue:C.value,"onUpdate:modelValue":e[12]||(e[12]=d=>C.value=d),"list-type":c.value,onSelect:Se},null,8,["modelValue","list-type"]),p(pe,{modelValue:t.value,"onUpdate:modelValue":e[13]||(e[13]=d=>t.value=d),"list-type":"refusal",onSelect:We},null,8,["modelValue"]),p(Me,{open:U.value,"onUpdate:open":e[15]||(e[15]=d=>U.value=d),title:"Cost Estimation",width:"90vw",style:{maxWidth:"1000px"}},{footer:_(()=>[p(r,{onClick:e[14]||(e[14]=d=>U.value=!1)},{default:_(()=>e[37]||(e[37]=[$("Close")])),_:1,__:[37]})]),default:_(()=>[a("div",$a,[w.value?(n(),v("div",Ca,[e[32]||(e[32]=a("h4",null,"Token Analysis",-1)),a("div",Va,[a("div",null,"Min: "+y(w.value.promptTokens),1),a("div",null,"Max: "+y(w.value.totalEstimate),1),a("div",null,"Avg: "+y(Math.round((w.value.promptTokens+w.value.totalEstimate)/2)),1),a("div",null,"Variables: "+y(Object.keys(w.value.variableTokens).length),1)])])):P("",!0),a("div",xa,[e[36]||(e[36]=a("p",null,"Pricing calculation will be implemented with V3 backend integration.",-1)),a("p",null,[e[33]||(e[33]=$("Template: ")),a("strong",null,y(s.value.name||"Untitled"),1)]),a("p",null,[e[34]||(e[34]=$("Variables: ")),a("strong",null,y(h.value.length),1)]),a("p",null,[e[35]||(e[35]=$("Combinations: ")),a("strong",null,y(se.value.formatted),1)])])])]),_:1},8,["open"])])}}}),Ia=X(La,[["__scopeId","data-v-4b096dee"]]);export{Ia as default};
