import{o as V,a as d,c as r,l as w,d as B}from"./index-BHXEDjmJ.js";import{u as I}from"./useV4LiveQuery-1pEB3sHw.js";const E="v4-data-updates";let f=null;function v(){return f||(f=new BroadcastChannel(E),d.debug("V4 Cross-tab communication initialized")),f}function Q(a,o){try{const s=v(),i={type:"data-changed",table:a,operation:o,timestamp:Date.now()};s.postMessage(i),d.debug("V4 Cross-tab broadcast sent:",i)}catch(s){console.warn("V4 Cross-tab broadcast failed:",s)}}function P(a){const o=v(),s=i=>{d.debug("V4 Cross-tab message received:",i.data),a(i.data)};return o.addEventListener("message",s),V(()=>{o.removeEventListener("message",s)}),{channel:o,cleanup:()=>o.removeEventListener("message",s)}}function x(){const{data:a,loading:o,error:s}=I(()=>w(()=>B.variableLists.orderBy("updated").reverse().toArray()),e=>Object.freeze(e.map(t=>Object.freeze(t))),{initialValue:[],shallow:!0});P(e=>{e.table==="variableLists"&&d.debug("V4 Cross-tab update received for variableLists:",e.operation)});const i=r(()=>a.value),y=r(()=>Object.freeze(a.value.filter(e=>e.category==="simple"))),L=r(()=>Object.freeze(a.value.filter(e=>e.category==="attributed"))),C=r(()=>Object.freeze(a.value.filter(e=>e.category==="refusal"))),p=r(()=>Object.freeze(a.value.filter(e=>e.category==="tabular")));function h(e){return r(()=>{const t=a.value.find(n=>n.id===e);return t?Object.freeze(t):null})}function z(e){return r(()=>Object.freeze(a.value.filter(t=>t.category===e)))}function j(e){return r(()=>{if(!e.trim())return a.value;const t=e.toLowerCase(),n=a.value.filter(c=>{var b;return c.name.toLowerCase().includes(t)||((b=c.description)==null?void 0:b.toLowerCase().includes(t))||c.category.toLowerCase().includes(t)});return Object.freeze(n)})}const O=r(()=>{const e=a.value,t=e.length;if(t===0)return Object.freeze({total:0,byCategory:{simple:0,attributed:0,refusal:0,tabular:0},totalItems:0,avgItemsPerList:0,mostPopularCategory:null});const n=e.reduce((l,u)=>(l[u.category]=(l[u.category]||0)+1,l),{}),c={simple:n.simple||0,attributed:n.attributed||0,refusal:n.refusal||0,tabular:n.tabular||0},b=e.reduce((l,u)=>l+(u.itemCount||0),0);let g=null,m=0;for(const[l,u]of Object.entries(c))u>m&&(m=u,g=l);return Object.freeze({total:t,byCategory:Object.freeze(c),totalItems:b,avgItemsPerList:t>0?Math.round(b/t):0,mostPopularCategory:g})});return{variableLists:i,simpleLists:y,attributedLists:L,refusalLists:C,tabularLists:p,loading:r(()=>o.value),error:r(()=>s.value),getListById:h,getListsByCategory:z,searchLists:j,stats:O}}export{x as a,Q as b,P as u};
