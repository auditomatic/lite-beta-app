import{_ as e,p as l,l as a,N as t,d as o}from"./index-BMmW_fIo.js";import{t as d}from"./token-calculation.service-DZqUO16y.js";import{u as n}from"./useLiveData-n7g3jX7E.js";import{u as s}from"./useLiveDataSingle-B4-VdYVc.js";import{d as i,c as r,ab as u,_ as c,a1 as p,k as m,Z as v,f,Y as g,$ as y,F as k,ac as h,a4 as M,a0 as C,a3 as b,B as _,G as x,r as S,o as w,w as I,u as U}from"./vendor-CdfxntmD.js";import{M as F}from"./ModelCostDisplayV2-D526dbm6.js";const V={class:"model-search-filters"},z={class:"panel-header"},O={class:"search-container"},T=e(i({__name:"ModelSearchFilters",props:{modelValue:{}},emits:["update:modelValue"],setup(e,{emit:l}){const a=e,t=l,o=r({get:()=>a.modelValue,set:e=>t("update:modelValue",e)});return(e,l)=>{const a=v("a-input-search");return c(),u("div",V,[p("div",z,[l[2]||(l[2]=p("h3",null,"Available Models",-1)),p("div",O,[l[1]||(l[1]=p("span",{class:"search-label"},"Search:",-1)),m(a,{value:o.value,"onUpdate:value":l[0]||(l[0]=e=>o.value=e),placeholder:"Search models...",size:"large","allow-clear":"",class:"search-input"},null,8,["value"])])])])}}}),[["__scopeId","data-v-b69ac8fd"]]),P={class:"provider-header"},j={class:"provider-name"},G={class:"provider-model-count"},N={class:"provider-models"},A=["onClick"],E={class:"model-name"},K={key:0,class:"model-specs"},L=e(i({__name:"ModelProviderGroup",props:{groupedModels:{},selectedModelId:{},mode:{},getInputTokensForModel:{type:Function},getOutputTokensForModel:{type:Function},hasConfigPanel:{type:Boolean}},emits:["select-model"],setup(e){const l=f([]);return(e,a)=>{const t=v("a-button"),o=v("a-collapse-panel"),d=v("a-collapse");return c(),g(d,{activeKey:l.value,"onUpdate:activeKey":a[0]||(a[0]=e=>l.value=e),bordered:!1},{default:y(()=>[(c(!0),u(k,null,h(e.groupedModels,(a,d)=>(c(),g(o,{key:d,class:"provider-panel"},{header:y(()=>[p("div",P,[p("span",j,b(d),1),p("span",G,b(a.length)+" models",1)])]),extra:y(()=>[m(t,{size:"small",type:"text",onClick:_(e=>function(e){const a=l.value.indexOf(e);a>-1?l.value.splice(a,1):l.value.push(e)}(d),["stop"])},{default:y(()=>[x(b(l.value.includes(d)?"Collapse":"Expand"),1)]),_:2},1032,["onClick"])]),default:y(()=>[p("div",N,[(c(!0),u(k,null,h(a,l=>(c(),u("div",{key:l.id,class:M(["model-row",{selected:e.selectedModelId===l.id}]),onClick:a=>e.$emit("select-model",l)},[p("div",E,b(l.displayName),1),e.hasConfigPanel?C("",!0):(c(),u("div",K,[m(F,{model:l,mode:"trial"===e.mode?"range":"input-output","input-tokens":e.getInputTokensForModel(l),"min-output-tokens":10,"max-output-tokens":e.getOutputTokensForModel(l),layout:"inline",size:"medium"},null,8,["model","mode","input-tokens","max-output-tokens"])]))],10,A))),128))])]),_:2},1024))),128))]),_:1},8,["activeKey"])}}}),[["__scopeId","data-v-cdf9d97a"]]),$={class:"config-panel"},B={class:"config-header"},D={class:"config-header-title"},q={class:"total-cost"},J={key:0,class:"cost-info"},R={key:0,class:"config-content"},W={class:"param-description"},Y={class:"param-description"},Z={class:"config-footer"},H={key:0,class:"duplicate-error"},Q=e(i({__name:"ModelConfigurationPanel",props:{selectedModel:{},mode:{},totalCalls:{},costEstimate:{},getInputTokensForModel:{type:Function},getOutputTokensForModel:{type:Function},existingConfigurations:{}},emits:["close","add-configuration","confirm-selection"],setup(e,{emit:o}){const d=e,n=o,s=f(""),i=S({}),M=f(!1),_=f("");w(async()=>{try{await l.waitForReady(),M.value=!0,a.debug("Provider registry ready in ModelConfigurationPanel")}catch(e){a.error("Failed to initialize provider registry",e)}});const V=r(()=>d.selectedModel&&M.value?l.getBasicParameters(d.selectedModel.provider,d.selectedModel.modelId):{}),z=r(()=>d.selectedModel&&M.value?l.getAdvancedParameters(d.selectedModel.provider,d.selectedModel.modelId):{});function O(e){if(e&&(s.value=e.displayName,Object.keys(i).forEach(e=>delete i[e]),M.value)){const a={...l.getBasicParameters(e.provider,e.modelId),...l.getAdvancedParameters(e.provider,e.modelId)};for(const[e,l]of Object.entries(a))void 0!==l.default&&(i[e]=l.default)}}function T(e){return e.replace(/\./g," â€º ").replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())}function P(){_.value="";const e=function(){if(!d.selectedModel||!s.value)return null;const e={},l=(e,l,a)=>{const t=l.split(".");let o=e;for(let d=0;d<t.length-1;d++)o[t[d]]||(o[t[d]]={}),o=o[t[d]];o[t[t.length-1]]=a};for(const[a,t]of Object.entries(i))(null!=t&&""!==t||!1===t)&&l(e,a,t);return{name:s.value,provider:d.selectedModel.provider,modelId:d.selectedModel.modelId,parameters:e}}();if(e){if(d.existingConfigurations){if(d.existingConfigurations.some(l=>l.provider===e.provider&&l.modelId===e.modelId&&JSON.stringify(l.parameters)===JSON.stringify(e.parameters)))return void(_.value=`${e.provider}:${e.modelId} with these parameters is already added. Please modify the parameters or select a different model.`)}n("add-configuration",e)}}return I(()=>d.selectedModel,e=>{O(e),_.value=""},{immediate:!0}),I(i,()=>{_.value=""},{deep:!0}),I(M,e=>{e&&d.selectedModel&&O(d.selectedModel)}),(e,l)=>{const a=v("a-button"),o=v("a-input"),d=v("a-form-item"),n=v("a-input-number"),r=v("a-switch"),f=v("a-select-option"),M=v("a-select"),S=v("a-col"),w=v("a-row"),I=v("a-collapse-panel"),O=v("a-collapse"),j=v("a-form"),G=v("a-alert");return c(),u("div",$,[p("div",B,[p("div",D,[p("h3",null,b("trial"===e.mode?"Configure":"Selected")+": "+b(e.selectedModel.displayName),1),m(a,{type:"text",onClick:l[0]||(l[0]=l=>e.$emit("close")),class:"config-close-btn","aria-label":"Close configuration panel"},{default:y(()=>[m(U(t))]),_:1})]),p("div",q,[m(F,{model:e.selectedModel,mode:"trial"===e.mode?"total":"input-output","input-tokens":e.costEstimate?.inputTokens.avgTokens||e.getInputTokensForModel(e.selectedModel),"output-tokens":e.costEstimate?.outputTokens||e.getOutputTokensForModel(e.selectedModel),layout:"inline",size:"large"},null,8,["model","mode","input-tokens","output-tokens"]),"trial"===e.mode&&e.totalCalls>1?(c(),u("span",J,"("+b(e.totalCalls)+" calls)",1)):C("",!0)])]),"trial"===e.mode?(c(),u("div",R,[m(j,{layout:"vertical"},{default:y(()=>[m(d,{label:"Configuration Name",required:""},{default:y(()=>[m(o,{value:s.value,"onUpdate:value":l[1]||(l[1]=e=>s.value=e),placeholder:"e.g., GPT-4 Creative, Claude-3 Analytical",size:"large"},null,8,["value"])]),_:1}),m(O,{"default-active-key":["basic"],ghost:""},{default:y(()=>[m(I,{key:"basic",header:"Basic Parameters"},{default:y(()=>[m(w,{gutter:16},{default:y(()=>[(c(!0),u(k,null,h(V.value,(e,a)=>(c(),g(S,{key:a,span:12},{default:y(()=>[m(d,{label:T(a)},{default:y(()=>["number"===e.type?(c(),g(n,{key:0,value:i[a],"onUpdate:value":e=>i[a]=e,min:e.min,max:e.max,step:.1,placeholder:String(e.default),style:{width:"100%"},size:"large"},null,8,["value","onUpdate:value","min","max","placeholder"])):"integer"===e.type?(c(),g(n,{key:1,value:i[a],"onUpdate:value":e=>i[a]=e,min:e.min,max:e.max,placeholder:String(e.default),style:{width:"100%"},size:"large"},null,8,["value","onUpdate:value","min","max","placeholder"])):"boolean"===e.type?(c(),g(r,{key:2,checked:i[a],"onUpdate:checked":e=>i[a]=e,"checked-children":"true","un-checked-children":"false"},null,8,["checked","onUpdate:checked"])):"string"===e.type&&e.enum?(c(),g(M,{key:3,value:i[a],"onUpdate:value":e=>i[a]=e,placeholder:e.default?String(e.default):"<not set>",size:"large",style:{width:"100%"},allowClear:""},{default:y(()=>[m(f,{value:void 0},{default:y(()=>l[3]||(l[3]=[p("span",{style:{color:"#999"}},"<not set>",-1)])),_:1,__:[3]}),(c(!0),u(k,null,h(e.enum,e=>(c(),g(f,{key:e,value:e},{default:y(()=>[x(b(e),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])):(c(),g(o,{key:4,value:i[a],"onUpdate:value":e=>i[a]=e,placeholder:String(e.default),size:"large"},null,8,["value","onUpdate:value","placeholder"])),p("div",W,b(e.description),1)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})]),_:1}),Object.keys(z.value).length>0?(c(),g(I,{key:"advanced",header:"Advanced Parameters"},{default:y(()=>[m(w,{gutter:16},{default:y(()=>[(c(!0),u(k,null,h(z.value,(e,a)=>(c(),g(S,{key:a,span:12},{default:y(()=>[m(d,{label:T(a)},{default:y(()=>["number"===e.type||"integer"===e.type?(c(),g(n,{key:0,value:i[a],"onUpdate:value":e=>i[a]=e,min:e.min,max:e.max,step:"number"===e.type?.1:1,placeholder:String(e.default),style:{width:"100%"},size:"large"},null,8,["value","onUpdate:value","min","max","step","placeholder"])):"boolean"===e.type?(c(),g(r,{key:1,checked:i[a],"onUpdate:checked":e=>i[a]=e,"checked-children":"true","un-checked-children":"false"},null,8,["checked","onUpdate:checked"])):"string"===e.type&&e.enum?(c(),g(M,{key:2,value:i[a],"onUpdate:value":e=>i[a]=e,placeholder:e.default?String(e.default):"<not set>",size:"large",style:{width:"100%"},allowClear:""},{default:y(()=>[m(f,{value:void 0},{default:y(()=>l[4]||(l[4]=[p("span",{style:{color:"#999"}},"<not set>",-1)])),_:1,__:[4]}),(c(!0),u(k,null,h(e.enum,e=>(c(),g(f,{key:e,value:e},{default:y(()=>[x(b(e),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["value","onUpdate:value","placeholder"])):(c(),g(o,{key:3,value:i[a],"onUpdate:value":e=>i[a]=e,placeholder:String(e.default),size:"large"},null,8,["value","onUpdate:value","placeholder"])),p("div",Y,b(e.description),1)]),_:2},1032,["label"])]),_:2},1024))),128))]),_:1})]),_:1})):C("",!0)]),_:1})]),_:1})])):C("",!0),p("div",Z,[_.value?(c(),u("div",H,[m(G,{message:_.value,type:"error",showIcon:"",style:{marginBottom:"10px"}},null,8,["message"])])):C("",!0),"trial"===e.mode?(c(),g(a,{key:1,type:"primary",size:"large",onClick:P,disabled:!s.value||!e.selectedModel},{default:y(()=>l[5]||(l[5]=[x(" Add Configuration ")])),_:1,__:[5]},8,["disabled"])):(c(),g(a,{key:2,type:"primary",size:"large",onClick:l[2]||(l[2]=l=>e.$emit("confirm-selection",e.selectedModel)),disabled:!e.selectedModel},{default:y(()=>l[6]||(l[6]=[x(" Select Model ")])),_:1,__:[6]},8,["disabled"]))])])}}}),[["__scopeId","data-v-f0009607"]]),X={class:"modal-content-wrapper"},ee={key:0,class:"loading-container"},le={key:1,class:"modal-content"},ae={class:"models-panel"},te={class:"models-list"},oe=e(i({__name:"GenericModelSelectorModalV2",props:{open:{type:Boolean},mode:{},trialContext:{},design:{},title:{},existingConfigurations:{}},emits:["close","add-configuration","select-model"],setup(e,{emit:t}){const i=e,k=t,{data:h,loading:M}=n(()=>o.models.toArray(),{debounce:100}),{data:b}=s(()=>o.settings.get("main"),{debounce:100}),_=r(()=>{if(!h.value)return a.debug("GenericModelSelectorModalV2: No models loaded yet"),[];a.debug("GenericModelSelectorModalV2: Filtering models",{totalModels:h.value.length,settingsLoaded:!!b.value,apiKeys:b.value?.apiKeys?Object.keys(b.value.apiKeys):[]});const e=h.value.filter(e=>{if(!e.enabled)return!1;if(!b.value)return!0;if(l.requiresApiKey(e.provider)){const l=!!(b.value.apiKeys||{})[e.provider];return l||a.debug(`GenericModelSelectorModalV2: Filtering out ${e.displayName} - no API key for ${e.provider}`),l}return!0});return a.debug("GenericModelSelectorModalV2: Filtered models",{filteredCount:e.length,providers:[...new Set(e.map(e=>e.provider))]}),e}),x=r(()=>void 0===h.value||M.value),S=f(""),U=f(null),F=f(null),V=r(()=>{if(!_.value)return a.debug("GenericModelSelectorModalV2: groupedModels - no models available"),{};let e=_.value;if(S.value){const l=S.value.toLowerCase();e=e.filter(e=>e.displayName.toLowerCase().includes(l)||e.modelId.toLowerCase().includes(l))}const l={};for(const a of e)l[a.provider]||(l[a.provider]=[]),l[a.provider].push(a);for(const a in l)l[a].sort((e,l)=>e.displayName.localeCompare(l.displayName));return a.debug("GenericModelSelectorModalV2: groupedModels result",{providers:Object.keys(l),counts:Object.entries(l).map(([e,l])=>({provider:e,count:l.length}))}),l}),z=r(()=>{if("trial"!==i.mode)return 1;if(i.trialContext)return i.trialContext.totalCombinations;if(i.design){let e=1;for(const l of Object.values(i.design.variableBindings))"direct"===l.type&&(e*=l.values?.length||1);return e}return 1});function O(e){if(U.value=e,"playground"===i.mode)return k("select-model",e),void k("close")}function P(e){a.info("ðŸŽ¯ GenericModelSelectorModalV2: Emitting add-configuration",{config:e,mode:i.mode}),k("add-configuration",e)}function j(e){k("select-model",e),k("close")}function G(){U.value=null}function N(e){if("trial"===i.mode){if(i.trialContext)return i.trialContext.avgTokens;if(i.design)return i.design.tokenEstimate?.avgTokens||150}return 1e3}function A(e){if("trial"===i.mode){return d.getOutputTokenLimit(e.provider,e.modelId,{})||256}return 1e3}return I([U],async()=>{if(U.value&&"trial"===i.mode)if(i.trialContext||i.design)try{i.trialContext?F.value=await d.calculateCostEstimateFromContext(i.trialContext.totalCombinations,i.trialContext.avgTokens,U.value,{}):i.design&&(F.value=await d.calculateCostEstimate(i.design,U.value,{}))}catch(e){a.error("Failed to calculate cost estimate:",e),F.value=null}else F.value=null;else F.value=null}),I(()=>i.open,e=>{e&&(U.value=null,S.value="",a.debug("GenericModelSelectorModalV2 opened - reset selection"))}),w(()=>{a.debug("GenericModelSelectorModalV2 mounted",{mode:i.mode,open:i.open})}),(e,l)=>{const a=v("a-spin"),t=v("a-modal");return c(),g(t,{open:e.open,onCancel:l[1]||(l[1]=l=>e.$emit("close")),title:e.title||"Select Model",width:"97.5%",footer:null,bodyStyle:{padding:0,height:"80vh",display:"flex",flexDirection:"column"},maskClosable:!1,centered:!0,class:"full-width-modal"},{default:y(()=>[p("div",X,[x.value?(c(),u("div",ee,[m(a,{size:"large",tip:"Loading models..."})])):(c(),u("div",le,[p("div",ae,[m(T,{modelValue:S.value,"onUpdate:modelValue":l[0]||(l[0]=e=>S.value=e)},null,8,["modelValue"]),p("div",te,[m(L,{"grouped-models":V.value,"selected-model-id":U.value?.id,mode:e.mode,"get-input-tokens-for-model":N,"get-output-tokens-for-model":A,"has-config-panel":!!U.value,onSelectModel:O},null,8,["grouped-models","selected-model-id","mode","has-config-panel"])])]),U.value&&"trial"===e.mode?(c(),g(Q,{key:0,"selected-model":U.value,mode:e.mode,"total-calls":z.value,"cost-estimate":F.value,"get-input-tokens-for-model":N,"get-output-tokens-for-model":A,"existing-configurations":e.existingConfigurations,onClose:G,onAddConfiguration:P,onConfirmSelection:j},null,8,["selected-model","mode","total-calls","cost-estimate","existing-configurations"])):C("",!0)]))])]),_:1},8,["open","title"])}}}),[["__scopeId","data-v-392ca2fd"]]);export{oe as G};
