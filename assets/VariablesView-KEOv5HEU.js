import{u as e}from"./useResponsiveTable-Cw1RaX8o.js";import{u as t}from"./variables-db-BA-HAITb.js";import{l as a,_ as l,q as i}from"./index-C3IQIdkL.js";import{r as s,f as r,c as o,w as n,u,n as d,d as c,a6 as m,Y as p,a1 as b,_ as v,G as y,a0 as g,ab as f,q as h,F as V,a8 as k,aa as _,ae as w,B as C,V as K,Z as L,k as S,z as x,af as I,o as A,W as E}from"./vendor-DImCB_rW.js";import{v as D}from"./variable.service-Dh8OY-94.js";import"./defaultData-Bk-Mi7PC.js";import{_ as U}from"./BaseModal.vue_vue_type_style_index_0_lang-D3rbY83j.js";import{_ as $}from"./BaseButton.vue_vue_type_style_index_0_lang-DGDU8ryj.js";import"./db-CL8uhZCz.js";function j(e){const l=t(),i=s({name:"",description:"",category:"simple",values:[],attributeKeys:[],items:[]}),c=r(!1),m=r(!1),p=r([]),b=r(!1),v=r(""),y=r(!1),g=o(()=>"simple"===i.category||"refusal"===i.category?i.values.length:i.items.length),f=o(()=>{const e=[];if(i.name.trim()||e.push("Name is required"),"simple"===i.category||"refusal"===i.category){0===i.values.length&&e.push("At least one value is required");new Set(i.values.map(e=>e.toLowerCase().trim())).size<i.values.length&&e.push("Duplicate values detected")}else if("attributed"===i.category){0===i.attributeKeys.length&&e.push("At least one attribute key is required"),0===i.items.length&&e.push("At least one item is required");const t=D.validateAttributedList(i.items,i.attributeKeys);t.isValid||e.push(...t.errors)}return{isValid:0===e.length,errors:e}}),h=o(()=>"attributed"!==i.category?{}:D.getAttributeStats(i.items));return n(()=>i.category,(e,t)=>{a.debug("Category watcher triggered",{newCategory:e,oldCategory:t,isLoadingData:y.value}),e===t||void 0===t||y.value?a.debug("Not clearing data - category change is during load or initial"):(a.debug("Clearing data due to category change"),i.values.splice(0,i.values.length),i.attributeKeys.splice(0,i.attributeKeys.length),i.items.splice(0,i.items.length))}),n(()=>u(e),t=>{a.debug("ListId watcher triggered",{newId:t}),t?(a.debug("Calling load() for listId",{newId:t}),async function(){const t=u(e);if(a.debug("Loading list with ID",{currentListId:t}),t){m.value=!0,y.value=!0;try{const e=await l.getList(t);if(a.debug("Loaded list from store",{list:e}),!e)throw new Error("Variable list not found");a.debug("Setting form.name",{name:e.name}),i.name=e.name,a.debug("form.name is now",{name:i.name}),a.debug("Setting form.description",{description:e.description??""}),i.description=e.description??"",a.debug("form.description is now",{description:i.description}),a.debug("Setting form.category",{category:e.category}),i.category=e.category,a.debug("form.category is now",{category:i.category}),await d(),"simple"===e.category||"refusal"===e.category?(a.debug("Loading simple/refusal values",{values:e.values}),i.values.splice(0,i.values.length,...e.values||[]),a.debug("form.values is now",{values:i.values,length:i.values.length})):(a.debug("Loading attributed data - attributeKeys",{attributeKeys:e.attributeKeys}),i.attributeKeys.splice(0,i.attributeKeys.length,...e.attributeKeys||[]),a.debug("form.attributeKeys is now",{attributeKeys:i.attributeKeys,length:i.attributeKeys.length}),a.debug("Loading attributed data - items",{itemCount:e.items?.length}),i.items.splice(0,i.items.length,...e.items?e.items.map(e=>({value:e.value,attributes:{...e.attributes}})):[]),a.debug("form.items is now",{itemCount:i.items.length})),a.debug("Final form state",{name:i.name,description:i.description,category:i.category,valuesLength:i.values.length,attributeKeysLength:i.attributeKeys.length,itemsLength:i.items.length}),await d()}catch(s){a.error("Error loading list",s)}finally{m.value=!1,y.value=!1,a.debug("Load complete, isLoadingData set to false")}}}()):(a.debug("Resetting form for new list"),i.name="",i.description="",i.category="simple",i.values.splice(0,i.values.length),i.attributeKeys.splice(0,i.attributeKeys.length),i.items.splice(0,i.items.length),a.debug("Form reset complete"))},{immediate:!0}),{form:i,isSaving:c,isLoading:m,errors:p,showImportDialog:b,importText:v,itemCount:g,validation:f,attributeStats:h,save:async function(){if(!f.value.isValid)throw p.value=f.value.errors,new Error(f.value.errors[0]);c.value=!0,p.value=[];try{const t={name:i.name.trim(),description:i.description.trim()||void 0,category:i.category,values:"simple"===i.category||"refusal"===i.category?[...i.values]:void 0,attributeKeys:"attributed"===i.category?[...i.attributeKeys]:void 0,items:"attributed"===i.category?i.items.map(e=>({value:e.value,attributes:{...e.attributes}})):void 0,itemCount:g.value},a=u(e);return a?(await l.updateList(a,t),a):await l.createList(t)}finally{c.value=!1}},addValue:function(e){const t=e.trim();t&&(i.values.includes(t)||i.values.push(t))},removeValue:function(e){i.values.splice(e,1)},addAttributeKey:function(e){const t=e.trim();t&&(i.attributeKeys.includes(t)||(i.attributeKeys.push(t),i.items.forEach(e=>{t in e.attributes||(e.attributes[t]="")})))},removeAttributeKey:function(e){const t=i.attributeKeys.indexOf(e);-1!==t&&(i.attributeKeys.splice(t,1),i.items.forEach(t=>{delete t.attributes[e]}))},addItem:function(e){const t={value:e.value,attributes:{}};i.attributeKeys.forEach(a=>{t.attributes[a]=e.attributes[a]??""}),i.items.push(t)},removeItem:function(e){i.items.splice(e,1)},importData:async function(){try{const e=v.value.trim();if(!e)return;if(e.startsWith("[")||e.startsWith("{")){const t=D.parseJSON(e);if("simple"===i.category){if(!Array.isArray(t))throw new Error("For simple lists, JSON must be an array");i.values=t.map(e=>"string"==typeof e?e:e.value||e.name||String(e)).filter(Boolean)}else{const e=Array.isArray(t)?t:[t],a=new Set;e.forEach(e=>{Object.keys(e).forEach(e=>{"value"!==e&&"name"!==e&&a.add(e)})}),i.attributeKeys=Array.from(a),i.items=e.map(e=>({value:String(e.value||e.name||""),attributes:i.attributeKeys.reduce((t,a)=>(t[a]=String(e[a]||""),t),{})})).filter(e=>e.value)}}else{const t=D.parseCSV(e);if("simple"===i.category)i.values=t.rows.map(e=>Object.values(e)[0]).filter(Boolean);else{const e=D.csvToAttributedItems(t),a=t.headers.filter(e=>"value"!==e.toLowerCase()&&"name"!==e.toLowerCase());i.attributeKeys=a,i.items=e}}b.value=!1,v.value=""}catch(e){throw a.error("Import failed",e),e}},exportData:function(){return"simple"===i.category?`value\n${i.values.join("\n")}`:D.exportToCSV(i.items)}}}const z={class:"tag-input","data-testid":"tag-input-component"},F={key:0,class:"tag-input-label"},R={key:0,class:"required"},B={class:"tags"},O=["onClick","aria-label"],N=["placeholder","aria-label","onKeydown"],T={key:1,class:"helper-text"},q=l(c({__name:"TagInput",props:{modelValue:{},label:{},placeholder:{default:"Add a value..."},helperText:{},required:{type:Boolean}},emits:["update:modelValue"],setup(e,{expose:t,emit:a}){const l=e,i=a,s=r(),o=r(""),n=r(!1);function u(){const e=o.value.trim();e&&(l.modelValue.includes(e)||i("update:modelValue",[...l.modelValue,e]),o.value="")}function d(e){const t=[...l.modelValue];t.splice(e,1),i("update:modelValue",t)}function c(){""===o.value&&l.modelValue.length>0&&d(l.modelValue.length-1)}function K(e){","!==e.key&&188!==e.keyCode||(e.preventDefault(),u())}function L(e){e.preventDefault();const t=e.clipboardData?.getData("text");if(!t)return;const a=t.split(/[\n,\t]+/).map(e=>e.trim()).filter(Boolean),s=[...new Set([...l.modelValue,...a])];i("update:modelValue",s),o.value=""}function S(){o.value.trim()&&u(),n.value=!1}return t({focus:()=>s.value?.focus()}),(e,t)=>(p(),m("div",z,[e.label?(p(),m("label",F,[y(g(e.label)+" ",1),e.required?(p(),m("span",R,"*")):b("",!0)])):b("",!0),v("div",{class:f(["tag-input-container",{focused:n.value}])},[v("div",B,[(p(!0),m(V,null,k(e.modelValue,(e,t)=>(p(),m("span",{key:`${e}-${t}`,class:"tag"},[y(g(e)+" ",1),v("button",{type:"button",class:"tag-remove",onClick:e=>d(t),"aria-label":`Remove ${e}`}," × ",8,O)]))),128)),h(v("input",{ref_key:"inputRef",ref:s,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),placeholder:e.placeholder,class:"tag-input-field","data-testid":"tag-input-field","aria-label":e.label||"Enter tags",onKeydown:[w(C(u,["prevent"]),["enter"]),w(c,["backspace"]),K],onPaste:L,onFocus:t[1]||(t[1]=e=>n.value=!0),onBlur:S},null,40,N),[[_,o.value]])])],2),e.helperText?(p(),m("div",T,g(e.helperText),1)):b("",!0)]))}}),[["__scopeId","data-v-613f6ba9"]]),W={class:"attributed-items-grid"},J={key:0,class:"grid-header"},M={class:"grid-actions"},P=["disabled"],G={key:1,class:"add-row"},H=["onUpdate:modelValue","placeholder","data-testid","aria-label"],Y={key:2,class:"grid-container"},Z={class:"items-table"},Q={key:0,class:"actions-column"},X=["data-testid","data-item-value"],ee={key:0,class:"actions-column"},te=["onClick","data-testid","aria-label"],ae={key:0,class:"placeholder-row"},le={class:"placeholder-text"},ie={key:3,class:"empty-state"},se={key:4,class:"empty-state"},re=l(c({__name:"AttributedItemsGrid",props:{modelValue:{},attributeKeys:{},showStructure:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=t,i=r(!1),o=s({value:"",attributes:{}});function u(){if(!o.value.trim())return;const e={value:o.value.trim(),attributes:{...o.attributes}};l("update:modelValue",[...a.modelValue,e]),o.value="",a.attributeKeys.forEach(e=>{o.attributes[e]=""}),i.value=!1}function d(){o.value="",a.attributeKeys.forEach(e=>{o.attributes[e]=""}),i.value=!1}function c(e){const t=e.toLowerCase();return t.includes("age")?"25":t.includes("gender")||t.includes("sex")?"Female":t.includes("price")||t.includes("cost")?"$19.99":t.includes("category")||t.includes("type")?"Technology":t.includes("color")||t.includes("colour")?"Blue":t.includes("size")?"Medium":t.includes("country")?"USA":t.includes("city")?"Seattle":"Sample Value"}return n(()=>a.attributeKeys,e=>{o.attributes={},e.forEach(e=>{o.attributes[e]=""})},{immediate:!0}),(e,t)=>(p(),m("div",W,[e.attributeKeys.length>0?(p(),m("div",J,[v("div",M,[v("button",{type:"button",class:"add-button",disabled:0===e.attributeKeys.length,onClick:t[0]||(t[0]=e=>i.value=!0),"data-testid":"btn-add-attributed-item","aria-label":"Add new attributed item"}," + Add Item ",8,P)])])):b("",!0),i.value?(p(),m("div",G,[h(v("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),placeholder:"Value",class:"grid-input",onKeyup:w(u,["enter"]),"data-testid":"input-item-value","aria-label":"Item value"},null,544),[[_,o.value]]),(p(!0),m(V,null,k(e.attributeKeys,e=>h((p(),m("input",{key:e,"onUpdate:modelValue":t=>o.attributes[e]=t,placeholder:e,class:"grid-input",onKeyup:w(u,["enter"]),"data-testid":`input-attribute-${e}`,"aria-label":`${e} attribute value`},null,40,H)),[[_,o.attributes[e]]])),128)),v("div",{class:"row-actions"},[v("button",{type:"button",class:"save-button",onClick:u,"data-testid":"btn-save-attributed-item","aria-label":"Save attributed item"}," ✓ "),v("button",{type:"button",class:"cancel-button",onClick:d,"data-testid":"btn-cancel-attributed-item","aria-label":"Cancel adding item"}," × ")])])):b("",!0),e.modelValue.length>0||e.showStructure&&e.attributeKeys.length>0?(p(),m("div",Y,[v("table",Z,[v("thead",null,[v("tr",null,[t[2]||(t[2]=v("th",null,"Value",-1)),(p(!0),m(V,null,k(e.attributeKeys,e=>(p(),m("th",{key:e},g(e),1))),128)),e.modelValue.length>0?(p(),m("th",Q)):b("",!0)])]),v("tbody",null,[(p(!0),m(V,null,k(e.modelValue,(t,i)=>(p(),m("tr",{key:i,"data-testid":`attributed-item-row-${i}`,"data-item-value":t.value},[v("td",null,g(t.value),1),(p(!0),m(V,null,k(e.attributeKeys,e=>(p(),m("td",{key:e},g(t.attributes[e]||"-"),1))),128)),e.modelValue.length>0?(p(),m("td",ee,[v("button",{type:"button",class:"remove-button",onClick:e=>function(e){const t=[...a.modelValue];t.splice(e,1),l("update:modelValue",t)}(i),"data-testid":`btn-remove-item-${i}`,"aria-label":`Remove item ${t.value}`}," × ",8,te)])):b("",!0)],8,X))),128)),0===e.modelValue.length&&e.showStructure&&e.attributeKeys.length>0?(p(),m("tr",ae,[t[3]||(t[3]=v("td",{class:"placeholder-cell"},"Sample Name",-1)),(p(!0),m(V,null,k(e.attributeKeys,e=>(p(),m("td",{key:`placeholder-${e}`,class:"placeholder-cell"},[v("span",le,g(c(e)),1)]))),128))])):b("",!0)])])])):0===e.attributeKeys.length?(p(),m("div",ie,t[4]||(t[4]=[v("div",{class:"empty-icon"},"📋",-1),v("p",{class:"empty-title"},"Ready for Attributes",-1),v("p",{class:"empty-subtitle"},"Define attributes above to see the data structure here",-1)]))):(p(),m("div",se,t[5]||(t[5]=[v("div",{class:"empty-icon"},"📝",-1),v("p",{class:"empty-title"},"Ready for Data",-1),v("p",{class:"empty-subtitle"},'Click "Add Item" to start entering your data',-1)])))]))}}),[["__scopeId","data-v-e8a6944a"]]),oe={class:"import-content"},ne={class:"import-help"},ue={key:0,class:"format-examples"},de=["placeholder"],ce=l(c({__name:"ImportDialog",props:{category:{}},emits:["close","import"],setup(e,{emit:t}){const a=e,l=t,i=r(""),s=o(()=>"simple"===a.category?"Apple\nBanana\nCherry\n\nOR\n\nApple, Banana, Cherry":"Paste CSV or JSON data here...");function n(){i.value.trim()?l("import",i.value):alert("Please paste some data to import")}return(e,t)=>(p(),K(U,{"model-value":!0,title:"Import Data","onUpdate:modelValue":t[2]||(t[2]=t=>e.$emit("close"))},{footer:L(()=>[S($,{variant:"ghost",onClick:t[1]||(t[1]=t=>e.$emit("close"))},{default:L(()=>t[4]||(t[4]=[y(" Cancel ")])),_:1,__:[4]}),S($,{onClick:n},{default:L(()=>t[5]||(t[5]=[y(" Import ")])),_:1,__:[5]})]),default:L(()=>[v("div",oe,[v("p",ne,["simple"===e.category?(p(),m(V,{key:0},[y(" Paste values, one per line or comma-separated. ")],64)):(p(),m(V,{key:1},[y(" Paste CSV or JSON data. For CSV, first row should be headers. ")],64))]),"attributed"===e.category?(p(),m("div",ue,t[3]||(t[3]=[v("details",null,[v("summary",null,"CSV Example"),v("pre",null,"value,race,gender\nJohn Smith,White,Male\nMaria Garcia,Hispanic,Female\nWei Chen,Asian,Male")],-1),v("details",null,[v("summary",null,"JSON Example"),v("pre",null,'[\n  {"value": "John Smith", "race": "White", "gender": "Male"},\n  {"value": "Maria Garcia", "race": "Hispanic", "gender": "Female"}\n]')],-1)]))):b("",!0),h(v("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.value=e),class:"import-textarea",placeholder:s.value,rows:"15"},null,8,de),[[_,i.value]])])]),_:1}))}}),[["__scopeId","data-v-f851c3b3"]]),me={class:"form-container"},pe={class:"name-desc-row"},be={class:"form-field"},ve={class:"form-field"},ye={class:"type-row","data-testid":"variable-type-selector"},ge={class:"radio-group-inline"},fe={class:"radio-label-inline"},he=["disabled"],Ve={class:"radio-label-inline"},ke=["disabled"],_e={class:"radio-label-inline"},we=["disabled"],Ce={key:0,class:"form-section"},Ke={key:1,class:"form-section"},Le={class:"import-actions"},Se={key:2,class:"form-section"},xe={class:"attributed-inline"},Ie={class:"attributes-content"},Ae={class:"items-section"},Ee={class:"items-content"},De={key:0,class:"import-actions"},Ue={key:3,class:"error-banner"},$e={class:"footer-content"},je={class:"stats"},ze={class:"actions"},Fe=l(c({__name:"VariableListEditor",props:{modelValue:{type:Boolean},listId:{}},emits:["update:modelValue","saved"],setup(e,{emit:t}){const l=t,i=j(x(e,"listId"));async function s(){try{const e=await i.save();l("saved",e),l("update:modelValue",!1)}catch(e){a.error("Failed to save variable list",e)}}async function r(e){try{i.importText.value=e,await i.importData(),i.showImportDialog.value=!1}catch(t){a.error("Failed to import data",t),alert("Failed to import: "+(t instanceof Error?t.message:"Unknown error"))}}return n(()=>i.form.name,e=>{a.debug("VariableListEditor: form.name changed",{name:e})}),n(()=>i.form.category,e=>{a.debug("VariableListEditor: form.category changed",{category:e})}),n(()=>i.form.values,e=>{a.debug("VariableListEditor: form.values changed",{values:e,length:e.length})},{deep:!0}),n(()=>i.form.attributeKeys,e=>{a.debug("VariableListEditor: form.attributeKeys changed",{keys:e,length:e.length})},{deep:!0}),n(()=>i.form.items,e=>{a.debug("VariableListEditor: form.items changed",{itemCount:e.length})},{deep:!0}),(e,t)=>(p(),K(U,{"model-value":e.modelValue,title:e.listId?"Edit Variable List":"Create Variable List",size:"full","data-testid":"modal-variable-editor","onUpdate:modelValue":t[13]||(t[13]=t=>e.$emit("update:modelValue",t))},{footer:L(()=>[v("div",$e,[v("div",je,g(u(i).itemCount.value)+" items ",1),v("div",ze,[S($,{variant:"ghost",onClick:t[11]||(t[11]=t=>e.$emit("update:modelValue",!1))},{default:L(()=>t[30]||(t[30]=[y(" Cancel ")])),_:1,__:[30]}),S($,{type:"submit",loading:u(i).isSaving.value,disabled:!u(i).validation.value.isValid,onClick:s},{default:L(()=>[y(g(e.listId?"Update":"Create"),1)]),_:1},8,["loading","disabled"])])])]),default:L(()=>[v("div",me,[v("form",{onSubmit:C(s,["prevent"])},[v("div",pe,[t[14]||(t[14]=v("label",{class:"inline-field-label"},"Name",-1)),v("div",be,[h(v("input",{id:"name","onUpdate:modelValue":t[0]||(t[0]=e=>u(i).form.name=e),type:"text",class:"form-input large",placeholder:"Enter list name","data-testid":"input-variable-list-name","aria-label":"Variable list name",required:""},null,512),[[_,u(i).form.name]])]),t[15]||(t[15]=v("label",{class:"inline-field-label"},"Description",-1)),v("div",ve,[h(v("input",{id:"description","onUpdate:modelValue":t[1]||(t[1]=e=>u(i).form.description=e),type:"text",class:"form-input large",placeholder:"Optional description","data-testid":"input-variable-list-description","aria-label":"Variable list description"},null,512),[[_,u(i).form.description]])])]),v("div",ye,[t[22]||(t[22]=v("label",{class:"inline-field-label"},"Type",-1)),v("div",ge,[v("label",fe,[h(v("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>u(i).form.category=e),type:"radio",value:"simple",disabled:!!e.listId,"data-testid":"radio-simple-list","aria-label":"Simple variable list type"},null,8,he),[[I,u(i).form.category]]),t[16]||(t[16]=v("span",{class:"radio-text"},"Simple List",-1)),t[17]||(t[17]=v("span",{class:"radio-example"},"(colors, names, countries)",-1))]),v("label",Ve,[h(v("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>u(i).form.category=e),type:"radio",value:"attributed",disabled:!!e.listId,"data-testid":"radio-attributed-list","aria-label":"Attributed variable list type"},null,8,ke),[[I,u(i).form.category]]),t[18]||(t[18]=v("span",{class:"radio-text"},"Attributed List",-1)),t[19]||(t[19]=v("span",{class:"radio-example"},"(names with gender/ethnicity, cities with region/size)",-1))]),v("label",_e,[h(v("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>u(i).form.category=e),type:"radio",value:"refusal",disabled:!!e.listId},null,8,we),[[I,u(i).form.category]]),t[20]||(t[20]=v("span",{class:"radio-text"},"Refusal Words",-1)),t[21]||(t[21]=v("span",{class:"radio-example"},"(cannot, unable, refuse)",-1))])])]),"simple"===u(i).form.category?(p(),m("div",Ce,[t[23]||(t[23]=v("h3",null,"Values",-1)),S(q,{modelValue:u(i).form.values,"onUpdate:modelValue":t[5]||(t[5]=e=>u(i).form.values=e),label:"List Values",placeholder:"Add a value...","helper-text":"Enter values or paste from spreadsheet"},null,8,["modelValue"])])):b("",!0),"refusal"===u(i).form.category?(p(),m("div",Ke,[t[25]||(t[25]=v("h3",null,"Refusal Words",-1)),S(q,{modelValue:u(i).form.values,"onUpdate:modelValue":t[6]||(t[6]=e=>u(i).form.values=e),label:"Refusal Words",placeholder:"Add a refusal word (e.g., 'cannot', 'unable', 'refuse')...","helper-text":"Words or phrases that indicate model refusal"},null,8,["modelValue"]),v("div",Le,[S($,{variant:"secondary",size:"small",onClick:t[7]||(t[7]=e=>u(i).showImportDialog.value=!0)},{default:L(()=>t[24]||(t[24]=[y(" Import CSV ")])),_:1,__:[24]})])])):b("",!0),"attributed"===u(i).form.category?(p(),m("div",Se,[v("div",xe,[t[26]||(t[26]=v("label",{class:"inline-field-label"},"Attributes",-1)),v("div",Ie,[S(q,{modelValue:u(i).form.attributeKeys,"onUpdate:modelValue":t[8]||(t[8]=e=>u(i).form.attributeKeys=e),label:"",placeholder:"Add attribute (e.g., gender, ethnicity, region, size)...","helper-text":"Define properties first, then add data below"},null,8,["modelValue"])])]),v("div",Ae,[t[28]||(t[28]=v("label",{class:"inline-field-label"},"Data",-1)),v("div",Ee,[S(re,{modelValue:u(i).form.items,"onUpdate:modelValue":t[9]||(t[9]=e=>u(i).form.items=e),"attribute-keys":u(i).form.attributeKeys,"show-structure":!0},null,8,["modelValue","attribute-keys"]),u(i).form.attributeKeys.length>0?(p(),m("div",De,[S($,{variant:"secondary",size:"small",onClick:t[10]||(t[10]=e=>u(i).showImportDialog.value=!0)},{default:L(()=>t[27]||(t[27]=[y(" Import CSV/JSON ")])),_:1,__:[27]})])):b("",!0)])])])):b("",!0),u(i).errors.value.length>0?(p(),m("div",Ue,[t[29]||(t[29]=v("strong",null,"Please fix the following errors:",-1)),v("ul",null,[(p(!0),m(V,null,k(u(i).errors.value,e=>(p(),m("li",{key:e},g(e),1))),128))])])):b("",!0)],32)]),u(i).showImportDialog.value?(p(),K(ce,{key:0,category:u(i).form.category,onClose:t[12]||(t[12]=e=>u(i).showImportDialog.value=!1),onImport:r},null,8,["category"])):b("",!0)]),_:1},8,["model-value","title"]))}}),[["__scopeId","data-v-733d75a4"]]),Re={class:"variables-view","data-testid":"page-variables"},Be={class:"page-header"},Oe={key:3},Ne={class:"scientific-table-container"},Te={class:"scientific-table-wrapper"},qe={key:0,class:"table-info-cell"},We={class:"table-info-title"},Je={class:"table-info-subtitle"},Me={key:3,class:"table-cell-ellipsis"},Pe={key:4,class:"date-cell"},Ge={key:5,class:"table-actions-grid"},He=l(c({__name:"VariablesView",setup(l){const s=t(),{getVisibleColumns:n,formatDateTime:d,createVariableColumns:c}=e(),f=r(!1),h=r(),k=r("all"),_=n(c()),w=o(()=>{switch(k.value){case"simple":return s.simpleLists;case"attributed":return s.attributedLists;case"refusal":return s.refusalLists;default:return s.lists}});function C(){h.value=void 0,f.value=!1}function x(e){if("simple"===e.category||"refusal"===e.category){const t=e.values||[],a=t.slice(0,3).join(", ");return t.length>3?`${a}, ...`:a}const t=e.items||[],a=t.slice(0,2).map(e=>e.name||e.value).join(", ");return t.length>2?`${a}, ...`:a}return A(async()=>{await s.initialize()}),(e,t)=>{const l=E("a-button"),r=E("a-spin"),o=E("a-alert"),n=E("a-empty"),c=E("a-tab-pane"),I=E("a-tabs"),A=E("a-tag"),D=E("a-table");return p(),m("div",Re,[v("div",Be,[t[6]||(t[6]=v("div",{class:"header-content"},[v("h1",null,"Variable Lists"),v("p",{class:"description"},"Manage reusable variable lists for prompt templates")],-1)),S(l,{type:"primary",onClick:t[0]||(t[0]=e=>f.value=!0),"data-testid":"btn-create-variable-list","aria-label":"Create new variable list"},{icon:L(()=>[S(u(i))]),default:L(()=>[t[5]||(t[5]=y(" Create List "))]),_:1,__:[5]})]),u(s).isLoading?(p(),K(r,{key:0,size:"large",tip:"Loading variable lists..."},{default:L(()=>t[7]||(t[7]=[v("div",{style:{"min-height":"200px"}},null,-1)])),_:1,__:[7]})):u(s).error?(p(),K(o,{key:1,type:"error",message:u(s).error,class:"error-alert"},null,8,["message"])):0===u(s).lists.length?(p(),K(n,{key:2,description:"No variable lists yet. Create lists to use in your prompt designs."},{image:L(()=>t[8]||(t[8]=[v("div",{style:{color:"#bfbfbf","font-size":"48px"}},"📃",-1)])),default:L(()=>[S(l,{type:"primary",onClick:t[1]||(t[1]=e=>f.value=!0)},{default:L(()=>t[9]||(t[9]=[y(" Create Your First List ")])),_:1,__:[9]})]),_:1})):(p(),m("div",Oe,[S(I,{activeKey:k.value,"onUpdate:activeKey":t[2]||(t[2]=e=>k.value=e),size:"small",class:"list-tabs"},{default:L(()=>[S(c,{key:"all",tab:`All Lists (${u(s).lists.length})`},null,8,["tab"]),S(c,{key:"simple",tab:`Simple (${u(s).simpleLists.length})`},null,8,["tab"]),S(c,{key:"attributed",tab:`Attributed (${u(s).attributedLists.length})`},null,8,["tab"]),S(c,{key:"refusal",tab:`Refusal (${u(s).refusalLists.length})`},null,8,["tab"])]),_:1},8,["activeKey"]),v("div",Ne,[v("div",Te,[S(D,{columns:u(_),"data-source":w.value,pagination:!1,size:"small",scroll:{y:"calc(100vh - 180px)"},"row-key":"id",class:"scientific-table"},{bodyCell:L(({column:e,record:i})=>{return["name"===e.key?(p(),m("div",qe,[v("span",We,g(i.name),1),v("span",Je,g(i.description||"No description"),1)])):b("",!0),"category"===e.key?(p(),K(A,{key:1,size:"small",color:"simple"===i.category?"blue":"attributed"===i.category?"green":"red"},{default:L(()=>[y(g(i.category),1)]),_:2},1032,["color"])):b("",!0),"itemCount"===e.key?(p(),m(V,{key:2},[y(g((o=i,"simple"===o.category||"refusal"===o.category?o.values?.length||0:o.items?.length||0)),1)],64)):b("",!0),"description"===e.key?(p(),m("div",Me,g(x(i)),1)):b("",!0),"created"===e.key?(p(),m("div",Pe,g((r=i.created,d(r))),1)):b("",!0),"actions"===e.key?(p(),m("div",Ge,[S(l,{size:"small",type:"primary",onClick:e=>{return t=i.id,h.value=t,void(f.value=!0);var t}},{default:L(()=>t[10]||(t[10]=[y(" Edit ")])),_:2,__:[10]},1032,["onClick"]),S(l,{size:"small",class:"btn-success",onClick:e=>async function(e){const t=e.id;try{const e=await s.getList(t);if(!e)return;let a,l;"simple"===e.category||"refusal"===e.category?(a=`value\n${e.values?.join("\n")??""}`,l=`${e.name.replace(/\s+/g,"-")}-values.csv`):(a=JSON.stringify(e.items,null,2),l=`${e.name.replace(/\s+/g,"-")}-attributed.json`);const i=new Blob([a],{type:"text/plain"}),r=URL.createObjectURL(i),o=document.createElement("a");o.href=r,o.download=l,o.click(),URL.revokeObjectURL(r)}catch(l){a.error("Failed to export list",l),alert("Failed to export list")}}(i)},{default:L(()=>t[11]||(t[11]=[y(" Export ")])),_:2,__:[11]},1032,["onClick"]),S(l,{size:"small",danger:"",onClick:e=>async function(e){if(confirm("Are you sure you want to delete this list?"))try{await s.deleteList(e)}catch(t){a.error("Failed to delete list",t),alert(t instanceof Error?t.message:"Failed to delete list")}}(i.id)},{default:L(()=>t[12]||(t[12]=[y(" Delete ")])),_:2,__:[12]},1032,["onClick"])])):b("",!0)];var r,o}),_:1},8,["columns","data-source"])])])])),f.value?(p(),K(Fe,{key:4,modelValue:f.value,"onUpdate:modelValue":[t[3]||(t[3]=e=>f.value=e),t[4]||(t[4]=e=>{e||(h.value=void 0)})],"list-id":h.value,onSaved:C},null,8,["modelValue","list-id"])):b("",!0)])}}}),[["__scopeId","data-v-36572d8f"]]);export{He as default};
