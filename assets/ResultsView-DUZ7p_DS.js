const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./PythonExportModal.vue_vue_type_style_index_0_lang-CLsxOcCp.js","./designs-db-Cu90pWLg.js","./vendor-BxfGckcK.js","./db-COX2g2xv.js","./index-JX8mTFJZ.js","./index-DDdwWpse.css","./variables-db-DFlmKEoQ.js","./registry-aRYPBFJZ.js","./models-db-CmLn_MUd.js","./trials-db-By9dbEH8.js","./settings-db-BVOtWTBg.js","./ModelSelectionTable-Dq708mA7.js","./ModelSelectionTable-BLrMfBZ9.css","./PythonExportModal-ND3QJOLk.css"])))=>i.map(i=>d[i]);
import{a as e,_ as a,T as t,R as l,D as s,f as n,c as i,C as r,I as o,e as u,d as c,L as d,A as p}from"./index-JX8mTFJZ.js";import{u as f}from"./trials-db-By9dbEH8.js";import{d as v,f as m,c as y,a2 as g,B as h,Y as _,F as k,a4 as b,G as C,a5 as x,W as w,q as S,ac as R,ab as T,k as E,S as j,a3 as I,U as $,X as M,l as D,u as q,a6 as A,o as P}from"./vendor-BxfGckcK.js";import{E as O}from"./ExportOutlined-sXgnmGRV.js";import{a as z,_ as N,T as U}from"./PythonExportModal.vue_vue_type_style_index_0_lang-CLsxOcCp.js";import"./db-COX2g2xv.js";import"./registry-aRYPBFJZ.js";import"./designs-db-Cu90pWLg.js";import"./variables-db-DFlmKEoQ.js";import"./settings-db-BVOtWTBg.js";import"./models-db-CmLn_MUd.js";import"./ModelSelectionTable-Dq708mA7.js";const L={class:"modal-content"},F={class:"modal-header"},B={class:"modal-body"},V={class:"section"},H={class:"format-options"},J=["value"],W={class:"format-label"},K={class:"format-name"},Y={class:"section"},G={class:"field-groups"},X={class:"field-list"},Q=["value"],Z={class:"field-label"},ee={class:"field-name"},ae={class:"field-desc"},te={class:"section"},le={class:"preview-info"},se={class:"preview-count"},ne={class:"preview-fields"},ie={class:"preview-size"},re={class:"modal-footer"},oe=["disabled"],ue=a(v({__name:"ExportDataModal",props:{trial:{},apiCalls:{}},emits:["close"],setup(a){const t=a,l=[{id:"csv",name:"CSV",description:"Comma-separated values (Excel compatible)"},{id:"tsv",name:"TSV",description:"Tab-separated values"},{id:"excel",name:"Excel",description:"Microsoft Excel (.xlsx)"},{id:"json",name:"JSON",description:"JavaScript Object Notation"},{id:"jsonl",name:"JSONL",description:"JSON Lines (one object per line)"}],s=[{name:"Basic Info",fields:[{id:"id",name:"ID",description:"API call identifier",default:!0},{id:"trial_id",name:"Trial ID",description:"Parent trial identifier",default:!0},{id:"trial_name",name:"Trial Name",description:"Human-readable trial name",default:!0},{id:"status",name:"Status",description:"Call status (completed, failed, etc.)",default:!0},{id:"created",name:"Created",description:"When the call was initiated",default:!0},{id:"completed",name:"Completed",description:"When the call finished",default:!0}]},{name:"Configuration",fields:[{id:"configuration_index",name:"Config Index",description:"Configuration array index",default:!1},{id:"configuration_name",name:"Config Name",description:"Human-readable config name",default:!1},{id:"provider",name:"Provider",description:"AI service provider",default:!0},{id:"model",name:"Model",description:"Model identifier",default:!0}]},{name:"Content",fields:[{id:"prompt",name:"Prompt",description:"Input prompt text",default:!0},{id:"variables",name:"Variables",description:"Variable substitutions (flattened as separate columns)",default:!0},{id:"result_content",name:"Result Content",description:"AI response content",default:!0},{id:"result_error",name:"Result Error",description:"Error message if failed",default:!0}]},{name:"Performance",fields:[{id:"response_latency_ms",name:"Latency (ms)",description:"Response time",default:!0},{id:"duration_ms",name:"Duration (ms)",description:"Total processing time",default:!1},{id:"result_success",name:"Success",description:"Whether call succeeded",default:!0}]},{name:"Technical Details",fields:[{id:"request_url",name:"Request URL",description:"API endpoint URL",default:!0},{id:"request_method",name:"Request Method",description:"HTTP method",default:!1},{id:"request_headers",name:"Request Headers",description:"HTTP request headers",default:!1},{id:"request_body",name:"Request Body",description:"Full request payload",default:!1},{id:"response_status",name:"Response Status",description:"HTTP status code",default:!0},{id:"response_headers",name:"Response Headers",description:"HTTP response headers",default:!1},{id:"response_body",name:"Response Body",description:"Full response payload",default:!1}]},{name:"Error Handling",fields:[{id:"network_error_count",name:"Network Errors",description:"Number of network failures",default:!1},{id:"retry_count",name:"Retry Count",description:"Number of retry attempts",default:!1}]}],n=m("csv"),i=m([]),r=s.flatMap(e=>e.fields);i.value=r.filter(e=>e.default).map(e=>e.id);const o=y(()=>{const e=50*i.value.length,a=t.apiCalls.length*e;return a<1024?`${a}B`:a<1048576?`${(a/1024).toFixed(1)}KB`:`${(a/1048576).toFixed(1)}MB`});function u(){i.value=r.map(e=>e.id)}function c(){i.value=r.filter(e=>e.default).map(e=>e.id)}function d(){i.value=[]}function p(){const e=new Set;return i.value.includes("variables")&&t.apiCalls.forEach(a=>{a.variables&&"object"==typeof a.variables&&Object.keys(a.variables).forEach(a=>e.add(a))}),t.apiCalls.map(a=>{const l={};var s,n;if(i.value.includes("id")&&(l.ID=a.id),i.value.includes("trial_id")&&(l["Trial ID"]=a.trialId),i.value.includes("trial_name")&&(l["Trial Name"]=t.trial.name),i.value.includes("status")&&(l.Status=a.status),i.value.includes("created")&&(l.Created=a.created.toISOString()),i.value.includes("completed")&&(l.Completed=a.completed?.toISOString()||""),i.value.includes("configuration_index")&&(l["Configuration Index"]=a.configurationIndex),i.value.includes("configuration_name")&&(l["Configuration Name"]=(s=a.configurationIndex,t.trial.configurationSnapshots[s]&&t.trial.configurationSnapshots[s].name||`Config ${s+1}`)),i.value.includes("provider")&&(l.Provider=(n=a,n.request?.url?.includes("openai.com")?"OpenAI":n.request?.url?.includes("anthropic.com")?"Anthropic":n.request?.url?.includes("openrouter.ai")?"OpenRouter":n.request?.url?.includes("localhost:11434")?"Ollama":"Unknown")),i.value.includes("model")&&(l.Model=function(e){return e.request?.body?.model?e.request.body.model:"Unknown"}(a)),i.value.includes("prompt")&&(l.Prompt=a.prompt),i.value.includes("variables"))for(const t of e)l[`variable_${t}`]=a.variables?.[t]||"";return i.value.includes("result_content")&&(l["Result Content"]=a.result?.content||""),i.value.includes("result_error")&&(l["Result Error"]=a.result?.error||""),i.value.includes("response_latency_ms")&&(l["Response Latency (ms)"]=a.response?.latencyMs||""),i.value.includes("duration_ms")&&(l["Duration (ms)"]=a.completed?a.completed.getTime()-a.created.getTime():""),i.value.includes("result_success")&&(l["Result Success"]=a.result?.success||!1),i.value.includes("request_url")&&(l["Request URL"]=a.request?.url||""),i.value.includes("request_method")&&(l["Request Method"]=a.request?.method||""),i.value.includes("request_headers")&&(l["Request Headers"]=JSON.stringify(a.request?.headers||{})),i.value.includes("request_body")&&(l["Request Body"]=JSON.stringify(a.request?.body||{})),i.value.includes("response_status")&&(l["Response Status"]=a.response?.status||""),i.value.includes("response_headers")&&(l["Response Headers"]=JSON.stringify(a.response?.headers||{})),i.value.includes("response_body")&&(l["Response Body"]=JSON.stringify(a.response?.body||{})),i.value.includes("network_error_count")&&(l["Network Error Count"]=0),i.value.includes("retry_count")&&(l["Retry Count"]=0),l})}async function f(){const a=p(),l=(new Date).toISOString().split("T")[0],s=`${t.trial.name}_${n.value}_${l}`;try{switch(n.value){case"csv":!function(e,a){if(0===e.length)return;const t=Object.keys(e[0]||{}),l=t.filter(e=>!e.startsWith("variable_")),s=t.filter(e=>e.startsWith("variable_")).sort(),n=[...l,...s],i=[n.join(","),...e.map(e=>n.map(a=>`"${String(e[a]||"").replace(/"/g,'""')}"`).join(","))].join("\n");v(i,`${a}.csv`,"text/csv")}(a,s);break;case"tsv":!function(e,a){if(0===e.length)return;const t=Object.keys(e[0]||{}),l=t.filter(e=>!e.startsWith("variable_")),s=t.filter(e=>e.startsWith("variable_")).sort(),n=[...l,...s],i=[n.join("\t"),...e.map(e=>n.map(a=>String(e[a]||"").replace(/\t/g," ")).join("\t"))].join("\n");v(i,`${a}.tsv`,"text/tab-separated-values")}(a,s);break;case"excel":await async function(a,t){const l=await e(()=>import("./xlsx-DfDjAMCE.js"),[],import.meta.url),s=l.utils.book_new(),n=l.utils.json_to_sheet(a),i=Object.keys(a[0]||{}),r=i.map(e=>({wch:Math.min(Math.max(e.length,10),50)}));n["!cols"]=r,l.utils.book_append_sheet(s,n,"Trial Results"),l.writeFile(s,`${t}.xlsx`)}(a,s);break;case"json":!function(e,a){const t=JSON.stringify(e,null,2);v(t,`${a}.json`,"application/json")}(a,s);break;case"jsonl":!function(e,a){const t=e.map(e=>JSON.stringify(e)).join("\n");v(t,`${a}.jsonl`,"application/jsonl")}(a,s)}}catch(i){console.error("Export failed:",i),alert("Export failed: "+(i instanceof Error?i.message:"Unknown error"))}}function v(e,a,t){const l=new Blob([e],{type:t}),s=URL.createObjectURL(l),n=document.createElement("a");n.href=s,n.download=a,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}return(e,a)=>(w(),g("div",{class:"modal-overlay",onClick:a[4]||(a[4]=h(a=>e.$emit("close"),["self"]))},[_("div",L,[_("div",F,[a[5]||(a[5]=_("h3",null,"Export Trial Data",-1)),_("button",{onClick:a[0]||(a[0]=a=>e.$emit("close")),class:"close-btn"},"×")]),_("div",B,[_("div",V,[a[6]||(a[6]=_("h4",null,"Export Format",-1)),_("div",H,[(w(),g(k,null,b(l,e=>_("label",{key:e.id,class:"format-option"},[S(_("input",{type:"radio",value:e.id,"onUpdate:modelValue":a[1]||(a[1]=e=>n.value=e),class:"format-radio"},null,8,J),[[R,n.value]]),_("span",W,[_("span",K,x(e.name),1)])])),64))])]),_("div",Y,[_("h4",null,[a[7]||(a[7]=C(" Fields to Export ")),_("div",{class:"field-controls"},[_("button",{onClick:u,class:"control-btn"},"Select All"),_("button",{onClick:c,class:"control-btn"},"Defaults"),_("button",{onClick:d,class:"control-btn"},"Select None")])]),_("div",G,[(w(),g(k,null,b(s,e=>_("div",{key:e.name,class:"field-group"},[_("h5",null,x(e.name),1),_("div",X,[(w(!0),g(k,null,b(e.fields,e=>(w(),g("label",{key:e.id,class:"field-option"},[S(_("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":a[2]||(a[2]=e=>i.value=e),class:"field-checkbox"},null,8,Q),[[T,i.value]]),_("span",Z,[_("span",ee,x(e.name),1),_("span",ae,x(e.description),1)])]))),128))])])),64))])]),_("div",te,[a[8]||(a[8]=_("h4",null,"Export Preview",-1)),_("div",le,[_("span",se,x(e.apiCalls.length)+" records",1),_("span",ne,x(i.value.length)+" fields",1),_("span",ie,"~"+x(o.value),1)])])]),_("div",re,[_("button",{onClick:a[3]||(a[3]=a=>e.$emit("close")),class:"btn btn-cancel"},"Cancel"),_("button",{onClick:f,class:"btn btn-export",disabled:0===i.value.length}," Export "+x(n.value.toUpperCase()),9,oe)])])]))}}),[["__scopeId","data-v-4bb61770"]]),ce={class:"results-table-container full-width"},de={class:"results-header"},pe={class:"header-actions"},fe={key:0,class:"trial-info-cell"},ve={class:"trial-header"},me={class:"trial-name"},ye={class:"trial-design"},ge={class:"text-secondary"},he={class:"trial-created"},_e={class:"text-secondary"},ke={key:1,class:"progress-summary"},be={class:"progress-stats"},Ce={class:"stat successful"},xe={class:"stat failed"},we={class:"stat total"},Se={class:"progress-text"},Re={key:0,class:"error-indicator"},Te={key:2,class:"success-rate-cell"},Ee={class:"rate-value"},je={key:3,class:"performance-cell"},Ie={class:"metric"},$e={class:"metric-value"},Me={class:"metric"},De={class:"metric-value"},qe={key:4,class:"configurations-cell"},Ae={class:"config-details"},Pe={class:"text-secondary"},Oe={key:5,class:"cost-summary"},ze={key:1,class:"text-secondary"},Ne={key:0,class:"cost-per-call"},Ue=a(v({__name:"ResultsTable",props:{trials:{},loading:{type:Boolean,default:!1}},emits:["view-results","export-trial","duplicate-trial","delete-trial","trial-details","refresh-trials","export-all","status-filter-changed"],setup(e,{emit:a}){const d=e,p=a,f=m("all"),v=m(!1),S=m(null),R=m([]),T=[{key:"all",label:"All"},{key:"completed",label:"Completed"},{key:"failed",label:"Failed"},{key:"running",label:"Running"},{key:"cancelled",label:"Cancelled"}],P=[{title:"Trial",key:"trial",width:250,fixed:"left",sorter:(e,a)=>e.name.localeCompare(a.name)},{title:"Progress",key:"progress",width:180,sorter:(e,a)=>F(e)-F(a)},{title:"Success Rate",key:"success_rate",width:120,sorter:(e,a)=>B(e)-B(a),align:"center"},{title:"Performance",key:"performance",width:140},{title:"Configs",key:"configurations",width:100,align:"center",sorter:(e,a)=>(e.configurationSnapshots?.length||0)-(a.configurationSnapshots?.length||0)},{title:"Cost",key:"cost",width:100,align:"right",sorter:(e,a)=>Math.abs(e.estimatedCost)-Math.abs(a.estimatedCost)},{title:"Actions",key:"actions",width:200,fixed:"right"}],O=y(()=>"all"===f.value?d.trials:d.trials.filter(e=>e.status===f.value)),z=y(()=>d.trials.filter(e=>"completed"===e.status));function N(e){f.value=e,p("status-filter-changed",e)}function U(e){p("view-results",e)}function L(e){return"all"===e?d.trials.length:d.trials.filter(a=>a.status===e).length}function F(e){return 0===e.progress.total?0:Math.round(e.progress.completed/e.progress.total*100)}function B(e){if(0===e.progress.completed)return 0;const a=e.progress.completed-e.progress.networkErrors;return Math.round(a/e.progress.completed*100)}function V(e){const a=B(e);return a>=95?"#52c41a":a>=80?"#faad14":"#ff4d4f"}function H(e){return e.progress.completed>0?"1,234":"-"}function J(e){return e.progress.completed>0?"2.5":"-"}function W(e){if(0===e.progress.total||0===Math.abs(e.estimatedCost))return"0.000";return(Math.abs(e.estimatedCost)/e.progress.total).toFixed(4)}function K(e){const a=[];return"completed"===e.status&&a.push("status-completed"),"failed"===e.status&&a.push("status-failed"),"running"===e.status&&a.push("status-running"),a.join(" ")}function Y(e){const a=(new Date).getTime()-e.getTime(),t=Math.floor(a/864e5);return 0===t?"Today":1===t?"Yesterday":t<7?`${t} days ago`:t<30?`${Math.floor(t/7)} weeks ago`:e.toLocaleDateString()}function G(){p("refresh-trials")}async function X(){const e=z.value;if(0!==e.length)try{const a=[];for(const t of e){const e=await c.apiCalls.where("trialId").equals(t.id).toArray();a.push(...e)}S.value={id:"all-trials",name:`All Completed Trials (${e.length} trials)`,status:"completed",created:new Date,updated:new Date,designSnapshot:{originalName:"Multiple Designs"},configurationSnapshots:[],variableSnapshots:{},progress:{completed:a.filter(e=>"completed"===e.status).length,total:a.length,networkErrors:a.filter(e=>"failed"===e.status).length},totalCombinations:a.length,estimatedCost:e.reduce((e,a)=>e+a.estimatedCost,0)},R.value=a,v.value=!0}catch(a){console.error("Failed to load API calls:",a)}}function Q(e){return D("div",{class:"expanded-trial-details"},[D("h4",{style:{margin:"0 0 12px 0",fontSize:"13px"}},"Configuration Breakdown"),D(t,{columns:[{title:"Model",dataIndex:"model",key:"model",width:200},{title:"Parameters",dataIndex:"parameters",key:"parameters",width:300},{title:"Calls",dataIndex:"calls",key:"calls",width:80,align:"center"},{title:"Success Rate",dataIndex:"successRate",key:"successRate",width:100,align:"center"},{title:"Avg Latency",dataIndex:"latency",key:"latency",width:100,align:"center"},{title:"Cost",dataIndex:"cost",key:"cost",width:80,align:"right"}],dataSource:(a=e,(a.configurationSnapshots||[]).map((e,t)=>({id:t,model:`${e.provider}:${e.modelId}`,parameters:Object.entries(e.parameters).map(([e,a])=>`${e}:${a}`).join(", "),calls:Math.floor(a.progress.total/(a.configurationSnapshots?.length||1)),successRate:`${B(a)}%`,latency:H(a)+"ms",cost:`$${W(a)}`}))),pagination:!1,size:"small",rowKey:"id"})]);var a}return(e,a)=>{const t=$("a-button"),d=$("a-space"),m=$("a-tab-pane"),y=$("a-tabs"),D=$("a-tag"),Z=$("a-progress"),ee=$("a-menu-item"),ae=$("a-menu-divider"),te=$("a-menu"),le=$("a-dropdown"),se=$("a-table");return w(),g("div",ce,[_("div",de,[a[4]||(a[4]=_("div",{class:"header-content"},[_("h2",null,"Trial Results"),_("p",{class:"description"}," Analyze and export completed experimental results ")],-1)),_("div",pe,[E(d,null,{default:M(()=>[E(t,{onClick:G},{icon:M(()=>[E(q(l))]),default:M(()=>[a[2]||(a[2]=C(" Refresh "))]),_:1,__:[2]}),E(t,{type:"primary",onClick:X,disabled:0===z.value.length},{icon:M(()=>[E(q(s))]),default:M(()=>[a[3]||(a[3]=C(" Export All Data "))]),_:1,__:[3]},8,["disabled"])]),_:1})])]),E(y,{activeKey:f.value,"onUpdate:activeKey":a[0]||(a[0]=e=>f.value=e),size:"small",class:"status-tabs",onChange:N},{default:M(()=>[(w(),g(k,null,b(T,e=>E(m,{key:e.key,tab:`${e.label} (${L(e.key)})`},null,8,["tab"])),64))]),_:1},8,["activeKey"]),E(se,{columns:P,"data-source":O.value,pagination:!1,size:"small",scroll:{y:"calc(100vh - 200px)",x:1400},"row-key":"id","row-class-name":K,class:"scientific-table",onRowClick:U,"expand-row-by-click":!1,"expanded-row-render":Q},{bodyCell:M(({column:e,record:l})=>{return["trial"===e.key?(w(),g("div",fe,[_("div",ve,[_("strong",me,x(l.name),1),E(D,{color:(m=l.status,{completed:"success",failed:"error",running:"processing",cancelled:"default",draft:"default",pending:"processing",paused:"warning"}[m]||"default"),size:"small",class:"trial-status-tag"},{default:M(()=>[C(x(l.status.toUpperCase()),1)]),_:2},1032,["color"])]),_("div",ye,[_("small",ge," Design: "+x(l.designSnapshot?.originalName||"Unknown Design"),1)]),_("div",he,[_("small",_e," Created "+x(Y(l.created)),1)])])):I("",!0),"progress"===e.key?(w(),g("div",ke,[_("div",be,[_("span",Ce,x(l.progress.completed)+" ✓",1),_("span",xe,x(l.progress.networkErrors)+" ✗",1),_("span",we,"/ "+x(l.progress.total),1)]),E(Z,{percent:F(l),size:"small",status:(f=l,"failed"===f.status?"exception":"completed"===f.status?"success":f.progress.networkErrors>0?"exception":"normal"),"show-info":!1,class:"progress-bar"},null,8,["percent","status"]),_("div",Se,[C(x(F(l))+"% complete ",1),l.progress.networkErrors>0?(w(),g("span",Re," ("+x(l.progress.networkErrors)+" errors) ",1)):I("",!0)])])):I("",!0),"success_rate"===e.key?(w(),g("div",Te,[_("div",Ee,x(B(l))+"%",1),E(Z,{percent:B(l),size:"small","show-info":!1,"stroke-color":V(l),class:"success-rate-bar"},null,8,["percent","stroke-color"])])):I("",!0),"performance"===e.key?(w(),g("div",je,[_("div",Ie,[a[5]||(a[5]=_("small",{class:"metric-label"},"Avg Latency",-1)),_("strong",$e,x(H(l))+"ms",1)]),_("div",Me,[a[6]||(a[6]=_("small",{class:"metric-label"},"Throughput",-1)),_("strong",De,x(J(l))+"/min",1)])])):I("",!0),"configurations"===e.key?(w(),g("div",qe,[E(D,{size:"small",color:"blue"},{default:M(()=>[C(x(l.configurationSnapshots?.length||0)+" configs ",1)]),_:2},1024),_("div",Ae,[_("small",Pe,x(l.totalCombinations)+" variables ",1)])])):I("",!0),"cost"===e.key?(w(),g("div",Oe,[_("span",{class:A(["cost-value",{negative:l.estimatedCost<0}])},[Math.abs(l.estimatedCost)>0?(w(),g(k,{key:0},[C(" $"+x(Math.abs(l.estimatedCost).toFixed(3)),1)],64)):(w(),g("span",ze,"-"))],2),l.progress.total>0?(w(),g("small",Ne," $"+x(W(l))+"/call ",1)):I("",!0)])):I("",!0),"actions"===e.key?(w(),j(d,{key:6,size:"small"},{default:M(()=>[E(t,{type:"primary",size:"small",onClick:h(e=>function(e){p("view-results",e)}(l),["stop"])},{icon:M(()=>[E(q(n))]),default:M(()=>[a[7]||(a[7]=C(" View Results "))]),_:2,__:[7]},1032,["onClick"]),E(t,{size:"small",onClick:h(e=>async function(e){S.value=e;try{R.value=await c.apiCalls.where("trialId").equals(e.id).toArray(),v.value=!0}catch(a){console.error("Failed to load API calls:",a)}}(l),["stop"])},{icon:M(()=>[E(q(s))]),default:M(()=>[a[8]||(a[8]=C(" Export Data "))]),_:2,__:[8]},1032,["onClick"]),E(le,{trigger:["click"]},{overlay:M(()=>[E(te,{onClick:e=>function(e,a){switch(e){case"duplicate":p("duplicate-trial",a);break;case"details":p("trial-details",a);break;case"delete":p("delete-trial",a)}}(e.key,l)},{default:M(()=>[E(ee,{key:"duplicate"},{default:M(()=>[E(q(r)),a[10]||(a[10]=C(" Duplicate Trial "))]),_:1,__:[10]}),E(ee,{key:"details"},{default:M(()=>[E(q(o)),a[11]||(a[11]=C(" Trial Details "))]),_:1,__:[11]}),E(ae),E(ee,{key:"delete",danger:""},{default:M(()=>[E(q(u)),a[12]||(a[12]=C(" Delete Trial "))]),_:1,__:[12]})]),_:2},1032,["onClick"])]),default:M(()=>[E(t,{size:"small"},{default:M(()=>[a[9]||(a[9]=C(" More ")),E(q(i))]),_:1,__:[9]})]),_:2},1024)]),_:2},1024)):I("",!0)];var f,m}),_:1},8,["data-source"]),v.value&&S.value?(w(),j(ue,{key:0,trial:S.value,"api-calls":R.value,onClose:a[1]||(a[1]=e=>v.value=!1)},null,8,["trial","api-calls"])):I("",!0)])}}}),[["__scopeId","data-v-41b2e7a5"]]),Le={class:"results-table-container"},Fe={class:"filters-bar"},Be={key:1},Ve={key:2,class:"variables-compact"},He={key:0,class:"text-secondary"},Je={key:1,class:"text-secondary"},We={key:2,class:"text-error"},Ke={key:3,class:"response-content"},Ye={key:4,class:"text-secondary"},Ge={key:0},Xe={key:1,class:"text-secondary"},Qe=a(v({__name:"TrialResultsTable",props:{trial:{},apiCalls:{},loading:{type:Boolean}},setup(e){const a=e,t=m(""),l=m(""),s=m(""),i=m(!1),r=[{title:"Status",key:"status",width:100,fixed:"left"},{title:"Config",key:"config",width:150},{title:"Variables",key:"variables",width:400},{title:"Response",key:"response",ellipsis:!0},{title:"Latency",key:"latency",width:80,align:"right"},{title:"",key:"actions",width:60,fixed:"right"}],o=y(()=>{let e=a.apiCalls;if(t.value&&(e=e.filter(e=>e.status===t.value)),""!==l.value&&(e=e.filter(e=>e.configurationIndex===Number(l.value))),s.value){const a=s.value.toLowerCase();e=e.filter(e=>{if(JSON.stringify(e.variables).toLowerCase().includes(a))return!0;if(e.result?.content){if(String(e.result.content).toLowerCase().includes(a))return!0}return!1})}return e});function u(e){const t=a.trial.configurationSnapshots[e];return t?.name||`Config ${e+1}`}function c(e,a){return e.length<=a?e:e.substring(0,a)+"..."}return(e,a)=>{const p=$("a-select-option"),f=$("a-select"),v=$("a-input-search"),m=$("a-space"),y=$("a-button"),h=$("a-tag"),S=$("a-tooltip"),R=$("a-table");return w(),g("div",Le,[_("div",Fe,[E(m,null,{default:M(()=>[E(f,{value:t.value,"onUpdate:value":a[0]||(a[0]=e=>t.value=e),placeholder:"All Statuses",style:{width:"150px"},size:"small","allow-clear":""},{default:M(()=>[E(p,{value:""},{default:M(()=>a[5]||(a[5]=[C("All Statuses")])),_:1,__:[5]}),E(p,{value:"completed"},{default:M(()=>a[6]||(a[6]=[C("Completed")])),_:1,__:[6]}),E(p,{value:"failed"},{default:M(()=>a[7]||(a[7]=[C("Failed")])),_:1,__:[7]}),E(p,{value:"running"},{default:M(()=>a[8]||(a[8]=[C("Running")])),_:1,__:[8]}),E(p,{value:"pending"},{default:M(()=>a[9]||(a[9]=[C("Pending")])),_:1,__:[9]})]),_:1},8,["value"]),E(f,{value:l.value,"onUpdate:value":a[1]||(a[1]=e=>l.value=e),placeholder:"All Configurations",style:{width:"200px"},size:"small","allow-clear":""},{default:M(()=>[E(p,{value:""},{default:M(()=>a[10]||(a[10]=[C("All Configurations")])),_:1,__:[10]}),(w(!0),g(k,null,b(e.trial.configurationSnapshots,(e,a)=>(w(),j(p,{key:a,value:a},{default:M(()=>[C(x(e.name||`Config ${a+1}`),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),E(v,{value:s.value,"onUpdate:value":a[2]||(a[2]=e=>s.value=e),placeholder:"Search variables or response...",style:{width:"300px"},size:"small","allow-clear":""},null,8,["value"])]),_:1}),E(y,{size:"small",onClick:a[3]||(a[3]=e=>i.value=!0)},{icon:M(()=>[E(q(O))]),default:M(()=>[a[11]||(a[11]=C(" Export Data "))]),_:1,__:[11]})]),E(R,{columns:r,"data-source":o.value,loading:e.loading,pagination:!1,scroll:{y:"calc(100vh - 350px)",x:1400},size:"small","row-key":"id",class:"results-table"},{bodyCell:M(({column:e,record:t})=>{return["status"===e.key?(w(),j(h,{key:0,color:(l=t.status,{completed:"success",failed:"error",running:"processing",pending:"default"}[l]||"default"),size:"small"},{default:M(()=>[C(x(t.status.toUpperCase()),1)]),_:2},1032,["color"])):I("",!0),"config"===e.key?(w(),g("code",Be,x(u(t.configurationIndex)),1)):I("",!0),"variables"===e.key?(w(),g("div",Ve,[(w(!0),g(k,null,b(t.variables,(e,a)=>(w(),j(S,{key:a},{title:M(()=>[C(x(a)+": "+x(e),1)]),default:M(()=>[E(h,{size:"small"},{default:M(()=>[C(x(a)+": "+x(c(String(e),15)),1)]),_:2},1024)]),_:2},1024))),128))])):I("",!0),"response"===e.key?(w(),g(k,{key:3},["pending"===t.status?(w(),g("div",He," Waiting... ")):"running"===t.status?(w(),g("div",Je,[E(q(d)),a[12]||(a[12]=C(" Processing... "))])):"failed"===t.status?(w(),g("div",We,x(c(t.result?.error||"API call failed",100)),1)):t.result?.content?(w(),g("div",Ke,[E(S,{title:String(t.result.content)},{default:M(()=>[_("span",null,x(c(String(t.result.content),100)),1)]),_:2},1032,["title"])])):(w(),g("div",Ye," No content "))],64)):I("",!0),"latency"===e.key?(w(),g(k,{key:4},[t.response?.latencyMs?(w(),g("span",Ge,x(t.response.latencyMs)+"ms ",1)):(w(),g("span",Xe,"-"))],64)):I("",!0),"actions"===e.key?(w(),j(y,{key:5,size:"small",onClick:e=>{return a=t,void console.log("View API call:",a);var a}},{default:M(()=>[E(q(n))]),_:2},1032,["onClick"])):I("",!0)];var l}),_:1},8,["data-source","loading"]),i.value?(w(),j(ue,{key:0,trial:e.trial,"api-calls":o.value,onClose:a[4]||(a[4]=e=>i.value=!1)},null,8,["trial","api-calls"])):I("",!0)])}}}),[["__scopeId","data-v-a525444e"]]),Ze={class:"trial-analysis"},ea={class:"stats-summary"},aa=a(v({__name:"TrialAnalysisView",props:{trial:{},apiCalls:{},loading:{type:Boolean}},emits:["back-to-selection","export-trial"],setup(e){const a=e,t=y(()=>a.apiCalls.filter(e=>"completed"===e.status).length),l=y(()=>a.apiCalls.filter(e=>"failed"===e.status).length),s=y(()=>{const e=t.value+l.value;return 0===e?0:Math.round(t.value/e*100)}),n=y(()=>{const e=a.apiCalls.filter(e=>e.response?.latencyMs);if(0===e.length)return 0;const t=e.reduce((e,a)=>e+(a.response?.latencyMs||0),0);return Math.round(t/e.length)}),i=y(()=>a.trial.progress.completed*(a.trial.estimatedCost/a.trial.progress.total));return(e,a)=>{const r=$("a-statistic"),o=$("a-divider");return w(),g("div",Ze,[_("div",ea,[E(r,{title:"Success Rate",value:s.value,suffix:"%","value-style":{color:s.value>=90?"#52c41a":s.value>=70?"#faad14":"#ff4d4f"}},null,8,["value","value-style"]),E(o,{type:"vertical"}),E(r,{title:"Completed",value:t.value,suffix:`/ ${e.trial.progress.total}`},null,8,["value","suffix"]),E(o,{type:"vertical"}),E(r,{title:"Failed",value:l.value,"value-style":{color:l.value>0?"#ff4d4f":"#52c41a"}},null,8,["value","value-style"]),E(o,{type:"vertical"}),E(r,{title:"Avg Latency",value:n.value,suffix:"ms"},null,8,["value"]),E(o,{type:"vertical"}),E(r,{title:"Total Cost",value:i.value,prefix:"$",precision:4},null,8,["value"])]),E(Qe,{trial:e.trial,"api-calls":e.apiCalls,loading:e.loading},null,8,["trial","api-calls","loading"])])}}}),[["__scopeId","data-v-29db9da1"]]),ta={class:"results-view full-width"},la={key:0,class:"results-table-view"},sa={key:1,class:"analysis-view"},na={class:"analysis-header"},ia={class:"analysis-title"},ra=a(v({__name:"ResultsView",setup(a){const t=f(),l=m("table"),n=m(null),i=m(null),r=m([]),o=m([]),u=m(!1),d=m(!1),v=m("all"),y=m(!1),h=m(!1),k=m(!1),b=m(null),S=m(null);async function R(){u.value=!0;try{await t.initialize(),r.value=t.trials}catch(e){console.error("Failed to load trials:",e)}finally{u.value=!1}}async function T(e){!function(e){n.value=e.id,i.value=e}(e),l.value="analysis",await async function(){if(n.value){d.value=!0;try{o.value=await c.apiCalls.where("trialId").equals(n.value).toArray()}catch(e){console.error("Failed to load results:",e)}finally{d.value=!1}}}()}function D(){l.value="table",n.value=null,i.value=null,o.value=[]}function A(e,a){b.value=e,"python"===a?y.value=!0:W(e)}function O(e){S.value=e,k.value=!0}function L(e){i.value=e,h.value=!0}function F(){console.log("Exporting all results...")}function B(e){v.value=e}function V(e){console.log("Results exported:",e),y.value=!1,b.value=null}function H(){R()}function J(e){console.log("Trial duplicated:",e),k.value=!1,S.value=null,R()}async function W(a){try{const{PythonExportService:t}=await e(async()=>{const{PythonExportService:e}=await import("./PythonExportModal.vue_vue_type_style_index_0_lang-CLsxOcCp.js").then(e=>e.p);return{PythonExportService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13]),import.meta.url);await t.downloadPythonScript(a)}catch(t){console.error("Export failed:",t),alert("Export failed: "+(t instanceof Error?t.message:"Unknown error"))}}async function K(e){if(confirm(`Delete trial "${e.name}"? This cannot be undone.`))try{await t.deleteTrial(e.id),n.value===e.id&&D()}catch(a){console.error("Failed to delete trial:",a),alert("Failed to delete trial")}}return P(()=>{R()}),(e,a)=>{const t=$("a-button"),n=$("a-tag"),c=$("a-space");return w(),g("div",ta,["table"===l.value?(w(),g("div",la,[E(Ue,{trials:r.value,loading:u.value,onViewResults:T,onExportTrial:A,onDuplicateTrial:O,onDeleteTrial:K,onTrialDetails:L,onRefreshTrials:R,onExportAll:F,onStatusFilterChanged:B},null,8,["trials","loading"])])):"analysis"===l.value&&i.value?(w(),g("div",sa,[_("div",na,[E(t,{onClick:D,type:"default",class:"back-button"},{icon:M(()=>[E(q(p))]),default:M(()=>[a[4]||(a[4]=C(" Back to Results "))]),_:1,__:[4]}),_("div",ia,[_("h2",null,x(i.value.name),1),E(n,{color:(f=i.value.status,{completed:"success",failed:"error",running:"processing",cancelled:"default",draft:"default",pending:"processing",paused:"warning"}[f]||"default"),size:"small"},{default:M(()=>[C(x(i.value.status.toUpperCase()),1)]),_:1},8,["color"])]),E(c,null,{default:M(()=>[E(t,{onClick:a[0]||(a[0]=e=>W(i.value))},{icon:M(()=>[E(q(s))]),default:M(()=>[a[5]||(a[5]=C(" Export Results "))]),_:1,__:[5]})]),_:1})]),E(aa,{trial:i.value,"api-calls":o.value,loading:d.value,onBackToSelection:D,onExportTrial:W},null,8,["trial","api-calls","loading"])])):I("",!0),y.value&&b.value?(w(),j(z,{key:2,trial:b.value,onClose:a[1]||(a[1]=e=>{y.value=!1,b.value=null}),onExported:V},null,8,["trial"])):I("",!0),h.value&&i.value?(w(),j(N,{key:3,trial:i.value,onClose:a[2]||(a[2]=e=>h.value=!1),onUpdated:H},null,8,["trial"])):I("",!0),k.value?(w(),j(U,{key:4,trialToDuplicate:S.value,onClose:a[3]||(a[3]=e=>{k.value=!1,S.value=null}),onCreated:J},null,8,["trialToDuplicate"])):I("",!0)]);var f}}}),[["__scopeId","data-v-27afa482"]]);export{ra as default};
