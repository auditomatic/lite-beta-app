import{k as e,d as a,f as t,o as l,aa as s,Z as n,a0 as i,F as o,ab as r,a2 as c,c as d,$ as u,q as p,ac as m,G as v,a3 as g,u as b,ad as f,_ as h,Y as y,W as w,X as k}from"./vendor-BsQOyEiA.js";import{I as C,e as _,p as x,_ as D,l as T,g as A,i as I,h as S,M as E,j as P,k as U,Q as L}from"./index-CDZ8s7Dx.js";import{s as N}from"./storage-calculation.service-DhFzjdOO.js";import{p as R,a as M,b as O,c as j,d as $,e as z}from"./import-helpers-R1GGtEJc.js";import"./db-CL8uhZCz.js";var V={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M864 736c0-111.6-65.4-208-160-252.9V317.3c0-15.1-5.3-29.7-15.1-41.2L536.5 95.4C530.1 87.8 521 84 512 84s-18.1 3.8-24.5 11.4L335.1 276.1a63.97 63.97 0 00-15.1 41.2v165.8C225.4 528 160 624.4 160 736h156.5c-2.3 7.2-3.5 15-3.5 23.8 0 22.1 7.6 43.7 21.4 60.8a97.2 97.2 0 0043.1 30.6c23.1 54 75.6 88.8 134.5 88.8 29.1 0 57.3-8.6 81.4-24.8 23.6-15.8 41.9-37.9 53-64a97 97 0 0043.1-30.5 97.52 97.52 0 0021.4-60.8c0-8.4-1.1-16.4-3.1-23.8H864zM762.3 621.4c9.4 14.6 17 30.3 22.5 46.6H700V558.7a211.6 211.6 0 0162.3 62.7zM388 483.1V318.8l124-147 124 147V668H388V483.1zM239.2 668c5.5-16.3 13.1-32 22.5-46.6 16.3-25.2 37.5-46.5 62.3-62.7V668h-84.8zm388.9 116.2c-5.2 3-11.2 4.2-17.1 3.4l-19.5-2.4-2.8 19.4c-5.4 37.9-38.4 66.5-76.7 66.5-38.3 0-71.3-28.6-76.7-66.5l-2.8-19.5-19.5 2.5a27.7 27.7 0 01-17.1-3.5c-8.7-5-14.1-14.3-14.1-24.4 0-10.6 5.9-19.4 14.6-23.8h231.3c8.8 4.5 14.6 13.3 14.6 23.8-.1 10.2-5.5 19.6-14.2 24.5zM464 400a48 48 0 1096 0 48 48 0 10-96 0z"}}]},name:"rocket",theme:"outlined"};function B(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),l.forEach(function(a){F(e,a,t[a])})}return e}function F(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var W=function(a,t){var l=B({},a,t.attrs);return e(C,B({},l,{icon:V}),null)};W.displayName="RocketOutlined",W.inheritAttrs=!1;const K={class:"provider-endpoint-configuration"},G={class:"endpoint-grid"},J=["value","onInput","placeholder","disabled","data-testid","aria-label"],q=D(a({__name:"ProviderEndpointConfiguration",setup(e){const a=_(),d=t([]);function u(e){const a=d.value.find(a=>a.id===e);return a?.api.baseUrl||""}function p(e){return a.isProviderEnabled(e)}return l(async()=>{await x.waitForReady(),d.value=[...x.getAllProviders()]}),(e,t)=>(n(),s("div",K,[t[0]||(t[0]=i("h3",null,"Provider Endpoints",-1)),t[1]||(t[1]=i("p",{class:"section-desc"},"Configure base URLs for API providers",-1)),i("div",G,[(n(!0),s(o,null,r(d.value,e=>{return n(),s("div",{key:e.id,class:"endpoint-item"},[i("label",null,c(e.name),1),i("input",{value:(t=e.id,a.getBaseUrl(t)||""),onInput:t=>function(e,t){const l=t.target.value;a.setBaseUrl(e,l)}(e.id,t),placeholder:u(e.id),disabled:!p(e.id),class:"endpoint-input","data-testid":`input-endpoint-${e.id}`,"aria-label":`${e.name} endpoint URL`},null,40,J)]);var t}),128))])]))}}),[["__scopeId","data-v-451d83ee"]]),H={class:"system-information-panel"},Y={class:"info-grid"},Z={class:"info-item"},Q={class:"info-item"},X={class:"info-item"},ee={class:"info-item"},ae=D(a({__name:"SystemInformationPanel",props:{totalRecords:{}},setup(e){const a=e,o=t(null),r=d(()=>({dbVersion:"1.0.0",totalRecords:a.totalRecords,storageUsed:o.value?o.value.formattedUsed:"Calculating...",lastUpdated:(new Date).toLocaleString()}));return l(async()=>{try{o.value=await N.getStorageInfo()}catch(e){T.warn("Failed to get storage info",{error:e})}}),(e,a)=>(n(),s("div",H,[a[4]||(a[4]=i("h3",null,"System Information",-1)),i("div",Y,[i("div",Z,[a[0]||(a[0]=i("label",null,"Database Version:",-1)),i("span",null,c(r.value.dbVersion),1)]),i("div",Q,[a[1]||(a[1]=i("label",null,"Records Count:",-1)),i("span",null,c(r.value.totalRecords),1)]),i("div",X,[a[2]||(a[2]=i("label",null,"Storage Used:",-1)),i("span",null,c(r.value.storageUsed),1)]),i("div",ee,[a[3]||(a[3]=i("label",null,"Last Updated:",-1)),i("span",null,c(r.value.lastUpdated),1)])])]))}}),[["__scopeId","data-v-92906e97"]]),te={class:"database-table-manager"},le={class:"table-header"},se={class:"table-actions"},ne=["onClick","data-testid","aria-label"],ie=["onClick","data-testid","aria-label"],oe=["onClick","disabled","data-testid","aria-label"],re={key:0,class:"table-content"},ce={class:"table-controls"},de=["onUpdate:modelValue","data-testid","aria-label"],ue=["onClick","data-testid","aria-label"],pe={class:"table-data"},me=["onClick","data-testid","aria-label","aria-expanded"],ve=D(a({__name:"DatabaseTableManager",props:{tableData:{}},emits:["refresh-data"],setup(e,{emit:a}){const l=e,v=a,g=t(new Set),b=t({}),f=t(""),h=t(),y=d(()=>[{name:"designs",count:l.tableData.designs?.length||0},{name:"variableLists",count:l.tableData.variableLists?.length||0},{name:"trials",count:l.tableData.trials?.length||0},{name:"models",count:l.tableData.models?.length||0},{name:"apiCalls",count:l.tableData.apiCalls?.length||0},{name:"settings",count:l.tableData.settings?.length||0},{name:"templatePrompts",count:l.tableData.templatePrompts?.length||0},{name:"spreadsheetPrompts",count:l.tableData.spreadsheetPrompts?.length||0}]);function w(e){const a=l.tableData[e]||[],t=b.value[e]?.toLowerCase()||"";if(!t)return JSON.stringify(a.slice(0,10),null,2);const s=a.filter(e=>JSON.stringify(e).toLowerCase().includes(t));return JSON.stringify(s.slice(0,10),null,2)}function k(e){!function(e,a){const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),l=URL.createObjectURL(t),s=document.createElement("a");s.href=l,s.download=a,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(l)}(l.tableData[e]||[],`${e}_export.json`)}async function C(e){const a=e.target.files?.[0];if(a){try{const e=await a.text(),t=JSON.parse(e);l.tableData[f.value]&&await async function(e,a){const t=A[e];if(t){let l=a;switch(e){case"trials":l=$(a);break;case"designs":l=j(a);break;case"variableLists":l=O(a);break;case"models":l=M(a);break;case"apiCalls":l=R(a)}await t.bulkPut(l)}}(f.value,t),v("refresh-data"),alert("Import completed successfully!")}catch(t){T.error("Import failed",t),alert("Import failed: "+(t instanceof Error?t.message:"Unknown error"))}h.value&&(h.value.value="")}}return(e,a)=>(n(),s("div",te,[a[0]||(a[0]=i("h3",null,"Database Tables",-1)),(n(!0),s(o,null,r(y.value,e=>(n(),s("div",{key:e.name,class:"table-section"},[i("div",le,[i("h4",null,c(e.name)+" ("+c(e.count)+" records)",1),i("div",se,[i("button",{onClick:a=>k(e.name),class:"export-btn","data-testid":`btn-export-table-${e.name}`,"aria-label":`Export ${e.name} table`},"Export",8,ne),i("button",{onClick:a=>{return t=e.name,f.value=t,void h.value?.click();var t},class:"import-btn","data-testid":`btn-import-table-${e.name}`,"aria-label":`Import ${e.name} table`},"Import",8,ie),i("button",{onClick:a=>async function(e){if(!confirm(`Are you sure you want to clear all ${e} data? This cannot be undone.`))return;const a=A[e];a&&(await a.clear(),v("refresh-data"))}(e.name),class:"clear-btn",disabled:0===e.count,"data-testid":`btn-clear-table-${e.name}`,"aria-label":`Clear all ${e.name} data`}," Clear All ",8,oe)])]),g.value.has(e.name)?(n(),s("div",re,[i("div",ce,[p(i("input",{"onUpdate:modelValue":a=>b.value[e.name]=a,placeholder:"Search records...",class:"search-input","data-testid":`input-search-${e.name}`,"aria-label":`Search ${e.name} records`},null,8,de),[[m,b.value[e.name]]]),i("button",{onClick:a=>(e.name,void v("refresh-data")),class:"refresh-btn","data-testid":`btn-refresh-${e.name}`,"aria-label":`Refresh ${e.name} table`},"Refresh",8,ue)]),i("div",pe,[i("pre",null,c(w(e.name)),1)])])):u("",!0),i("button",{onClick:a=>{return t=e.name,void(g.value.has(t)?g.value.delete(t):g.value.add(t));var t},class:"toggle-btn","data-testid":`btn-toggle-${e.name}`,"aria-label":`${g.value.has(e.name)?"Collapse":"Expand"} ${e.name} table`,"aria-expanded":g.value.has(e.name)},c(g.value.has(e.name)?"Collapse":"Expand"),9,me)]))),128)),i("input",{ref_key:"fileInput",ref:h,type:"file",accept:".json",onChange:C,style:{display:"none"},"data-testid":"input-file-import","aria-label":"Select JSON file to import"},null,544)]))}}),[["__scopeId","data-v-f84bffa7"]]),ge={class:"trial-debug-information"},be={key:0,class:"debug-info"},fe={class:"debug-row"},he={class:"debug-row"},ye={class:"debug-row"},we={class:"debug-row"},ke={class:"debug-row"},Ce={class:"debug-row"},_e={class:"debug-json"},xe={key:0,class:"debug-row"},De={class:"native-snapshot-info template"},Te={key:1,class:"debug-row"},Ae={class:"native-snapshot-info spreadsheet"},Ie={key:2,class:"debug-row"},Se={key:1,class:"empty-state"},Ee=D(a({__name:"TrialDebugInformation",setup(e){const a=t(null);async function l(){try{const e=await A.trials.toArray();if(e.length>0){const t=e.sort((e,a)=>new Date(a.created).getTime()-new Date(e.created).getTime())[0];a.value=t,I(t)?T.info("Latest trial debug info (Template):",{name:t.name,type:t.type,templateId:t.templateId,templateName:t.templateName}):S(t)&&T.info("Latest trial debug info (Spreadsheet):",{name:t.name,type:t.type,spreadsheetId:t.spreadsheetId,datasetName:t.datasetName})}else a.value=null}catch(e){T.error("Failed to load latest trial",e)}}function o(e){return e?I(e)?"Template":S(e)?"Spreadsheet":"Unknown V2 type":"No trial"}function r(e){return e?I(e)?e.templateId:S(e)?e.spreadsheetId:"Unknown":"N/A"}function d(e){return e?I(e)?e.templateName:S(e)?e.datasetName:"Unknown":"N/A"}function p(e){return e?I(e)?{type:e.type,templateId:e.templateId,templateName:e.templateName,template:e.template?.substring(0,100)+"...",variablesCount:Object.keys(e.variables||{}).length,outputType:e.outputType,configCount:e.configurationSnapshots?.length||0}:S(e)?{type:e.type,spreadsheetId:e.spreadsheetId,datasetName:e.datasetName,promptPattern:e.promptPattern?.substring(0,100)+"...",datasetRowCount:e.datasetSnapshot?.rows?.length||0,outputType:e.outputType,configCount:e.configurationSnapshots?.length||0}:{type:"unknown",raw:e}:null}return l(),(e,t)=>{return n(),s("div",ge,[t[9]||(t[9]=i("h3",null,"Latest Trial Debug Info",-1)),a.value?(n(),s("div",be,[i("div",fe,[t[0]||(t[0]=i("strong",null,"Name:",-1)),v(" "+c(a.value.name),1)]),i("div",he,[t[1]||(t[1]=i("strong",null,"Created:",-1)),v(" "+c(new Date(a.value.created).toLocaleString()),1)]),i("div",ye,[t[2]||(t[2]=i("strong",null,"Source Type:",-1)),i("span",{class:g(["source-type",(m=a.value,m?I(m)?"template":S(m)?"spreadsheet":"unknown":"none")])},c(o(a.value)),3)]),i("div",we,[t[3]||(t[3]=i("strong",null,"Source ID:",-1)),i("code",null,c(r(a.value)),1)]),i("div",ke,[t[4]||(t[4]=i("strong",null,"Source Name:",-1)),i("span",null,c(d(a.value)),1)]),i("div",Ce,[t[5]||(t[5]=i("strong",null,"V2 Trial Data:",-1)),i("pre",_e,c(JSON.stringify(p(a.value),null,2)),1)]),b(I)(a.value)?(n(),s("div",xe,[t[6]||(t[6]=i("strong",null,"V2 Template Trial:",-1)),i("div",De,[i("div",null,"Template Name: "+c(a.value.templateName),1),i("div",null,"Template Length: "+c(a.value.template?.length||0)+" chars",1),i("div",null,"Variables: "+c(Object.keys(a.value.variables||{}).join(", ")||"None"),1),i("div",null,"Output Type: "+c(a.value.outputType),1),i("div",null,"Extract Pattern: "+c(a.value.extractPattern||"None"),1)])])):u("",!0),b(S)(a.value)?(n(),s("div",Te,[t[7]||(t[7]=i("strong",null,"V2 Spreadsheet Trial:",-1)),i("div",Ae,[i("div",null,"Dataset Name: "+c(a.value.datasetName),1),i("div",null,"Prompt Pattern Length: "+c(a.value.promptPattern?.length||0)+" chars",1),i("div",null,"Dataset Rows: "+c(a.value.datasetSnapshot?.rows?.length||0),1),i("div",null,"Dataset Columns: "+c(a.value.datasetSnapshot?.columns?.join(", ")||"None"),1),i("div",null,"Output Type: "+c(a.value.outputType),1)])])):u("",!0),!a.value||b(I)(a.value)||b(S)(a.value)?u("",!0):(n(),s("div",Ie,t[8]||(t[8]=[i("div",{class:"warning-box"}," ⚠️ Unknown V2 trial type - this trial may be corrupted or from an unsupported version ",-1)])))])):(n(),s("div",Se," No trials found ")),i("button",{onClick:l,class:"refresh-btn"}," Refresh Latest Trial ")]);var m}}}),[["__scopeId","data-v-d30cff78"]]),Pe={class:"import-export-tools"},Ue=D(a({__name:"ImportExportTools",props:{tableData:{}},emits:["refresh-data"],setup(e,{emit:a}){const l=e,o=a,r=t(""),c=t();async function d(){k({version:"1.0.0",exported:(new Date).toISOString(),data:l.tableData},`auditomatic_full_export_${Date.now()}.json`)}async function u(){const e=l.tableData.designs||[],a=l.tableData.variableLists||[];k({version:"1.0.0",exported:(new Date).toISOString(),designs:e,variableLists:a},`designs_variables_export_${Date.now()}.json`)}async function p(){const e=l.tableData.trials||[],a=l.tableData.apiCalls||[];k({version:"1.0.0",exported:(new Date).toISOString(),trials:e,apiCalls:a},`trials_export_${Date.now()}.json`)}async function m(){k(l.tableData.models||[],`models_export_${Date.now()}.json`)}async function v(){k((l.tableData.models||[]).map(e=>({id:e.id,provider:e.provider,modelId:e.modelId,enabled:e.enabled})),`model_states_export_${Date.now()}.json`)}function g(){r.value="fullDatabase",c.value?.click()}function b(){r.value="designsAndVariables",c.value?.click()}function f(){r.value="trials",c.value?.click()}function h(){r.value="models",c.value?.click()}function y(){r.value="modelStates",c.value?.click()}async function w(e){const a=e.target.files?.[0];if(a){try{const e=await a.text(),t=JSON.parse(e);switch(r.value){case"fullDatabase":await async function(e){const a=z(e);if(a.data)for(const[t,l]of Object.entries(a.data)){const e=A[t];e&&await e.bulkPut(l)}}(t);break;case"designsAndVariables":await async function(e){if(e.designs){const a=j(e.designs);await A.designs.bulkPut(a)}if(e.variableLists){const a=O(e.variableLists);await A.variableLists.bulkPut(a)}}(t);break;case"trials":await async function(e){if(e.trials){const a=$(e.trials);await A.trials.bulkPut(a)}if(e.apiCalls){const a=R(e.apiCalls);await A.apiCalls.bulkPut(a)}}(t);break;case"models":await async function(e){const a=M(e);await A.models.bulkPut(a)}(t);break;case"modelStates":await async function(e){for(const a of e)await A.models.update(a.id,{enabled:a.enabled})}(t)}o("refresh-data"),alert("Import completed successfully!")}catch(t){T.error("Import failed",t),alert("Import failed: "+(t instanceof Error?t.message:"Unknown error"))}c.value&&(c.value.value="")}}function k(e,a){const t=new Blob([JSON.stringify(e,null,2)],{type:"application/json"}),l=URL.createObjectURL(t),s=document.createElement("a");s.href=l,s.download=a,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(l)}return(e,a)=>(n(),s("div",Pe,[a[6]||(a[6]=i("h3",null,"Import/Export Tools",-1)),i("div",{class:"export-group"},[a[0]||(a[0]=i("h4",null,"Complete Database",-1)),i("div",{class:"export-actions"},[i("button",{onClick:d,class:"export-all-btn","data-testid":"btn-export-full-database","aria-label":"Export complete database"},"Export All Data"),i("button",{onClick:g,class:"import-all-btn","data-testid":"btn-import-full-database","aria-label":"Import complete database"},"Import All Data")])]),i("div",{class:"export-group"},[a[1]||(a[1]=i("h4",null,"Designs & Variables",-1)),a[2]||(a[2]=i("p",{class:"export-desc"},"Exports designs with their linked variable lists",-1)),i("div",{class:"export-actions"},[i("button",{onClick:u,class:"export-btn","data-testid":"btn-export-designs-variables","aria-label":"Export designs and variables"},"Export Designs+Variables"),i("button",{onClick:b,class:"import-btn","data-testid":"btn-import-designs-variables","aria-label":"Import designs and variables"},"Import Designs+Variables")])]),i("div",{class:"export-group"},[a[3]||(a[3]=i("h4",null,"Trials",-1)),a[4]||(a[4]=i("p",{class:"export-desc"},"Exports trials with configuration snapshots and results",-1)),i("div",{class:"export-actions"},[i("button",{onClick:p,class:"export-btn"},"Export Trials"),i("button",{onClick:f,class:"import-btn"},"Import Trials")])]),i("div",{class:"export-group"},[a[5]||(a[5]=i("h4",null,"Models",-1)),i("div",{class:"export-actions"},[i("button",{onClick:m,class:"export-btn"},"Export All Models"),i("button",{onClick:h,class:"import-btn"},"Import All Models")]),i("div",{class:"export-actions"},[i("button",{onClick:v,class:"export-state-btn"},"Export Model States Only"),i("button",{onClick:y,class:"import-state-btn"},"Import Model States Only")])]),i("input",{ref_key:"fileInput",ref:c,type:"file",accept:".json",onChange:w,style:{display:"none"},"data-testid":"input-file-import","aria-label":"Select JSON file to import"},null,544)]))}}),[["__scopeId","data-v-89d2b8b7"]]),Le={class:"developer-tools"},Ne={key:0,class:"section"},Re={key:0,class:"migration-status"},Me={class:"status-item"},Oe={class:"status-item"},je={class:"status-item"},$e={class:"migration-actions"},ze=["disabled"],Ve=["disabled"],Be=["disabled"],Fe={key:0},We={key:0},Ke={class:"section"},Ge={class:"tokenizer-test"},Je={class:"test-input-group"},qe={class:"test-actions"},He=["disabled"],Ye=["disabled"],Ze=["disabled"],Qe={class:"worker-status"},Xe={class:"text-secondary"},ea={key:0,class:"test-results"},aa={class:"result-grid"},ta={class:"result-item"},la={class:"result-item"},sa={class:"result-item"},na={class:"result-item"},ia={key:0,class:"error-message"},oa={key:1,class:"progress-messages"},ra={class:"section debug-settings-section"},ca={class:"debug-toggle"},da={class:"checkbox-label"},ua={class:"checkbox-text"},pa={key:0,class:"debug-warning"},ma=D(a({__name:"DeveloperTools",emits:["refresh-data"],setup(e,{emit:a}){const d=a,b=t(P.ENABLE_PROMPT_REFACTOR),h=t(!1),y=t(!1),w=t(!1),k=t(null),C=t(null),x=t("Hello world! This is a test of tiktoken tokenization."),D=t(!1),I=t(!1),S=t(null),U=t(null),L=_(),N=t(!1);async function R(){await L.setDebugThrowAllErrors(N.value),T.info("Debug throw all errors flag updated",{enabled:N.value})}async function M(){h.value=!0,C.value=null;try{const e=await A.designs.toArray(),a=await A.templatePrompts.toArray(),t=await A.spreadsheetPrompts.toArray();let l=0;const s=new Set(e.map(e=>e.id)),n=new Set([...a.map(e=>e.id),...t.map(e=>e.id)]);for(const r of s)n.has(r)&&l++;const i=e.length,o=i-l;k.value={total:i,migrated:l,pending:o},0===l&&i>0?C.value={type:"warning",title:"No migrations found",details:`${i} designs are ready to migrate to the new prompt system.`}:l===i&&i>0?C.value={type:"success",title:"Migration complete",details:"All designs have been migrated to the new prompt system."}:l>0&&o>0&&(C.value={type:"warning",title:"Partial migration",details:`${l} of ${i} designs have been migrated. ${o} remaining.`})}catch(e){T.error("Failed to check migration status",e),C.value={type:"error",title:"Failed to check migration status",details:e instanceof Error?e.message:"Unknown error"}}finally{h.value=!1}}async function O(){y.value=!0,C.value=null;try{await E.forceReMigration(),await M();const e=await E.getMigrationStatus();C.value={type:"success",title:"V2 migration completed successfully",details:`Migration completed. Status: ${e.templatePromptsCount} templates, ${e.spreadsheetPromptsCount} spreadsheets. ${e.legacyDesignsCount} legacy designs remaining.`}}catch(e){T.error("Migration failed",e),C.value={type:"error",title:"V2 migration failed",details:e instanceof Error?e.message:"Unknown error"}}finally{y.value=!1}}async function j(){w.value=!0,C.value=null;try{const e=await E.validateMigration();e.valid?C.value={type:"success",title:"Migration validation passed",details:"All designs have been correctly migrated to their respective prompt tables."}:C.value={type:"error",title:"Migration validation failed",details:`Found ${e.errors.length} validation errors.`,errors:e.errors.join("\n")}}catch(e){T.error("Validation failed",e),C.value={type:"error",title:"Validation failed",details:e instanceof Error?e.message:"Unknown error"}}finally{w.value=!1}}async function $(){if(!x.value)return;D.value=!0,U.value=null;const e=Date.now();try{const a=Math.ceil(x.value.length/4),t=Date.now()-e;U.value={method:"Approximate (4 chars/token)",tokens:a,duration:t,isAccurate:!1}}catch(a){U.value={method:"Approximate (4 chars/token)",tokens:0,duration:Date.now()-e,isAccurate:!1,error:a instanceof Error?a.message:"Unknown error"}}finally{D.value=!1}}async function z(){if(!x.value)return;I.value=!0,U.value=null;const e=Date.now(),a=[];try{const t=new Worker(new URL(""+new URL("token-calculation.worker-_TmsjB_5.js",import.meta.url).href,import.meta.url),{type:"module"}),l=`test-${Date.now()}`,s=await new Promise((e,s)=>{const n=setTimeout(()=>{t.terminate(),s(new Error("Worker timeout after 30 seconds"))},3e4);t.onmessage=i=>{const o=i.data;o.id===l&&("progress"===o.type?a.push(`${o.stage}: ${o.message}`):"result"===o.type?(clearTimeout(n),t.terminate(),e(o.result)):"error"===o.type&&(clearTimeout(n),t.terminate(),s(new Error(o.error.message))))},t.onerror=e=>{clearTimeout(n),t.terminate(),s(e)},t.postMessage({id:l,method:"accurate",design:{promptTemplate:x.value,variableBindings:{}}})}),n=Date.now()-e;U.value={method:"Accurate (Reload CDN)",tokens:s.minTokens,duration:n,isAccurate:s.isAccurate,progress:a}}catch(t){U.value={method:"Accurate (Reload CDN)",tokens:0,duration:Date.now()-e,isAccurate:!1,error:t instanceof Error?t.message:"Unknown error",progress:a}}finally{I.value=!1}}async function V(){if(!x.value||!S.value)return;I.value=!0,U.value=null;const e=Date.now(),a=[];try{const t=`test-${Date.now()}`,l=await new Promise((e,l)=>{const s=setTimeout(()=>{l(new Error("Worker timeout after 30 seconds"))},3e4),n=i=>{const o=i.data;o.id===t&&("progress"===o.type?a.push(`${o.stage}: ${o.message}`):"result"===o.type?(clearTimeout(s),S.value?.removeEventListener("message",n),e(o.result)):"error"===o.type&&(clearTimeout(s),S.value?.removeEventListener("message",n),l(new Error(o.error.message))))};S.value?.addEventListener("message",n),S.value?.postMessage({id:t,method:"accurate",design:{promptTemplate:x.value,variableBindings:{}}})}),s=Date.now()-e;U.value={method:"Accurate (Use Cached)",tokens:l.minTokens,duration:s,isAccurate:l.isAccurate,progress:a}}catch(t){U.value={method:"Accurate (Use Cached)",tokens:0,duration:Date.now()-e,isAccurate:!1,error:t instanceof Error?t.message:"Unknown error",progress:a}}finally{I.value=!1}}async function B(){if(!S.value)try{const e=new Worker(new URL(""+new URL("token-calculation.worker-_TmsjB_5.js",import.meta.url).href,import.meta.url),{type:"module"});await new Promise(a=>{const t=setTimeout(()=>a(!1),1e4);e.onmessage=e=>{"result"!==e.data.type&&"error"!==e.data.type||(clearTimeout(t),a(!0))},e.postMessage({id:"prime",method:"accurate",design:{promptTemplate:"test",variableBindings:{}}})})?S.value=e:e.terminate()}catch(e){T.error("Failed to initialize persistent worker",e)}}function F(){S.value&&(S.value.terminate(),S.value=null)}async function W(){confirm("Are you sure you want to clear ALL data? This cannot be undone.")&&(await A.delete(),localStorage.clear(),sessionStorage.clear(),document.cookie.split(";").forEach(e=>{document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")}),T.info("All data cleared - reloading page"),window.location.reload())}async function K(){confirm("Reset all settings to defaults? This will clear all data.")&&await W()}async function G(){confirm("Regenerate database? This will clear all data and rebuild.")&&(await A.delete(),await A.open(),d("refresh-data"))}return l(async()=>{await L.initialize(),N.value=L.getDebugThrowAllErrors()}),(e,a)=>(n(),s("div",Le,[b.value?(n(),s("div",Ne,[a[5]||(a[5]=i("h3",null,"Design Type Migration",-1)),a[6]||(a[6]=i("p",{class:"section-desc"},"Migrate old designs to new template/spreadsheet prompt types",-1)),k.value?(n(),s("div",Re,[i("div",Me,[a[2]||(a[2]=i("label",null,"Total Designs:",-1)),i("span",null,c(k.value.total),1)]),i("div",Oe,[a[3]||(a[3]=i("label",null,"Already Migrated:",-1)),i("span",null,c(k.value.migrated),1)]),i("div",je,[a[4]||(a[4]=i("label",null,"Pending Migration:",-1)),i("span",null,c(k.value.pending),1)])])):u("",!0),i("div",$e,[i("button",{onClick:M,class:"check-btn",disabled:h.value},c(h.value?"Checking...":"Check Migration Status"),9,ze),i("button",{onClick:O,class:"migrate-btn",disabled:y.value||null!==k.value&&0===k.value.pending},c(y.value?"Migrating...":"Run Migration"),9,Ve),i("button",{onClick:j,class:"validate-btn",disabled:w.value},c(w.value?"Validating...":"Validate Migration"),9,Be)]),C.value?(n(),s("div",{key:1,class:g(["migration-result",C.value.type])},[i("h4",null,c(C.value.title),1),C.value.details?(n(),s("div",Fe,[i("p",null,c(C.value.details),1),C.value.errors?(n(),s("pre",We,c(C.value.errors),1)):u("",!0)])):u("",!0)],2)):u("",!0)])):u("",!0),i("div",Ke,[a[14]||(a[14]=i("h3",null,"Tokenizer Testing",-1)),a[15]||(a[15]=i("p",{class:"section-desc"},"Test the CDN-based tiktoken worker implementation",-1)),i("div",Ge,[i("div",Je,[a[7]||(a[7]=i("label",null,"Test Text:",-1)),p(i("textarea",{"onUpdate:modelValue":a[0]||(a[0]=e=>x.value=e),placeholder:"Enter text to tokenize...",class:"test-textarea",rows:"3"},null,512),[[m,x.value]])]),i("div",qe,[i("button",{onClick:$,class:"test-btn",disabled:!x.value||D.value},c(D.value?"Testing...":"Test Approximate (4 chars/token)"),9,He),i("button",{onClick:z,class:"test-btn primary",disabled:!x.value||I.value},c(I.value?"Loading CDN...":"Test Accurate (Reload CDN)"),9,Ye),i("button",{onClick:V,class:"test-btn secondary",disabled:!x.value||I.value||!S.value},c(I.value?"Testing...":"Test Accurate (Use Cached)"),9,Ze)]),i("div",Qe,[i("small",Xe,[v(" Worker Status: "+c(S.value?"✅ Cached (CDN loaded)":"❌ Not initialized")+" ",1),S.value?u("",!0):(n(),s("button",{key:0,onClick:B,class:"init-btn"},"Initialize Cached Worker")),S.value?(n(),s("button",{key:1,onClick:F,class:"terminate-btn"},"Terminate Worker")):u("",!0)])]),U.value?(n(),s("div",ea,[a[13]||(a[13]=i("h4",null,"Results:",-1)),i("div",aa,[i("div",ta,[a[8]||(a[8]=i("label",null,"Method:",-1)),i("span",null,c(U.value.method),1)]),i("div",la,[a[9]||(a[9]=i("label",null,"Token Count:",-1)),i("span",null,c(U.value.tokens),1)]),i("div",sa,[a[10]||(a[10]=i("label",null,"Time Taken:",-1)),i("span",null,c(U.value.duration)+"ms",1)]),i("div",na,[a[11]||(a[11]=i("label",null,"Is Accurate:",-1)),i("span",null,c(U.value.isAccurate?"✅ Yes":"❌ No"),1)])]),U.value.error?(n(),s("div",ia," ❌ Error: "+c(U.value.error),1)):u("",!0),U.value.progress?(n(),s("div",oa,[a[12]||(a[12]=i("h5",null,"Progress:",-1)),(n(!0),s(o,null,r(U.value.progress,e=>(n(),s("div",{key:e,class:"progress-msg"},c(e),1))),128))])):u("",!0)])):u("",!0)])]),i("div",ra,[a[17]||(a[17]=i("h3",null,"🚨 Heisenbug Debug Mode",-1)),a[18]||(a[18]=i("p",{class:"section-desc"},"When enabled, all API execution errors will throw immediately instead of being stored, showing full stack traces in DevTools.",-1)),i("div",ca,[i("label",da,[p(i("input",{type:"checkbox","onUpdate:modelValue":a[1]||(a[1]=e=>N.value=e),onChange:R},null,544),[[f,N.value]]),i("span",ua,c(N.value?"🔥 Debug Mode ON - Errors will throw!":"💤 Debug Mode OFF - Errors stored normally"),1)])]),N.value?(n(),s("div",pa,a[16]||(a[16]=[v(" ⚠️ "),i("strong",null,"Warning:",-1),v(" With debug mode enabled, any error during API execution will crash the application and show stack traces in browser DevTools. This is intended for debugging the heisenbug. ")]))):u("",!0)]),i("div",{class:"section danger-actions-section"},[a[19]||(a[19]=i("h3",null,"Destructive Actions",-1)),i("div",{class:"danger-actions"},[i("button",{onClick:W,class:"danger-btn","data-testid":"btn-clear-all-data","aria-label":"Clear all application data"},"Clear All Data"),i("button",{onClick:K,class:"danger-btn","data-testid":"btn-reset-defaults","aria-label":"Reset application to default settings"},"Reset to Defaults"),i("button",{onClick:G,class:"danger-btn","data-testid":"btn-regenerate-database","aria-label":"Regenerate database structure"},"Regenerate Database")])])]))}}),[["__scopeId","data-v-a2b7505a"]]),va={class:"debug-data-management"},ga=D(a({__name:"DebugDataManagement",setup(a){const i=t({}),o=d(()=>Object.values(i.value).reduce((e,a)=>e+a.length,0));async function r(){try{const e={designs:await A.designs.toArray(),variableLists:await A.variableLists.toArray(),trials:await A.trials.toArray(),models:await A.models.toArray(),apiCalls:await A.apiCalls.toArray(),settings:await A.settings.toArray(),templatePrompts:await A.templatePrompts.toArray(),spreadsheetPrompts:await A.spreadsheetPrompts.toArray()};i.value=e}catch(e){T.error("Failed to load table data",e)}}return l(async()=>{await r()}),(a,t)=>(n(),s("div",va,[e(q),e(ae,{"total-records":o.value},null,8,["total-records"]),e(ve,{"table-data":i.value,onRefreshData:r},null,8,["table-data"]),e(Ee),e(Ue,{"table-data":i.value,onRefreshData:r},null,8,["table-data"]),e(ma,{onRefreshData:r})]))}}),[["__scopeId","data-v-224fee86"]]),ba={class:"settings-view full-width","data-testid":"page-settings"},fa={class:"api-key-label"},ha={class:"provider-info spacing-top-xs"},ya={class:"text-secondary"},wa={class:"help-item"},ka={class:"help-content"},Ca={class:"help-item"},_a={class:"help-content"},xa={class:"single-line-setting"},Da={key:0,class:"environmental-toggle-section"},Ta={class:"env-toggle-container"},Aa=D(a({__name:"SettingsView",setup(a){const p=_(),m=U(),f=w(),C=t([]),D=t([]),A=d({get:()=>p.financialCostsEnabled,set:e=>p.setFinancialCostsEnabled(e)}),I=t(!0),S=d({get:()=>p.environmentalCostsEnabled,set:e=>p.setEnvironmentalCostsEnabled(e)}),E=t("carbon"),P=t(["cars","phones"]),N=[{title:"Provider Group",dataIndex:"name",key:"name",width:150},{title:"Providers",dataIndex:"providers",key:"providers",width:200},{title:"Value",key:"input",width:100,align:"center"},{title:"Slider (1-6)",key:"slider",width:200,align:"center"}],R=d(()=>{const e=x.getAllGroups(),a=[];for(const t of e){const e=x.getProvidersInGroup(t);if(0===e.length)continue;const l=e.some(e=>p.isProviderEnabled(e.id));let s=1;for(const a of e)a.execution?.defaultConcurrency&&(s=Math.max(s,a.execution.defaultConcurrency));const n=p.getGroupConcurrency(t),i=void 0!==n?n:s;a.push({id:t,name:t.charAt(0).toUpperCase()+t.slice(1),providers:e.map(e=>e.name).join(", "),concurrency:i,enabled:l,defaultConcurrency:s})}return a}),M=d(()=>p.apiKeyGroups);function O(e,a){p.setGroupConcurrency(e,a)}function j(){f.push("/environmental-config")}function $(){m.reset(),f.push("/welcome")}return l(async()=>{T.debug("SettingsView mounted")}),(a,t)=>{const l=y("a-tag"),d=y("a-alert"),m=y("a-input-password"),f=y("a-form-item"),w=y("a-col"),_=y("a-row"),x=y("a-form"),T=y("a-card"),U=y("a-button"),z=y("a-divider"),V=y("a-space"),B=y("a-input-number"),F=y("a-slider"),K=y("a-table"),G=y("a-collapse-panel"),J=y("a-collapse"),q=y("a-switch"),H=y("a-select-option"),Y=y("a-select"),Z=y("a-checkbox"),Q=y("a-checkbox-group");return n(),s("div",ba,[t[30]||(t[30]=i("div",{class:"settings-header"},[i("h2",null,"Settings"),i("p",{class:"description"},"Configure API keys and provider settings for scientific model testing")],-1)),e(T,{title:"API Keys",class:"settings-card",size:"small"},{extra:h(()=>[e(l,{color:"green",size:"small"},{default:h(()=>[v(c(Object.values(M.value).filter(e=>e.hasKey).length)+" / "+c(Object.keys(M.value).length)+" configured ",1)]),_:1})]),default:h(()=>[e(d,{message:"Local Storage Only: API keys are stored locally in your browser and are never sent to auditomatic.org. API Keys only leave your browser as authentication to external LLM API providers, via encrypted HTTPS.",type:"info","show-icon":"",class:"spacing-bottom-md"}),e(x,{layout:"vertical",size:"small"},{default:h(()=>[e(_,{gutter:[16,16]},{default:h(()=>[(n(!0),s(o,null,r(M.value,a=>(n(),k(w,{key:a.id,span:12},{default:h(()=>[e(f,null,{label:h(()=>[i("div",fa,[v(c(a.name)+" ",1),a.hasKey?(n(),k(l,{key:0,color:"success",size:"small"},{default:h(()=>t[6]||(t[6]=[v("✓ Configured")])),_:1,__:[6]})):(n(),k(l,{key:1,color:"default",size:"small"},{default:h(()=>t[7]||(t[7]=[v("Not configured")])),_:1,__:[7]}))])]),default:h(()=>{return[e(m,{value:(t=a.id,p.getApiKey(t)||""),onInput:e=>function(e,a){const t=a.target.value;p.setApiKey(e,t)}(a.id,e),placeholder:`Enter ${a.name} API key`,autocomplete:"off",size:"small",visibilityToggle:!0,"data-testid":`input-api-key-${a.id}`,"aria-label":`${a.name} API key input`},null,8,["value","onInput","placeholder","data-testid","aria-label"]),i("div",ha,[i("small",ya," Used by: "+c(a.providers.join(", ")),1)])];var t}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),e(T,{title:"Getting Started",class:"settings-card",size:"small"},{extra:h(()=>[e(l,{color:"blue",size:"small"},{default:h(()=>t[8]||(t[8]=[v("Help")])),_:1,__:[8]})]),default:h(()=>[e(V,{direction:"vertical",style:{width:"100%"}},{default:h(()=>[i("div",wa,[e(b(W),{class:"help-icon"}),i("div",ka,[t[10]||(t[10]=i("h4",null,"Setup Wizard",-1)),t[11]||(t[11]=i("p",null,"New to Auditomatic? Run the setup wizard to configure providers and learn the basics.",-1)),e(U,{onClick:$},{default:h(()=>t[9]||(t[9]=[v(" Run Setup Wizard ")])),_:1,__:[9]})])]),e(z,{style:{margin:"12px 0"}}),i("div",Ca,[e(b(L),{class:"help-icon"}),i("div",_a,[t[13]||(t[13]=i("h4",null,"Documentation",-1)),t[14]||(t[14]=i("p",null,"Learn more about using Auditomatic Lite for systematic LLM testing.",-1)),e(U,{type:"link",href:"/docs",target:"_blank"},{default:h(()=>t[12]||(t[12]=[v(" View Documentation → ")])),_:1,__:[12]})])])]),_:1})]),_:1}),e(T,{class:"settings-card",size:"small"},{default:h(()=>[e(J,{activeKey:C.value,"onUpdate:activeKey":t[0]||(t[0]=e=>C.value=e),bordered:!1},{default:h(()=>[e(G,{key:"concurrency"},{header:h(()=>t[15]||(t[15]=[i("div",{class:"collapse-header"},[i("span",{class:"collapse-title"},"Concurrency Settings"),i("small",{class:"text-secondary"},"Request limits per provider group (max 6 due to browser limitations)")],-1)])),default:h(()=>[e(d,{message:"Browser Connection Limit",description:"Modern browsers limit HTTP/1.1 connections to 6 per host. Since all AI providers use HTTP/1.1, setting concurrency above 6 will have no effect.",type:"info","show-icon":"",style:{marginBottom:"16px"}}),e(K,{columns:N,"data-source":R.value,pagination:!1,size:"small",class:"scientific-table","row-key":"id"},{bodyCell:h(({column:e,record:a})=>["input"===e.key?(n(),k(B,{key:0,value:a.concurrency,onChange:e=>O(a.id,e),min:1,max:6,disabled:!a.enabled,size:"small",style:{width:"80px"},"data-testid":`input-concurrency-${a.id}`,"aria-label":`Concurrency limit for ${a.name}`},null,8,["value","onChange","disabled","data-testid","aria-label"])):u("",!0),"slider"===e.key?(n(),k(F,{key:1,value:a.concurrency,onChange:e=>O(a.id,e),min:1,max:6,disabled:!a.enabled,style:{width:"150px",margin:"0 auto"},size:"small"},null,8,["value","onChange","disabled"])):u("",!0)]),_:1},8,["data-source"])]),_:1})]),_:1},8,["activeKey"])]),_:1}),e(T,{title:"Cost Tracking",class:"settings-card",size:"small"},{default:h(()=>[i("div",xa,[t[16]||(t[16]=i("span",{class:"setting-label"},"Financial:",-1)),t[17]||(t[17]=i("span",{class:"setting-desc"},"Display estimated API costs for model usage",-1)),e(q,{checked:A.value,"onUpdate:checked":t[1]||(t[1]=e=>A.value=e),"data-testid":"switch-financial-costs","aria-label":"Enable or disable financial cost display"},null,8,["checked"])]),I.value?(n(),s("div",Da,[t[20]||(t[20]=i("h3",{class:"settings-subsection-title"},"Environmental Impact Display",-1)),i("div",Ta,[i("div",{class:g(["env-toggle-option",{active:!S.value}])},t[18]||(t[18]=[i("strong",null,'Show "??"',-1),i("span",null,"Display as placeholders",-1)]),2),e(q,{checked:S.value,"onUpdate:checked":t[2]||(t[2]=e=>S.value=e),"data-testid":"switch-environmental-costs","aria-label":"Toggle between ?? placeholders and estimates",size:"default"},null,8,["checked"]),i("div",{class:g(["env-toggle-option",{active:S.value}])},t[19]||(t[19]=[i("strong",null,"Show Estimates",-1),i("span",null,"Beta estimates (not recommended)",-1)]),2)]),S.value?(n(),k(d,{key:0,message:"These environmental estimates are very inaccurate and not currently recommended. They're shown for relative comparison only.",type:"warning","show-icon":"",class:"spacing-top-md",style:{fontSize:"12px"}})):u("",!0)])):u("",!0),S.value?(n(),k(x,{key:1,layout:"vertical",size:"small",class:"spacing-top-lg"},{default:h(()=>[e(f,{label:"Primary Environmental Metric"},{default:h(()=>[e(Y,{value:E.value,"onUpdate:value":t[3]||(t[3]=e=>E.value=e),style:{width:"200px"},size:"small","data-testid":"select-environmental-metric","aria-label":"Select primary environmental metric"},{default:h(()=>[e(H,{value:"carbon"},{default:h(()=>t[21]||(t[21]=[v("Carbon Footprint")])),_:1,__:[21]}),e(H,{value:"water"},{default:h(()=>t[22]||(t[22]=[v("Water Usage")])),_:1,__:[22]}),e(H,{value:"energy"},{default:h(()=>t[23]||(t[23]=[v("Energy Consumption")])),_:1,__:[23]})]),_:1},8,["value"])]),_:1}),e(f,{label:"Show Equivalents"},{default:h(()=>[e(Q,{value:P.value,"onUpdate:value":t[4]||(t[4]=e=>P.value=e),"data-testid":"checkbox-group-equivalents","aria-label":"Select environmental equivalents to display"},{default:h(()=>[e(Z,{value:"cars","data-testid":"checkbox-equiv-cars"},{default:h(()=>t[24]||(t[24]=[v("Car Miles")])),_:1,__:[24]}),e(Z,{value:"trees","data-testid":"checkbox-equiv-trees"},{default:h(()=>t[25]||(t[25]=[v("Trees Needed")])),_:1,__:[25]}),e(Z,{value:"phones","data-testid":"checkbox-equiv-phones"},{default:h(()=>t[26]||(t[26]=[v("Phone Charges")])),_:1,__:[26]}),e(Z,{value:"bottles","data-testid":"checkbox-equiv-bottles"},{default:h(()=>t[27]||(t[27]=[v("Water Bottles")])),_:1,__:[27]})]),_:1},8,["value"])]),_:1}),e(f,null,{default:h(()=>[e(U,{type:"link",onClick:j,size:"small","data-testid":"btn-configure-environmental","aria-label":"Go to environmental cost configuration"},{default:h(()=>t[28]||(t[28]=[v(" Configure Environmental Cost Data → ")])),_:1,__:[28]})]),_:1})]),_:1})):u("",!0)]),_:1}),e(T,{class:"settings-card danger-zone-card",size:"small"},{default:h(()=>[e(J,{activeKey:D.value,"onUpdate:activeKey":t[5]||(t[5]=e=>D.value=e),bordered:!1},{default:h(()=>[e(G,{key:"danger-zone"},{header:h(()=>t[29]||(t[29]=[i("div",{class:"collapse-header danger-zone-header"},[i("span",{class:"collapse-title danger-zone-title"},"DANGER ZONE SETTINGS"),i("small",{class:"text-danger"},"Data management & destructive actions")],-1)])),default:h(()=>[e(ga)]),_:1})]),_:1},8,["activeKey"])]),_:1})])}}}),[["__scopeId","data-v-d3b392d0"]]);export{Aa as default};
