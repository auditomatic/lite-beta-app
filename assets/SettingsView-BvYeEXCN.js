import{d as a,f as e,c as t,o as l,a6 as s,Y as n,_ as i,F as o,a8 as r,a0 as d,a1 as c,q as u,aa as p,k as b,Z as v,W as m,a9 as f,V as g,G as y}from"./vendor-DImCB_rW.js";import{u as h,a as k,p as w,l as C,d as _,_ as x}from"./index-CQy8uDNc.js";import{u as I}from"./designs-db-CxUhrxQA.js";import{u as S}from"./variables-db-DpO5XvdA.js";import{s as E}from"./storage-calculation.service-frBt-Sa0.js";import"./db-CL8uhZCz.js";import"./defaultData-BR5V2V3r.js";import"./variable.service-DtVlxFLx.js";function A(a,e){if(Array.isArray(a))return a.map(a=>A(a,e));const t={...a};for(const l of e)t[l]&&"string"==typeof t[l]&&(t[l]=new Date(t[l]));return t}function D(a){return A(a,["created","started","completed"])}function P(a){return A(a,["created","updated"])}function L(a){return A(a,["created","updated"])}function U(a){return A(a,["created"])}function $(a){return A(a,["created","completed"])}const j={class:"debug-data-management"},z={class:"section"},R={class:"endpoint-grid"},O=["value","onInput","placeholder","disabled","data-testid","aria-label"],T={class:"section"},K={class:"info-grid"},V={class:"info-item"},M={class:"info-item"},N={class:"info-item"},q={class:"info-item"},F={class:"section"},J={class:"table-header"},G={class:"table-actions"},B=["onClick","data-testid","aria-label"],W=["onClick","data-testid","aria-label"],Z=["onClick","disabled","data-testid","aria-label"],H={key:0,class:"table-content"},Y={class:"table-controls"},Q=["onUpdate:modelValue","data-testid","aria-label"],X=["onClick","data-testid","aria-label"],aa={class:"table-data"},ea=["onClick","data-testid","aria-label","aria-expanded"],ta=x(a({__name:"DebugDataManagement",setup(a){const b=I(),v=S(),m=h(),f=k(),g=e(new Set),y=e({}),x=e({}),A=e(""),ta=e(),la=e(null),sa=e([]),na=t(()=>({dbVersion:"1.0.0",totalRecords:Object.values(x.value).reduce((a,e)=>a+e.length,0),storageUsed:la.value?la.value.formattedUsed:"Calculating...",lastUpdated:(new Date).toLocaleString()})),ia=t(()=>[{name:"designs",count:x.value.designs?.length||0},{name:"variableLists",count:x.value.variableLists?.length||0},{name:"trials",count:x.value.trials?.length||0},{name:"models",count:x.value.models?.length||0},{name:"apiCalls",count:x.value.apiCalls?.length||0},{name:"settings",count:x.value.settings?.length||0}]);async function oa(){try{x.value={designs:await _.designs.toArray(),variableLists:await _.variableLists.toArray(),trials:await _.trials.toArray(),models:await _.models.toArray(),apiCalls:await _.apiCalls.toArray(),settings:await _.settings.toArray()}}catch(a){C.error("Failed to load table data",a)}}function ra(a){const e=x.value[a]||[],t=y.value[a]?.toLowerCase()||"";if(!t)return JSON.stringify(e.slice(0,10),null,2);const l=e.filter(a=>JSON.stringify(a).toLowerCase().includes(t));return JSON.stringify(l.slice(0,10),null,2)}async function da(){xa({version:"1.0.0",exported:(new Date).toISOString(),data:x.value},`auditomatic_full_export_${Date.now()}.json`)}async function ca(){const a=x.value.designs||[],e=x.value.variableLists||[];xa({version:"1.0.0",exported:(new Date).toISOString(),designs:a,variableLists:e},`designs_variables_export_${Date.now()}.json`)}async function ua(){const a=x.value.trials||[],e=x.value.apiCalls||[];xa({version:"1.0.0",exported:(new Date).toISOString(),trials:a,apiCalls:e},`trials_export_${Date.now()}.json`)}async function pa(){xa(x.value.models||[],`models_export_${Date.now()}.json`)}async function ba(){xa((x.value.models||[]).map(a=>({id:a.id,provider:a.provider,modelId:a.modelId,enabled:a.enabled})),`model_states_export_${Date.now()}.json`)}function va(){A.value="fullDatabase",ta.value?.click()}function ma(){A.value="designsAndVariables",ta.value?.click()}function fa(){A.value="trials",ta.value?.click()}function ga(){A.value="models",ta.value?.click()}function ya(){A.value="modelStates",ta.value?.click()}async function ha(a){const e=a.target.files?.[0];if(e){try{const a=await e.text(),t=JSON.parse(a);switch(A.value){case"fullDatabase":await async function(a){const e=function(a){const e={...a};return a.data&&(a.data.trials&&(e.data.trials=D(a.data.trials)),a.data.designs&&(e.data.designs=P(a.data.designs)),a.data.variableLists&&(e.data.variableLists=L(a.data.variableLists)),a.data.models&&(e.data.models=U(a.data.models)),a.data.apiCalls&&(e.data.apiCalls=$(a.data.apiCalls))),e}(a);if(e.data)for(const[t,l]of Object.entries(e.data))await ka(t,l)}(t);break;case"designsAndVariables":await async function(a){if(a.designs){const e=P(a.designs);await _.designs.bulkPut(e)}if(a.variableLists){const e=L(a.variableLists);await _.variableLists.bulkPut(e)}}(t);break;case"trials":await async function(a){if(a.trials){const e=D(a.trials);await _.trials.bulkPut(e)}if(a.apiCalls){const e=$(a.apiCalls);await _.apiCalls.bulkPut(e)}}(t);break;case"models":await async function(a){const e=U(a);await _.models.bulkPut(e)}(t);break;case"modelStates":await async function(a){for(const e of a)await _.models.update(e.id,{enabled:e.enabled})}(t);break;default:x.value[A.value]&&await ka(A.value,t)}await oa(),alert("Import completed successfully!")}catch(t){C.error("Import failed",t),alert("Import failed: "+(t instanceof Error?t.message:"Unknown error"))}ta.value&&(ta.value.value="")}}async function ka(a,e){const t=_[a];if(t){let l=e;switch(a){case"trials":l=D(e);break;case"designs":l=P(e);break;case"variableLists":l=L(e);break;case"models":l=U(e);break;case"apiCalls":l=$(e)}await t.bulkPut(l)}}async function wa(){confirm("Are you sure you want to clear ALL data? This cannot be undone.")&&(await _.delete(),await _.open(),await oa())}async function Ca(){confirm("Reset all settings to defaults? This will clear all data.")&&(await wa(),await Promise.all([b.initialize(),v.initialize(),m.initialize()]))}async function _a(){confirm("Regenerate database? This will clear all data and rebuild.")&&(await _.delete(),await _.open(),await oa())}function xa(a,e){const t=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),l=URL.createObjectURL(t),s=document.createElement("a");s.href=l,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(l)}function Ia(a){const e=sa.value.find(e=>e.id===a);return e?.api.baseUrl||""}function Sa(a){return f.isProviderEnabled(a)}return l(async()=>{await oa(),await w.waitForReady(),sa.value=[...w.getAllProviders()];try{la.value=await E.getStorageInfo()}catch(a){C.warn("Failed to get storage info",{error:a})}}),(a,e)=>(n(),s("div",j,[i("div",z,[e[0]||(e[0]=i("h3",null,"Provider Endpoints",-1)),e[1]||(e[1]=i("p",{class:"section-desc"},"Configure base URLs for API providers",-1)),i("div",R,[(n(!0),s(o,null,r(sa.value,a=>{return n(),s("div",{key:a.id,class:"endpoint-item"},[i("label",null,d(a.name),1),i("input",{value:(e=a.id,f.getBaseUrl(e)||""),onInput:e=>function(a,e){const t=e.target.value;f.setBaseUrl(a,t)}(a.id,e),placeholder:Ia(a.id),disabled:!Sa(a.id),class:"endpoint-input","data-testid":`input-endpoint-${a.id}`,"aria-label":`${a.name} endpoint URL`},null,40,O)]);var e}),128))])]),i("div",T,[e[6]||(e[6]=i("h3",null,"System Information",-1)),i("div",K,[i("div",V,[e[2]||(e[2]=i("label",null,"Database Version:",-1)),i("span",null,d(na.value.dbVersion),1)]),i("div",M,[e[3]||(e[3]=i("label",null,"Records Count:",-1)),i("span",null,d(na.value.totalRecords),1)]),i("div",N,[e[4]||(e[4]=i("label",null,"Storage Used:",-1)),i("span",null,d(na.value.storageUsed),1)]),i("div",q,[e[5]||(e[5]=i("label",null,"Last Updated:",-1)),i("span",null,d(na.value.lastUpdated),1)])])]),i("div",F,[e[7]||(e[7]=i("h3",null,"Database Tables",-1)),(n(!0),s(o,null,r(ia.value,a=>(n(),s("div",{key:a.name,class:"table-section"},[i("div",J,[i("h4",null,d(a.name)+" ("+d(a.count)+" records)",1),i("div",G,[i("button",{onClick:e=>async function(a){xa(x.value[a]||[],`${a}_export.json`)}(a.name),class:"export-btn","data-testid":`btn-export-table-${a.name}`,"aria-label":`Export ${a.name} table`},"Export",8,B),i("button",{onClick:e=>{return t=a.name,A.value=t,void ta.value?.click();var t},class:"import-btn","data-testid":`btn-import-table-${a.name}`,"aria-label":`Import ${a.name} table`},"Import",8,W),i("button",{onClick:e=>async function(a){if(!confirm(`Are you sure you want to clear all ${a} data? This cannot be undone.`))return;const e=_[a];e&&(await e.clear(),await oa())}(a.name),class:"clear-btn",disabled:0===a.count,"data-testid":`btn-clear-table-${a.name}`,"aria-label":`Clear all ${a.name} data`}," Clear All ",8,Z)])]),g.value.has(a.name)?(n(),s("div",H,[i("div",Y,[u(i("input",{"onUpdate:modelValue":e=>y.value[a.name]=e,placeholder:"Search records...",class:"search-input","data-testid":`input-search-${a.name}`,"aria-label":`Search ${a.name} records`},null,8,Q),[[p,y.value[a.name]]]),i("button",{onClick:e=>async function(){await oa()}(a.name),class:"refresh-btn","data-testid":`btn-refresh-${a.name}`,"aria-label":`Refresh ${a.name} table`},"Refresh",8,X)]),i("div",aa,[i("pre",null,d(ra(a.name)),1)])])):c("",!0),i("button",{onClick:e=>{return t=a.name,void(g.value.has(t)?g.value.delete(t):g.value.add(t));var t},class:"toggle-btn","data-testid":`btn-toggle-${a.name}`,"aria-label":`${g.value.has(a.name)?"Collapse":"Expand"} ${a.name} table`,"aria-expanded":g.value.has(a.name)},d(g.value.has(a.name)?"Collapse":"Expand"),9,ea)]))),128))]),i("div",{class:"section"},[e[14]||(e[14]=i("h3",null,"Import/Export Tools",-1)),i("div",{class:"export-group"},[e[8]||(e[8]=i("h4",null,"Complete Database",-1)),i("div",{class:"export-actions"},[i("button",{onClick:da,class:"export-all-btn","data-testid":"btn-export-full-database","aria-label":"Export complete database"},"Export All Data"),i("button",{onClick:va,class:"import-all-btn","data-testid":"btn-import-full-database","aria-label":"Import complete database"},"Import All Data")])]),i("div",{class:"export-group"},[e[9]||(e[9]=i("h4",null,"Designs & Variables",-1)),e[10]||(e[10]=i("p",{class:"export-desc"},"Exports designs with their linked variable lists",-1)),i("div",{class:"export-actions"},[i("button",{onClick:ca,class:"export-btn","data-testid":"btn-export-designs-variables","aria-label":"Export designs and variables"},"Export Designs+Variables"),i("button",{onClick:ma,class:"import-btn","data-testid":"btn-import-designs-variables","aria-label":"Import designs and variables"},"Import Designs+Variables")])]),i("div",{class:"export-group"},[e[11]||(e[11]=i("h4",null,"Trials",-1)),e[12]||(e[12]=i("p",{class:"export-desc"},"Exports trials with configuration snapshots and results",-1)),i("div",{class:"export-actions"},[i("button",{onClick:ua,class:"export-btn"},"Export Trials"),i("button",{onClick:fa,class:"import-btn"},"Import Trials")])]),i("div",{class:"export-group"},[e[13]||(e[13]=i("h4",null,"Models",-1)),i("div",{class:"export-actions"},[i("button",{onClick:pa,class:"export-btn"},"Export All Models"),i("button",{onClick:ga,class:"import-btn"},"Import All Models")]),i("div",{class:"export-actions"},[i("button",{onClick:ba,class:"export-state-btn"},"Export Model States Only"),i("button",{onClick:ya,class:"import-state-btn"},"Import Model States Only")])])]),i("div",{class:"section danger-actions-section"},[e[15]||(e[15]=i("h3",null,"Destructive Actions",-1)),i("div",{class:"danger-actions"},[i("button",{onClick:wa,class:"danger-btn","data-testid":"btn-clear-all-data","aria-label":"Clear all application data"},"Clear All Data"),i("button",{onClick:Ca,class:"danger-btn","data-testid":"btn-reset-defaults","aria-label":"Reset application to default settings"},"Reset to Defaults"),i("button",{onClick:_a,class:"danger-btn","data-testid":"btn-regenerate-database","aria-label":"Regenerate database structure"},"Regenerate Database")])]),i("input",{ref_key:"fileInput",ref:ta,type:"file",accept:".json",onChange:ha,style:{display:"none"},"data-testid":"input-file-import","aria-label":"Select JSON file to import"},null,544)]))}}),[["__scopeId","data-v-afc1e976"]]),la={class:"settings-view full-width","data-testid":"page-settings"},sa={class:"api-key-label"},na={class:"provider-info spacing-top-xs"},ia={class:"text-secondary"},oa={class:"single-line-setting"},ra={key:0,class:"single-line-setting"},da=x(a({__name:"SettingsView",setup(a){const u=k(),p=f(),h=e([]),_=e([]),x=t({get:()=>u.financialCostsEnabled,set:a=>u.setFinancialCostsEnabled(a)}),I=e(!0),S=t({get:()=>u.environmentalCostsEnabled,set:a=>u.setEnvironmentalCostsEnabled(a)}),E=e("carbon"),A=e(["cars","phones"]),D=[{title:"Provider",dataIndex:"name",key:"name",width:150},{title:"Value",key:"input",width:100,align:"center"},{title:"Slider (1-64)",key:"slider",width:200,align:"center"}],P=t(()=>w.getAllProviders().map(a=>{return{id:a.id,name:a.name,concurrency:(e=a.id,u.getProviderConcurrency(e)||U(e)),enabled:u.isProviderEnabled(a.id)};var e})),L=t(()=>u.apiKeyGroups);function U(a){const e=w.getProvider(a);return e?.execution?.defaultConcurrency||4}function $(a,e){u.setProviderConcurrency(a,e)}function j(){p.push("/environmental-config")}return l(async()=>{C.debug("onMounted start"),C.debug("Waiting for provider registry to load"),await w.waitForReady(),C.debug("Provider registry ready"),C.debug("onMounted end")}),(a,e)=>{const t=m("a-tag"),l=m("a-alert"),p=m("a-input-password"),f=m("a-form-item"),k=m("a-col"),w=m("a-row"),C=m("a-form"),U=m("a-card"),z=m("a-input-number"),R=m("a-slider"),O=m("a-table"),T=m("a-collapse-panel"),K=m("a-collapse"),V=m("a-switch"),M=m("a-select-option"),N=m("a-select"),q=m("a-checkbox"),F=m("a-checkbox-group"),J=m("a-button");return n(),s("div",la,[e[22]||(e[22]=i("div",{class:"settings-header"},[i("h2",null,"Settings"),i("p",{class:"description"},"Configure API keys and provider settings for scientific model testing")],-1)),b(U,{title:"API Keys",class:"settings-card",size:"small"},{extra:v(()=>[b(t,{color:"green",size:"small"},{default:v(()=>[y(d(Object.values(L.value).filter(a=>a.hasKey).length)+" / "+d(Object.keys(L.value).length)+" configured ",1)]),_:1})]),default:v(()=>[b(l,{message:"Local Storage Only: API keys are stored locally in your browser and are never sent to auditomatic.org. API Keys only leave your browser as authentication to external LLM API providers, via encrypted HTTPS.",type:"info","show-icon":"",class:"spacing-bottom-md"}),b(C,{layout:"vertical",size:"small"},{default:v(()=>[b(w,{gutter:[16,16]},{default:v(()=>[(n(!0),s(o,null,r(L.value,a=>(n(),g(k,{key:a.id,span:12},{default:v(()=>[b(f,null,{label:v(()=>[i("div",sa,[y(d(a.name)+" ",1),a.hasKey?(n(),g(t,{key:0,color:"success",size:"small"},{default:v(()=>e[6]||(e[6]=[y("✓ Configured")])),_:1,__:[6]})):(n(),g(t,{key:1,color:"default",size:"small"},{default:v(()=>e[7]||(e[7]=[y("Not configured")])),_:1,__:[7]}))])]),default:v(()=>{return[b(p,{value:(e=a.id,u.getApiKey(e)||""),onInput:e=>function(a,e){const t=e.target.value;u.setApiKey(a,t)}(a.id,e),placeholder:`Enter ${a.name} API key`,autocomplete:"off",size:"small",visibilityToggle:!0,"data-testid":`input-api-key-${a.id}`,"aria-label":`${a.name} API key input`},null,8,["value","onInput","placeholder","data-testid","aria-label"]),i("div",na,[i("small",ia," Used by: "+d(a.providers.join(", ")),1)])];var e}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),b(U,{class:"settings-card",size:"small"},{default:v(()=>[b(K,{activeKey:h.value,"onUpdate:activeKey":e[0]||(e[0]=a=>h.value=a),bordered:!1},{default:v(()=>[b(T,{key:"concurrency"},{header:v(()=>e[8]||(e[8]=[i("div",{class:"collapse-header"},[i("span",{class:"collapse-title"},"Concurrency Settings"),i("small",{class:"text-secondary"},"Request limits per provider")],-1)])),default:v(()=>[b(O,{columns:D,"data-source":P.value,pagination:!1,size:"small",class:"scientific-table","row-key":"id"},{bodyCell:v(({column:a,record:e})=>["input"===a.key?(n(),g(z,{key:0,value:e.concurrency,onChange:a=>$(e.id,a),min:1,max:64,disabled:!e.enabled,size:"small",style:{width:"80px"},"data-testid":`input-concurrency-${e.id}`,"aria-label":`Concurrency limit for ${e.name}`},null,8,["value","onChange","disabled","data-testid","aria-label"])):c("",!0),"slider"===a.key?(n(),g(R,{key:1,value:e.concurrency,onChange:a=>$(e.id,a),min:1,max:64,disabled:!e.enabled,style:{width:"150px",margin:"0 auto"},size:"small"},null,8,["value","onChange","disabled"])):c("",!0)]),_:1},8,["data-source"])]),_:1})]),_:1},8,["activeKey"])]),_:1}),b(U,{title:"Cost Tracking",class:"settings-card",size:"small"},{default:v(()=>[i("div",oa,[e[9]||(e[9]=i("span",{class:"setting-label"},"Financial:",-1)),e[10]||(e[10]=i("span",{class:"setting-desc"},"Display estimated API costs for model usage",-1)),b(V,{checked:x.value,"onUpdate:checked":e[1]||(e[1]=a=>x.value=a),"data-testid":"switch-financial-costs","aria-label":"Enable or disable financial cost display"},null,8,["checked"])]),I.value?(n(),s("div",ra,[e[11]||(e[11]=i("span",{class:"setting-label"},"Environmental:",-1)),e[12]||(e[12]=i("span",{class:"setting-desc"},"Show carbon, water, and energy consumption",-1)),b(V,{checked:S.value,"onUpdate:checked":e[2]||(e[2]=a=>S.value=a),"data-testid":"switch-environmental-costs","aria-label":"Enable or disable environmental cost tracking"},null,8,["checked"])])):c("",!0),I.value&&S.value?(n(),g(l,{key:1,message:"Environmental numbers are estimates for relative comparison only",type:"warning","show-icon":"",class:"spacing-top-md",style:{fontSize:"12px"}})):c("",!0),S.value?(n(),g(C,{key:2,layout:"vertical",size:"small",class:"spacing-top-lg"},{default:v(()=>[b(f,{label:"Primary Environmental Metric"},{default:v(()=>[b(N,{value:E.value,"onUpdate:value":e[3]||(e[3]=a=>E.value=a),style:{width:"200px"},size:"small","data-testid":"select-environmental-metric","aria-label":"Select primary environmental metric"},{default:v(()=>[b(M,{value:"carbon"},{default:v(()=>e[13]||(e[13]=[y("Carbon Footprint")])),_:1,__:[13]}),b(M,{value:"water"},{default:v(()=>e[14]||(e[14]=[y("Water Usage")])),_:1,__:[14]}),b(M,{value:"energy"},{default:v(()=>e[15]||(e[15]=[y("Energy Consumption")])),_:1,__:[15]})]),_:1},8,["value"])]),_:1}),b(f,{label:"Show Equivalents"},{default:v(()=>[b(F,{value:A.value,"onUpdate:value":e[4]||(e[4]=a=>A.value=a),"data-testid":"checkbox-group-equivalents","aria-label":"Select environmental equivalents to display"},{default:v(()=>[b(q,{value:"cars","data-testid":"checkbox-equiv-cars"},{default:v(()=>e[16]||(e[16]=[y("Car Miles")])),_:1,__:[16]}),b(q,{value:"trees","data-testid":"checkbox-equiv-trees"},{default:v(()=>e[17]||(e[17]=[y("Trees Needed")])),_:1,__:[17]}),b(q,{value:"phones","data-testid":"checkbox-equiv-phones"},{default:v(()=>e[18]||(e[18]=[y("Phone Charges")])),_:1,__:[18]}),b(q,{value:"bottles","data-testid":"checkbox-equiv-bottles"},{default:v(()=>e[19]||(e[19]=[y("Water Bottles")])),_:1,__:[19]})]),_:1},8,["value"])]),_:1}),b(f,null,{default:v(()=>[b(J,{type:"link",onClick:j,size:"small","data-testid":"btn-configure-environmental","aria-label":"Go to environmental cost configuration"},{default:v(()=>e[20]||(e[20]=[y(" Configure Environmental Cost Data → ")])),_:1,__:[20]})]),_:1})]),_:1})):c("",!0)]),_:1}),b(U,{class:"settings-card danger-zone-card",size:"small"},{default:v(()=>[b(K,{activeKey:_.value,"onUpdate:activeKey":e[5]||(e[5]=a=>_.value=a),bordered:!1},{default:v(()=>[b(T,{key:"danger-zone"},{header:v(()=>e[21]||(e[21]=[i("div",{class:"collapse-header danger-zone-header"},[i("span",{class:"collapse-title danger-zone-title"},"DANGER ZONE SETTINGS"),i("small",{class:"text-danger"},"Data management & destructive actions")],-1)])),default:v(()=>[b(ta)]),_:1})]),_:1},8,["activeKey"])]),_:1})])}}}),[["__scopeId","data-v-6b95805a"]]);export{da as default};
