import{I as e,l as a,f as t,c as l,_ as s,H as n,J as i,K as r,L as o,i as u,d as c,v as d}from"./index-Dynr8V5n.js";import{k as p,d as v,f,c as m,a6 as y,B as g,_ as b,F as _,a8 as h,G as x,a0 as k,W as C,Z as w,Y as S,q as R,af as $,ak as E,a1 as j,V as O,u as I,o as T,w as q,l as L}from"./vendor-DImCB_rW.js";import{A as M,P}from"./PythonExportModal.vue_vue_type_style_index_0_lang-BKaFWCp2.js";import{i as N}from"./feature-flags-DaxAZY-J.js";var U={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"};function A(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),l.forEach(function(a){F(e,a,t[a])})}return e}function F(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var z=function(a,t){var l=A({},a,t.attrs);return p(e,A({},l,{icon:U}),null)};z.displayName="ExportOutlined",z.inheritAttrs=!1;const B={class:"modal-content"},D={class:"modal-header"},H={class:"modal-body"},V={class:"section"},J={class:"format-options"},W=["data-testid","aria-label"],K=["value","data-testid","aria-label"],G={class:"format-label"},Y={class:"format-name"},Z={class:"section"},Q={class:"field-groups"},X=["data-testid"],ee={class:"field-list"},ae=["data-testid","aria-label"],te=["value","data-testid","aria-label"],le={class:"field-label"},se={class:"field-name"},ne={class:"field-desc"},ie={class:"section"},re={class:"preview-info"},oe={class:"preview-count"},ue={class:"preview-fields"},ce={class:"preview-size"},de={class:"modal-footer"},pe=s(v({__name:"ExportDataModal",props:{trial:{},apiCalls:{}},emits:["close"],setup(e){const s=e,n=[{id:"csv",name:"CSV",description:"Comma-separated values (Excel compatible)"},{id:"tsv",name:"TSV",description:"Tab-separated values"},{id:"excel",name:"Excel",description:"Microsoft Excel (.xlsx)"},{id:"json",name:"JSON",description:"JavaScript Object Notation"},{id:"jsonl",name:"JSONL",description:"JSON Lines (one object per line)"}],i=[{name:"Basic Info",fields:[{id:"id",name:"ID",description:"API call identifier",default:!0},{id:"trial_id",name:"Trial ID",description:"Parent trial identifier",default:!0},{id:"trial_name",name:"Trial Name",description:"Human-readable trial name",default:!0},{id:"status",name:"Status",description:"Call status (completed, failed, etc.)",default:!0},{id:"created",name:"Created",description:"When the call was initiated",default:!0},{id:"completed",name:"Completed",description:"When the call finished",default:!0}]},{name:"Configuration",fields:[{id:"configuration_index",name:"Config Index",description:"Configuration array index",default:!1},{id:"configuration_name",name:"Config Name",description:"Human-readable config name",default:!1},{id:"provider",name:"Provider",description:"LLM service provider",default:!0},{id:"model",name:"Model",description:"Model identifier",default:!0}]},{name:"Content",fields:[{id:"prompt",name:"Prompt",description:"Input prompt text",default:!0},{id:"variables",name:"Variables",description:"Variable substitutions (flattened as separate columns)",default:!0},{id:"result_content",name:"Result Content",description:"LLM response content",default:!0},{id:"result_error",name:"Result Error",description:"Error message if failed",default:!0}]},{name:"Performance",fields:[{id:"response_latency_ms",name:"Latency (ms)",description:"Response time",default:!0},{id:"duration_ms",name:"Duration (ms)",description:"Total processing time",default:!1},{id:"result_success",name:"Success",description:"Whether call succeeded",default:!0}]},{name:"Technical Details",fields:[{id:"request_url",name:"Request URL",description:"API endpoint URL",default:!0},{id:"request_method",name:"Request Method",description:"HTTP method",default:!1},{id:"request_headers",name:"Request Headers",description:"HTTP request headers",default:!1},{id:"request_body",name:"Request Body",description:"Full request payload",default:!1},{id:"response_status",name:"Response Status",description:"HTTP status code",default:!0},{id:"response_headers",name:"Response Headers",description:"HTTP response headers",default:!1},{id:"response_body",name:"Response Body",description:"Full response payload",default:!1}]},{name:"Error Handling",fields:[{id:"network_error_count",name:"Network Errors",description:"Number of network failures",default:!1},{id:"retry_count",name:"Retry Count",description:"Number of retry attempts",default:!1}]}],r=f("csv"),o=f([]),u=i.flatMap(e=>e.fields);o.value=u.filter(e=>e.default).map(e=>e.id);const c=m(()=>{const e=50*o.value.length,a=s.apiCalls.length*e;return a<1024?`${a}B`:a<1048576?`${(a/1024).toFixed(1)}KB`:`${(a/1048576).toFixed(1)}MB`});function d(){o.value=u.map(e=>e.id)}function v(){o.value=u.filter(e=>e.default).map(e=>e.id)}function j(){o.value=[]}function O(){const e=new Set;return o.value.includes("variables")&&s.apiCalls.forEach(a=>{a.variables&&"object"==typeof a.variables&&Object.keys(a.variables).forEach(a=>e.add(a))}),s.apiCalls.map(a=>{const t={};var l,n;if(o.value.includes("id")&&(t.ID=a.id),o.value.includes("trial_id")&&(t["Trial ID"]=a.trialId),o.value.includes("trial_name")&&(t["Trial Name"]=s.trial.name),o.value.includes("status")&&(t.Status=a.status),o.value.includes("created")&&(t.Created=a.created.toISOString()),o.value.includes("completed")&&(t.Completed=a.completed?.toISOString()||""),o.value.includes("configuration_index")&&(t["Configuration Index"]=a.configurationIndex),o.value.includes("configuration_name")&&(t["Configuration Name"]=(l=a.configurationIndex,s.trial.configurationSnapshots[l]&&s.trial.configurationSnapshots[l].name||`Config ${l+1}`)),o.value.includes("provider")&&(t.Provider=(n=a,n.request?.url?.includes("openai.com")?"OpenAI":n.request?.url?.includes("anthropic.com")?"Anthropic":n.request?.url?.includes("openrouter.ai")?"OpenRouter":n.request?.url?.includes("localhost:11434")?"Ollama":"Unknown")),o.value.includes("model")&&(t.Model=function(e){return e.request?.body?.model?e.request.body.model:"Unknown"}(a)),o.value.includes("prompt")&&(t.Prompt=a.prompt),o.value.includes("variables"))for(const s of e)t[`variable_${s}`]=a.variables?.[s]||"";return o.value.includes("result_content")&&(t["Result Content"]=a.result?.content||""),o.value.includes("result_error")&&(t["Result Error"]=a.result?.error||""),o.value.includes("response_latency_ms")&&(t["Response Latency (ms)"]=a.response?.latencyMs||""),o.value.includes("duration_ms")&&(t["Duration (ms)"]=a.completed?a.completed.getTime()-a.created.getTime():""),o.value.includes("result_success")&&(t["Result Success"]=a.result?.success||!1),o.value.includes("request_url")&&(t["Request URL"]=a.request?.url||""),o.value.includes("request_method")&&(t["Request Method"]=a.request?.method||""),o.value.includes("request_headers")&&(t["Request Headers"]=JSON.stringify(a.request?.headers||{})),o.value.includes("request_body")&&(t["Request Body"]=JSON.stringify(a.request?.body||{})),o.value.includes("response_status")&&(t["Response Status"]=a.response?.status||""),o.value.includes("response_headers")&&(t["Response Headers"]=JSON.stringify(a.response?.headers||{})),o.value.includes("response_body")&&(t["Response Body"]=JSON.stringify(a.response?.body||{})),o.value.includes("network_error_count")&&(t["Network Error Count"]=0),o.value.includes("retry_count")&&(t["Retry Count"]=0),t})}async function I(){const e=O(),n=(new Date).toISOString().split("T")[0],i=`${s.trial.name}_${r.value}_${n}`;try{switch(r.value){case"csv":!function(e,a){if(0===e.length)return;const t=Object.keys(e[0]||{}),l=t.filter(e=>!e.startsWith("variable_")),s=t.filter(e=>e.startsWith("variable_")).sort(),n=[...l,...s],i=[n.join(","),...e.map(e=>n.map(a=>`"${String(e[a]||"").replace(/"/g,'""')}"`).join(","))].join("\n");T(i,`${a}.csv`,"text/csv")}(e,i);break;case"tsv":!function(e,a){if(0===e.length)return;const t=Object.keys(e[0]||{}),l=t.filter(e=>!e.startsWith("variable_")),s=t.filter(e=>e.startsWith("variable_")).sort(),n=[...l,...s],i=[n.join("\t"),...e.map(e=>n.map(a=>String(e[a]||"").replace(/\t/g," ")).join("\t"))].join("\n");T(i,`${a}.tsv`,"text/tab-separated-values")}(e,i);break;case"excel":await async function(e,a){const t=await l(()=>import("./xlsx-C4WhbwXR.js"),[],import.meta.url),s=t.utils.book_new(),n=t.utils.json_to_sheet(e),i=Object.keys(e[0]||{}),r=i.map(e=>({wch:Math.min(Math.max(e.length,10),50)}));n["!cols"]=r,t.utils.book_append_sheet(s,n,"Trial Results"),t.writeFile(s,`${a}.xlsx`)}(e,i);break;case"json":!function(e,a){const t=JSON.stringify(e,null,2);T(t,`${a}.json`,"application/json")}(e,i);break;case"jsonl":!function(e,a){const t=e.map(e=>JSON.stringify(e)).join("\n");T(t,`${a}.jsonl`,"application/jsonl")}(e,i)}}catch(o){a.error("Export failed",o),t.error("Export failed: "+(o instanceof Error?o.message:"Unknown error"))}}function T(e,a,t){let l=e;"text/csv"!==t&&"text/tab-separated-values"!==t||(l="\ufeff"+e);const s=new Blob([l],{type:`${t};charset=utf-8`}),n=URL.createObjectURL(s),i=document.createElement("a");i.href=n,i.download=a,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}return(e,a)=>{const t=C("a-button");return S(),y("div",{class:"modal-overlay",onClick:a[4]||(a[4]=g(a=>e.$emit("close"),["self"]))},[b("div",B,[b("div",D,[a[5]||(a[5]=b("h3",null,"Export Trial Data",-1)),b("button",{onClick:a[0]||(a[0]=a=>e.$emit("close")),class:"close-btn","data-testid":"btn-close-export-modal","aria-label":"Close export modal"},"×")]),b("div",H,[b("div",V,[a[6]||(a[6]=b("h4",null,"Export Format",-1)),b("div",J,[(S(),y(_,null,h(n,e=>b("label",{key:e.id,class:"format-option","data-testid":`label-format-${e.id}`,"aria-label":`Export as ${e.name} format`},[R(b("input",{type:"radio",value:e.id,"onUpdate:modelValue":a[1]||(a[1]=e=>r.value=e),class:"format-radio","data-testid":`radio-format-${e.id}`,"aria-label":`Select ${e.name} format`},null,8,K),[[$,r.value]]),b("span",G,[b("span",Y,k(e.name),1)])],8,W)),64))])]),b("div",Z,[b("h4",null,[a[7]||(a[7]=x(" Fields to Export ")),b("div",{class:"field-controls"},[b("button",{onClick:d,class:"control-btn","data-testid":"btn-select-all-fields","aria-label":"Select all export fields"},"Select All"),b("button",{onClick:v,class:"control-btn","data-testid":"btn-select-default-fields","aria-label":"Select default export fields"},"Defaults"),b("button",{onClick:j,class:"control-btn","data-testid":"btn-select-no-fields","aria-label":"Deselect all export fields"},"Select None")])]),b("div",Q,[(S(),y(_,null,h(i,e=>b("div",{key:e.name,class:"field-group","data-testid":`field-group-${e.name.toLowerCase().replace(/\s+/g,"-")}`},[b("h5",null,k(e.name),1),b("div",ee,[(S(!0),y(_,null,h(e.fields,e=>(S(),y("label",{key:e.id,class:"field-option","data-testid":`label-field-${e.id}`,"aria-label":`Include ${e.name} in export`},[R(b("input",{type:"checkbox",value:e.id,"onUpdate:modelValue":a[2]||(a[2]=e=>o.value=e),class:"field-checkbox","data-testid":`checkbox-field-${e.id}`,"aria-label":`Select ${e.name} field for export`},null,8,te),[[E,o.value]]),b("span",le,[b("span",se,k(e.name),1),b("span",ne,k(e.description),1)])],8,ae))),128))])],8,X)),64))])]),b("div",ie,[a[8]||(a[8]=b("h4",null,"Export Preview",-1)),b("div",re,[b("span",oe,k(e.apiCalls.length)+" records",1),b("span",ue,k(o.value.length)+" fields",1),b("span",ce,"~"+k(c.value),1)])])]),b("div",de,[p(t,{onClick:a[3]||(a[3]=a=>e.$emit("close")),size:"large",class:"footer-button","data-testid":"btn-cancel-export","aria-label":"Cancel export"},{default:w(()=>a[9]||(a[9]=[x(" Cancel ")])),_:1,__:[9]}),p(t,{type:"primary",onClick:I,disabled:0===o.value.length,size:"large",class:"footer-button footer-button-primary","data-testid":"btn-confirm-export","data-format":r.value,"aria-label":`Export data as ${r.value.toUpperCase()}`},{default:w(()=>[x(" Export "+k(r.value.toUpperCase()),1)]),_:1},8,["disabled","data-format","aria-label"])])])])}}}),[["__scopeId","data-v-92920379"]]),ve={class:"repeat-group"},fe={class:"group-header"},me={class:"prompt-preview"},ye={class:"prompt-text"},ge={key:0,class:"group-stats"},be={key:0,class:"stats-range"},_e={class:"response-header"},he={class:"response-index"},xe={key:2,class:"latency"},ke={class:"response-content"},Ce={key:0,class:"result-content"},we={class:"extracted-value"},Se={key:1,class:"raw-response"},Re={class:"response-text"},$e={key:2,class:"error-content"},Ee=s(v({__name:"RepeatGroupResults",props:{calls:{},initialExpanded:{type:Boolean}},setup(e){const a=e,t=f(a.initialExpanded?[a.calls[0]?.id]:[]),l=m(()=>n(a.calls));function s(e,a=150){return e.length<=a?e:e.substring(0,a)+"..."}return(e,a)=>{const n=C("a-tag"),i=C("a-space"),r=C("a-statistic"),o=C("a-col"),u=C("a-row"),c=C("a-alert"),d=C("a-collapse-panel"),v=C("a-collapse");return S(),y("div",ve,[b("div",fe,[b("div",me,[a[1]||(a[1]=b("strong",null,"Prompt:",-1)),b("span",ye,k(s(e.calls[0].prompt)),1)]),p(i,null,{default:w(()=>[p(n,{color:"blue"},{default:w(()=>[x(k(e.calls.length)+" responses",1)]),_:1}),100===l.value.consistencyScore?(S(),O(n,{key:0,color:"green"},{default:w(()=>a[2]||(a[2]=[x("Consistent")])),_:1,__:[2]})):l.value.consistencyScore>=80?(S(),O(n,{key:1,color:"orange"},{default:w(()=>a[3]||(a[3]=[x("Mostly Consistent")])),_:1,__:[3]})):(S(),O(n,{key:2,color:"red"},{default:w(()=>a[4]||(a[4]=[x("Varied")])),_:1,__:[4]}))]),_:1})]),e.calls.length>1?(S(),y("div",ge,[p(u,{gutter:16},{default:w(()=>[p(o,{span:6},{default:w(()=>[p(r,{title:"Consistency",value:l.value.consistencyScore,suffix:"%",precision:1},null,8,["value"])]),_:1}),p(o,{span:6},{default:w(()=>[p(r,{title:"Avg Response Length",value:l.value.avgResponseLength},null,8,["value"])]),_:1}),p(o,{span:6},{default:w(()=>[p(r,{title:"Avg Response Time",value:l.value.avgResponseTime,suffix:"ms"},null,8,["value"])]),_:1}),p(o,{span:6},{default:w(()=>[p(r,{title:"Success Rate",value:l.value.successRate,suffix:"%"},null,8,["value"])]),_:1})]),_:1}),l.value.minResponseTime!==l.value.maxResponseTime?(S(),y("div",be,[b("span",null,"Response time range: "+k(l.value.minResponseTime)+"ms - "+k(l.value.maxResponseTime)+"ms",1)])):j("",!0)])):j("",!0),p(v,{activeKey:t.value,"onUpdate:activeKey":a[0]||(a[0]=e=>t.value=e),style:{"margin-top":"16px"}},{default:w(()=>[(S(!0),y(_,null,h(e.calls,(e,t)=>(S(),O(d,{key:e.id},{header:w(()=>[b("div",_e,[b("span",he,"Response "+k(t+1),1),p(i,{size:"small"},{default:w(()=>[e.result?.success?(S(),O(n,{key:0,color:"success",size:"small"},{default:w(()=>a[5]||(a[5]=[x("Success")])),_:1,__:[5]})):(S(),O(n,{key:1,color:"error",size:"small"},{default:w(()=>a[6]||(a[6]=[x("Failed")])),_:1,__:[6]})),e.response?.latencyMs?(S(),y("span",xe,k(e.response.latencyMs)+"ms",1)):j("",!0)]),_:2},1024)])]),default:w(()=>[b("div",ke,[e.result?.content?(S(),y("div",Ce,[a[7]||(a[7]=b("h4",null,"Extracted Result:",-1)),b("div",we,k(e.result.content),1)])):j("",!0),e.response?.body?.choices?.[0]?.message?.content?(S(),y("div",Se,[a[8]||(a[8]=b("h4",null,"Full Response:",-1)),b("pre",Re,k(e.response.body.choices[0].message.content),1)])):e.result?.error?(S(),y("div",$e,[p(c,{type:"error","show-icon":""},{message:w(()=>[x(k(e.result.error),1)]),_:2},1024)])):j("",!0)])]),_:2},1024))),128))]),_:1},8,["activeKey"])])}}}),[["__scopeId","data-v-dbf18579"]]),je={class:"results-table-container"},Oe={class:"filters-bar"},Ie={key:0,class:"grouped-results"},Te={key:0,class:"loading-container"},qe={key:1},Le={key:1},Me={key:2,class:"variables-compact"},Pe={key:0,class:"text-secondary"},Ne={key:1,class:"text-secondary"},Ue={key:2,class:"text-error"},Ae={key:3,class:"response-content"},Fe={key:4,class:"text-secondary"},ze={key:0,class:"length-value"},Be={key:1,class:"text-secondary"},De={key:0},He={key:1,class:"text-secondary"},Ve=s(v({__name:"TrialResultsTable",props:{trial:{},apiCalls:{},loading:{type:Boolean}},setup(e){const a=e,t=f(""),l=f(""),s=f(""),n=f(!1),u=f(null),c=[{title:"Status",key:"status",width:100,fixed:"left"},{title:"Config",key:"config",width:150},{title:"Variables",key:"variables",width:400},{title:"Response",key:"response",ellipsis:!0},{title:"Length",key:"length",width:80,align:"right"},{title:"Latency",key:"latency",width:80,align:"right"}],d=m(()=>i(v.value)),v=m(()=>{let e=a.apiCalls;if(t.value&&(e=e.filter(e=>e.status===t.value)),""!==l.value&&(e=e.filter(e=>e.configurationIndex===Number(l.value))),s.value){const a=s.value.toLowerCase();e=e.filter(e=>{if(JSON.stringify(e.variables).toLowerCase().includes(a))return!0;if(e.result?.content){if(String(e.result.content).toLowerCase().includes(a))return!0}return!1})}return e});function g(e){const t=a.trial.configurationSnapshots[e];return t?.name||`Config ${e+1}`}return(e,a)=>{const i=C("a-select-option"),f=C("a-select"),m=C("a-input-search"),R=C("a-space"),$=C("a-button"),E=C("a-spin"),T=C("a-tag"),q=C("a-tooltip"),L=C("a-table");return S(),y("div",je,[b("div",Oe,[p(R,null,{default:w(()=>[p(f,{value:t.value,"onUpdate:value":a[0]||(a[0]=e=>t.value=e),placeholder:"All Statuses",style:{width:"150px"},size:"small","allow-clear":"","data-testid":"select-status-filter","aria-label":"Filter results by status"},{default:w(()=>[p(i,{value:""},{default:w(()=>a[6]||(a[6]=[x("All Statuses")])),_:1,__:[6]}),p(i,{value:"completed"},{default:w(()=>a[7]||(a[7]=[x("Completed")])),_:1,__:[7]}),p(i,{value:"failed"},{default:w(()=>a[8]||(a[8]=[x("Failed")])),_:1,__:[8]}),p(i,{value:"running"},{default:w(()=>a[9]||(a[9]=[x("Running")])),_:1,__:[9]}),p(i,{value:"pending"},{default:w(()=>a[10]||(a[10]=[x("Pending")])),_:1,__:[10]})]),_:1},8,["value"]),p(f,{value:l.value,"onUpdate:value":a[1]||(a[1]=e=>l.value=e),placeholder:"All Configurations",style:{width:"200px"},size:"small","allow-clear":"","data-testid":"select-config-filter","aria-label":"Filter results by configuration"},{default:w(()=>[p(i,{value:""},{default:w(()=>a[11]||(a[11]=[x("All Configurations")])),_:1,__:[11]}),(S(!0),y(_,null,h(e.trial.configurationSnapshots,(e,a)=>(S(),O(i,{key:a,value:a},{default:w(()=>[x(k(e.name||`Config ${a+1}`),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),p(m,{value:s.value,"onUpdate:value":a[2]||(a[2]=e=>s.value=e),placeholder:"Search variables or response...",style:{width:"300px"},size:"small","allow-clear":"","data-testid":"input-search-results","aria-label":"Search in variables or response content"},null,8,["value"])]),_:1}),p($,{size:"small",onClick:a[3]||(a[3]=e=>n.value=!0),"data-testid":"btn-export-results-data","aria-label":"Export trial results data"},{icon:w(()=>[p(I(z))]),default:w(()=>[a[12]||(a[12]=x(" Export Data "))]),_:1,__:[12]})]),I(r)(e.trial)?(S(),y("div",Ie,[e.loading?(S(),y("div",Te,[p(E,{size:"large"})])):(S(),y("div",qe,[(S(!0),y(_,null,h(d.value,([e,a])=>(S(),O(Ee,{key:e,calls:a,"initial-expanded":1===d.value.size},null,8,["calls","initial-expanded"]))),128))]))])):(S(),O(L,{key:1,columns:c,"data-source":v.value,loading:e.loading,pagination:!1,scroll:{y:"calc(100vh - 350px)",x:1400},size:"small","row-key":"id",class:"results-table","custom-row":e=>({onClick:()=>{return a=e,void(u.value=a);var a},class:"clickable-row"})},{bodyCell:w(({column:e,record:t})=>{return["status"===e.key?(S(),O(T,{key:0,color:(l=t.status,{completed:"success",failed:"error",running:"processing",pending:"default"}[l]||"default"),size:"small"},{default:w(()=>[x(k(t.status.toUpperCase()),1)]),_:2},1032,["color"])):j("",!0),"config"===e.key?(S(),y("code",Le,k(g(t.configurationIndex)),1)):j("",!0),"variables"===e.key?(S(),y("div",Me,[(S(!0),y(_,null,h(t.variables,(e,a)=>(S(),O(q,{key:a},{title:w(()=>[x(k(a)+": "+k(e),1)]),default:w(()=>[p(T,{size:"small"},{default:w(()=>{return[x(k(a)+": "+k((t=String(e),l=15,t.length<=l?t:t.substring(0,l)+"...")),1)];var t,l}),_:2},1024)]),_:2},1024))),128))])):j("",!0),"response"===e.key?(S(),y(_,{key:3},["pending"===t.status?(S(),y("div",Pe," Waiting... ")):"running"===t.status?(S(),y("div",Ne,[p(I(o)),a[13]||(a[13]=x(" Processing... "))])):"failed"===t.status?(S(),y("div",Ue,k(t.result?.error||"API call failed"),1)):t.result?.content?(S(),y("div",Ae,[b("span",null,k(String(t.result.content)),1)])):(S(),y("div",Fe," No content "))],64)):j("",!0),"length"===e.key?(S(),y(_,{key:4},[t.result?.content?(S(),y("span",ze,k(String(t.result.content).length),1)):(S(),y("span",Be,"-"))],64)):j("",!0),"latency"===e.key?(S(),y(_,{key:5},[t.response?.latencyMs?(S(),y("span",De,k(t.response.latencyMs)+"ms ",1)):(S(),y("span",He,"-"))],64)):j("",!0)];var l}),_:1},8,["data-source","loading","custom-row"])),n.value?(S(),O(pe,{key:2,trial:e.trial,"api-calls":v.value,onClose:a[4]||(a[4]=e=>n.value=!1)},null,8,["trial","api-calls"])):j("",!0),u.value?(S(),O(M,{key:3,"api-call":u.value,trial:e.trial,onClose:a[5]||(a[5]=e=>u.value=null)},null,8,["api-call","trial"])):j("",!0)])}}}),[["__scopeId","data-v-ff91d6e1"]]),Je={class:"trial-analysis"},We={class:"stats-summary"},Ke={class:"pivot-container"},Ge={key:1,class:"empty-state"},Ye=s(v({__name:"TrialAnalysisView",props:{trial:{},apiCalls:{},loading:{type:Boolean,default:!1},embedded:{type:Boolean,default:!1}},emits:["back-to-selection","export-trial"],setup(e){const t=e,l=f("table"),s=f([]),n=f(!1),i=m(()=>t.apiCalls||s.value),r=m(()=>t.loading||n.value),o=f({rowField:"",columnField:"model",valueField:"success",aggregation:"mean"});async function v(){if(t.embedded&&!t.apiCalls){n.value=!0;try{s.value=await c.apiCalls.where("trialId").equals(t.trial.id).toArray()}catch(e){a.error("Failed to load API calls",e)}finally{n.value=!1}}}T(()=>{v()}),q(()=>t.trial.id,()=>{v()});const g=m(()=>i.value.filter(e=>"completed"===e.status).length),h=m(()=>i.value.filter(e=>"failed"===e.status).length),x=m(()=>{const e=g.value+h.value;return 0===e?0:Math.round(g.value/e*100)}),k=m(()=>{const e=i.value.filter(e=>e.response?.latencyMs);if(0===e.length)return 0;const a=e.reduce((e,a)=>e+(a.response?.latencyMs||0),0);return Math.round(a/e.length)}),R=m(()=>t.trial.progress.completed*(t.trial.estimatedCost/t.trial.progress.total)),$=f(N()),E=m(()=>{if(!$.value)return 0;let e=0;return i.value.forEach(a=>{if("completed"===a.status&&a.response?.body)try{const l=t.trial.configurationSnapshots[a.configurationIndex];if(l&&a.response?.body?.usage?.total_tokens){const t=u.calculateEnvironmentalCostUnsafe(l.provider,l.modelId,a.response.body.usage.total_tokens);e+=t.carbon}}catch(l){}}),e}),I=m(()=>{if(!$.value)return 0;let e=0;return i.value.forEach(a=>{if("completed"===a.status&&a.response?.body)try{const l=t.trial.configurationSnapshots[a.configurationIndex];if(l&&a.response?.body?.usage?.total_tokens){const t=u.calculateEnvironmentalCostUnsafe(l.provider,l.modelId,a.response.body.usage.total_tokens);e+=t.water}}catch(l){}}),e}),M=m(()=>{if(!$.value)return 0;let e=0;return i.value.forEach(a=>{if("completed"===a.status&&a.response?.body)try{const l=t.trial.configurationSnapshots[a.configurationIndex];if(l&&a.response?.body?.usage?.total_tokens){const t=u.calculateEnvironmentalCostUnsafe(l.provider,l.modelId,a.response.body.usage.total_tokens);e+=t.energy}}catch(l){}}),e}),U=e=>{o.value=e},A=e=>{if(!e.cell)return;const a=e.cell.apiCalls||[];0!==a.length&&d.info({title:`${e.row} × ${e.column}`,width:"80%",class:"pivot-cell-details-modal",content:()=>L("div",{class:"pivot-cell-details"},[L("div",{class:"cell-summary"},[L("span",{class:"count"},`${a.length} calls`),L("span",{class:"separator"},"•"),L("span",{class:"aggregate"},`${"average"===o.value.aggregation?"Avg":"Total"}: ${e.cell.value.toFixed(2)}`)]),L("div",{class:"calls-list"},a.map((e,a)=>L("div",{key:e.id,class:"call-row"},[L("span",{class:"call-index"},`${a+1}.`),L("span",{class:"model"},e.model),L("span",{class:`status ${e.status}`},e.status),e.variables&&Object.entries(e.variables).length>0&&L("span",{class:"variables"},Object.entries(e.variables).map(([e,a])=>`${e}: ${a}`).join(", ")),e.extracted&&L("span",{class:"extracted"},`→ ${e.extracted}`),L("span",{class:"metrics"},[e.cost&&`$${e.cost.toFixed(3)}`,e.cost&&e.duration&&" • ",e.duration&&`${e.duration}ms`].filter(Boolean).join(""))])))])})};return(e,a)=>{const t=C("a-statistic"),s=C("a-divider"),n=C("a-tab-pane"),u=C("a-tabs");return S(),y("div",Je,[b("div",We,[p(t,{title:"Success Rate",value:x.value,suffix:"%","value-style":{color:x.value>=90?"#52c41a":x.value>=70?"#faad14":"#ff4d4f"}},null,8,["value","value-style"]),p(s,{type:"vertical"}),p(t,{title:"Completed",value:g.value,suffix:`/ ${e.trial.progress.total}`},null,8,["value","suffix"]),p(s,{type:"vertical"}),p(t,{title:"Failed",value:h.value,"value-style":{color:h.value>0?"#ff4d4f":"#52c41a"}},null,8,["value","value-style"]),p(s,{type:"vertical"}),p(t,{title:"Avg Latency",value:k.value,suffix:"ms"},null,8,["value"]),p(s,{type:"vertical"}),p(t,{title:"Total Cost",value:R.value,prefix:"$",precision:4},null,8,["value"]),$.value?(S(),y(_,{key:0},[p(s,{type:"vertical"}),p(t,{title:"Carbon",value:E.value,suffix:"g CO₂e",precision:3,"value-style":{color:"#52c41a"}},null,8,["value"]),p(s,{type:"vertical"}),p(t,{title:"Water",value:I.value,suffix:"mL",precision:1,"value-style":{color:"#1890ff"}},null,8,["value"]),p(s,{type:"vertical"}),p(t,{title:"Energy",value:M.value,suffix:"Wh",precision:3,"value-style":{color:"#faad14"}},null,8,["value"])],64)):j("",!0)]),p(u,{activeKey:l.value,"onUpdate:activeKey":a[0]||(a[0]=e=>l.value=e),type:"card",class:"analysis-tabs"},{default:w(()=>[p(n,{key:"table",tab:"Results Table"},{default:w(()=>[p(Ve,{trial:e.trial,"api-calls":i.value,loading:r.value},null,8,["trial","api-calls","loading"])]),_:1}),p(n,{key:"pivot",tab:"Pivot Analysis"},{default:w(()=>[b("div",Ke,[i.value.length>0?(S(),O(P,{key:0,"api-calls":i.value,trial:e.trial,config:o.value,"show-totals":!0,onConfigChange:U,onCellClick:A},null,8,["api-calls","trial","config"])):(S(),y("div",Ge,a[1]||(a[1]=[b("p",null,"No data available for pivot table analysis.",-1)])))])]),_:1})]),_:1},8,["activeKey"])])}}}),[["__scopeId","data-v-3bffccea"]]);export{pe as E,Ye as T};
