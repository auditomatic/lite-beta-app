import{d as a,c as e,f as t,o as l,ab as s,a1 as n,F as i,ac as o,a3 as r,_ as d,a0 as c,q as u,ad as p}from"./vendor-CdfxntmD.js";import{p as b,l as m,d as v,_ as f}from"./index-qi1cGAr3.js";import{u as g}from"./useLiveData-gB4mnUxo.js";import{s as w}from"./storage-calculation.service-C5axB9J1.js";import{e as h,b as y,d as k,p as C,a as x}from"./import-helpers-R1GGtEJc.js";import"./db-CL8uhZCz.js";const P={class:"debug-view","data-testid":"page-debug"},D={class:"section"},I={class:"endpoint-grid"},S=["value","onInput","placeholder","disabled","data-testid","aria-label"],L={class:"section"},$={class:"info-grid"},_={class:"info-item"},A={class:"info-item"},U={class:"info-item"},j={class:"info-item"},R={class:"section"},E={class:"table-header"},O={class:"table-actions"},V=["onClick","data-testid","aria-label"],T=["onClick","data-testid","aria-label"],J=["onClick","disabled","data-testid","aria-label"],N={key:0,class:"table-content"},F={class:"table-controls"},M=["onUpdate:modelValue","data-testid","aria-label"],B=["onClick","data-testid","aria-label"],q={class:"table-data"},z=["onClick","data-testid","aria-label","aria-expanded"],Z=f(a({__name:"DebugView",setup(a){const{data:f}=g(async()=>{const a=await v.settings.get("main");return a?[a]:[]},{debounce:100}),Z=e(()=>f.value?.[0]),G=t(new Set),H=t({}),K=t({}),Q=t(""),W=t(),X=t(null),Y=t([]),aa=e(()=>({dbVersion:"1.0.0",totalRecords:Object.values(K.value).reduce((a,e)=>a+e.length,0),storageUsed:X.value?X.value.formattedUsed:"Calculating...",lastUpdated:(new Date).toLocaleString()})),ea=e(()=>[{name:"templatePrompts",count:K.value.templatePrompts?.length||0},{name:"spreadsheetPrompts",count:K.value.spreadsheetPrompts?.length||0},{name:"variableLists",count:K.value.variableLists?.length||0},{name:"trials",count:K.value.trials?.length||0},{name:"models",count:K.value.models?.length||0},{name:"apiCalls",count:K.value.apiCalls?.length||0},{name:"settings",count:K.value.settings?.length||0}]);async function ta(){try{K.value={templatePrompts:await v.templatePrompts.toArray(),spreadsheetPrompts:await v.spreadsheetPrompts.toArray(),variableLists:await v.variableLists.toArray(),trials:await v.trials.toArray(),models:await v.models.toArray(),apiCalls:await v.apiCalls.toArray(),settings:await v.settings.toArray()}}catch(a){m.error("Failed to load table data",a)}}function la(a){const e=K.value[a]||[],t=H.value[a]?.toLowerCase()||"";if(!t)return JSON.stringify(e.slice(0,10),null,2);const l=e.filter(a=>JSON.stringify(a).toLowerCase().includes(t));return JSON.stringify(l.slice(0,10),null,2)}async function sa(){ha({version:"1.0.0",exported:(new Date).toISOString(),data:K.value},`auditomatic_full_export_${Date.now()}.json`)}async function na(){const a=K.value.templatePrompts||[],e=K.value.spreadsheetPrompts||[],t=K.value.variableLists||[];ha({version:"2.0.0",exported:(new Date).toISOString(),templatePrompts:a,spreadsheetPrompts:e,variableLists:t},`prompts_variables_export_${Date.now()}.json`)}async function ia(){const a=K.value.trials||[],e=K.value.apiCalls||[];ha({version:"1.0.0",exported:(new Date).toISOString(),trials:a,apiCalls:e},`trials_export_${Date.now()}.json`)}async function oa(){ha(K.value.models||[],`models_export_${Date.now()}.json`)}async function ra(){ha((K.value.models||[]).map(a=>({id:a.id,provider:a.provider,modelId:a.modelId,enabled:a.enabled})),`model_states_export_${Date.now()}.json`)}function da(){Q.value="fullDatabase",W.value?.click()}function ca(){Q.value="designsAndVariables",W.value?.click()}function ua(){Q.value="trials",W.value?.click()}function pa(){Q.value="models",W.value?.click()}function ba(){Q.value="modelStates",W.value?.click()}async function ma(a){const e=a.target.files?.[0];if(e){try{const a=await e.text(),t=JSON.parse(a);switch(Q.value){case"fullDatabase":await async function(a){const e=h(a);if(e.data)for(const[t,l]of Object.entries(e.data))await va(t,l)}(t);break;case"designsAndVariables":await async function(a){a.templatePrompts&&await v.templatePrompts.bulkPut(a.templatePrompts);a.spreadsheetPrompts&&await v.spreadsheetPrompts.bulkPut(a.spreadsheetPrompts);a.designs&&m.warn("Importing legacy designs format - consider migrating to V2 format");if(a.variableLists){const e=y(a.variableLists);await v.variableLists.bulkPut(e)}}(t);break;case"trials":await async function(a){if(a.trials){const e=k(a.trials);await v.trials.bulkPut(e)}if(a.apiCalls){const e=C(a.apiCalls);await v.apiCalls.bulkPut(e)}}(t);break;case"models":await async function(a){const e=x(a);await v.models.bulkPut(e)}(t);break;case"modelStates":await async function(a){for(const e of a)await v.models.update(e.id,{enabled:e.enabled})}(t);break;default:K.value[Q.value]&&await va(Q.value,t)}await ta(),alert("Import completed successfully!")}catch(t){m.error("Import failed",t),alert("Import failed: "+(t instanceof Error?t.message:"Unknown error"))}W.value&&(W.value.value="")}}async function va(a,e){const t=v[a];if(t){let l=e;switch(a){case"trials":l=k(e);break;case"templatePrompts":case"spreadsheetPrompts":l=e;break;case"variableLists":l=y(e);break;case"models":l=x(e);break;case"apiCalls":l=C(e)}await t.bulkPut(l)}}async function fa(){confirm("Are you sure you want to clear ALL data? This cannot be undone.")&&(await v.delete(),await v.open(),await ta())}async function ga(){confirm("Reset all settings to defaults? This will clear all data.")&&await fa()}async function wa(){confirm("Regenerate database? This will clear all data and rebuild.")&&(await v.delete(),await v.open(),await ta())}function ha(a,e){const t=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),l=URL.createObjectURL(t),s=document.createElement("a");s.href=l,s.download=e,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(l)}function ya(a){const e=Y.value.find(e=>e.id===a);return e?.api.baseUrl||""}function ka(a){return!!Z.value&&(Z.value.providers?.[a]?.enabled??!1)}return l(async()=>{await ta(),await b.waitForReady(),Y.value=[...b.getAllProviders()];try{X.value=await w.getStorageInfo()}catch(a){m.warn("Failed to get storage info",{error:a})}}),(a,e)=>(d(),s("div",P,[n("div",D,[e[0]||(e[0]=n("h2",null,"Provider Endpoints",-1)),e[1]||(e[1]=n("p",{class:"section-desc"},"Configure base URLs for API providers",-1)),n("div",I,[(d(!0),s(i,null,o(Y.value,a=>{return d(),s("div",{key:a.id,class:"endpoint-item"},[n("label",null,r(a.name),1),n("input",{value:(e=a.id,Z.value&&Z.value.customBaseUrls?.[e]||""),onInput:e=>async function(a,e){const t=e.target.value;if(!Z.value)return;const l={...Z.value.customBaseUrls};t?l[a]=t:delete l[a],await v.settings.update("main",{customBaseUrls:l})}(a.id,e),placeholder:ya(a.id),disabled:!ka(a.id),class:"endpoint-input","data-testid":`input-endpoint-${a.id}`,"aria-label":`${a.name} endpoint URL`},null,40,S)]);var e}),128))])]),n("div",L,[e[6]||(e[6]=n("h2",null,"System Information",-1)),n("div",$,[n("div",_,[e[2]||(e[2]=n("label",null,"Database Version:",-1)),n("span",null,r(aa.value.dbVersion),1)]),n("div",A,[e[3]||(e[3]=n("label",null,"Records Count:",-1)),n("span",null,r(aa.value.totalRecords),1)]),n("div",U,[e[4]||(e[4]=n("label",null,"Storage Used:",-1)),n("span",null,r(aa.value.storageUsed),1)]),n("div",j,[e[5]||(e[5]=n("label",null,"Last Updated:",-1)),n("span",null,r(aa.value.lastUpdated),1)])])]),n("div",R,[e[7]||(e[7]=n("h2",null,"Database Tables",-1)),(d(!0),s(i,null,o(ea.value,a=>(d(),s("div",{key:a.name,class:"table-section"},[n("div",E,[n("h3",null,r(a.name)+" ("+r(a.count)+" records)",1),n("div",O,[n("button",{onClick:e=>async function(a){ha(K.value[a]||[],`${a}_export.json`)}(a.name),class:"export-btn","data-testid":`btn-export-table-${a.name}`,"aria-label":`Export ${a.name} table`},"Export",8,V),n("button",{onClick:e=>{return t=a.name,Q.value=t,void W.value?.click();var t},class:"import-btn","data-testid":`btn-import-table-${a.name}`,"aria-label":`Import ${a.name} table`},"Import",8,T),n("button",{onClick:e=>async function(a){if(!confirm(`Are you sure you want to clear all ${a} data? This cannot be undone.`))return;const e=v[a];e&&(await e.clear(),await ta())}(a.name),class:"clear-btn",disabled:0===a.count,"data-testid":`btn-clear-table-${a.name}`,"aria-label":`Clear all ${a.name} data`}," Clear All ",8,J)])]),G.value.has(a.name)?(d(),s("div",N,[n("div",F,[u(n("input",{"onUpdate:modelValue":e=>H.value[a.name]=e,placeholder:"Search records...",class:"search-input","data-testid":`input-search-${a.name}`,"aria-label":`Search ${a.name} records`},null,8,M),[[p,H.value[a.name]]]),n("button",{onClick:e=>async function(){await ta()}(a.name),class:"refresh-btn","data-testid":`btn-refresh-${a.name}`,"aria-label":`Refresh ${a.name} table`},"Refresh",8,B)]),n("div",q,[n("pre",null,r(la(a.name)),1)])])):c("",!0),n("button",{onClick:e=>{return t=a.name,void(G.value.has(t)?G.value.delete(t):G.value.add(t));var t},class:"toggle-btn","data-testid":`btn-toggle-${a.name}`,"aria-label":`${G.value.has(a.name)?"Collapse":"Expand"} ${a.name} table`,"aria-expanded":G.value.has(a.name)},r(G.value.has(a.name)?"Collapse":"Expand"),9,z)]))),128))]),n("div",{class:"section"},[e[14]||(e[14]=n("h2",null,"Import/Export Tools",-1)),n("div",{class:"export-group"},[e[8]||(e[8]=n("h3",null,"Complete Database",-1)),n("div",{class:"export-actions"},[n("button",{onClick:sa,class:"export-all-btn","data-testid":"btn-export-full-database","aria-label":"Export complete database"},"Export All Data"),n("button",{onClick:da,class:"import-all-btn","data-testid":"btn-import-full-database","aria-label":"Import complete database"},"Import All Data")])]),n("div",{class:"export-group"},[e[9]||(e[9]=n("h3",null,"Designs & Variables",-1)),e[10]||(e[10]=n("p",{class:"export-desc"},"Exports designs with their linked variable lists",-1)),n("div",{class:"export-actions"},[n("button",{onClick:na,class:"export-btn","data-testid":"btn-export-designs-variables","aria-label":"Export designs and variables"},"Export Designs+Variables"),n("button",{onClick:ca,class:"import-btn","data-testid":"btn-import-designs-variables","aria-label":"Import designs and variables"},"Import Designs+Variables")])]),n("div",{class:"export-group"},[e[11]||(e[11]=n("h3",null,"Trials",-1)),e[12]||(e[12]=n("p",{class:"export-desc"},"Exports trials with configuration snapshots and results",-1)),n("div",{class:"export-actions"},[n("button",{onClick:ia,class:"export-btn"},"Export Trials"),n("button",{onClick:ua,class:"import-btn"},"Import Trials")])]),n("div",{class:"export-group"},[e[13]||(e[13]=n("h3",null,"Models",-1)),n("div",{class:"export-actions"},[n("button",{onClick:oa,class:"export-btn"},"Export All Models"),n("button",{onClick:pa,class:"import-btn"},"Import All Models")]),n("div",{class:"export-actions"},[n("button",{onClick:ra,class:"export-state-btn"},"Export Model States Only"),n("button",{onClick:ba,class:"import-state-btn"},"Import Model States Only")])])]),n("div",{class:"section danger-zone"},[e[15]||(e[15]=n("h2",null,"Danger Zone",-1)),n("div",{class:"danger-actions"},[n("button",{onClick:fa,class:"danger-btn","data-testid":"btn-clear-all-data","aria-label":"Clear all application data"},"Clear All Data"),n("button",{onClick:ga,class:"danger-btn","data-testid":"btn-reset-defaults","aria-label":"Reset application to default settings"},"Reset to Defaults"),n("button",{onClick:wa,class:"danger-btn","data-testid":"btn-regenerate-database","aria-label":"Regenerate database structure"},"Regenerate Database")])]),n("input",{ref_key:"fileInput",ref:W,type:"file",accept:".json",onChange:ma,style:{display:"none"},"data-testid":"input-file-import","aria-label":"Select JSON file to import"},null,544)]))}}),[["__scopeId","data-v-feff7ad7"]]);export{Z as default};
