const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./APICallDetailModal-CuqMsvbj.js","./vendor-BiapkIQZ.js","./designs-db-BnxPWGVY.js","./db-CL8uhZCz.js","./index-JPKDQHeA.js","./index-D-paDmtB.css","./defaultData-DyqJdH2z.js","./variables-db-CPg65Q8f.js","./logger.service-_k__GSpu.js","./registry-CD_hKmbW.js","./models-db-wgnka_cR.js","./trials-db-OIuqYcu5.js","./settings-db-B3gFDSc-.js","./ModelSelectionTable-BiNHnxLg.js","./cost-formatting-D-OPWEvg.js","./ModelSelectionTable-B2A5b4Ts.css","./BaseModal.vue_vue_type_style_index_0_lang-cdfHDDQp.js","./BaseModal-BUMqEu7M.css","./APICallDetailModal-90K-mWHJ.css"])))=>i.map(i=>d[i]);
import{d as e,_ as a,D as t,a as l}from"./index-JPKDQHeA.js";import{d as s,f as i,c as o,w as r,o as n,b as c,Z as d,W as u,Y as p,_ as v,S as m,a5 as g,a8 as y,G as f,q as k,ae as b,a4 as h,aa as _,F as C,a6 as w,a9 as x,k as T,U as S,X as P,u as E,B as j,V as D,$ as I}from"./vendor-BiapkIQZ.js";import{u as z}from"./trials-db-OIuqYcu5.js";import{u as L}from"./settings-db-B3gFDSc-.js";import{A as F,T as A,_ as M,a as $}from"./APICallDetailModal-CuqMsvbj.js";import{l as U}from"./db-CL8uhZCz.js";import{u as N}from"./BaseModal.vue_vue_type_style_index_0_lang-cdfHDDQp.js";import"./defaultData-DyqJdH2z.js";import"./registry-CD_hKmbW.js";import"./designs-db-BnxPWGVY.js";import"./variables-db-CPg65Q8f.js";import"./logger.service-_k__GSpu.js";import"./models-db-wgnka_cR.js";import"./ModelSelectionTable-BiNHnxLg.js";import"./cost-formatting-D-OPWEvg.js";const V={class:"execution-monitor"},O={class:"monitor-header"},R={class:"header-left"},q={key:0,class:"progress-summary"},K={class:"progress-bar"},B={class:"progress-text"},Y={key:0,class:"network-errors"},G={key:0,class:"header-stats"},W={class:"stat"},X={class:"stat pending"},Z={class:"stat running"},H={class:"stat completed"},J={class:"stat failed"},Q={key:0,class:"monitor-filters"},ee={class:"monitor-content"},ae={key:0,class:"empty-state"},te={key:1,class:"empty-state"},le={class:"placeholder-content"},se={key:2,class:"results-table"},ie={class:"table-body"},oe=["onClick"],re={class:"col-status"},ne={class:"col-config"},ce={class:"config-name"},de={class:"col-variables"},ue={class:"variables-list"},pe={class:"var-key"},ve={class:"var-value"},me={key:0,class:"separator"},ge={class:"col-response"},ye={key:0,class:"response-placeholder"},fe={key:1,class:"response-placeholder"},ke={key:2,class:"response-error"},be={key:3,class:"response-content"},he={key:4,class:"response-placeholder"},_e={class:"col-time"},Ce={key:0,class:"time-info"},we={class:"duration"},xe={key:0,class:"latency"},Te={key:1,class:"time-placeholder"},Se={key:0,class:"load-more"},Pe=a(s({__name:"ExecutionMonitor",props:{trialId:{}},setup(a){const t=a,l=i(null),s=i([]),T=i("all"),S=i(""),P=i(null),E=i(100);let j=null,D=null;const I=o(()=>{const e={total:0,pending:0,running:0,completed:0,failed:0};return s.value.forEach(a=>{e.total++,e[a.status]++}),e}),z=o(()=>l.value&&0!==l.value.progress.total?l.value.progress.completed/l.value.progress.total*100:0),L=o(()=>{let e=s.value;if("all"!==T.value&&(e=e.filter(e=>e.status===T.value)),S.value.trim()){const a=S.value.toLowerCase();e=e.filter(e=>Object.values(e.variables).some(e=>e.toLowerCase().includes(a))||e.result?.content&&String(e.result.content).toLowerCase().includes(a)||e.result?.error&&e.result.error.toLowerCase().includes(a))}return e.sort((e,a)=>a.created.getTime()-e.created.getTime())}),A=o(()=>L.value.slice(0,E.value));function M(e,a){return e.length<=a?e:e.slice(0,a)+"..."}function $(){E.value+=50}function N(){j&&j.unsubscribe(),D&&D.unsubscribe(),j=U(()=>e.trials.get(t.trialId)).subscribe({next:e=>{l.value=e||null},error:e=>{console.error("Trial subscription error:",e)}}),D=U(()=>e.apiCalls.where("trialId").equals(t.trialId).toArray()).subscribe({next:e=>{s.value=e},error:e=>{console.error("API calls subscription error:",e)}})}return r(()=>t.trialId,e=>{e&&N()},{immediate:!0}),n(()=>{N()}),c(()=>{j&&j.unsubscribe(),D&&D.unsubscribe()}),(e,a)=>(u(),d("div",V,[p("div",O,[p("div",R,[p("h3",null,g(l.value?.name||"Select a trial to monitor"),1),l.value?(u(),d("div",q,[p("div",K,[p("div",{class:"progress-fill",style:y({width:z.value+"%"})},null,4)]),p("span",B,[f(g(l.value.progress.completed)+" / "+g(l.value.progress.total)+" completed ",1),l.value.progress.networkErrors>0?(u(),d("span",Y,"("+g(l.value.progress.networkErrors)+" network errors)",1)):v("",!0)])])):v("",!0)]),l.value?(u(),d("div",G,[p("span",W,g(I.value.total)+" total",1),p("span",X,g(I.value.pending)+" pending",1),p("span",Z,g(I.value.running)+" running",1),p("span",H,g(I.value.completed)+" completed",1),p("span",J,g(I.value.failed)+" failed",1)])):v("",!0)]),l.value?(u(),d("div",Q,[k(p("select",{"onUpdate:modelValue":a[0]||(a[0]=e=>T.value=e),class:"filter-select"},a[3]||(a[3]=[h('<option value="all" data-v-445e5ed9>All Statuses</option><option value="pending" data-v-445e5ed9>Pending</option><option value="running" data-v-445e5ed9>Running</option><option value="completed" data-v-445e5ed9>Completed</option><option value="failed" data-v-445e5ed9>Failed</option>',5)]),512),[[b,T.value]]),k(p("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>S.value=e),type:"text",placeholder:"Search variables or response...",class:"search-input"},null,512),[[_,S.value]])])):v("",!0),p("div",ee,[l.value?0===L.value.length?(u(),d("div",te,[p("div",le,[a[5]||(a[5]=p("h4",null,"No API Calls",-1)),p("p",null,g(0===I.value.total?"Start the trial to see API calls here.":"No API calls match the current filters."),1)])])):(u(),d("div",se,[a[6]||(a[6]=h('<div class="table-header" data-v-445e5ed9><div class="col-status" data-v-445e5ed9>Status</div><div class="col-config" data-v-445e5ed9>Config</div><div class="col-variables" data-v-445e5ed9>Variables</div><div class="col-response" data-v-445e5ed9>Response</div><div class="col-time" data-v-445e5ed9>Time</div></div>',1)),p("div",ie,[(u(!0),d(C,null,w(A.value,e=>{return u(),d("div",{key:e.id,class:x(["table-row",[e.status]]),onClick:a=>function(e){P.value=e}(e)},[p("div",re,[p("span",{class:x(["status-badge",e.status])},g(e.status),3)]),p("div",ne,[p("span",ce,g((t=e.configurationIndex,l.value&&l.value.configurationSnapshots[t]&&l.value.configurationSnapshots[t].name||`Config ${t+1}`)),1)]),p("div",de,[p("div",ue,[(u(!0),d(C,null,w(Object.entries(e.variables),([a,t],l)=>(u(),d("span",{key:a,class:"variable-pair"},[p("span",pe,g(a)+":",1),p("span",ve,g(M(t,30)),1),l<Object.entries(e.variables).length-1?(u(),d("span",me,"•")):v("",!0)]))),128))])]),p("div",ge,["pending"===e.status?(u(),d("div",ye," Waiting... ")):"running"===e.status?(u(),d("div",fe," Processing... ")):"failed"===e.status?(u(),d("div",ke,g(e.result?.error||"API call failed"),1)):e.result?.content?(u(),d("div",be,g(M(String(e.result.content),100)),1)):(u(),d("div",he," No content "))]),p("div",_e,[e.completed?(u(),d("div",Ce,[p("div",we,g((a=e.completed.getTime()-e.created.getTime(),a<1e3?`${a}ms`:`${(a/1e3).toFixed(1)}s`)),1),e.response?(u(),d("div",xe,g(e.response.latencyMs)+"ms",1)):v("",!0)])):(u(),d("div",Te,"—"))])],10,oe);var a,t}),128))]),L.value.length>E.value?(u(),d("div",Se,[p("button",{onClick:$,class:"load-more-btn"}," Load More ("+g(L.value.length-E.value)+" remaining) ",1)])):v("",!0)])):(u(),d("div",ae,a[4]||(a[4]=[p("div",{class:"placeholder-content"},[p("h4",null,"No Trial Selected"),p("p",null,"Click on a trial card to monitor its execution progress and view results.")],-1)])))]),P.value?(u(),m(F,{key:1,"api-call":P.value,trial:l.value,onClose:a[2]||(a[2]=e=>P.value=null)},null,8,["api-call","trial"])):v("",!0)]))}}),[["__scopeId","data-v-445e5ed9"]]),Ee={class:"trials-table-container full-width scientific-table-wrapper"},je={key:0,class:"trial-name-cell"},De={class:"trial-header"},Ie={class:"trial-name"},ze={class:"trial-design"},Le={class:"text-secondary"},Fe={key:1,class:"progress-cell"},Ae={class:"progress-text text-xs"},Me={key:0,class:"network-errors"},$e={key:4,class:"api-calls-cell"},Ue={class:"total-calls"},Ne={class:"calls-calculation text-secondary"},Ve={key:1,class:"text-secondary"},Oe={class:"date-cell"},Re={class:"date-value"},qe={class:"time-value text-secondary"},Ke={key:7,class:"table-actions-grid trials-actions"},Be=a(s({__name:"TrialsTable",props:{trials:{},isLoading:{type:Boolean,default:!1}},emits:["trial-selected","trial-started","trial-paused","trial-resumed","trial-cancelled","trial-exported","trial-duplicated","trial-deleted","trial-viewed","trial-export-data","trial-export-python","status-filter-changed"],setup(e,{emit:a}){const l=e,s=a,r=i("all"),n=[{key:"all",label:"All"},{key:"draft",label:"Draft"},{key:"pending",label:"Pending"},{key:"running",label:"Running"},{key:"paused",label:"Paused"},{key:"completed",label:"Completed"},{key:"failed",label:"Failed"},{key:"cancelled",label:"Cancelled"}],{createTrialColumns:c,getVisibleColumns:y}=N(),k=y(c()),b=o(()=>"all"===r.value?l.trials:l.trials.filter(e=>e.status===r.value));function h(e){r.value=e,s("status-filter-changed",e)}function _(e){return{onClick:a=>{const t=a.target;t.closest(".ant-btn")||t.closest(".ant-dropdown-trigger")||(e.name,e.id,s("trial-selected",e))}}}function D(e){return"all"===e?l.trials.length:l.trials.filter(a=>a.status===e).length}function I(e){return"failed"===e.status?"exception":"completed"===e.status?"success":e.progress.networkErrors>0?"exception":"normal"}function z(e){const a=[];return"running"===e.status&&a.push("status-running"),"failed"===e.status&&a.push("status-failed"),"completed"===e.status&&a.push("status-completed"),a.join(" ")}function L(e){const a=(new Date).getTime()-e.getTime(),t=Math.floor(a/864e5);return 0===t?"Today":1===t?"Yesterday":t<7?`${t} days ago`:t<30?`${Math.floor(t/7)} weeks ago`:e.toLocaleDateString()}return(e,a)=>{const l=S("a-tab-pane"),i=S("a-tabs"),o=S("a-tag"),c=S("a-progress"),y=S("a-tooltip"),F=S("a-button"),A=S("a-table");return u(),d("div",Ee,[T(i,{activeKey:r.value,"onUpdate:activeKey":a[0]||(a[0]=e=>r.value=e),size:"small",class:"status-tabs",onChange:h},{default:P(()=>[(u(),d(C,null,w(n,e=>T(l,{key:e.key,tab:`${e.label} (${D(e.key)})`},null,8,["tab"])),64))]),_:1},8,["activeKey"]),T(A,{columns:E(k),"data-source":b.value,pagination:!1,size:"small",scroll:{y:"calc(100vh - 200px)"},"row-key":"id","row-class-name":z,class:"scientific-table clickable-rows","custom-row":_},{bodyCell:P(({column:e,record:l})=>{return["name"===e.key?(u(),d("div",je,[p("div",De,[p("strong",Ie,g(l.name),1),T(o,{color:(r=l.status,{draft:"default",pending:"processing",running:"processing",paused:"warning",completed:"success",failed:"error",cancelled:"default"}[r]||"default"),size:"small",class:"trial-status-tag"},{default:P(()=>[f(g(l.status.toUpperCase()),1)]),_:2},1032,["color"])]),p("div",ze,[p("small",Le," Design: "+g(l.designSnapshot?.originalName||"Unknown Design"),1)]),a[1]||(a[1]=p("div",{class:"click-hint"},[p("small",{class:"text-secondary"},"Click to view live progress")],-1))])):v("",!0),"progress"===e.key?(u(),d("div",Fe,[T(c,{percent:(i=l,0===i.progress.total?0:Math.round(i.progress.completed/i.progress.total*100)),size:"small",status:I(l),"show-info":!1,class:"progress-bar"},null,8,["percent","status"]),p("div",Ae,[f(g(l.progress.completed)+" / "+g(l.progress.total)+" ",1),l.progress.networkErrors>0?(u(),d("span",Me," ("+g(l.progress.networkErrors)+" errors) ",1)):v("",!0)])])):v("",!0),"configurations"===e.key?(u(),m(y,{key:2,title:`${l.configurationSnapshots?.length||0} model configurations`},{default:P(()=>[T(o,{size:"small",color:"blue"},{default:P(()=>[f(g(l.configurationSnapshots?.length||0)+" configs ",1)]),_:2},1024)]),_:2},1032,["title"])):v("",!0),"variables"===e.key?(u(),m(y,{key:3,title:`${l.totalCombinations} variable combinations`},{default:P(()=>[T(o,{size:"small",color:"green"},{default:P(()=>[f(g(l.totalCombinations)+" combos ",1)]),_:2},1024)]),_:2},1032,["title"])):v("",!0),"api_calls"===e.key?(u(),d("div",$e,[p("span",Ue,g(l.progress.total),1),p("small",Ne,g(l.configurationSnapshots?.length||0)+" × "+g(l.totalCombinations),1)])):v("",!0),"cost"===e.key?(u(),d("span",{key:5,class:x(["cost-cell",{negative:l.estimatedCost<0}])},[Math.abs(l.estimatedCost)>0?(u(),d(C,{key:0},[f(" $"+g(Math.abs(l.estimatedCost).toFixed(2)),1)],64)):(u(),d("span",Ve,"-"))],2)):v("",!0),"created"===e.key?(u(),m(y,{key:6,title:l.created.toLocaleString()},{default:P(()=>{return[p("div",Oe,[p("span",Re,g(L(l.created)),1),p("small",qe,g((e=l.created,e.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}))),1)])];var e}),_:2},1032,["title"])):v("",!0),"actions"===e.key?(u(),d("div",Ke,[T(F,{size:"small",type:"primary",onClick:j(e=>function(e){s("trial-viewed",e)}(l),["stop"])},{default:P(()=>a[2]||(a[2]=[f(" Live Progress ")])),_:2,__:[2]},1032,["onClick"]),"draft"===l.status||"pending"===l.status?(u(),m(F,{key:0,size:"small",type:"primary",onClick:j(e=>function(e){s("trial-started",e),s("trial-viewed",e)}(l),["stop"])},{default:P(()=>a[3]||(a[3]=[f(" Start ")])),_:2,__:[3]},1032,["onClick"])):"running"===l.status?(u(),m(F,{key:1,size:"small",class:"btn-warning",onClick:j(e=>function(e){s("trial-paused",e)}(l),["stop"])},{default:P(()=>a[4]||(a[4]=[f(" Pause ")])),_:2,__:[4]},1032,["onClick"])):"paused"===l.status?(u(),m(F,{key:2,size:"small",type:"primary",onClick:j(e=>function(e){s("trial-resumed",e)}(l),["stop"])},{default:P(()=>a[5]||(a[5]=[f(" Resume ")])),_:2,__:[5]},1032,["onClick"])):(u(),m(F,{key:3,size:"small",disabled:""},{default:P(()=>a[6]||(a[6]=[f(" - ")])),_:1,__:[6]})),T(F,{size:"small",danger:"",onClick:j(e=>function(e){s("trial-deleted",e)}(l),["stop"])},{default:P(()=>a[7]||(a[7]=[f(" Delete ")])),_:2,__:[7]},1032,["onClick"]),T(F,{size:"small",onClick:j(e=>function(e){s("trial-duplicated",e)}(l),["stop"])},{default:P(()=>a[8]||(a[8]=[f(" Copy ")])),_:2,__:[8]},1032,["onClick"]),T(F,{size:"small",class:"btn-success",onClick:j(e=>function(e){s("trial-export-data",e)}(l),["stop"]),title:"Data Export"},{default:P(()=>[a[9]||(a[9]=f(" Data ")),T(E(t))]),_:2,__:[9]},1032,["onClick"]),T(F,{size:"small",class:"btn-success",onClick:j(e=>function(e){s("trial-export-python",e)}(l),["stop"]),title:"Python Export"},{default:P(()=>[a[10]||(a[10]=f(" Python ")),T(E(t))]),_:2,__:[10]},1032,["onClick"])])):v("",!0)];var i,r}),_:1},8,["columns","data-source"])])}}}),[["__scopeId","data-v-c44a4adf"]]),Ye={class:"trials-view full-width"},Ge={class:"page-header"},We={class:"header-actions"},Xe={class:"main-content"},Ze={key:0,class:"loading-state"},He={key:1,class:"empty-state"},Je={key:2,class:"trials-table-wrapper"},Qe={key:0,class:"monitoring-content"},ea={key:1,class:"monitoring-placeholder"},aa=a(s({__name:"TrialsView",setup(e){const a=z(),t=L(),s=D(),r=i(!1),c=i(null),g=i(null),y=i(!1),k=i(!1),b=i(null),h=i(null),_=i(),C=o(()=>a.isLoading),w=o(()=>[...a.trials]),x=o(()=>t.hasAnyApiKeys||t.isProviderEnabled("ollama-chat")||t.isProviderEnabled("ollama-generate"));function j(e){e.name,e.id,g.value=e,y.value=!0}function F(e){}function U(e){j(e)}async function N(e){try{await a.executeTrial(e.id),e.id,j(e)}catch(t){console.error("Failed to start trial:",t),alert("Failed to start trial: "+(t instanceof Error?t.message:"Unknown error"))}}async function V(e){try{await a.pauseTrial(e.id),e.id}catch(t){console.error("Failed to pause trial:",t),alert("Failed to pause trial")}}async function O(e){try{await a.executeTrial(e.id),e.id}catch(t){console.error("Failed to resume trial:",t),alert("Failed to resume trial")}}async function R(e){try{await a.cancelTrial(e.id),e.id}catch(t){console.error("Failed to cancel trial:",t),alert("Failed to cancel trial")}}async function q(e){await B(e)}async function K(e){alert("Data export functionality coming soon")}async function B(e){try{const{PythonExportService:a}=await l(async()=>{const{PythonExportService:e}=await import("./APICallDetailModal-CuqMsvbj.js").then(e=>e.p);return{PythonExportService:e}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18]),import.meta.url),t=a.validateTrialForExport(e);if(!t.valid)return void alert(`Cannot export trial:\n${t.errors.join("\n")}`);b.value=e,k.value=!0}catch(a){console.error("Python export failed:",a),alert(`Export failed: ${a instanceof Error?a.message:String(a)}`)}}function Y(e){}function G(e){h.value=e,r.value=!0}async function W(e){if(confirm(`Are you sure you want to delete "${e.name}"? This action cannot be undone.`))try{await a.deleteTrial(e.id)}catch(t){console.error("Failed to delete trial:",t),alert("Failed to delete trial")}}function X(e){}function Z(){}return n(async()=>{await a.initialize();const e=s.query.designId;e&&(_.value=e,r.value=!0)}),(e,a)=>{const t=S("a-button"),l=S("a-alert"),s=S("a-spin"),i=S("a-empty"),o=S("a-modal");return u(),d("div",Ye,[p("div",Ge,[a[7]||(a[7]=p("div",{class:"header-content"},[p("h1",null,"Trials"),p("p",{class:"description"}," Systematic testing of LLM models with complete reproducibility ")],-1)),p("div",We,[T(t,{type:"primary",onClick:a[0]||(a[0]=e=>r.value=!0),size:"default",disabled:!x.value},{default:P(()=>a[6]||(a[6]=[f(" Create Trial ")])),_:1,__:[6]},8,["disabled"])])]),x.value?v("",!0):(u(),m(l,{key:0,type:"warning",message:"No LLM providers configured",description:"Add keys for external APIs (local Ollama does not need keys) or enable Ollama provider.","show-icon":"",class:"warning-banner",action:""},{action:P(()=>[T(E(I),{to:"/settings"},{default:P(()=>[T(t,{size:"small",type:"primary"},{default:P(()=>a[8]||(a[8]=[f(" Go to Settings ")])),_:1,__:[8]})]),_:1})]),_:1})),p("div",Xe,[C.value?(u(),d("div",Ze,[T(s,{size:"large"},{tip:P(()=>a[9]||(a[9]=[f("Loading trials...")])),_:1})])):0===w.value.length?(u(),d("div",He,[T(i,{description:x.value?"No trials yet":"Configure LLM providers to start creating trials"},{image:P(()=>a[10]||(a[10]=[p("div",{style:{color:"#bfbfbf","font-size":"48px"}},"🧪",-1)])),default:P(()=>[x.value?(u(),m(t,{key:0,type:"primary",onClick:a[1]||(a[1]=e=>r.value=!0)},{default:P(()=>a[11]||(a[11]=[f(" Create Your First Trial ")])),_:1,__:[11]})):v("",!0)]),_:1},8,["description"])])):(u(),d("div",Je,[T(Be,{trials:w.value,"is-loading":C.value,onTrialSelected:j,onTrialStarted:N,onTrialPaused:V,onTrialResumed:O,onTrialCancelled:R,onTrialExported:q,onTrialDuplicated:G,onTrialDeleted:W,onTrialViewed:U,onTrialExportData:K,onTrialExportPython:B,onStatusFilterChanged:F},null,8,["trials","is-loading"])]))]),T(o,{open:y.value,"onUpdate:open":a[2]||(a[2]=e=>y.value=e),title:`Live Progress: ${g.value?.name||"Trial"}`,width:"95vw",footer:null,"body-style":{padding:0,height:"90vh",overflow:"auto"},"destroy-on-close":!0,centered:!0},{default:P(()=>[g.value?(u(),d("div",Qe,[T(Pe,{"trial-id":g.value.id},null,8,["trial-id"])])):(u(),d("div",ea,[T(i,{description:"No trial selected for monitoring"})]))]),_:1},8,["open","title"]),r.value?(u(),m(A,{key:1,trialToDuplicate:h.value,initialDesignId:_.value,onClose:a[3]||(a[3]=e=>{r.value=!1,h.value=null,_.value=void 0}),onCreated:X},null,8,["trialToDuplicate","initialDesignId"])):v("",!0),c.value?(u(),m(M,{key:2,trial:c.value,onClose:a[4]||(a[4]=e=>c.value=null),onUpdated:Z},null,8,["trial"])):v("",!0),k.value&&b.value?(u(),m($,{key:3,trial:b.value,onClose:a[5]||(a[5]=e=>{k.value=!1,b.value=null}),onExported:Y},null,8,["trial"])):v("",!0)])}}}),[["__scopeId","data-v-d61afc59"]]);export{aa as default};
