import{_ as e,u as t}from"./BaseButton.vue_vue_type_style_index_0_lang-DGlOSN5T.js";import{u as a}from"./useLiveData-exgVvd3B.js";import{L as l,l as s,_ as i,N as r,K as o,y as n,e as u,d}from"./index-QIXn2RXE.js";import{r as c,f as m,c as p,w as v,u as b,n as y,d as g,ab as f,_ as h,a0 as V,a1 as k,G as _,a3 as w,a4 as C,q as x,F as K,ac as S,ad as E,ah as L,B as I,k as A,Z as D,O as $,$ as U,o as T,Y as O,z,ai as j}from"./vendor-CdfxntmD.js";import{v as B}from"./variable.service-DPwFFS48.js";import{_ as R}from"./BaseModal.vue_vue_type_style_index_0_lang-DY82666A.js";import{Q as F}from"./vue3-datagrid-DtlEHN8J.js";import"./db-CL8uhZCz.js";function q(e){const t=l(),a=c({name:"",description:"",category:"simple",values:[],attributeKeys:[],items:[],tabularData:void 0}),i=m(!1),r=m(!1),o=m([]),n=m(!1),u=m(""),d=m(!1),g=p(()=>"simple"===a.category||"refusal"===a.category?a.values.length:"attributed"===a.category?a.items.length:"tabular"===a.category&&a.tabularData?.rows.length||0),f=p(()=>{const e=[];if(a.name.trim()||e.push("Name is required"),"simple"===a.category||"refusal"===a.category){0===a.values.length&&e.push("At least one value is required");new Set(a.values.map(e=>e.toLowerCase().trim())).size<a.values.length&&e.push("Duplicate values detected")}else if("attributed"===a.category){0===a.attributeKeys.length&&e.push("At least one attribute key is required"),0===a.items.length&&e.push("At least one item is required");const t=B.validateAttributedList(a.items,a.attributeKeys);t.isValid||e.push(...t.errors)}return{isValid:0===e.length,errors:e}}),h=p(()=>"attributed"!==a.category?{}:B.getAttributeStats(a.items));return v(()=>a.category,(e,t)=>{s.debug("Category watcher triggered",{newCategory:e,oldCategory:t,isLoadingData:d.value}),e===t||void 0===t||d.value?s.debug("Not clearing data - category change is during load or initial"):(s.debug("Clearing data due to category change"),a.values.splice(0,a.values.length),a.attributeKeys.splice(0,a.attributeKeys.length),a.items.splice(0,a.items.length))}),v(()=>b(e),l=>{s.debug("ListId watcher triggered",{newId:l}),l?(s.debug("Calling load() for listId",{newId:l}),async function(){const l=b(e);if(s.debug("Loading list with ID",{currentListId:l}),l){r.value=!0,d.value=!0;try{const e=await t.getList(l);if(s.debug("Loaded list from store",{list:e}),!e)throw new Error("Variable list not found");s.debug("Setting form.name",{name:e.name}),a.name=e.name,s.debug("form.name is now",{name:a.name}),s.debug("Setting form.description",{description:e.description??""}),a.description=e.description??"",s.debug("form.description is now",{description:a.description}),s.debug("Setting form.category",{category:e.category}),a.category=e.category,s.debug("form.category is now",{category:a.category}),await y(),"simple"===e.category||"refusal"===e.category?(s.debug("Loading simple/refusal values",{values:e.values}),a.values.splice(0,a.values.length,...e.values||[]),s.debug("form.values is now",{values:a.values,length:a.values.length})):"attributed"===e.category?(s.debug("Loading attributed data - attributeKeys",{attributeKeys:e.attributeKeys}),a.attributeKeys.splice(0,a.attributeKeys.length,...e.attributeKeys||[]),s.debug("form.attributeKeys is now",{attributeKeys:a.attributeKeys,length:a.attributeKeys.length}),s.debug("Loading attributed data - items",{itemCount:e.items?.length}),a.items.splice(0,a.items.length,...e.items?e.items.map(e=>({value:e.value,attributes:{...e.attributes}})):[]),s.debug("form.items is now",{itemCount:a.items.length})):"tabular"===e.category&&(s.debug("Loading tabular data",{columns:e.tabularData?.columns,rowCount:e.tabularData?.rows.length}),a.tabularData=e.tabularData?{columns:[...e.tabularData.columns],rows:e.tabularData.rows.map(e=>({...e}))}:void 0),s.debug("Final form state",{name:a.name,description:a.description,category:a.category,valuesLength:a.values.length,attributeKeysLength:a.attributeKeys.length,itemsLength:a.items.length}),await y()}catch(i){s.error("Error loading list",i)}finally{r.value=!1,d.value=!1,s.debug("Load complete, isLoadingData set to false")}}}()):(s.debug("Resetting form for new list"),a.name="",a.description="",a.category="simple",a.values.splice(0,a.values.length),a.attributeKeys.splice(0,a.attributeKeys.length),a.items.splice(0,a.items.length),s.debug("Form reset complete"))},{immediate:!0}),{form:a,isSaving:i,isLoading:r,errors:o,showImportDialog:n,importText:u,itemCount:g,validation:f,attributeStats:h,save:async function(){if(!f.value.isValid)throw o.value=f.value.errors,new Error(f.value.errors[0]);i.value=!0,o.value=[];try{const l={name:a.name.trim(),description:a.description.trim()||void 0,category:a.category,values:"simple"===a.category||"refusal"===a.category?[...a.values]:void 0,attributeKeys:"attributed"===a.category?[...a.attributeKeys]:void 0,items:"attributed"===a.category?a.items.map(e=>({value:e.value,attributes:{...e.attributes}})):void 0,tabularData:"tabular"===a.category?a.tabularData:void 0,itemCount:g.value},s=b(e);return s?(await t.updateList(s,l),s):await t.createList(l)}finally{i.value=!1}},addValue:function(e){const t=e.trim();t&&(a.values.includes(t)||a.values.push(t))},removeValue:function(e){a.values.splice(e,1)},addAttributeKey:function(e){const t=e.trim();t&&(a.attributeKeys.includes(t)||(a.attributeKeys.push(t),a.items.forEach(e=>{t in e.attributes||(e.attributes[t]="")})))},removeAttributeKey:function(e){const t=a.attributeKeys.indexOf(e);-1!==t&&(a.attributeKeys.splice(t,1),a.items.forEach(t=>{delete t.attributes[e]}))},addItem:function(e){const t={value:e.value,attributes:{}};a.attributeKeys.forEach(a=>{t.attributes[a]=e.attributes[a]??""}),a.items.push(t)},removeItem:function(e){a.items.splice(e,1)},importData:async function(){try{const e=u.value.trim();if(!e)return;if(e.startsWith("[")||e.startsWith("{")){const t=B.parseJSON(e);if("simple"===a.category){if(!Array.isArray(t))throw new Error("For simple lists, JSON must be an array");a.values=t.map(e=>"string"==typeof e?e:e.value||e.name||String(e)).filter(Boolean)}else{const e=Array.isArray(t)?t:[t],l=new Set;e.forEach(e=>{Object.keys(e).forEach(e=>{"value"!==e&&"name"!==e&&l.add(e)})}),a.attributeKeys=Array.from(l),a.items=e.map(e=>({value:String(e.value||e.name||""),attributes:a.attributeKeys.reduce((t,a)=>(t[a]=String(e[a]||""),t),{})})).filter(e=>e.value)}}else{const t=B.parseCSV(e);if("simple"===a.category)a.values=t.rows.map(e=>Object.values(e)[0]).filter(Boolean);else{const e=B.csvToAttributedItems(t),l=t.headers.filter(e=>"value"!==e.toLowerCase()&&"name"!==e.toLowerCase());a.attributeKeys=l,a.items=e}}n.value=!1,u.value=""}catch(e){throw s.error("Import failed",e),e}},exportData:function(){return"simple"===a.category?`value\n${a.values.join("\n")}`:B.exportToCSV(a.items)}}}const N={class:"tag-input","data-testid":"tag-input-component"},J={key:0,class:"tag-input-label"},M={key:0,class:"required"},P={class:"tags"},W=["onClick","aria-label"],G=["placeholder","aria-label","onKeydown"],Y={key:1,class:"helper-text"},H=i(g({__name:"TagInput",props:{modelValue:{},label:{},placeholder:{default:"Add a value..."},helperText:{},required:{type:Boolean}},emits:["update:modelValue"],setup(e,{expose:t,emit:a}){const l=e,s=a,i=m(),r=m(""),o=m(!1);function n(){const e=r.value.trim();e&&(l.modelValue.includes(e)||s("update:modelValue",[...l.modelValue,e]),r.value="")}function u(e){const t=[...l.modelValue];t.splice(e,1),s("update:modelValue",t)}function d(){""===r.value&&l.modelValue.length>0&&u(l.modelValue.length-1)}function c(e){","!==e.key&&188!==e.keyCode||(e.preventDefault(),n())}function p(e){e.preventDefault();const t=e.clipboardData?.getData("text");if(!t)return;const a=t.split(/[\n,\t]+/).map(e=>e.trim()).filter(Boolean),i=[...new Set([...l.modelValue,...a])];s("update:modelValue",i),r.value=""}function v(){r.value.trim()&&n(),o.value=!1}return t({focus:()=>i.value?.focus()}),(e,t)=>(h(),f("div",N,[e.label?(h(),f("label",J,[_(w(e.label)+" ",1),e.required?(h(),f("span",M,"*")):V("",!0)])):V("",!0),k("div",{class:C(["tag-input-container",{focused:o.value}])},[k("div",P,[(h(!0),f(K,null,S(e.modelValue,(e,t)=>(h(),f("span",{key:`${e}-${t}`,class:"tag"},[_(w(e)+" ",1),k("button",{type:"button",class:"tag-remove",onClick:e=>u(t),"aria-label":`Remove ${e}`}," Ã— ",8,W)]))),128)),x(k("input",{ref_key:"inputRef",ref:i,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value=e),placeholder:e.placeholder,class:"tag-input-field","data-testid":"tag-input-field","aria-label":e.label||"Enter tags",onKeydown:[L(I(n,["prevent"]),["enter"]),L(d,["backspace"]),c],onPaste:p,onFocus:t[1]||(t[1]=e=>o.value=!0),onBlur:v},null,40,G),[[E,r.value]])])],2),e.helperText?(h(),f("div",Y,w(e.helperText),1)):V("",!0)]))}}),[["__scopeId","data-v-613f6ba9"]]),Z={class:"list-textarea","data-testid":"list-textarea-component"},Q={key:0,class:"list-textarea-label"},X={key:0,class:"required"},ee={class:"list-stats"},te={class:"item-count"},ae={key:0,class:"helper-text"},le=i(g({__name:"ListTextArea",props:{modelValue:{},label:{},placeholder:{default:"Enter values, one per line\nOr paste from spreadsheet"},helperText:{},required:{type:Boolean},dataTestId:{default:"list-textarea-field"}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=t,s=p({get:()=>a.modelValue.join("\n"),set:e=>{const t=e.split("\n").map(e=>e.trim()).filter(e=>e.length>0),a=[...new Set(t)];l("update:modelValue",a)}});function i(){s.value=s.value}function r(){s.value=s.value}return(e,t)=>{const a=D("a-textarea");return h(),f("div",Z,[e.label?(h(),f("label",Q,[_(w(e.label)+" ",1),e.required?(h(),f("span",X,"*")):V("",!0)])):V("",!0),A(a,{value:s.value,"onUpdate:value":t[0]||(t[0]=e=>s.value=e),placeholder:e.placeholder,"auto-size":{minRows:8,maxRows:20},class:"list-textarea-input","data-testid":e.dataTestId,"aria-label":e.label||"Enter list values",onChange:i,onBlur:r},null,8,["value","placeholder","data-testid","aria-label"]),k("div",ee,[k("span",te,w(e.modelValue.length)+" items",1),e.helperText?(h(),f("span",ae,w(e.helperText),1)):V("",!0)])])}}}),[["__scopeId","data-v-298ae26a"]]),se={class:"variable-card-editor","data-testid":"variable-card-editor"},ie={key:0,class:"editor-label"},re={key:0,class:"required"},oe={class:"variables-grid"},ne=["data-testid"],ue=["onClick","aria-label"],de={class:"variable-content"},ce={class:"editor-stats"},me={class:"item-count"},pe={key:0,class:"helper-text"},ve={class:"bulk-add-hint"},be=i(g({__name:"VariableCardEditor",props:{modelValue:{},label:{},placeholder:{default:"Enter values"},helperText:{},required:{type:Boolean},dataTestId:{default:"variable-card-editor"}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=t,s=m(!1),i=m("");function d(e){const t=[...a.modelValue];t.splice(e,1),l("update:modelValue",t)}function c(e,t){const s=[...a.modelValue];s[e]=t,l("update:modelValue",s)}function p(e){e===a.modelValue.length-1&&a.modelValue[e].trim()&&function(){const e=[...a.modelValue,""];l("update:modelValue",e),setTimeout(()=>{const e=document.querySelectorAll(".variable-card input"),t=e[e.length-1];t&&t.focus()},50)}()}function v(){i.value="",s.value=!0}function y(){const e=i.value.split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(0===e.length)return void u.warning("Please enter at least one value");const t=new Set(a.modelValue),r=[...a.modelValue];let o=0;for(const a of e)t.has(a)||(r.push(a),t.add(a),o++);l("update:modelValue",r),o>0?u.success(`Added ${o} new item${o>1?"s":""}`):u.info("All values were already in the list"),s.value=!1}return(e,t)=>{const l=D("a-input"),u=D("a-textarea"),m=D("a-modal");return h(),f("div",se,[e.label?(h(),f("label",ie,[_(w(e.label)+" ",1),e.required?(h(),f("span",re,"*")):V("",!0)])):V("",!0),k("div",oe,[A($,{name:"card-transition"},{default:U(()=>[(h(!0),f(K,null,S(e.modelValue,(e,t)=>(h(),f("div",{key:`var-${t}-${e}`,class:"variable-card","data-testid":`variable-card-${t}`},[k("button",{class:"remove-btn",onClick:e=>d(t),"aria-label":`Remove ${e}`,"data-testid":"remove-btn"},[A(b(r))],8,ue),k("div",de,[A(l,{value:e,onInput:e=>c(t,e.target.value),onKeydown:L(e=>p(t),["enter"]),onBlur:e=>function(e){const t=a.modelValue[e];t&&t.trim()?c(e,t.trim()):d(e)}(t),placeholder:"Enter value",size:"small"},null,8,["value","onInput","onKeydown","onBlur"])])],8,ne))),128)),k("div",{key:"add-card",class:"add-card",onClick:v,"data-testid":"add-variable-card"},[A(b(o),{class:"add-icon"}),t[3]||(t[3]=k("span",null,"Add Variable",-1))])]),_:1})]),k("div",ce,[k("span",me,w(e.modelValue.length)+" items",1),e.helperText?(h(),f("span",pe,w(e.helperText),1)):V("",!0)]),A(m,{open:s.value,"onUpdate:open":t[1]||(t[1]=e=>s.value=e),title:"Add Multiple Variables",onOk:y,onCancel:t[2]||(t[2]=e=>s.value=!1),width:"600px"},{default:U(()=>[A(u,{value:i.value,"onUpdate:value":t[0]||(t[0]=e=>i.value=e),placeholder:"Enter values, one per line\nOr paste from spreadsheet","auto-size":{minRows:8,maxRows:20},class:"bulk-add-textarea"},null,8,["value"]),k("div",ve,[A(b(n)),t[4]||(t[4]=k("span",null,"Tip: You can paste from Excel or Google Sheets. Duplicate values will be ignored.",-1))])]),_:1},8,["open"])])}}}),[["__scopeId","data-v-5e82d820"]]),ye={class:"revogrid-spreadsheet"},ge=i(g({__name:"RevoGridSpreadsheet",props:{modelValue:{},columns:{}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=t,s=m(),i=m([]);function r(){a.columns&&a.columns.length>0?i.value=a.columns.map((e,t)=>({prop:e,name:e,size:0===t?150:100})):i.value=Array.from({length:26},(e,t)=>({prop:String.fromCharCode(65+t),name:String.fromCharCode(65+t),size:0===t?150:100}))}const o=m([]);function n(){const e=o.value.filter(e=>Object.values(e).some(e=>""!==e&&null!=e)).map(e=>{const t={};return Object.entries(e).forEach(([e,a])=>{a&&(t[e]=a)}),t});l("update:modelValue",e)}function u(){o.value=Array.from({length:1e3},()=>{const e={};return i.value.forEach(t=>{e[t.prop]=""}),e})}return v(()=>a.modelValue,e=>{e&&e.length>0&&(o.value.forEach(e=>{Object.keys(e).forEach(t=>{e[t]=""})}),e.forEach((e,t)=>{o.value[t]&&Object.entries(e).forEach(([e,a])=>{o.value[t].hasOwnProperty(e)&&(o.value[t][e]=a)})}))},{immediate:!0}),T(()=>{r(),u(),v(()=>a.columns,()=>{r(),u()})}),(e,t)=>(h(),f("div",ye,[A(b(F),{ref_key:"grid",ref:s,source:o.value,columns:i.value,theme:"compact","row-size":32,range:!0,clipboard:!0,resize:!0,"auto-size-column":!0,onAfteredit:n,style:{height:"100%","min-height":"400px"}},null,8,["source","columns"])]))}}),[["__scopeId","data-v-e309ce18"]]),fe={class:"attributed-items-grid"},he={key:0,class:"grid-header"},Ve={class:"grid-actions"},ke=["disabled"],_e={key:1,class:"add-row"},we=["onUpdate:modelValue","placeholder","data-testid","aria-label"],Ce={key:2,class:"grid-container"},xe={class:"items-table"},Ke={key:0,class:"actions-column"},Se=["data-testid","data-item-value"],Ee={key:0,class:"actions-column"},Le=["onClick","data-testid","aria-label"],Ie={key:0,class:"placeholder-row"},Ae={class:"placeholder-text"},De={key:3,class:"empty-state"},$e={key:4,class:"empty-state"},Ue=i(g({__name:"AttributedItemsGrid",props:{modelValue:{},attributeKeys:{},showStructure:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=e,l=t,s=m(!1),i=m(),r=m([]),o=c({value:"",attributes:{}});function n(){if(!o.value.trim())return;const e={value:o.value.trim(),attributes:{...o.attributes}};l("update:modelValue",[...a.modelValue,e]),o.value="",a.attributeKeys.forEach(e=>{o.attributes[e]=""}),s.value=!1}function u(){o.value="",a.attributeKeys.forEach(e=>{o.attributes[e]=""}),s.value=!1}function d(e){const t=e.toLowerCase();return t.includes("age")?"25":t.includes("gender")||t.includes("sex")?"Female":t.includes("price")||t.includes("cost")?"$19.99":t.includes("category")||t.includes("type")?"Technology":t.includes("color")||t.includes("colour")?"Blue":t.includes("size")?"Medium":t.includes("country")?"USA":t.includes("city")?"Seattle":"Sample Value"}function p(){s.value=!0,setTimeout(()=>{i.value?.focus()},50)}function b(e){}function y(){const e=document.activeElement;if(e===i.value&&r.value.length>0)return void r.value[0]?.focus();const t=r.value.findIndex(t=>t===e);t>=0&&t<r.value.length-1?r.value[t+1]?.focus():(n(),p())}return v(()=>a.attributeKeys,e=>{o.attributes={},e.forEach(e=>{o.attributes[e]=""})},{immediate:!0}),(e,t)=>(h(),f("div",fe,[e.attributeKeys.length>0?(h(),f("div",he,[k("div",Ve,[k("button",{type:"button",class:"add-button",disabled:0===e.attributeKeys.length,onClick:p,"data-testid":"btn-add-attributed-item","aria-label":"Add new attributed item"}," + Add Item ",8,ke),t[1]||(t[1]=k("span",{class:"hint-text"},"Enter value first, then Tab through attributes, press Enter to save",-1))])])):V("",!0),s.value?(h(),f("div",_e,[x(k("input",{ref_key:"valueInput",ref:i,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value=e),placeholder:"Enter name/value first, then press Tab",class:"grid-input primary-input",onKeyup:L(y,["enter"]),onKeydown:L(b,["tab"]),"data-testid":"input-item-value","aria-label":"Item value"},null,544),[[E,o.value]]),(h(!0),f(K,null,S(e.attributeKeys,(e,t)=>x((h(),f("input",{key:e,ref_for:!0,ref:e=>r.value[t]=e,"onUpdate:modelValue":t=>o.attributes[e]=t,placeholder:`${e} (press Tab)`,class:"grid-input attribute-input",onKeyup:L(y,["enter"]),onKeydown:L(b,["tab"]),"data-testid":`input-attribute-${e}`,"aria-label":`${e} attribute value`},null,40,we)),[[E,o.attributes[e]]])),128)),k("div",{class:"row-actions"},[k("button",{type:"button",class:"save-button",onClick:n,"data-testid":"btn-save-attributed-item","aria-label":"Save attributed item (or press Enter)",title:"Save (Enter)"}," âœ“ "),k("button",{type:"button",class:"cancel-button",onClick:u,"data-testid":"btn-cancel-attributed-item","aria-label":"Cancel adding item",title:"Cancel"}," Ã— ")])])):V("",!0),e.modelValue.length>0||e.showStructure&&e.attributeKeys.length>0?(h(),f("div",Ce,[k("table",xe,[k("thead",null,[k("tr",null,[t[2]||(t[2]=k("th",null,"Value",-1)),(h(!0),f(K,null,S(e.attributeKeys,e=>(h(),f("th",{key:e},w(e),1))),128)),e.modelValue.length>0?(h(),f("th",Ke)):V("",!0)])]),k("tbody",null,[(h(!0),f(K,null,S(e.modelValue,(t,s)=>(h(),f("tr",{key:`item-${t.value}-${s}`,"data-testid":`attributed-item-row-${s}`,"data-item-value":t.value},[k("td",null,w(t.value),1),(h(!0),f(K,null,S(e.attributeKeys,e=>(h(),f("td",{key:e},w(t.attributes[e]||"-"),1))),128)),e.modelValue.length>0?(h(),f("td",Ee,[k("button",{type:"button",class:"remove-button",onClick:e=>function(e){const t=[...a.modelValue];t.splice(e,1),l("update:modelValue",t)}(s),"data-testid":`btn-remove-item-${s}`,"aria-label":`Remove item ${t.value}`}," Ã— ",8,Le)])):V("",!0)],8,Se))),128)),0===e.modelValue.length&&e.showStructure&&e.attributeKeys.length>0?(h(),f("tr",Ie,[t[3]||(t[3]=k("td",{class:"placeholder-cell"},"Sample Name",-1)),(h(!0),f(K,null,S(e.attributeKeys,e=>(h(),f("td",{key:`placeholder-${e}`,class:"placeholder-cell"},[k("span",Ae,w(d(e)),1)]))),128))])):V("",!0)])])])):0===e.attributeKeys.length?(h(),f("div",De,t[4]||(t[4]=[k("div",{class:"empty-icon"},"ðŸ“‹",-1),k("p",{class:"empty-title"},"Ready for Attributes",-1),k("p",{class:"empty-subtitle"},"Define attributes above to see the data structure here",-1)]))):(h(),f("div",$e,t[5]||(t[5]=[k("div",{class:"empty-icon"},"ðŸ“",-1),k("p",{class:"empty-title"},"Ready for Data",-1),k("p",{class:"empty-subtitle"},'Click "Add Item" to start entering your data',-1)])))]))}}),[["__scopeId","data-v-d9c9a00c"]]),Te={class:"import-content"},Oe={class:"import-help"},ze={key:0,class:"format-examples"},je=["placeholder"],Be=i(g({__name:"ImportDialog",props:{category:{}},emits:["close","import"],setup(t,{emit:a}){const l=t,s=a,i=m(""),r=p(()=>"simple"===l.category?"Apple\nBanana\nCherry\n\nOR\n\nApple, Banana, Cherry":"Paste CSV or JSON data here...");function o(){i.value.trim()?s("import",i.value):alert("Please paste some data to import")}return(t,a)=>(h(),O(R,{"model-value":!0,title:"Import Data","onUpdate:modelValue":a[2]||(a[2]=e=>t.$emit("close"))},{footer:U(()=>[A(e,{variant:"ghost",onClick:a[1]||(a[1]=e=>t.$emit("close"))},{default:U(()=>a[4]||(a[4]=[_(" Cancel ")])),_:1,__:[4]}),A(e,{onClick:o},{default:U(()=>a[5]||(a[5]=[_(" Import ")])),_:1,__:[5]})]),default:U(()=>[k("div",Te,[k("p",Oe,["simple"===t.category?(h(),f(K,{key:0},[_(" Paste values, one per line or comma-separated. ")],64)):(h(),f(K,{key:1},[_(" Paste CSV or JSON data. For CSV, first row should be headers. ")],64))]),"attributed"===t.category?(h(),f("div",ze,a[3]||(a[3]=[k("details",null,[k("summary",null,"CSV Example"),k("pre",null,"value,race,gender\nJohn Smith,White,Male\nMaria Garcia,Hispanic,Female\nWei Chen,Asian,Male")],-1),k("details",null,[k("summary",null,"JSON Example"),k("pre",null,'[\n  {"value": "John Smith", "race": "White", "gender": "Male"},\n  {"value": "Maria Garcia", "race": "Hispanic", "gender": "Female"}\n]')],-1)]))):V("",!0),x(k("textarea",{"onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e),class:"import-textarea",placeholder:r.value,rows:"15"},null,8,je),[[E,i.value]])])]),_:1}))}}),[["__scopeId","data-v-f851c3b3"]]),Re={class:"form-container"},Fe={class:"name-desc-row"},qe={class:"form-field"},Ne={class:"form-field"},Je={class:"type-row","data-testid":"variable-type-selector"},Me={class:"radio-group-inline"},Pe={class:"radio-label-inline"},We=["disabled"],Ge={class:"radio-label-inline"},Ye=["disabled"],He={class:"radio-label-inline"},Ze=["disabled"],Qe={key:0,class:"form-section"},Xe={key:1,class:"form-section"},et={class:"import-actions"},tt={key:2,class:"form-section"},at={class:"attributed-inline"},lt={class:"attributes-content"},st={class:"items-section"},it={class:"items-content"},rt={class:"import-section"},ot={key:3,class:"error-banner"},nt={class:"footer-content"},ut={class:"stats"},dt={class:"actions"},ct=i(g({__name:"VariableListEditor",props:{modelValue:{type:Boolean},listId:{}},emits:["update:modelValue","saved"],setup(t,{emit:a}){const l=t,i=a,{form:r,isSaving:o,errors:n,showImportDialog:u,importText:d,itemCount:c,validation:y,save:g,importData:C}=q(z(l,"listId")),L=m("grid"),$=p({get:()=>r.items.map(e=>({value:e.value,...e.attributes})),set:e=>{r.items=e.map(e=>{const{value:t,...a}=e;return{value:t,attributes:a}})}});async function T(){try{const e=await g();i("saved",e),i("update:modelValue",!1)}catch(e){s.error("Failed to save variable list",e)}}async function B(e){try{d.value=e,await C(),u.value=!1}catch(t){s.error("Failed to import data",t),alert("Failed to import: "+(t instanceof Error?t.message:"Unknown error"))}}return v(()=>r.name,e=>{s.debug("VariableListEditor: form.name changed",{name:e})}),v(()=>r.category,e=>{s.debug("VariableListEditor: form.category changed",{category:e})}),v(()=>r.values,e=>{s.debug("VariableListEditor: form.values changed",{values:e,length:e.length})},{deep:!0}),v(()=>r.attributeKeys,e=>{s.debug("VariableListEditor: form.attributeKeys changed",{keys:e,length:e.length})},{deep:!0}),v(()=>r.items,e=>{s.debug("VariableListEditor: form.items changed",{itemCount:e.length})},{deep:!0}),(t,a)=>{const l=D("a-tag"),s=D("a-tab-pane"),i=D("a-tabs");return h(),O(R,{"model-value":t.modelValue,title:t.listId?"Edit Variable List":"Create Variable List",size:"full","data-testid":"modal-variable-editor","onUpdate:modelValue":a[15]||(a[15]=e=>t.$emit("update:modelValue",e))},{footer:U(()=>[k("div",nt,[k("div",ut,w(b(c))+" items ",1),k("div",dt,[A(e,{variant:"ghost",onClick:a[13]||(a[13]=e=>t.$emit("update:modelValue",!1))},{default:U(()=>a[34]||(a[34]=[_(" Cancel ")])),_:1,__:[34]}),A(e,{type:"submit",loading:b(o),disabled:!b(y).isValid,onClick:T},{default:U(()=>[_(w(t.listId?"Update":"Create"),1)]),_:1},8,["loading","disabled"])])])]),default:U(()=>[k("div",Re,[k("form",{onSubmit:I(T,["prevent"]),class:"form-content"},[k("div",Fe,[a[16]||(a[16]=k("label",{class:"inline-field-label"},"Name",-1)),k("div",qe,[x(k("input",{id:"name","onUpdate:modelValue":a[0]||(a[0]=e=>b(r).name=e),type:"text",class:"form-input large",placeholder:"Enter list name","data-testid":"input-variable-list-name","aria-label":"Variable list name",required:""},null,512),[[E,b(r).name]])]),a[17]||(a[17]=k("label",{class:"inline-field-label"},"Description",-1)),k("div",Ne,[x(k("input",{id:"description","onUpdate:modelValue":a[1]||(a[1]=e=>b(r).description=e),type:"text",class:"form-input large",placeholder:"Optional description","data-testid":"input-variable-list-description","aria-label":"Variable list description"},null,512),[[E,b(r).description]])])]),k("div",Je,[a[25]||(a[25]=k("label",{class:"inline-field-label"},"Type",-1)),k("div",Me,[k("label",Pe,[x(k("input",{"onUpdate:modelValue":a[2]||(a[2]=e=>b(r).category=e),type:"radio",value:"simple",disabled:!!t.listId,"data-testid":"radio-simple-list","aria-label":"Simple variable list type"},null,8,We),[[j,b(r).category]]),a[18]||(a[18]=k("span",{class:"radio-text"},"Simple List",-1)),a[19]||(a[19]=k("span",{class:"radio-example"},"(colors, names, countries)",-1))]),k("label",Ge,[x(k("input",{"onUpdate:modelValue":a[3]||(a[3]=e=>b(r).category=e),type:"radio",value:"attributed",disabled:!!t.listId,"data-testid":"radio-attributed-list","aria-label":"Attributed variable list type"},null,8,Ye),[[j,b(r).category]]),a[21]||(a[21]=k("span",{class:"radio-text"},"Attributed List",-1)),A(l,{size:"small",color:"orange",style:{"margin-left":"8px"}},{default:U(()=>a[20]||(a[20]=[_("Beta")])),_:1,__:[20]}),a[22]||(a[22]=k("span",{class:"radio-example"},"(names with gender/ethnicity, cities with region/size)",-1))]),k("label",He,[x(k("input",{"onUpdate:modelValue":a[4]||(a[4]=e=>b(r).category=e),type:"radio",value:"refusal",disabled:!!t.listId},null,8,Ze),[[j,b(r).category]]),a[23]||(a[23]=k("span",{class:"radio-text"},"Refusal Words",-1)),a[24]||(a[24]=k("span",{class:"radio-example"},"(cannot, unable, refuse)",-1))])])]),"simple"===b(r).category?(h(),f("div",Qe,[a[26]||(a[26]=k("h3",null,"Values",-1)),A(be,{modelValue:b(r).values,"onUpdate:modelValue":a[5]||(a[5]=e=>b(r).values=e),label:"List Values",placeholder:"Enter value","helper-text":"Click 'Add Variable' or use the bulk add to paste from spreadsheet. Duplicates are automatically removed.","data-testid":"simple-list-values"},null,8,["modelValue"])])):V("",!0),"refusal"===b(r).category?(h(),f("div",Xe,[a[28]||(a[28]=k("h3",null,"Refusal Words",-1)),A(le,{modelValue:b(r).values,"onUpdate:modelValue":a[6]||(a[6]=e=>b(r).values=e),label:"Refusal Words",placeholder:"Enter refusal words, one per line\nExamples:\ncannot\nunable\nrefuse\nnot appropriate","helper-text":"Words or phrases that indicate model refusal","data-testid":"refusal-list-values"},null,8,["modelValue"]),k("div",et,[A(e,{variant:"secondary",size:"small",onClick:a[7]||(a[7]=e=>u.value=!0)},{default:U(()=>a[27]||(a[27]=[_(" Import CSV ")])),_:1,__:[27]})])])):V("",!0),"attributed"===b(r).category?(h(),f("div",tt,[k("div",at,[a[29]||(a[29]=k("label",{class:"inline-field-label"},"Attributes",-1)),k("div",lt,[A(H,{modelValue:b(r).attributeKeys,"onUpdate:modelValue":a[8]||(a[8]=e=>b(r).attributeKeys=e),label:"",placeholder:"Add attribute (e.g., gender, ethnicity, region, size)...","helper-text":"Define properties/columns that each item will have"},null,8,["modelValue"])])]),k("div",st,[a[32]||(a[32]=k("label",{class:"inline-field-label"},"Data",-1)),k("div",it,[A(i,{activeKey:L.value,"onUpdate:activeKey":a[12]||(a[12]=e=>L.value=e),type:"card"},{default:U(()=>[A(s,{key:"grid",tab:"Manual Entry"},{default:U(()=>[A(Ue,{modelValue:b(r).items,"onUpdate:modelValue":a[9]||(a[9]=e=>b(r).items=e),"attribute-keys":b(r).attributeKeys,"show-structure":!0},null,8,["modelValue","attribute-keys"])]),_:1}),A(s,{key:"spreadsheet",tab:"Spreadsheet"},{default:U(()=>[A(ge,{modelValue:$.value,"onUpdate:modelValue":a[10]||(a[10]=e=>$.value=e),columns:["value",...b(r).attributeKeys]},null,8,["modelValue","columns"])]),_:1}),A(s,{key:"import",tab:"Import"},{default:U(()=>[k("div",rt,[a[31]||(a[31]=k("p",null,"Import data from CSV, JSON, or paste from Excel/Google Sheets",-1)),A(e,{variant:"primary",onClick:a[11]||(a[11]=e=>u.value=!0)},{default:U(()=>a[30]||(a[30]=[_(" Import CSV/JSON File ")])),_:1,__:[30]})])]),_:1})]),_:1},8,["activeKey"])])])])):V("",!0),b(n).length>0?(h(),f("div",ot,[a[33]||(a[33]=k("strong",null,"Please fix the following errors:",-1)),k("ul",null,[(h(!0),f(K,null,S(b(n),e=>(h(),f("li",{key:e},w(e),1))),128))])])):V("",!0)],32)]),b(u)?(h(),O(Be,{key:0,category:"tabular"===b(r).category?"simple":b(r).category,onClose:a[14]||(a[14]=e=>u.value=!1),onImport:B},null,8,["category"])):V("",!0)]),_:1},8,["model-value","title"])}}}),[["__scopeId","data-v-68a352b7"]]),mt={class:"variables-view","data-testid":"page-variables"},pt={class:"page-header"},vt={key:3},bt={class:"scientific-table-container"},yt={class:"scientific-table-wrapper"},gt={key:0,class:"table-info-cell"},ft={class:"table-info-title"},ht={class:"table-info-subtitle"},Vt={key:3,class:"table-cell-ellipsis"},kt={key:4,class:"date-cell"},_t={key:5,class:"table-actions-grid"},wt=i(g({__name:"VariablesView",setup(e){const{getVisibleColumns:l,formatDateTime:i,createVariableColumns:r}=t(),{data:n,error:u,loading:c}=a(()=>d.variableLists.orderBy("updated").reverse().toArray(),{debounce:100}),v=m(!1),y=m(),g=m("all"),C=l(r()),x=p(()=>n.value?.filter(e=>"simple"===e.category)||[]),S=p(()=>n.value?.filter(e=>"attributed"===e.category)||[]),E=p(()=>n.value?.filter(e=>"refusal"===e.category)||[]),L=p(()=>n.value?.filter(e=>"tabular"!==e.category&&void 0!==e.category)||[]),I=p(()=>n.value?.filter(e=>"tabular"===e.category||!e.category)||[]),$=p(()=>{switch(g.value){case"simple":return x.value;case"attributed":return S.value;case"refusal":return E.value;case"spreadsheet":return I.value;default:return L.value}});function T(){y.value=void 0,v.value=!1}function z(e){if("simple"===e.category||"refusal"===e.category){const t=e.values||[],a=t.slice(0,3).join(", ");return t.length>3?`${a}, ...`:a}const t=e.items||[],a=t.slice(0,2).map(e=>e.name||e.value).join(", ");return t.length>2?`${a}, ...`:a}return(e,t)=>{const a=D("a-button"),l=D("a-spin"),r=D("a-alert"),m=D("a-empty"),p=D("a-tab-pane"),j=D("a-tabs"),B=D("a-tag"),R=D("a-table");return h(),f("div",mt,[k("div",pt,[t[6]||(t[6]=k("div",{class:"header-content"},[k("h1",null,"Variable Lists"),k("p",{class:"description"},"Manage reusable variable lists for prompt templates")],-1)),A(a,{type:"primary",onClick:t[0]||(t[0]=e=>v.value=!0),"data-testid":"btn-create-variable-list","aria-label":"Create new variable list"},{icon:U(()=>[A(b(o))]),default:U(()=>[t[5]||(t[5]=_(" Create List "))]),_:1,__:[5]})]),b(c)?(h(),O(l,{key:0,size:"large",tip:"Loading variable lists..."},{default:U(()=>t[7]||(t[7]=[k("div",{style:{"min-height":"200px"}},null,-1)])),_:1,__:[7]})):b(u)?(h(),O(r,{key:1,type:"error",message:b(u)?.message||"Failed to load variable lists",class:"error-alert"},null,8,["message"])):b(n)&&0!==b(n).length?(h(),f("div",vt,[A(j,{activeKey:g.value,"onUpdate:activeKey":t[2]||(t[2]=e=>g.value=e),size:"small",class:"list-tabs"},{default:U(()=>[A(p,{key:"all",tab:`All Lists (${L.value.length})`},null,8,["tab"]),A(p,{key:"simple",tab:`Simple (${x.value.length})`},null,8,["tab"]),A(p,{key:"attributed",tab:`Attributed (${S.value.length})`},null,8,["tab"]),A(p,{key:"refusal",tab:`Refusal (${E.value.length})`},null,8,["tab"]),A(p,{key:"spreadsheet",tab:`Spreadsheet Lists (${I.value.length})`},null,8,["tab"])]),_:1},8,["activeKey"]),k("div",bt,[k("div",yt,[A(R,{columns:b(C),"data-source":$.value,pagination:!1,size:"small",scroll:{y:"calc(100vh - 180px)"},"row-key":"id",class:"scientific-table"},{bodyCell:U(({column:e,record:l})=>{return["name"===e.key?(h(),f("div",gt,[k("span",ft,w(l.name),1),k("span",ht,w(l.description||"No description"),1)])):V("",!0),"category"===e.key?(h(),O(B,{key:1,size:"small",color:"simple"===l.category?"blue":"attributed"===l.category?"green":"red"},{default:U(()=>[_(w(l.category),1)]),_:2},1032,["color"])):V("",!0),"itemCount"===e.key?(h(),f(K,{key:2},[_(w((o=l,"simple"===o.category||"refusal"===o.category?o.values?.length||0:o.items?.length||0)),1)],64)):V("",!0),"description"===e.key?(h(),f("div",Vt,w(z(l)),1)):V("",!0),"created"===e.key?(h(),f("div",kt,w((r=l.created,i(r))),1)):V("",!0),"actions"===e.key?(h(),f("div",_t,[A(a,{size:"small",type:"primary",onClick:e=>{return t=l.id,y.value=t,void(v.value=!0);var t}},{default:U(()=>t[10]||(t[10]=[_(" Edit ")])),_:2,__:[10]},1032,["onClick"]),A(a,{size:"small",class:"btn-success",onClick:e=>async function(e){try{let t,a;"simple"===e.category||"refusal"===e.category?(t=`value\n${e.values?.join("\n")??""}`,a=`${e.name.replace(/\s+/g,"-")}-values.csv`):(t=JSON.stringify(e.items,null,2),a=`${e.name.replace(/\s+/g,"-")}-attributed.json`);const l=new Blob([t],{type:"text/plain"}),s=URL.createObjectURL(l),i=document.createElement("a");i.href=s,i.download=a,i.click(),URL.revokeObjectURL(s)}catch(t){s.error("Failed to export list",t),alert("Failed to export list")}}(l)},{default:U(()=>t[11]||(t[11]=[_(" Export ")])),_:2,__:[11]},1032,["onClick"]),A(a,{size:"small",danger:"",onClick:e=>async function(e){if(confirm("Are you sure you want to delete this list?"))try{await d.variableLists.delete(e)}catch(t){s.error("Failed to delete list",t),alert(t instanceof Error?t.message:"Failed to delete list")}}(l.id)},{default:U(()=>t[12]||(t[12]=[_(" Delete ")])),_:2,__:[12]},1032,["onClick"])])):V("",!0)];var r,o}),_:1},8,["columns","data-source"])])])])):(h(),O(m,{key:2,description:"No variable lists yet. Create lists to use in your prompt designs."},{image:U(()=>t[8]||(t[8]=[k("div",{class:"empty-state-icon"},"ðŸ“ƒ",-1)])),default:U(()=>[A(a,{type:"primary",onClick:t[1]||(t[1]=e=>v.value=!0)},{default:U(()=>t[9]||(t[9]=[_(" Create Your First List ")])),_:1,__:[9]})]),_:1})),v.value?(h(),O(ct,{key:4,modelValue:v.value,"onUpdate:modelValue":[t[3]||(t[3]=e=>v.value=e),t[4]||(t[4]=e=>{e||(y.value=void 0)})],"list-id":y.value,onSaved:T},null,8,["modelValue","list-id"])):V("",!0)])}}}),[["__scopeId","data-v-f874b3cd"]]);export{wt as default};
