import{k as e,d as a,f as t,ab as l,a1 as s,Z as r,$ as n,_ as o,a0 as i,u as c,a3 as u,G as d,a4 as p,c as v,aj as m,w as f,F as h,ac as g,n as b,Y as y,q as w,A as _,X as x}from"./vendor-CdfxntmD.js";import{I as S,e as C,F as k,E,_ as D,y as V,l as N,K as P,g as $,a8 as z,L as j}from"./index-COu0csOc.js";import{read as A,utils as I}from"./xlsx-C4WhbwXR.js";import{a as T,T as U}from"./TrialCreationModalNew-DkWbrEh4.js";import"./db-CL8uhZCz.js";import"./BaseModal.vue_vue_type_style_index_0_lang-DY82666A.js";import"./useLiveData-D-xinmMz.js";import"./papaparse.min-DYvV7_qI.js";import"./cost-formatting-DSpbVMtV.js";import"./useEnvironmentalCost-DUUqz85l.js";import"./token-calculation.service-DxLNJTZv.js";import"./variable.service-p5oZZ_-F.js";import"./GenericModelSelectorModalV2-BJG2ctZj.js";import"./useLiveDataSingle-X0OuE1-_.js";import"./ModelCostDisplayV2-Dyx8rAYg.js";var L={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M518.3 459a8 8 0 00-12.6 0l-112 141.7a7.98 7.98 0 006.3 12.9h73.9V856c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V613.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 459z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-upload",theme:"outlined"};function F(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?Object(arguments[a]):{},l=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),l.forEach(function(a){O(e,a,t[a])})}return e}function O(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}var R=function(a,t){var l=F({},a,t.attrs);return e(S,F({},l,{icon:L}),null)};function M(){function e(e){const a=[];let t="",l=!1;for(let s=0;s<e.length;s++){const r=e[s],n=e[s+1];'"'===r?l&&'"'===n?(t+='"',s++):l=!l:","!==r||l?t+=r:(a.push(t),t="")}return a.push(t),a}async function a(e){return new Promise((a,t)=>{try{const l=A(e,{type:"string",raw:!1,dateNF:"yyyy-mm-dd"}),s=l.SheetNames[0],r=l.Sheets[s],n=I.sheet_to_json(r,{raw:!1,defval:"",header:1});if(0===n.length)return void t(new Error("No data found"));const o=n[0].map(e=>String(e||"").trim()),i=[];for(let e=1;e<n.length;e++){const a={};o.forEach((t,l)=>{a[t]=n[e][l]||""}),i.push(a)}a({data:i,columns:o})}catch(l){try{const l=e.trim().split("\n").filter(e=>e.trim());if(0===l.length)return void t(new Error("No data found"));const s=l[0];let r="\t";s.includes("\t")||(s.includes(",")?r=",":s.includes(";")?r=";":s.includes("|")&&(r="|"));const n=l[0].split(r).map(e=>e.trim().replace(/^["']|["']$/g,"")),o=[];for(let e=1;e<l.length;e++){const a=l[e].split(r).map(e=>e.trim().replace(/^["']|["']$/g,"")),t={};n.forEach((e,l)=>{t[e]=a[l]||""}),o.push(t)}a({data:o,columns:n})}catch(s){t(l)}}})}function t(e){return e.map(e=>{let a=e.replace(/[^a-zA-Z0-9_]/g,"_");return/^[a-zA-Z]/.test(a)||(a="col_"+a),a=a.replace(/_+/g,"_"),a=a.replace(/_+$/,""),a})}return{parseCSV:async function(a){return new Promise((t,l)=>{try{const s=a.trim().split("\n").filter(e=>e.trim());if(0===s.length)return void l(new Error("No data found"));const r=e(s[0]).map(e=>e.trim()),n=[];for(let a=1;a<s.length;a++){const t=e(s[a]),l={};r.forEach((e,a)=>{l[e]=t[a]||""}),n.push(l)}t({data:n,columns:r})}catch(s){l(s)}})},parseExcel:async function(e){return new Promise((a,t)=>{const l=new FileReader;l.onload=e=>{try{const l=e.target?.result,s=A(l,{type:"binary"}),r=s.SheetNames[0],n=s.Sheets[r],o=I.sheet_to_json(n,{raw:!1,defval:""});if(0===o.length)return void t(new Error("No data found in Excel file"));const i=Object.keys(o[0]);a({data:o,columns:i})}catch(l){t(l)}},l.onerror=()=>{t(new Error("Failed to read file"))},l.readAsBinaryString(e)})},parseTabDelimited:a,parseClipboardData:async function(e){return new Promise((l,s)=>{try{const r=e.getData("text/html");if(r){const e=A(r,{type:"string",raw:!1,dateNF:"yyyy-mm-dd"}),a=e.SheetNames[0],s=e.Sheets[a],n=I.sheet_to_json(s,{raw:!1,defval:"",header:1});if(n.length>0){const e=t(n[0].map(e=>String(e||"").trim())),a=[];for(let t=1;t<n.length;t++){const l={};e.forEach((e,a)=>{l[e]=n[t][a]||""}),a.push(l)}return void l({data:a,columns:e})}}const n=e.getData("text/plain");n?a(n).then(l).catch(s):s(new Error("No suitable data found in clipboard"))}catch(r){s(r)}})},validateColumns:function(e){const a=[],t=/^[a-zA-Z][a-zA-Z0-9_]*$/,l=["if","else","for","while","function","return","var","let","const"];e.forEach(e=>{t.test(e)||a.push(`Column "${e}" contains invalid characters. Variable names must start with a letter and contain only letters, numbers, and underscores.`),l.includes(e.toLowerCase())&&a.push(`Column "${e}" is a reserved word and cannot be used as a variable name.`)});const s=new Set;return e.forEach(e=>{s.has(e.toLowerCase())&&a.push(`Duplicate column name: "${e}"`),s.add(e.toLowerCase())}),{valid:0===a.length,errors:a}},sanitizeColumnNames:t}}R.displayName="CloudUploadOutlined",R.inheritAttrs=!1;const W={class:"spreadsheet-import"},G={class:"upload-section"},H={class:"ant-upload-drag-icon"},K={key:0,class:"file-info"},B={class:"paste-section"},J={key:0,class:"paste-placeholder"},Z={key:1,class:"pasted-preview"},q={class:"paste-actions"},Y={class:"sample-data"},Q=D(a({__name:"SpreadsheetImport",emits:["data-imported","columns-detected"],setup(a,{emit:v}){const m=v,f=t("upload"),h=t(null),g=t(""),b=t(),{parseCSV:y,parseExcel:w,parseTabDelimited:_,parseClipboardData:x}=M();async function S(e){try{let a;if(h.value=e,e.name.endsWith(".csv")){const t=await e.text();a=await y(t)}else{if(!e.name.endsWith(".xlsx")&&!e.name.endsWith(".xls"))throw new Error("Unsupported file format");a=await w(e)}if(!(a.data.length>0))throw new Error("No data found in file");m("data-imported",a.data),m("columns-detected",a.columns),C.success(`Successfully imported ${a.data.length} rows`),setTimeout(()=>{window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"})},100)}catch(a){C.error(`Import failed: ${a instanceof Error?a.message:"Unknown error"}`),h.value=null}return!1}function D(){h.value=null}function V(){g.value="",b.value&&(b.value.textContent="")}async function N(e){if(e.preventDefault(),e.clipboardData)try{const a=await x(e.clipboardData);if(!(a.data.length>0))throw new Error("No valid data found in clipboard");g.value=e.clipboardData.getData("text/plain"),m("data-imported",a.data),m("columns-detected",a.columns),C.success(`Successfully processed ${a.data.length} rows from clipboard`),setTimeout(()=>{window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"})},100)}catch(a){const t=e.clipboardData.getData("text/plain");t?(g.value=t,C.info('Data pasted - click "Process Data" to continue')):C.error(`Paste failed: ${a instanceof Error?a.message:"Unknown error"}`)}else C.error("Clipboard access not available")}function P(e){const a=e.target;g.value=a.textContent||""}async function $(){if(g.value.trim())try{const e=await _(g.value);if(!(e.data.length>0))throw new Error("No valid data found");m("data-imported",e.data),m("columns-detected",e.columns),C.success(`Successfully processed ${e.data.length} rows`),setTimeout(()=>{window.scrollTo({top:document.documentElement.scrollHeight,behavior:"smooth"})},100)}catch(e){C.error(`Processing failed: ${e instanceof Error?e.message:"Unknown error"}`)}else C.warning("Please paste some data first")}function z(){g.value="Name\tAge\tCity\tDepartment\nJohn Smith\t32\tNew York\tEngineering\nSarah Johnson\t28\tSan Francisco\tMarketing\nMichael Brown\t45\tChicago\tSales\nEmily Davis\t31\tBoston\tHR\nRobert Wilson\t39\tSeattle\tEngineering",f.value="paste",C.info('Sample data loaded - click "Process Data" to continue')}return(a,t)=>{const v=r("a-upload-dragger"),m=r("a-button"),y=r("a-tab-pane"),w=r("a-tabs");return o(),l("div",W,[e(w,{activeKey:f.value,"onUpdate:activeKey":t[0]||(t[0]=e=>f.value=e)},{default:n(()=>[e(y,{key:"upload",tab:"Upload File"},{default:n(()=>[s("div",G,[e(v,{"before-upload":S,accept:".csv,.xlsx,.xls","show-upload-list":!1,class:"upload-area"},{default:n(()=>[s("p",H,[e(c(R))]),t[1]||(t[1]=s("p",{class:"ant-upload-text"}," Click or drag CSV/Excel file to upload ",-1)),t[2]||(t[2]=s("p",{class:"ant-upload-hint"}," Supports .csv, .xlsx, .xls files. First row will be used as column headers. ",-1))]),_:1,__:[1,2]}),h.value?(o(),l("div",K,[e(c(k)),s("span",null,u(h.value.name),1),e(m,{type:"link",danger:"",size:"small",onClick:D},{default:n(()=>t[3]||(t[3]=[d(" Remove ")])),_:1,__:[3]})])):i("",!0)])]),_:1}),e(y,{key:"paste",tab:"Paste Data"},{default:n(()=>[s("div",B,[t[6]||(t[6]=s("p",{class:"paste-hint"}," Copy data from Excel, Google Sheets, or any spreadsheet and paste it here. First row will be used as column headers. ",-1)),s("div",{ref_key:"pasteArea",ref:b,class:p(["paste-area",{"has-content":g.value}]),contenteditable:"true",onPaste:N,onInput:P},[g.value?(o(),l("pre",Z,u(g.value),1)):(o(),l("div",J," Click here and paste your data (Ctrl+V or Cmd+V) "))],34),s("div",q,[e(m,{size:"large",onClick:V},{default:n(()=>t[4]||(t[4]=[d("Clear")])),_:1,__:[4]}),e(m,{type:"primary",size:"large",onClick:$,disabled:!g.value},{default:n(()=>t[5]||(t[5]=[d(" Process Data ")])),_:1,__:[5]},8,["disabled"])])])]),_:1})]),_:1},8,["activeKey"]),s("div",Y,[e(m,{type:"link",size:"large",onClick:z},{default:n(()=>[e(c(E)),t[7]||(t[7]=d(" Load Sample Data "))]),_:1,__:[7]})])])}}}),[["__scopeId","data-v-ff814767"]]),X={class:"spreadsheet-grid"},ee={class:"grid-header"},ae={class:"grid-info"},te={class:"row-count"},le={class:"column-count"},se={class:"grid-actions"},re={class:"grid-container"},ne={class:"column-header"},oe={class:"column-name"},ie=["title"],ce={key:0,class:"preview-notice"},ue={class:"preview-text"},de={key:0,class:"preview-actions"},pe={key:1,class:"grid-footer"},ve=D(a({__name:"SpreadsheetGrid",props:{data:{},columns:{}},setup(a){const p=a,f=t(!1),h=v(()=>f.value?p.data:p.data.slice(0,10)),g=v(()=>p.columns.map(e=>({title:e,dataIndex:e,key:e,width:150,ellipsis:!0,sorter:(a,t)=>{const l=a[e],s=t[e];return isNaN(Number(l))||isNaN(Number(s))?String(l||"").localeCompare(String(s||"")):Number(l)-Number(s)}})));function b(){f.value=!f.value}function y(e,a){const t=String(e||"");return t.length<=a?t:t.substring(0,a)+"..."}return(a,t)=>{const p=r("a-button"),v=r("a-tag"),w=r("a-table");return o(),l("div",X,[s("div",ee,[s("div",ae,[s("span",te,u(a.data.length)+" rows",1),s("span",le,u(a.columns.length)+" columns",1)]),s("div",se,[e(p,{size:"large",onClick:b},{default:n(()=>[d(u(f.value?"Show Preview":"Show All Data"),1)]),_:1})])]),s("div",re,[e(w,{columns:g.value,"data-source":h.value,pagination:!1,scroll:{x:150*a.columns.length,y:400},size:"small",bordered:"",class:"data-grid"},{headerCell:n(({column:a})=>[s("div",ne,[s("span",oe,u(a.title),1),e(v,{size:"small",color:"blue"},{default:n(()=>[d(u(a.dataIndex),1)]),_:2},1024)])]),bodyCell:n(({text:e})=>[s("div",{class:"cell-content",title:String(e||"")},u(y(e,100)),9,ie)]),_:1},8,["columns","data-source","scroll"])]),!f.value&&a.data.length>10?(o(),l("div",ce,[s("div",ue,[e(c(V)),d(" Showing first "+u(10)+' rows. Click "Show All Data" to see all '+u(a.data.length)+" rows. ",1)]),a.$slots.actions?(o(),l("div",de,[m(a.$slots,"actions",{},void 0,!0)])):i("",!0)])):a.$slots.actions?(o(),l("div",pe,[m(a.$slots,"actions",{},void 0,!0)])):i("",!0)])}}}),[["__scopeId","data-v-d7d049b7"]]),me={class:"variable-preview"},fe={class:"variable-list"},he=["onClick"],ge={class:"variable-header"},be={class:"variable-name"},ye={class:"variable-stats"},we={class:"stat-item"},_e={class:"stat-value"},xe={key:0,class:"stat-item"},Se={class:"stat-value example"},Ce={class:"variable-hint"},ke=["textContent"],Ee=D(a({__name:"SpreadsheetVariablePreview",props:{variables:{}},emits:["insert-variable"],setup(a,{emit:t}){const c=a,p=t;return N.info("SpreadsheetVariablePreview mounted with variables:",c.variables),f(()=>c.variables,e=>{N.info("SpreadsheetVariablePreview variables updated",{variables:e})},{immediate:!0,deep:!0}),(a,t)=>{const c=r("a-tag");return o(),l("div",me,[s("div",fe,[(o(!0),l(h,null,g(a.variables,a=>{return o(),l("div",{key:a.name,class:"variable-item",onClick:e=>{return t=a.name,N.info("SpreadsheetVariablePreview: Variable clicked",{name:t}),void p("insert-variable",t);var t}},[s("div",ge,[s("code",be,u(a.name),1),e(c,{size:"small",color:(v=a.type,{text:"blue",number:"green",date:"orange",mixed:"purple"}[v]||"default")},{default:n(()=>[d(u(a.type),1)]),_:2},1032,["color"])]),s("div",ye,[s("span",we,[t[0]||(t[0]=s("span",{class:"stat-label"},"Values:",-1)),s("span",_e,u(a.uniqueCount),1)]),a.examples.length>0?(o(),l("span",xe,[t[1]||(t[1]=s("span",{class:"stat-label"},"Example:",-1)),s("span",Se,u(a.examples[0]),1)])):i("",!0)]),s("div",Ce,[t[2]||(t[2]=d(" Click to insert ")),s("code",{textContent:u((r=a.name,`{{${r}}}`))},null,8,ke)])],8,he);var r,v}),128))])])}}}),[["__scopeId","data-v-8c045d15"]]),De={class:"design-editor"},Ve={class:"editor-header"},Ne={class:"editor-content"},Pe={class:"editor-toolbar"},$e={class:"toolbar-section"},ze={class:"toolbar-info"},je={key:0,class:"extractors-section"},Ae={class:"extractor-list"},Ie={class:"extractor-info"},Te={class:"extractor-name"},Ue={class:"preview-section"},Le=D(a({__name:"SpreadsheetDesignEditor",props:{prompt:{},extractors:{},variables:{},spreadsheetData:{}},emits:["update:prompt","update:extractors"],setup(a,{expose:p,emit:m}){const w=a,_=m,x=t(),S=t(w.prompt),C=t([...w.extractors]),k=t(!1),E=t({name:"",type:"regex",pattern:""}),D=t(!0),z=v(()=>{const e=[...S.value.matchAll(/\{\{(\w+)\}\}/g)];return[...new Set(e.map(e=>e[1]))]});function j(){_("update:prompt",S.value)}function A(e){const a=`{{${e}}}`;N.info("SpreadsheetDesignEditor.insertVariable called",{variableName:e});let t=null;if(x.value)try{x.value.$el&&(t=x.value.$el.querySelector("textarea")),!t&&x.value.resizableTextArea&&(t=x.value.resizableTextArea.textArea),!t&&x.value.textarea&&(t=x.value.textarea),N.info("Found textarea element",{found:!!t})}catch(l){N.warn("Error accessing textarea element",{error:l})}if(t&&"number"==typeof t.selectionStart){const e=t.selectionStart,l=t.selectionEnd,s=S.value;S.value=s.substring(0,e)+a+s.substring(l),b(()=>{if(t){t.focus();const l=e+a.length;t.setSelectionRange(l,l)}})}else S.value=S.value+(S.value?" ":"")+a,N.info("Using fallback insertion method");_("update:prompt",S.value)}function I(e){A(e)}function U(){E.value.name&&E.value.pattern&&(C.value.push({...E.value}),_("update:extractors",C.value),E.value={name:"",type:"regex",pattern:""},k.value=!1)}return f(()=>w.prompt,e=>{S.value=e}),f(()=>w.extractors,e=>{C.value=[...e]},{deep:!0}),p({insertVariable:A}),(a,t)=>{const p=r("a-button"),v=r("a-textarea"),m=r("a-select-option"),f=r("a-select"),b=r("a-tag"),w=r("a-input"),N=r("a-form-item"),A=r("a-radio"),L=r("a-radio-group"),F=r("a-form"),O=r("a-modal");return o(),l("div",De,[s("div",Ve,[t[8]||(t[8]=s("h3",null,"Prompt Template",-1)),e(p,{size:"small",type:"link",onClick:t[0]||(t[0]=e=>k.value=!0)},{default:n(()=>[e(c(P)),t[7]||(t[7]=d(" Add Extractor "))]),_:1,__:[7]})]),s("div",Ne,[e(v,{ref_key:"textareaRef",ref:x,value:S.value,"onUpdate:value":t[1]||(t[1]=e=>S.value=e),placeholder:"Enter your prompt template here. Use {{variable}} to insert variables from your spreadsheet.",rows:15,class:"prompt-editor",onChange:j},null,8,["value"]),s("div",Pe,[s("div",$e,[t[9]||(t[9]=s("span",{class:"toolbar-label"},"Insert Variable:",-1)),e(f,{placeholder:"Select variable",size:"small",style:{width:"200px"},onChange:I},{default:n(()=>[(o(!0),l(h,null,g(a.variables,e=>(o(),y(m,{key:e.name,value:e.name},{default:n(()=>[d(u(e.name),1)]),_:2},1032,["value"]))),128))]),_:1})]),s("div",ze,[e(c(V)),s("span",null,u(z.value.length)+" variables used",1)])])]),C.value.length>0?(o(),l("div",je,[t[10]||(t[10]=s("h4",null,"Response Extractors",-1)),s("div",Ae,[(o(!0),l(h,null,g(C.value,(a,t)=>(o(),l("div",{key:`${a.name}-${a.type}-${t}`,class:"extractor-item"},[s("div",Ie,[s("code",Te,u(a.name),1),e(b,{size:"small"},{default:n(()=>[d(u(a.type),1)]),_:2},1024)]),e(p,{type:"text",danger:"",size:"small",onClick:e=>function(e){C.value.splice(e,1),_("update:extractors",C.value)}(t)},{default:n(()=>[e(c($))]),_:2},1032,["onClick"])]))),128))])])):i("",!0),s("div",Ue,[t[11]||(t[11]=s("h4",null,"Preview with First Row",-1)),e(T,{template:S.value,"tabular-data":a.spreadsheetData,cycling:!0,"cycling-paused":D.value,"show-controls":"pause-play","display-mode":"block","show-legend":!0,"onUpdate:cyclingPaused":t[2]||(t[2]=e=>D.value=e)},null,8,["template","tabular-data","cycling-paused"])]),e(O,{open:k.value,"onUpdate:open":t[6]||(t[6]=e=>k.value=e),title:"Add Response Extractor",onOk:U},{default:n(()=>[e(F,{layout:"vertical"},{default:n(()=>[e(N,{label:"Extractor Name"},{default:n(()=>[e(w,{value:E.value.name,"onUpdate:value":t[3]||(t[3]=e=>E.value.name=e),placeholder:"e.g., sentiment, category"},null,8,["value"])]),_:1}),e(N,{label:"Pattern Type"},{default:n(()=>[e(L,{value:E.value.type,"onUpdate:value":t[4]||(t[4]=e=>E.value.type=e)},{default:n(()=>[e(A,{value:"regex"},{default:n(()=>t[12]||(t[12]=[d("Regular Expression")])),_:1,__:[12]}),e(A,{value:"keyword"},{default:n(()=>t[13]||(t[13]=[d("Keyword Match")])),_:1,__:[13]})]),_:1},8,["value"])]),_:1}),e(N,{label:"Pattern"},{default:n(()=>[e(w,{value:E.value.pattern,"onUpdate:value":t[5]||(t[5]=e=>E.value.pattern=e),placeholder:"Enter pattern"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["open"])])}}}),[["__scopeId","data-v-cc00d961"]]);function Fe(){const e=t([]),{sanitizeColumnNames:a}=M();function l(e){const a=new Set;return e.forEach(e=>{if(null==e||""===e)return;const t=String(e).trim();isNaN(Number(t))||""===t?!function(e){const a=new Date(e);return!isNaN(a.getTime())&&null!==e.match(/\d{1,4}[-/]\d{1,2}[-/]\d{1,4}/)}(t)?a.add("text"):a.add("date"):a.add("number")}),0===a.size?"text":1===a.size?Array.from(a)[0]:"mixed"}return{availableVariables:e,generateVariableLists:function(e,t){N.info("generateVariableLists called with:",{columns:e,dataLength:t.length});const s=a(e);N.info("Sanitized columns:",s);const r=s.map((a,s)=>{const r=e[s],n=t.map(e=>e[r]),o=Array.from(new Set(n.filter(e=>null!=e&&""!==e))),i={name:a,type:l(n),uniqueCount:o.length,examples:o.slice(0,3).map(e=>String(e))};return N.info("Generated variable:",i),i});return N.info("All generated variables:",r),r},convertToVariableLists:function(e,a){const t={};return e.forEach(e=>{const l=a.map(a=>a[e.name]);t[e.name]={type:"simple",name:e.name,values:l}}),t},generateCombinations:function(e){return e}}}const Oe={class:"spreadsheet-view"},Re={class:"step-content"},Me={class:"import-step"},We={class:"design-step"},Ge={class:"design-layout"},He={class:"variables-panel"},Ke={key:0,class:"no-variables"},Be={class:"editor-panel"},Je={class:"step-actions"},Ze={class:"configure-step"},qe={class:"step-actions"},Ye=D(a({__name:"SpreadsheetView",setup(a){const p=x(),m=t(),f=t(0),h=t([]),g=t([]),S=t(""),k=t([]),E=t([]),{generateVariableLists:D}=Fe(),{generatedDesign:P,createDesignFromSpreadsheet:$}=function(){const e=z(),a=j(),l=t(null);return{generatedDesign:l,createDesignFromSpreadsheet:async function(t){try{const s=await a.createList({name:`${t.name} - Dataset`,description:"Imported spreadsheet data",category:"tabular",tabularData:{columns:t.variables.map(e=>e.name),rows:JSON.parse(JSON.stringify(t.data))},itemCount:t.data.length});if(!s)throw new Error("Failed to create tabular variable list");const r=await e.createSpreadsheet({name:t.name,description:"Created from spreadsheet import",promptPattern:t.prompt,datasetId:s,outputConfig:{outputType:"text",extractPattern:t.extractors.length>0?t.extractors[0].pattern:void 0,refusalWords:void 0,refusalWordsListRef:void 0,rejectRefusalWords:!1}});if(r){const a=await e.getSpreadsheet(r);return l.value=a||null,a||null}return null}catch(s){return N.error("Failed to create spreadsheet prompt from data:",s),null}},validatePromptVariables:function(e,a){const t=[...e.matchAll(/\{\{(\w+)\}\}/g)],l=[...new Set(t.map(e=>e[1]))],s=l.filter(e=>!a.includes(e)),r=a.filter(e=>!l.includes(e));return{valid:0===s.length,missingVariables:s,unusedVariables:r}}}}(),A=v(()=>{switch(f.value){case 0:return h.value.length>0&&g.value.length>0;case 1:return S.value.trim().length>0;case 2:return!0;default:return!1}}),I=v(()=>({currentStep:f.value,importedDataLength:h.value.length,detectedColumns:g.value,availableVariablesLength:E.value.length,availableVariables:E.value}));function T(e){h.value=e,C.success(`Imported ${e.length} rows`)}function L(e){N.info("SpreadsheetView: handleColumnsDetected called",{columns:e}),g.value=e;const a=D(e,h.value);N.info("SpreadsheetView: Generated variables",{generated:a}),E.value=a,N.info("SpreadsheetView: availableVariables set",{variables:E.value})}async function F(){if(0===f.value)f.value++;else if(1===f.value){const e=await $({name:`Spreadsheet Import - ${(new Date).toLocaleDateString()}`,prompt:S.value,extractors:k.value,variables:E.value,data:h.value});e&&(P.value=e,f.value++)}}function O(e){C.success("Trial created successfully!"),p.push(`/trials/${e}`)}function R(e){C.success("Trial created and started!"),p.push(`/trials/${e}`)}return(a,t)=>{const p=r("a-step"),v=r("a-steps"),x=r("a-button"),C=r("a-tooltip");return o(),l("div",Oe,[t[11]||(t[11]=s("div",{class:"page-header"},[s("div",{class:"header-content"},[s("h1",null,"Spreadsheet Import"),s("p",{class:"description"}," Import data from CSV/Excel and create prompts using column variables. Unlike classic designs that generate all variable combinations (cartesian product), spreadsheet designs execute one API call per row - perfect for specific test cases where each row represents a complete, explainable scenario. ")])],-1)),e(v,{current:f.value,class:"workflow-steps"},{default:n(()=>[e(p,{title:"Import Data",description:"Upload or paste spreadsheet data"}),e(p,{title:"Design Prompt",description:"Create template using variables"}),e(p,{title:"Configure Trial",description:"Select models and settings"})]),_:1},8,["current"]),s("div",Re,[w(s("div",Me,[e(Q,{onDataImported:T,onColumnsDetected:L}),h.value.length>0?(o(),y(ve,{key:0,data:h.value,columns:g.value,class:"preview-grid"},{actions:n(()=>[e(x,{type:"primary",size:"large",onClick:F,disabled:!A.value},{default:n(()=>t[5]||(t[5]=[d(" Next ")])),_:1,__:[5]},8,["disabled"])]),_:1},8,["data","columns"])):i("",!0)],512),[[_,0===f.value]]),w(s("div",We,[s("div",Ge,[s("div",He,[s("h3",null,[t[6]||(t[6]=d(" Available Variables ")),e(C,{title:"These variables are extracted from your spreadsheet columns. Click any variable to insert it into your prompt."},{default:n(()=>[e(c(V),{class:"info-icon"})]),_:1})]),0===E.value.length?(o(),l("div",Ke,[t[7]||(t[7]=s("p",null,"No variables detected. Please import data first.",-1)),s("pre",null,u(JSON.stringify(I.value,null,2)),1)])):(o(),y(Ee,{key:1,variables:E.value,onInsertVariable:t[0]||(t[0]=e=>{c(N).info("SpreadsheetView: Received insert-variable event",{variable:e}),function(e){if(N.info("Inserting variable",{variable:e}),!m.value)return N.error("Design editor ref not available"),void b(()=>{m.value?m.value.insertVariable(e):N.error("Design editor ref still not available after nextTick")});m.value.insertVariable(e)}(e)})},null,8,["variables"]))]),s("div",Be,[e(Le,{ref_key:"designEditor",ref:m,prompt:S.value,"onUpdate:prompt":t[1]||(t[1]=e=>S.value=e),extractors:k.value,"onUpdate:extractors":t[2]||(t[2]=e=>k.value=e),variables:E.value,"spreadsheet-data":h.value},null,8,["prompt","extractors","variables","spreadsheet-data"])])]),s("div",Je,[e(x,{size:"large",onClick:t[3]||(t[3]=e=>f.value--)},{default:n(()=>t[8]||(t[8]=[d(" Previous ")])),_:1,__:[8]}),e(x,{type:"primary",size:"large",onClick:F,disabled:!A.value},{default:n(()=>t[9]||(t[9]=[d(" Next ")])),_:1,__:[9]},8,["disabled"])])],512),[[_,1===f.value]]),w(s("div",Ze,[c(P)?(o(),y(U,{key:`trial-creation-${c(P).id}`,"initial-prompt-source":{type:"spreadsheet",id:c(P).id},"is-tab-mode":!0,class:"trial-creation-wrapper",onCreated:O,onCreatedAndStarted:R},null,8,["initial-prompt-source"])):i("",!0),s("div",qe,[e(x,{size:"large",onClick:t[4]||(t[4]=e=>f.value--)},{default:n(()=>t[10]||(t[10]=[d(" Previous ")])),_:1,__:[10]})])],512),[[_,2===f.value]])])])}}}),[["__scopeId","data-v-a53e372a"]]);export{Ye as default};
